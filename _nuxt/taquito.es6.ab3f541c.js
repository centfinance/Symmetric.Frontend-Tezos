import{$ as Kr,aB as wi,bZ as Ec,b_ as Gl,b$ as Kl,aA as nt}from"./entry.782333c1.js";var Fl=/^-?(?:\d+(?:\.\d*)?|\.\d+)(?:e[+-]?\d+)?$/i,ji=Math.ceil,ye=Math.floor,Yt="[BigNumber Error] ",Fo=Yt+"Number primitive has more than 15 significant digits: ",de=1e14,q=14,Vi=9007199254740991,Gi=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9,1e10,1e11,1e12,1e13],ar=1e7,Nt=1e9;function vc(r){var t,e,n,i=S.prototype={constructor:S,toString:null,valueOf:null},s=new S(1),o=20,a=4,u=-7,p=21,f=-1e7,m=1e7,N=!1,T=1,x=0,B={prefix:"",groupSize:3,secondaryGroupSize:0,groupSeparator:",",decimalSeparator:".",fractionGroupSize:0,fractionGroupSeparator:"Â ",suffix:""},C="0123456789abcdefghijklmnopqrstuvwxyz",L=!0;function S(h,g){var l,v,b,_,R,w,c,d,E=this;if(!(E instanceof S))return new S(h,g);if(g==null){if(h&&h._isBigNumber===!0){E.s=h.s,!h.c||h.e>m?E.c=E.e=null:h.e<f?E.c=[E.e=0]:(E.e=h.e,E.c=h.c.slice());return}if((w=typeof h=="number")&&h*0==0){if(E.s=1/h<0?(h=-h,-1):1,h===~~h){for(_=0,R=h;R>=10;R/=10,_++);_>m?E.c=E.e=null:(E.e=_,E.c=[h]);return}d=String(h)}else{if(!Fl.test(d=String(h)))return n(E,d,w);E.s=d.charCodeAt(0)==45?(d=d.slice(1),-1):1}(_=d.indexOf("."))>-1&&(d=d.replace(".","")),(R=d.search(/e/i))>0?(_<0&&(_=R),_+=+d.slice(R+1),d=d.substring(0,R)):_<0&&(_=d.length)}else{if(ft(g,2,C.length,"Base"),g==10&&L)return E=new S(h),st(E,o+E.e+1,a);if(d=String(h),w=typeof h=="number"){if(h*0!=0)return n(E,d,w,g);if(E.s=1/h<0?(d=d.slice(1),-1):1,S.DEBUG&&d.replace(/^0\.0*|\./,"").length>15)throw Error(Fo+h)}else E.s=d.charCodeAt(0)===45?(d=d.slice(1),-1):1;for(l=C.slice(0,g),_=R=0,c=d.length;R<c;R++)if(l.indexOf(v=d.charAt(R))<0){if(v=="."){if(R>_){_=c;continue}}else if(!b&&(d==d.toUpperCase()&&(d=d.toLowerCase())||d==d.toLowerCase()&&(d=d.toUpperCase()))){b=!0,R=-1,_=0;continue}return n(E,String(h),w,g)}w=!1,d=e(d,g,10,E.s),(_=d.indexOf("."))>-1?d=d.replace(".",""):_=d.length}for(R=0;d.charCodeAt(R)===48;R++);for(c=d.length;d.charCodeAt(--c)===48;);if(d=d.slice(R,++c)){if(c-=R,w&&S.DEBUG&&c>15&&(h>Vi||h!==ye(h)))throw Error(Fo+E.s*h);if((_=_-R-1)>m)E.c=E.e=null;else if(_<f)E.c=[E.e=0];else{if(E.e=_,E.c=[],R=(_+1)%q,_<0&&(R+=q),R<c){for(R&&E.c.push(+d.slice(0,R)),c-=q;R<c;)E.c.push(+d.slice(R,R+=q));R=q-(d=d.slice(R)).length}else R-=c;for(;R--;d+="0");E.c.push(+d)}}else E.c=[E.e=0]}S.clone=vc,S.ROUND_UP=0,S.ROUND_DOWN=1,S.ROUND_CEIL=2,S.ROUND_FLOOR=3,S.ROUND_HALF_UP=4,S.ROUND_HALF_DOWN=5,S.ROUND_HALF_EVEN=6,S.ROUND_HALF_CEIL=7,S.ROUND_HALF_FLOOR=8,S.EUCLID=9,S.config=S.set=function(h){var g,l;if(h!=null)if(typeof h=="object"){if(h.hasOwnProperty(g="DECIMAL_PLACES")&&(l=h[g],ft(l,0,Nt,g),o=l),h.hasOwnProperty(g="ROUNDING_MODE")&&(l=h[g],ft(l,0,8,g),a=l),h.hasOwnProperty(g="EXPONENTIAL_AT")&&(l=h[g],l&&l.pop?(ft(l[0],-Nt,0,g),ft(l[1],0,Nt,g),u=l[0],p=l[1]):(ft(l,-Nt,Nt,g),u=-(p=l<0?-l:l))),h.hasOwnProperty(g="RANGE"))if(l=h[g],l&&l.pop)ft(l[0],-Nt,-1,g),ft(l[1],1,Nt,g),f=l[0],m=l[1];else if(ft(l,-Nt,Nt,g),l)f=-(m=l<0?-l:l);else throw Error(Yt+g+" cannot be zero: "+l);if(h.hasOwnProperty(g="CRYPTO"))if(l=h[g],l===!!l)if(l)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))N=l;else throw N=!l,Error(Yt+"crypto unavailable");else N=l;else throw Error(Yt+g+" not true or false: "+l);if(h.hasOwnProperty(g="MODULO_MODE")&&(l=h[g],ft(l,0,9,g),T=l),h.hasOwnProperty(g="POW_PRECISION")&&(l=h[g],ft(l,0,Nt,g),x=l),h.hasOwnProperty(g="FORMAT"))if(l=h[g],typeof l=="object")B=l;else throw Error(Yt+g+" not an object: "+l);if(h.hasOwnProperty(g="ALPHABET"))if(l=h[g],typeof l=="string"&&!/^.?$|[+\-.\s]|(.).*\1/.test(l))L=l.slice(0,10)=="0123456789",C=l;else throw Error(Yt+g+" invalid: "+l)}else throw Error(Yt+"Object expected: "+h);return{DECIMAL_PLACES:o,ROUNDING_MODE:a,EXPONENTIAL_AT:[u,p],RANGE:[f,m],CRYPTO:N,MODULO_MODE:T,POW_PRECISION:x,FORMAT:B,ALPHABET:C}},S.isBigNumber=function(h){if(!h||h._isBigNumber!==!0)return!1;if(!S.DEBUG)return!0;var g,l,v=h.c,b=h.e,_=h.s;t:if({}.toString.call(v)=="[object Array]"){if((_===1||_===-1)&&b>=-Nt&&b<=Nt&&b===ye(b)){if(v[0]===0){if(b===0&&v.length===1)return!0;break t}if(g=(b+1)%q,g<1&&(g+=q),String(v[0]).length==g){for(g=0;g<v.length;g++)if(l=v[g],l<0||l>=de||l!==ye(l))break t;if(l!==0)return!0}}}else if(v===null&&b===null&&(_===null||_===1||_===-1))return!0;throw Error(Yt+"Invalid BigNumber: "+h)},S.maximum=S.max=function(){return H(arguments,i.lt)},S.minimum=S.min=function(){return H(arguments,i.gt)},S.random=function(){var h=9007199254740992,g=Math.random()*h&2097151?function(){return ye(Math.random()*h)}:function(){return(Math.random()*1073741824|0)*8388608+(Math.random()*8388608|0)};return function(l){var v,b,_,R,w,c=0,d=[],E=new S(s);if(l==null?l=o:ft(l,0,Nt),R=ji(l/q),N)if(crypto.getRandomValues){for(v=crypto.getRandomValues(new Uint32Array(R*=2));c<R;)w=v[c]*131072+(v[c+1]>>>11),w>=9e15?(b=crypto.getRandomValues(new Uint32Array(2)),v[c]=b[0],v[c+1]=b[1]):(d.push(w%1e14),c+=2);c=R/2}else if(crypto.randomBytes){for(v=crypto.randomBytes(R*=7);c<R;)w=(v[c]&31)*281474976710656+v[c+1]*1099511627776+v[c+2]*4294967296+v[c+3]*16777216+(v[c+4]<<16)+(v[c+5]<<8)+v[c+6],w>=9e15?crypto.randomBytes(7).copy(v,c):(d.push(w%1e14),c+=7);c=R/7}else throw N=!1,Error(Yt+"crypto unavailable");if(!N)for(;c<R;)w=g(),w<9e15&&(d[c++]=w%1e14);for(R=d[--c],l%=q,R&&l&&(w=Gi[q-l],d[c]=ye(R/w)*w);d[c]===0;d.pop(),c--);if(c<0)d=[_=0];else{for(_=-1;d[0]===0;d.splice(0,1),_-=q);for(c=1,w=d[0];w>=10;w/=10,c++);c<q&&(_-=q-c)}return E.e=_,E.c=d,E}}(),S.sum=function(){for(var h=1,g=arguments,l=new S(g[0]);h<g.length;)l=l.plus(g[h++]);return l},e=function(){var h="0123456789";function g(l,v,b,_){for(var R,w=[0],c,d=0,E=l.length;d<E;){for(c=w.length;c--;w[c]*=v);for(w[0]+=_.indexOf(l.charAt(d++)),R=0;R<w.length;R++)w[R]>b-1&&(w[R+1]==null&&(w[R+1]=0),w[R+1]+=w[R]/b|0,w[R]%=b)}return w.reverse()}return function(l,v,b,_,R){var w,c,d,E,P,D,M,G,lt=l.indexOf("."),bt=o,X=a;for(lt>=0&&(E=x,x=0,l=l.replace(".",""),G=new S(v),D=G.pow(l.length-lt),x=E,G.c=g(Ke(ue(D.c),D.e,"0"),10,b,h),G.e=G.c.length),M=g(l,v,b,R?(w=C,h):(w=h,C)),d=E=M.length;M[--E]==0;M.pop());if(!M[0])return w.charAt(0);if(lt<0?--d:(D.c=M,D.e=d,D.s=_,D=t(D,G,bt,X,b),M=D.c,P=D.r,d=D.e),c=d+bt+1,lt=M[c],E=b/2,P=P||c<0||M[c+1]!=null,P=X<4?(lt!=null||P)&&(X==0||X==(D.s<0?3:2)):lt>E||lt==E&&(X==4||P||X==6&&M[c-1]&1||X==(D.s<0?8:7)),c<1||!M[0])l=P?Ke(w.charAt(1),-bt,w.charAt(0)):w.charAt(0);else{if(M.length=c,P)for(--b;++M[--c]>b;)M[c]=0,c||(++d,M=[1].concat(M));for(E=M.length;!M[--E];);for(lt=0,l="";lt<=E;l+=w.charAt(M[lt++]));l=Ke(l,d,w.charAt(0))}return l}}(),t=function(){function h(v,b,_){var R,w,c,d,E=0,P=v.length,D=b%ar,M=b/ar|0;for(v=v.slice();P--;)c=v[P]%ar,d=v[P]/ar|0,R=M*c+d*D,w=D*c+R%ar*ar+E,E=(w/_|0)+(R/ar|0)+M*d,v[P]=w%_;return E&&(v=[E].concat(v)),v}function g(v,b,_,R){var w,c;if(_!=R)c=_>R?1:-1;else for(w=c=0;w<_;w++)if(v[w]!=b[w]){c=v[w]>b[w]?1:-1;break}return c}function l(v,b,_,R){for(var w=0;_--;)v[_]-=w,w=v[_]<b[_]?1:0,v[_]=w*R+v[_]-b[_];for(;!v[0]&&v.length>1;v.splice(0,1));}return function(v,b,_,R,w){var c,d,E,P,D,M,G,lt,bt,X,ut,kt,kn,Hi,$i,me,hn,ce=v.s==b.s?1:-1,Ft=v.c,Et=b.c;if(!Ft||!Ft[0]||!Et||!Et[0])return new S(!v.s||!b.s||(Ft?Et&&Ft[0]==Et[0]:!Et)?NaN:Ft&&Ft[0]==0||!Et?ce*0:ce/0);for(lt=new S(ce),bt=lt.c=[],d=v.e-b.e,ce=_+d+1,w||(w=de,d=le(v.e/q)-le(b.e/q),ce=ce/q|0),E=0;Et[E]==(Ft[E]||0);E++);if(Et[E]>(Ft[E]||0)&&d--,ce<0)bt.push(1),P=!0;else{for(Hi=Ft.length,me=Et.length,E=0,ce+=2,D=ye(w/(Et[0]+1)),D>1&&(Et=h(Et,D,w),Ft=h(Ft,D,w),me=Et.length,Hi=Ft.length),kn=me,X=Ft.slice(0,me),ut=X.length;ut<me;X[ut++]=0);hn=Et.slice(),hn=[0].concat(hn),$i=Et[0],Et[1]>=w/2&&$i++;do{if(D=0,c=g(Et,X,me,ut),c<0){if(kt=X[0],me!=ut&&(kt=kt*w+(X[1]||0)),D=ye(kt/$i),D>1)for(D>=w&&(D=w-1),M=h(Et,D,w),G=M.length,ut=X.length;g(M,X,G,ut)==1;)D--,l(M,me<G?hn:Et,G,w),G=M.length,c=1;else D==0&&(c=D=1),M=Et.slice(),G=M.length;if(G<ut&&(M=[0].concat(M)),l(X,M,ut,w),ut=X.length,c==-1)for(;g(Et,X,me,ut)<1;)D++,l(X,me<ut?hn:Et,ut,w),ut=X.length}else c===0&&(D++,X=[0]);bt[E++]=D,X[0]?X[ut++]=Ft[kn]||0:(X=[Ft[kn]],ut=1)}while((kn++<Hi||X[0]!=null)&&ce--);P=X[0]!=null,bt[0]||bt.splice(0,1)}if(w==de){for(E=1,ce=bt[0];ce>=10;ce/=10,E++);st(lt,_+(lt.e=E+d*q-1)+1,R,P)}else lt.e=d,lt.r=+P;return lt}}();function yt(h,g,l,v){var b,_,R,w,c;if(l==null?l=a:ft(l,0,8),!h.c)return h.toString();if(b=h.c[0],R=h.e,g==null)c=ue(h.c),c=v==1||v==2&&(R<=u||R>=p)?Un(c,R):Ke(c,R,"0");else if(h=st(new S(h),g,l),_=h.e,c=ue(h.c),w=c.length,v==1||v==2&&(g<=_||_<=u)){for(;w<g;c+="0",w++);c=Un(c,_)}else if(g-=R,c=Ke(c,_,"0"),_+1>w){if(--g>0)for(c+=".";g--;c+="0");}else if(g+=_-w,g>0)for(_+1==w&&(c+=".");g--;c+="0");return h.s<0&&b?"-"+c:c}function H(h,g){for(var l,v=1,b=new S(h[0]);v<h.length;v++)if(l=new S(h[v]),l.s)g.call(b,l)&&(b=l);else{b=l;break}return b}function Lt(h,g,l){for(var v=1,b=g.length;!g[--b];g.pop());for(b=g[0];b>=10;b/=10,v++);return(l=v+l*q-1)>m?h.c=h.e=null:l<f?h.c=[h.e=0]:(h.e=l,h.c=g),h}n=function(){var h=/^(-?)0([xbo])(?=\w[\w.]*$)/i,g=/^([^.]+)\.$/,l=/^\.([^.]+)$/,v=/^-?(Infinity|NaN)$/,b=/^\s*\+(?=[\w.])|^\s+|\s+$/g;return function(_,R,w,c){var d,E=w?R:R.replace(b,"");if(v.test(E))_.s=isNaN(E)?null:E<0?-1:1;else{if(!w&&(E=E.replace(h,function(P,D,M){return d=(M=M.toLowerCase())=="x"?16:M=="b"?2:8,!c||c==d?D:P}),c&&(d=c,E=E.replace(g,"$1").replace(l,"0.$1")),R!=E))return new S(E,d);if(S.DEBUG)throw Error(Yt+"Not a"+(c?" base "+c:"")+" number: "+R);_.s=null}_.c=_.e=null}}();function st(h,g,l,v){var b,_,R,w,c,d,E,P=h.c,D=Gi;if(P){t:{for(b=1,w=P[0];w>=10;w/=10,b++);if(_=g-b,_<0)_+=q,R=g,c=P[d=0],E=c/D[b-R-1]%10|0;else if(d=ji((_+1)/q),d>=P.length)if(v){for(;P.length<=d;P.push(0));c=E=0,b=1,_%=q,R=_-q+1}else break t;else{for(c=w=P[d],b=1;w>=10;w/=10,b++);_%=q,R=_-q+b,E=R<0?0:c/D[b-R-1]%10|0}if(v=v||g<0||P[d+1]!=null||(R<0?c:c%D[b-R-1]),v=l<4?(E||v)&&(l==0||l==(h.s<0?3:2)):E>5||E==5&&(l==4||v||l==6&&(_>0?R>0?c/D[b-R]:0:P[d-1])%10&1||l==(h.s<0?8:7)),g<1||!P[0])return P.length=0,v?(g-=h.e+1,P[0]=D[(q-g%q)%q],h.e=-g||0):P[0]=h.e=0,h;if(_==0?(P.length=d,w=1,d--):(P.length=d+1,w=D[q-_],P[d]=R>0?ye(c/D[b-R]%D[R])*w:0),v)for(;;)if(d==0){for(_=1,R=P[0];R>=10;R/=10,_++);for(R=P[0]+=w,w=1;R>=10;R/=10,w++);_!=w&&(h.e++,P[0]==de&&(P[0]=1));break}else{if(P[d]+=w,P[d]!=de)break;P[d--]=0,w=1}for(_=P.length;P[--_]===0;P.pop());}h.e>m?h.c=h.e=null:h.e<f&&(h.c=[h.e=0])}return h}function J(h){var g,l=h.e;return l===null?h.toString():(g=ue(h.c),g=l<=u||l>=p?Un(g,l):Ke(g,l,"0"),h.s<0?"-"+g:g)}return i.absoluteValue=i.abs=function(){var h=new S(this);return h.s<0&&(h.s=1),h},i.comparedTo=function(h,g){return $r(this,new S(h,g))},i.decimalPlaces=i.dp=function(h,g){var l,v,b,_=this;if(h!=null)return ft(h,0,Nt),g==null?g=a:ft(g,0,8),st(new S(_),h+_.e+1,g);if(!(l=_.c))return null;if(v=((b=l.length-1)-le(this.e/q))*q,b=l[b])for(;b%10==0;b/=10,v--);return v<0&&(v=0),v},i.dividedBy=i.div=function(h,g){return t(this,new S(h,g),o,a)},i.dividedToIntegerBy=i.idiv=function(h,g){return t(this,new S(h,g),0,1)},i.exponentiatedBy=i.pow=function(h,g){var l,v,b,_,R,w,c,d,E,P=this;if(h=new S(h),h.c&&!h.isInteger())throw Error(Yt+"Exponent not an integer: "+J(h));if(g!=null&&(g=new S(g)),w=h.e>14,!P.c||!P.c[0]||P.c[0]==1&&!P.e&&P.c.length==1||!h.c||!h.c[0])return E=new S(Math.pow(+J(P),w?h.s*(2-Bn(h)):+J(h))),g?E.mod(g):E;if(c=h.s<0,g){if(g.c?!g.c[0]:!g.s)return new S(NaN);v=!c&&P.isInteger()&&g.isInteger(),v&&(P=P.mod(g))}else{if(h.e>9&&(P.e>0||P.e<-1||(P.e==0?P.c[0]>1||w&&P.c[1]>=24e7:P.c[0]<8e13||w&&P.c[0]<=9999975e7)))return _=P.s<0&&Bn(h)?-0:0,P.e>-1&&(_=1/_),new S(c?1/_:_);x&&(_=ji(x/q+2))}for(w?(l=new S(.5),c&&(h.s=1),d=Bn(h)):(b=Math.abs(+J(h)),d=b%2),E=new S(s);;){if(d){if(E=E.times(P),!E.c)break;_?E.c.length>_&&(E.c.length=_):v&&(E=E.mod(g))}if(b){if(b=ye(b/2),b===0)break;d=b%2}else if(h=h.times(l),st(h,h.e+1,1),h.e>14)d=Bn(h);else{if(b=+J(h),b===0)break;d=b%2}P=P.times(P),_?P.c&&P.c.length>_&&(P.c.length=_):v&&(P=P.mod(g))}return v?E:(c&&(E=s.div(E)),g?E.mod(g):_?st(E,x,a,R):E)},i.integerValue=function(h){var g=new S(this);return h==null?h=a:ft(h,0,8),st(g,g.e+1,h)},i.isEqualTo=i.eq=function(h,g){return $r(this,new S(h,g))===0},i.isFinite=function(){return!!this.c},i.isGreaterThan=i.gt=function(h,g){return $r(this,new S(h,g))>0},i.isGreaterThanOrEqualTo=i.gte=function(h,g){return(g=$r(this,new S(h,g)))===1||g===0},i.isInteger=function(){return!!this.c&&le(this.e/q)>this.c.length-2},i.isLessThan=i.lt=function(h,g){return $r(this,new S(h,g))<0},i.isLessThanOrEqualTo=i.lte=function(h,g){return(g=$r(this,new S(h,g)))===-1||g===0},i.isNaN=function(){return!this.s},i.isNegative=function(){return this.s<0},i.isPositive=function(){return this.s>0},i.isZero=function(){return!!this.c&&this.c[0]==0},i.minus=function(h,g){var l,v,b,_,R=this,w=R.s;if(h=new S(h,g),g=h.s,!w||!g)return new S(NaN);if(w!=g)return h.s=-g,R.plus(h);var c=R.e/q,d=h.e/q,E=R.c,P=h.c;if(!c||!d){if(!E||!P)return E?(h.s=-g,h):new S(P?R:NaN);if(!E[0]||!P[0])return P[0]?(h.s=-g,h):new S(E[0]?R:a==3?-0:0)}if(c=le(c),d=le(d),E=E.slice(),w=c-d){for((_=w<0)?(w=-w,b=E):(d=c,b=P),b.reverse(),g=w;g--;b.push(0));b.reverse()}else for(v=(_=(w=E.length)<(g=P.length))?w:g,w=g=0;g<v;g++)if(E[g]!=P[g]){_=E[g]<P[g];break}if(_&&(b=E,E=P,P=b,h.s=-h.s),g=(v=P.length)-(l=E.length),g>0)for(;g--;E[l++]=0);for(g=de-1;v>w;){if(E[--v]<P[v]){for(l=v;l&&!E[--l];E[l]=g);--E[l],E[v]+=de}E[v]-=P[v]}for(;E[0]==0;E.splice(0,1),--d);return E[0]?Lt(h,E,d):(h.s=a==3?-1:1,h.c=[h.e=0],h)},i.modulo=i.mod=function(h,g){var l,v,b=this;return h=new S(h,g),!b.c||!h.s||h.c&&!h.c[0]?new S(NaN):!h.c||b.c&&!b.c[0]?new S(b):(T==9?(v=h.s,h.s=1,l=t(b,h,0,3),h.s=v,l.s*=v):l=t(b,h,0,T),h=b.minus(l.times(h)),!h.c[0]&&T==1&&(h.s=b.s),h)},i.multipliedBy=i.times=function(h,g){var l,v,b,_,R,w,c,d,E,P,D,M,G,lt,bt,X=this,ut=X.c,kt=(h=new S(h,g)).c;if(!ut||!kt||!ut[0]||!kt[0])return!X.s||!h.s||ut&&!ut[0]&&!kt||kt&&!kt[0]&&!ut?h.c=h.e=h.s=null:(h.s*=X.s,!ut||!kt?h.c=h.e=null:(h.c=[0],h.e=0)),h;for(v=le(X.e/q)+le(h.e/q),h.s*=X.s,c=ut.length,P=kt.length,c<P&&(G=ut,ut=kt,kt=G,b=c,c=P,P=b),b=c+P,G=[];b--;G.push(0));for(lt=de,bt=ar,b=P;--b>=0;){for(l=0,D=kt[b]%bt,M=kt[b]/bt|0,R=c,_=b+R;_>b;)d=ut[--R]%bt,E=ut[R]/bt|0,w=M*d+E*D,d=D*d+w%bt*bt+G[_]+l,l=(d/lt|0)+(w/bt|0)+M*E,G[_--]=d%lt;G[_]=l}return l?++v:G.splice(0,1),Lt(h,G,v)},i.negated=function(){var h=new S(this);return h.s=-h.s||null,h},i.plus=function(h,g){var l,v=this,b=v.s;if(h=new S(h,g),g=h.s,!b||!g)return new S(NaN);if(b!=g)return h.s=-g,v.minus(h);var _=v.e/q,R=h.e/q,w=v.c,c=h.c;if(!_||!R){if(!w||!c)return new S(b/0);if(!w[0]||!c[0])return c[0]?h:new S(w[0]?v:b*0)}if(_=le(_),R=le(R),w=w.slice(),b=_-R){for(b>0?(R=_,l=c):(b=-b,l=w),l.reverse();b--;l.push(0));l.reverse()}for(b=w.length,g=c.length,b-g<0&&(l=c,c=w,w=l,g=b),b=0;g;)b=(w[--g]=w[g]+c[g]+b)/de|0,w[g]=de===w[g]?0:w[g]%de;return b&&(w=[b].concat(w),++R),Lt(h,w,R)},i.precision=i.sd=function(h,g){var l,v,b,_=this;if(h!=null&&h!==!!h)return ft(h,1,Nt),g==null?g=a:ft(g,0,8),st(new S(_),h,g);if(!(l=_.c))return null;if(b=l.length-1,v=b*q+1,b=l[b]){for(;b%10==0;b/=10,v--);for(b=l[0];b>=10;b/=10,v++);}return h&&_.e+1>v&&(v=_.e+1),v},i.shiftedBy=function(h){return ft(h,-Vi,Vi),this.times("1e"+h)},i.squareRoot=i.sqrt=function(){var h,g,l,v,b,_=this,R=_.c,w=_.s,c=_.e,d=o+4,E=new S("0.5");if(w!==1||!R||!R[0])return new S(!w||w<0&&(!R||R[0])?NaN:R?_:1/0);if(w=Math.sqrt(+J(_)),w==0||w==1/0?(g=ue(R),(g.length+c)%2==0&&(g+="0"),w=Math.sqrt(+g),c=le((c+1)/2)-(c<0||c%2),w==1/0?g="5e"+c:(g=w.toExponential(),g=g.slice(0,g.indexOf("e")+1)+c),l=new S(g)):l=new S(w+""),l.c[0]){for(c=l.e,w=c+d,w<3&&(w=0);;)if(b=l,l=E.times(b.plus(t(_,b,d,1))),ue(b.c).slice(0,w)===(g=ue(l.c)).slice(0,w))if(l.e<c&&--w,g=g.slice(w-3,w+1),g=="9999"||!v&&g=="4999"){if(!v&&(st(b,b.e+o+2,0),b.times(b).eq(_))){l=b;break}d+=4,w+=4,v=1}else{(!+g||!+g.slice(1)&&g.charAt(0)=="5")&&(st(l,l.e+o+2,1),h=!l.times(l).eq(_));break}}return st(l,l.e+o+1,a,h)},i.toExponential=function(h,g){return h!=null&&(ft(h,0,Nt),h++),yt(this,h,g,1)},i.toFixed=function(h,g){return h!=null&&(ft(h,0,Nt),h=h+this.e+1),yt(this,h,g)},i.toFormat=function(h,g,l){var v,b=this;if(l==null)h!=null&&g&&typeof g=="object"?(l=g,g=null):h&&typeof h=="object"?(l=h,h=g=null):l=B;else if(typeof l!="object")throw Error(Yt+"Argument not an object: "+l);if(v=b.toFixed(h,g),b.c){var _,R=v.split("."),w=+l.groupSize,c=+l.secondaryGroupSize,d=l.groupSeparator||"",E=R[0],P=R[1],D=b.s<0,M=D?E.slice(1):E,G=M.length;if(c&&(_=w,w=c,c=_,G-=_),w>0&&G>0){for(_=G%w||w,E=M.substr(0,_);_<G;_+=w)E+=d+M.substr(_,w);c>0&&(E+=d+M.slice(_)),D&&(E="-"+E)}v=P?E+(l.decimalSeparator||"")+((c=+l.fractionGroupSize)?P.replace(new RegExp("\\d{"+c+"}\\B","g"),"$&"+(l.fractionGroupSeparator||"")):P):E}return(l.prefix||"")+v+(l.suffix||"")},i.toFraction=function(h){var g,l,v,b,_,R,w,c,d,E,P,D,M=this,G=M.c;if(h!=null&&(w=new S(h),!w.isInteger()&&(w.c||w.s!==1)||w.lt(s)))throw Error(Yt+"Argument "+(w.isInteger()?"out of range: ":"not an integer: ")+J(w));if(!G)return new S(M);for(g=new S(s),d=l=new S(s),v=c=new S(s),D=ue(G),_=g.e=D.length-M.e-1,g.c[0]=Gi[(R=_%q)<0?q+R:R],h=!h||w.comparedTo(g)>0?_>0?g:d:w,R=m,m=1/0,w=new S(D),c.c[0]=0;E=t(w,g,0,1),b=l.plus(E.times(v)),b.comparedTo(h)!=1;)l=v,v=b,d=c.plus(E.times(b=d)),c=b,g=w.minus(E.times(b=g)),w=b;return b=t(h.minus(l),v,0,1),c=c.plus(b.times(d)),l=l.plus(b.times(v)),c.s=d.s=M.s,_=_*2,P=t(d,v,_,a).minus(M).abs().comparedTo(t(c,l,_,a).minus(M).abs())<1?[d,v]:[c,l],m=R,P},i.toNumber=function(){return+J(this)},i.toPrecision=function(h,g){return h!=null&&ft(h,1,Nt),yt(this,h,g,2)},i.toString=function(h){var g,l=this,v=l.s,b=l.e;return b===null?v?(g="Infinity",v<0&&(g="-"+g)):g="NaN":(h==null?g=b<=u||b>=p?Un(ue(l.c),b):Ke(ue(l.c),b,"0"):h===10&&L?(l=st(new S(l),o+b+1,a),g=Ke(ue(l.c),l.e,"0")):(ft(h,2,C.length,"Base"),g=e(Ke(ue(l.c),b,"0"),10,h,v,!0)),v<0&&l.c[0]&&(g="-"+g)),g},i.valueOf=i.toJSON=function(){return J(this)},i._isBigNumber=!0,i[Symbol.toStringTag]="BigNumber",i[Symbol.for("nodejs.util.inspect.custom")]=i.valueOf,r!=null&&S.set(r),S}function le(r){var t=r|0;return r>0||r===t?t:t-1}function ue(r){for(var t,e,n=1,i=r.length,s=r[0]+"";n<i;){for(t=r[n++]+"",e=q-t.length;e--;t="0"+t);s+=t}for(i=s.length;s.charCodeAt(--i)===48;);return s.slice(0,i+1||1)}function $r(r,t){var e,n,i=r.c,s=t.c,o=r.s,a=t.s,u=r.e,p=t.e;if(!o||!a)return null;if(e=i&&!i[0],n=s&&!s[0],e||n)return e?n?0:-a:o;if(o!=a)return o;if(e=o<0,n=u==p,!i||!s)return n?0:!i^e?1:-1;if(!n)return u>p^e?1:-1;for(a=(u=i.length)<(p=s.length)?u:p,o=0;o<a;o++)if(i[o]!=s[o])return i[o]>s[o]^e?1:-1;return u==p?0:u>p^e?1:-1}function ft(r,t,e,n){if(r<t||r>e||r!==ye(r))throw Error(Yt+(n||"Argument")+(typeof r=="number"?r<t||r>e?" out of range: ":" not an integer: ":" not a primitive number: ")+String(r))}function Bn(r){var t=r.c.length-1;return le(r.e/q)==t&&r.c[t]%2!=0}function Un(r,t){return(r.length>1?r.charAt(0)+"."+r.slice(1):r)+(t<0?"e":"e+")+t}function Ke(r,t,e){var n,i;if(t<0){for(i=e+".";++t;i+=e);r=i+r}else if(n=r.length,++t>n){for(i=e,t-=n;--t;i+=e);r+=i}else t<n&&(r=r.slice(0,t)+"."+r.slice(t));return r}var U=vc(),Hs={exports:{}},wc=function(t,e){return function(){for(var i=new Array(arguments.length),s=0;s<i.length;s++)i[s]=arguments[s];return t.apply(e,i)}},zl=wc,Or=Object.prototype.toString;function $s(r){return Array.isArray(r)}function bs(r){return typeof r>"u"}function ql(r){return r!==null&&!bs(r)&&r.constructor!==null&&!bs(r.constructor)&&typeof r.constructor.isBuffer=="function"&&r.constructor.isBuffer(r)}function _c(r){return Or.call(r)==="[object ArrayBuffer]"}function Wl(r){return Or.call(r)==="[object FormData]"}function Zl(r){var t;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?t=ArrayBuffer.isView(r):t=r&&r.buffer&&_c(r.buffer),t}function Yl(r){return typeof r=="string"}function Xl(r){return typeof r=="number"}function Ac(r){return r!==null&&typeof r=="object"}function Jn(r){if(Or.call(r)!=="[object Object]")return!1;var t=Object.getPrototypeOf(r);return t===null||t===Object.prototype}function Jl(r){return Or.call(r)==="[object Date]"}function Ql(r){return Or.call(r)==="[object File]"}function th(r){return Or.call(r)==="[object Blob]"}function Sc(r){return Or.call(r)==="[object Function]"}function eh(r){return Ac(r)&&Sc(r.pipe)}function rh(r){return Or.call(r)==="[object URLSearchParams]"}function nh(r){return r.trim?r.trim():r.replace(/^\s+|\s+$/g,"")}function ih(){return typeof navigator<"u"&&(navigator.product==="ReactNative"||navigator.product==="NativeScript"||navigator.product==="NS")?!1:typeof window<"u"&&typeof document<"u"}function js(r,t){if(!(r===null||typeof r>"u"))if(typeof r!="object"&&(r=[r]),$s(r))for(var e=0,n=r.length;e<n;e++)t.call(null,r[e],e,r);else for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&t.call(null,r[i],i,r)}function Es(){var r={};function t(i,s){Jn(r[s])&&Jn(i)?r[s]=Es(r[s],i):Jn(i)?r[s]=Es({},i):$s(i)?r[s]=i.slice():r[s]=i}for(var e=0,n=arguments.length;e<n;e++)js(arguments[e],t);return r}function sh(r,t,e){return js(t,function(i,s){e&&typeof i=="function"?r[s]=zl(i,e):r[s]=i}),r}function oh(r){return r.charCodeAt(0)===65279&&(r=r.slice(1)),r}var Qt={isArray:$s,isArrayBuffer:_c,isBuffer:ql,isFormData:Wl,isArrayBufferView:Zl,isString:Yl,isNumber:Xl,isObject:Ac,isPlainObject:Jn,isUndefined:bs,isDate:Jl,isFile:Ql,isBlob:th,isFunction:Sc,isStream:eh,isURLSearchParams:rh,isStandardBrowserEnv:ih,forEach:js,merge:Es,extend:sh,trim:nh,stripBOM:oh},jr=Qt;function zo(r){return encodeURIComponent(r).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}var Rc=function(t,e,n){if(!e)return t;var i;if(n)i=n(e);else if(jr.isURLSearchParams(e))i=e.toString();else{var s=[];jr.forEach(e,function(u,p){u===null||typeof u>"u"||(jr.isArray(u)?p=p+"[]":u=[u],jr.forEach(u,function(m){jr.isDate(m)?m=m.toISOString():jr.isObject(m)&&(m=JSON.stringify(m)),s.push(zo(p)+"="+zo(m))}))}),i=s.join("&")}if(i){var o=t.indexOf("#");o!==-1&&(t=t.slice(0,o)),t+=(t.indexOf("?")===-1?"?":"&")+i}return t},ah=Qt;function _i(){this.handlers=[]}_i.prototype.use=function(t,e,n){return this.handlers.push({fulfilled:t,rejected:e,synchronous:n?n.synchronous:!1,runWhen:n?n.runWhen:null}),this.handlers.length-1};_i.prototype.eject=function(t){this.handlers[t]&&(this.handlers[t]=null)};_i.prototype.forEach=function(t){ah.forEach(this.handlers,function(n){n!==null&&t(n)})};var ch=_i,uh=Qt,lh=function(t,e){uh.forEach(t,function(i,s){s!==e&&s.toUpperCase()===e.toUpperCase()&&(t[e]=i,delete t[s])})},Oc=function(t,e,n,i,s){return t.config=e,n&&(t.code=n),t.request=i,t.response=s,t.isAxiosError=!0,t.toJSON=function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code,status:this.response&&this.response.status?this.response.status:null}},t},Pc={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},Ki,qo;function Tc(){if(qo)return Ki;qo=1;var r=Oc;return Ki=function(e,n,i,s,o){var a=new Error(e);return r(a,n,i,s,o)},Ki}var Fi,Wo;function hh(){if(Wo)return Fi;Wo=1;var r=Tc();return Fi=function(e,n,i){var s=i.config.validateStatus;!i.status||!s||s(i.status)?e(i):n(r("Request failed with status code "+i.status,i.config,null,i.request,i))},Fi}var zi,Zo;function dh(){if(Zo)return zi;Zo=1;var r=Qt;return zi=r.isStandardBrowserEnv()?function(){return{write:function(n,i,s,o,a,u){var p=[];p.push(n+"="+encodeURIComponent(i)),r.isNumber(s)&&p.push("expires="+new Date(s).toGMTString()),r.isString(o)&&p.push("path="+o),r.isString(a)&&p.push("domain="+a),u===!0&&p.push("secure"),document.cookie=p.join("; ")},read:function(n){var i=document.cookie.match(new RegExp("(^|;\\s*)("+n+")=([^;]*)"));return i?decodeURIComponent(i[3]):null},remove:function(n){this.write(n,"",Date.now()-864e5)}}}():function(){return{write:function(){},read:function(){return null},remove:function(){}}}(),zi}var qi,Yo;function ph(){return Yo||(Yo=1,qi=function(t){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(t)}),qi}var Wi,Xo;function fh(){return Xo||(Xo=1,Wi=function(t,e){return e?t.replace(/\/+$/,"")+"/"+e.replace(/^\/+/,""):t}),Wi}var Zi,Jo;function gh(){if(Jo)return Zi;Jo=1;var r=ph(),t=fh();return Zi=function(n,i){return n&&!r(i)?t(n,i):i},Zi}var Yi,Qo;function mh(){if(Qo)return Yi;Qo=1;var r=Qt,t=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];return Yi=function(n){var i={},s,o,a;return n&&r.forEach(n.split(`
`),function(p){if(a=p.indexOf(":"),s=r.trim(p.substr(0,a)).toLowerCase(),o=r.trim(p.substr(a+1)),s){if(i[s]&&t.indexOf(s)>=0)return;s==="set-cookie"?i[s]=(i[s]?i[s]:[]).concat([o]):i[s]=i[s]?i[s]+", "+o:o}}),i},Yi}var Xi,ta;function yh(){if(ta)return Xi;ta=1;var r=Qt;return Xi=r.isStandardBrowserEnv()?function(){var e=/(msie|trident)/i.test(navigator.userAgent),n=document.createElement("a"),i;function s(o){var a=o;return e&&(n.setAttribute("href",a),a=n.href),n.setAttribute("href",a),{href:n.href,protocol:n.protocol?n.protocol.replace(/:$/,""):"",host:n.host,search:n.search?n.search.replace(/^\?/,""):"",hash:n.hash?n.hash.replace(/^#/,""):"",hostname:n.hostname,port:n.port,pathname:n.pathname.charAt(0)==="/"?n.pathname:"/"+n.pathname}}return i=s(window.location.href),function(a){var u=r.isString(a)?s(a):a;return u.protocol===i.protocol&&u.host===i.host}}():function(){return function(){return!0}}(),Xi}var Ji,ea;function Ai(){if(ea)return Ji;ea=1;function r(t){this.message=t}return r.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")},r.prototype.__CANCEL__=!0,Ji=r,Ji}var Qi,ra;function na(){if(ra)return Qi;ra=1;var r=Qt,t=hh(),e=dh(),n=Rc,i=gh(),s=mh(),o=yh(),a=Tc(),u=Pc,p=Ai();return Qi=function(m){return new Promise(function(T,x){var B=m.data,C=m.headers,L=m.responseType,S;function yt(){m.cancelToken&&m.cancelToken.unsubscribe(S),m.signal&&m.signal.removeEventListener("abort",S)}r.isFormData(B)&&delete C["Content-Type"];var H=new XMLHttpRequest;if(m.auth){var Lt=m.auth.username||"",st=m.auth.password?unescape(encodeURIComponent(m.auth.password)):"";C.Authorization="Basic "+btoa(Lt+":"+st)}var J=i(m.baseURL,m.url);H.open(m.method.toUpperCase(),n(J,m.params,m.paramsSerializer),!0),H.timeout=m.timeout;function h(){if(H){var l="getAllResponseHeaders"in H?s(H.getAllResponseHeaders()):null,v=!L||L==="text"||L==="json"?H.responseText:H.response,b={data:v,status:H.status,statusText:H.statusText,headers:l,config:m,request:H};t(function(R){T(R),yt()},function(R){x(R),yt()},b),H=null}}if("onloadend"in H?H.onloadend=h:H.onreadystatechange=function(){!H||H.readyState!==4||H.status===0&&!(H.responseURL&&H.responseURL.indexOf("file:")===0)||setTimeout(h)},H.onabort=function(){H&&(x(a("Request aborted",m,"ECONNABORTED",H)),H=null)},H.onerror=function(){x(a("Network Error",m,null,H)),H=null},H.ontimeout=function(){var v=m.timeout?"timeout of "+m.timeout+"ms exceeded":"timeout exceeded",b=m.transitional||u;m.timeoutErrorMessage&&(v=m.timeoutErrorMessage),x(a(v,m,b.clarifyTimeoutError?"ETIMEDOUT":"ECONNABORTED",H)),H=null},r.isStandardBrowserEnv()){var g=(m.withCredentials||o(J))&&m.xsrfCookieName?e.read(m.xsrfCookieName):void 0;g&&(C[m.xsrfHeaderName]=g)}"setRequestHeader"in H&&r.forEach(C,function(v,b){typeof B>"u"&&b.toLowerCase()==="content-type"?delete C[b]:H.setRequestHeader(b,v)}),r.isUndefined(m.withCredentials)||(H.withCredentials=!!m.withCredentials),L&&L!=="json"&&(H.responseType=m.responseType),typeof m.onDownloadProgress=="function"&&H.addEventListener("progress",m.onDownloadProgress),typeof m.onUploadProgress=="function"&&H.upload&&H.upload.addEventListener("progress",m.onUploadProgress),(m.cancelToken||m.signal)&&(S=function(l){H&&(x(!l||l&&l.type?new p("canceled"):l),H.abort(),H=null)},m.cancelToken&&m.cancelToken.subscribe(S),m.signal&&(m.signal.aborted?S():m.signal.addEventListener("abort",S))),B||(B=null),H.send(B)})},Qi}var Mt=Qt,ia=lh,bh=Oc,Eh=Pc,vh={"Content-Type":"application/x-www-form-urlencoded"};function sa(r,t){!Mt.isUndefined(r)&&Mt.isUndefined(r["Content-Type"])&&(r["Content-Type"]=t)}function wh(){var r;return(typeof XMLHttpRequest<"u"||typeof Kr<"u"&&Object.prototype.toString.call(Kr)==="[object process]")&&(r=na()),r}function _h(r,t,e){if(Mt.isString(r))try{return(t||JSON.parse)(r),Mt.trim(r)}catch(n){if(n.name!=="SyntaxError")throw n}return(e||JSON.stringify)(r)}var Si={transitional:Eh,adapter:wh(),transformRequest:[function(t,e){return ia(e,"Accept"),ia(e,"Content-Type"),Mt.isFormData(t)||Mt.isArrayBuffer(t)||Mt.isBuffer(t)||Mt.isStream(t)||Mt.isFile(t)||Mt.isBlob(t)?t:Mt.isArrayBufferView(t)?t.buffer:Mt.isURLSearchParams(t)?(sa(e,"application/x-www-form-urlencoded;charset=utf-8"),t.toString()):Mt.isObject(t)||e&&e["Content-Type"]==="application/json"?(sa(e,"application/json"),_h(t)):t}],transformResponse:[function(t){var e=this.transitional||Si.transitional,n=e&&e.silentJSONParsing,i=e&&e.forcedJSONParsing,s=!n&&this.responseType==="json";if(s||i&&Mt.isString(t)&&t.length)try{return JSON.parse(t)}catch(o){if(s)throw o.name==="SyntaxError"?bh(o,this,"E_JSON_PARSE"):o}return t}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,validateStatus:function(t){return t>=200&&t<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};Mt.forEach(["delete","get","head"],function(t){Si.headers[t]={}});Mt.forEach(["post","put","patch"],function(t){Si.headers[t]=Mt.merge(vh)});var Vs=Si,Ah=Qt,Sh=Vs,Rh=function(t,e,n){var i=this||Sh;return Ah.forEach(n,function(o){t=o.call(i,t,e)}),t},ts,oa;function Ic(){return oa||(oa=1,ts=function(t){return!!(t&&t.__CANCEL__)}),ts}var aa=Qt,es=Rh,Oh=Ic(),Ph=Vs,Th=Ai();function rs(r){if(r.cancelToken&&r.cancelToken.throwIfRequested(),r.signal&&r.signal.aborted)throw new Th("canceled")}var Ih=function(t){rs(t),t.headers=t.headers||{},t.data=es.call(t,t.data,t.headers,t.transformRequest),t.headers=aa.merge(t.headers.common||{},t.headers[t.method]||{},t.headers),aa.forEach(["delete","get","head","post","put","patch","common"],function(i){delete t.headers[i]});var e=t.adapter||Ph.adapter;return e(t).then(function(i){return rs(t),i.data=es.call(t,i.data,i.headers,t.transformResponse),i},function(i){return Oh(i)||(rs(t),i&&i.response&&(i.response.data=es.call(t,i.response.data,i.response.headers,t.transformResponse))),Promise.reject(i)})},te=Qt,Nc=function(t,e){e=e||{};var n={};function i(f,m){return te.isPlainObject(f)&&te.isPlainObject(m)?te.merge(f,m):te.isPlainObject(m)?te.merge({},m):te.isArray(m)?m.slice():m}function s(f){if(te.isUndefined(e[f])){if(!te.isUndefined(t[f]))return i(void 0,t[f])}else return i(t[f],e[f])}function o(f){if(!te.isUndefined(e[f]))return i(void 0,e[f])}function a(f){if(te.isUndefined(e[f])){if(!te.isUndefined(t[f]))return i(void 0,t[f])}else return i(void 0,e[f])}function u(f){if(f in e)return i(t[f],e[f]);if(f in t)return i(void 0,t[f])}var p={url:o,method:o,data:o,baseURL:a,transformRequest:a,transformResponse:a,paramsSerializer:a,timeout:a,timeoutMessage:a,withCredentials:a,adapter:a,responseType:a,xsrfCookieName:a,xsrfHeaderName:a,onUploadProgress:a,onDownloadProgress:a,decompress:a,maxContentLength:a,maxBodyLength:a,transport:a,httpAgent:a,httpsAgent:a,cancelToken:a,socketPath:a,responseEncoding:a,validateStatus:u};return te.forEach(Object.keys(t).concat(Object.keys(e)),function(m){var N=p[m]||s,T=N(m);te.isUndefined(T)&&N!==u||(n[m]=T)}),n},ns,ca;function xc(){return ca||(ca=1,ns={version:"0.26.1"}),ns}var Nh=xc().version,Gs={};["object","boolean","number","function","string","symbol"].forEach(function(r,t){Gs[r]=function(n){return typeof n===r||"a"+(t<1?"n ":" ")+r}});var ua={};Gs.transitional=function(t,e,n){function i(s,o){return"[Axios v"+Nh+"] Transitional option '"+s+"'"+o+(n?". "+n:"")}return function(s,o,a){if(t===!1)throw new Error(i(o," has been removed"+(e?" in "+e:"")));return e&&!ua[o]&&(ua[o]=!0,console.warn(i(o," has been deprecated since v"+e+" and will be removed in the near future"))),t?t(s,o,a):!0}};function xh(r,t,e){if(typeof r!="object")throw new TypeError("options must be an object");for(var n=Object.keys(r),i=n.length;i-- >0;){var s=n[i],o=t[s];if(o){var a=r[s],u=a===void 0||o(a,s,r);if(u!==!0)throw new TypeError("option "+s+" must be "+u);continue}if(e!==!0)throw Error("Unknown option "+s)}}var Lh={assertOptions:xh,validators:Gs},Lc=Qt,Ch=Rc,la=ch,ha=Ih,Ri=Nc,Cc=Lh,Vr=Cc.validators;function Pn(r){this.defaults=r,this.interceptors={request:new la,response:new la}}Pn.prototype.request=function(t,e){typeof t=="string"?(e=e||{},e.url=t):e=t||{},e=Ri(this.defaults,e),e.method?e.method=e.method.toLowerCase():this.defaults.method?e.method=this.defaults.method.toLowerCase():e.method="get";var n=e.transitional;n!==void 0&&Cc.assertOptions(n,{silentJSONParsing:Vr.transitional(Vr.boolean),forcedJSONParsing:Vr.transitional(Vr.boolean),clarifyTimeoutError:Vr.transitional(Vr.boolean)},!1);var i=[],s=!0;this.interceptors.request.forEach(function(T){typeof T.runWhen=="function"&&T.runWhen(e)===!1||(s=s&&T.synchronous,i.unshift(T.fulfilled,T.rejected))});var o=[];this.interceptors.response.forEach(function(T){o.push(T.fulfilled,T.rejected)});var a;if(!s){var u=[ha,void 0];for(Array.prototype.unshift.apply(u,i),u=u.concat(o),a=Promise.resolve(e);u.length;)a=a.then(u.shift(),u.shift());return a}for(var p=e;i.length;){var f=i.shift(),m=i.shift();try{p=f(p)}catch(N){m(N);break}}try{a=ha(p)}catch(N){return Promise.reject(N)}for(;o.length;)a=a.then(o.shift(),o.shift());return a};Pn.prototype.getUri=function(t){return t=Ri(this.defaults,t),Ch(t.url,t.params,t.paramsSerializer).replace(/^\?/,"")};Lc.forEach(["delete","get","head","options"],function(t){Pn.prototype[t]=function(e,n){return this.request(Ri(n||{},{method:t,url:e,data:(n||{}).data}))}});Lc.forEach(["post","put","patch"],function(t){Pn.prototype[t]=function(e,n,i){return this.request(Ri(i||{},{method:t,url:e,data:n}))}});var Dh=Pn,is,da;function Mh(){if(da)return is;da=1;var r=Ai();function t(e){if(typeof e!="function")throw new TypeError("executor must be a function.");var n;this.promise=new Promise(function(o){n=o});var i=this;this.promise.then(function(s){if(i._listeners){var o,a=i._listeners.length;for(o=0;o<a;o++)i._listeners[o](s);i._listeners=null}}),this.promise.then=function(s){var o,a=new Promise(function(u){i.subscribe(u),o=u}).then(s);return a.cancel=function(){i.unsubscribe(o)},a},e(function(o){i.reason||(i.reason=new r(o),n(i.reason))})}return t.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},t.prototype.subscribe=function(n){if(this.reason){n(this.reason);return}this._listeners?this._listeners.push(n):this._listeners=[n]},t.prototype.unsubscribe=function(n){if(this._listeners){var i=this._listeners.indexOf(n);i!==-1&&this._listeners.splice(i,1)}},t.source=function(){var n,i=new t(function(o){n=o});return{token:i,cancel:n}},is=t,is}var ss,pa;function kh(){return pa||(pa=1,ss=function(t){return function(n){return t.apply(null,n)}}),ss}var os,fa;function Bh(){if(fa)return os;fa=1;var r=Qt;return os=function(e){return r.isObject(e)&&e.isAxiosError===!0},os}var ga=Qt,Uh=wc,Qn=Dh,Hh=Nc,$h=Vs;function Dc(r){var t=new Qn(r),e=Uh(Qn.prototype.request,t);return ga.extend(e,Qn.prototype,t),ga.extend(e,t),e.create=function(i){return Dc(Hh(r,i))},e}var Ge=Dc($h);Ge.Axios=Qn;Ge.Cancel=Ai();Ge.CancelToken=Mh();Ge.isCancel=Ic();Ge.VERSION=xc().version;Ge.all=function(t){return Promise.all(t)};Ge.spread=kh();Ge.isAxiosError=Bh();Hs.exports=Ge;Hs.exports.default=Ge;var jh=Hs.exports,Vh=jh;const ma=wi(Vh);function Ks(r,t,e,n){function i(s){return s instanceof e?s:new e(function(o){o(s)})}return new(e||(e=Promise))(function(s,o){function a(f){try{p(n.next(f))}catch(m){o(m)}}function u(f){try{p(n.throw(f))}catch(m){o(m)}}function p(f){f.done?s(f.value):i(f.value).then(a,u)}p((n=n.apply(r,t||[])).next())})}const Gh=require("axios/lib/core/settle"),Kh=require("axios/lib/helpers/buildURL"),Fh=require("axios/lib/core/buildFullPath"),{isUndefined:zh,isStandardBrowserEnv:qh,isFormData:Wh}=require("axios/lib/utils");function Zh(r){return Ks(this,void 0,void 0,function*(){const t=Xh(r),e=[Yh(t,r)];r.timeout&&r.timeout>0&&e.push(new Promise(i=>{setTimeout(()=>{const s=r.timeoutErrorMessage?r.timeoutErrorMessage:"timeout of "+r.timeout+"ms exceeded";i(vs(s,r,"ECONNABORTED",t))},r.timeout)}));const n=yield Promise.race(e);return new Promise((i,s)=>{if(n instanceof Error)s(n);else{const o=r;"settle"in o&&Object.prototype.toString.call(o.settle)==="[object Function]"?o.settle(i,s,n):Gh(i,s,n)}})})}function Yh(r,t){return Ks(this,void 0,void 0,function*(){try{const e=yield fetch(r);let n={ok:e.ok,status:e.status,statusText:e.statusText,headers:new Headers(e.headers),config:t,request:r};if(e.status>=400)return vs("Response Error",t,"ERR_NETWORK",r,n);if(n={ok:e.ok,status:e.status,statusText:e.statusText,headers:new Headers(e.headers),config:t,request:r},e.status>=200&&e.status!==204)switch(t.responseType){case"arraybuffer":n.data=yield e.arrayBuffer();break;case"blob":n.data=yield e.blob();break;case"json":n.data=yield e.json();break;default:n.data=yield e.text();break}return n}catch{return vs("Network Error",t,"ERR_NETWORK",r)}})}function Xh(r){var t;const e=new Headers(r.headers);if(r.auth){const u=r.auth.username||"",p=r.auth.password?decodeURI(encodeURIComponent(r.auth.password)):"";e.set("Authorization",`Basic ${btoa(u+":"+p)}`)}const n=(t=r.method)===null||t===void 0?void 0:t.toUpperCase(),i={headers:e,method:n};n!=="GET"&&n!=="HEAD"&&(i.body=r.data,Wh(i.body)&&qh()&&e.delete("Content-Type"));const s=r;"mode"in s&&(i.mode=s.mode),"cache"in s&&(i.cache=s.cache),"integrity"in s&&(i.integrity=s.integrity),"redirect"in s&&(i.redirect=s.redirect),"referrer"in s&&(i.referrer=s.referrer),zh(s.withCredentials)||(i.credentials=s.withCredentials?"include":"omit");const o=Fh(s.baseURL,s.url),a=Kh(o,s.params,s.paramsSerializer);return new Request(a,i)}function vs(r,t,e,n,i){const s=new Error(r);return Jh(s,t,e,n,i)}function Jh(r,t,e,n,i){return r.config=t,e&&(r.code=e),r.request=n,r.response=i,r.isAxiosError=!0,r.toJSON=function(){return{message:this.message,name:this.name,description:"description"in this?this.description:void 0,number:"number"in this?this.number:void 0,fileName:"fileName"in this?this.fileName:void 0,lineNumber:"lineNumber"in this?this.lineNumber:void 0,columnNumber:"columnNumber"in this?this.columnNumber:void 0,stack:this.stack,config:this.config,code:this.code,status:this.response&&this.response.status?this.response.status:null}},r}var vn;(function(r){r[r.CONTINUE=100]="CONTINUE",r[r.SWITCHING_PROTOCOLS=101]="SWITCHING_PROTOCOLS",r[r.PROCESSING=102]="PROCESSING",r[r.OK=200]="OK",r[r.CREATED=201]="CREATED",r[r.ACCEPTED=202]="ACCEPTED",r[r.NON_AUTHORITATIVE_INFORMATION=203]="NON_AUTHORITATIVE_INFORMATION",r[r.NO_CONTENT=204]="NO_CONTENT",r[r.RESET_CONTENT=205]="RESET_CONTENT",r[r.PARTIAL_CONTENT=206]="PARTIAL_CONTENT",r[r.MULTI_STATUS=207]="MULTI_STATUS",r[r.ALREADY_REPORTED=208]="ALREADY_REPORTED",r[r.IM_USED=226]="IM_USED",r[r.MULTIPLE_CHOICES=300]="MULTIPLE_CHOICES",r[r.MOVED_PERMANENTLY=301]="MOVED_PERMANENTLY",r[r.FOUND=302]="FOUND",r[r.SEE_OTHER=303]="SEE_OTHER",r[r.NOT_MODIFIED=304]="NOT_MODIFIED",r[r.USE_PROXY=305]="USE_PROXY",r[r.SWITCH_PROXY=306]="SWITCH_PROXY",r[r.TEMPORARY_REDIRECT=307]="TEMPORARY_REDIRECT",r[r.PERMANENT_REDIRECT=308]="PERMANENT_REDIRECT",r[r.BAD_REQUEST=400]="BAD_REQUEST",r[r.UNAUTHORIZED=401]="UNAUTHORIZED",r[r.PAYMENT_REQUIRED=402]="PAYMENT_REQUIRED",r[r.FORBIDDEN=403]="FORBIDDEN",r[r.NOT_FOUND=404]="NOT_FOUND",r[r.METHOD_NOT_ALLOWED=405]="METHOD_NOT_ALLOWED",r[r.NOT_ACCEPTABLE=406]="NOT_ACCEPTABLE",r[r.PROXY_AUTHENTICATION_REQUIRED=407]="PROXY_AUTHENTICATION_REQUIRED",r[r.REQUEST_TIMEOUT=408]="REQUEST_TIMEOUT",r[r.CONFLICT=409]="CONFLICT",r[r.GONE=410]="GONE",r[r.LENGTH_REQUIRED=411]="LENGTH_REQUIRED",r[r.PRECONDITION_FAILED=412]="PRECONDITION_FAILED",r[r.PAYLOAD_TOO_LARGE=413]="PAYLOAD_TOO_LARGE",r[r.URI_TOO_LONG=414]="URI_TOO_LONG",r[r.UNSUPPORTED_MEDIA_TYPE=415]="UNSUPPORTED_MEDIA_TYPE",r[r.RANGE_NOT_SATISFIABLE=416]="RANGE_NOT_SATISFIABLE",r[r.EXPECTATION_FAILED=417]="EXPECTATION_FAILED",r[r.I_AM_A_TEAPOT=418]="I_AM_A_TEAPOT",r[r.MISDIRECTED_REQUEST=421]="MISDIRECTED_REQUEST",r[r.UNPROCESSABLE_ENTITY=422]="UNPROCESSABLE_ENTITY",r[r.LOCKED=423]="LOCKED",r[r.FAILED_DEPENDENCY=424]="FAILED_DEPENDENCY",r[r.UPGRADE_REQUIRED=426]="UPGRADE_REQUIRED",r[r.PRECONDITION_REQUIRED=428]="PRECONDITION_REQUIRED",r[r.TOO_MANY_REQUESTS=429]="TOO_MANY_REQUESTS",r[r.REQUEST_HEADER_FIELDS_TOO_LARGE=431]="REQUEST_HEADER_FIELDS_TOO_LARGE",r[r.UNAVAILABLE_FOR_LEGAL_REASONS=451]="UNAVAILABLE_FOR_LEGAL_REASONS",r[r.INTERNAL_SERVER_ERROR=500]="INTERNAL_SERVER_ERROR",r[r.NOT_IMPLEMENTED=501]="NOT_IMPLEMENTED",r[r.BAD_GATEWAY=502]="BAD_GATEWAY",r[r.SERVICE_UNAVAILABLE=503]="SERVICE_UNAVAILABLE",r[r.GATEWAY_TIMEOUT=504]="GATEWAY_TIMEOUT",r[r.HTTP_VERSION_NOT_SUPPORTED=505]="HTTP_VERSION_NOT_SUPPORTED",r[r.VARIANT_ALSO_NEGOTIATES=506]="VARIANT_ALSO_NEGOTIATES",r[r.INSUFFICIENT_STORAGE=507]="INSUFFICIENT_STORAGE",r[r.LOOP_DETECTED=508]="LOOP_DETECTED",r[r.NOT_EXTENDED=510]="NOT_EXTENDED",r[r.NETWORK_AUTHENTICATION_REQUIRED=511]="NETWORK_AUTHENTICATION_REQUIRED"})(vn||(vn={}));var as;const Mc=typeof Kr<"u"&&!!(!((as=Kr===null||Kr===void 0?void 0:Kr.versions)===null||as===void 0)&&as.node),Qh=Mc?void 0:Zh;var ai;(function(r){r.TEXT="text",r.JSON="json"})(ai||(ai={}));class on extends Error{constructor(t,e,n,i,s){super(t),this.message=t,this.status=e,this.statusText=n,this.body=i,this.url=s,this.name="HttpResponse"}}class td extends Error{constructor(t){super(t),this.message=t,this.name="HttpRequestFailed"}}class ed{constructor(t=3e4){this.timeout=t}serialize(t){if(!t)return"";const e=[];for(const i in t)if(t.hasOwnProperty(i)&&typeof t[i]<"u"){const s=typeof t[i].toJSON=="function"?t[i].toJSON():t[i];if(s===null){e.push(encodeURIComponent(i));continue}if(Array.isArray(s)){s.forEach(o=>{e.push(encodeURIComponent(i)+"="+encodeURIComponent(o))});continue}e.push(encodeURIComponent(i)+"="+encodeURIComponent(s))}const n=e.join("&");return n?`?${n}`:""}createRequest({url:t,method:e,timeout:n=this.timeout,query:i,headers:s={},json:o=!0},a){return Ks(this,void 0,void 0,function*(){let u,p;s["Content-Type"]||(s["Content-Type"]="application/json"),o?u=ai.JSON:(u=ai.TEXT,p=[f=>f]);try{return(yield ma.request({url:t+this.serialize(i),method:e??"GET",headers:s,responseType:u,transformResponse:p,timeout:n,data:a,adapter:Qh})).data}catch(f){if(ma.isAxiosError(f)&&f.response||!Mc&&f.response){let m;throw typeof f.response.data=="object"?m=JSON.stringify(f.response.data):m=f.response.data,new on(`Http error response: (${f.response.status}) ${m}`,f.response.status,f.response.statusText,m,t+this.serialize(i))}else throw new td(`${e} ${t+this.serialize(i)} ${String(f)}`)}})}}const rd="Input must be an string, Buffer or Uint8Array";function nd(r){let t;if(r instanceof Uint8Array)t=r;else if(typeof r=="string")t=new TextEncoder().encode(r);else throw new Error(rd);return t}function id(r){return Array.prototype.map.call(r,function(t){return(t<16?"0":"")+t.toString(16)}).join("")}function Hn(r){return(4294967296+r).toString(16).substring(1)}function sd(r,t,e){let n=`
`+r+" = ";for(let i=0;i<t.length;i+=2){if(e===32)n+=Hn(t[i]).toUpperCase(),n+=" ",n+=Hn(t[i+1]).toUpperCase();else if(e===64)n+=Hn(t[i+1]).toUpperCase(),n+=Hn(t[i]).toUpperCase();else throw new Error("Invalid size "+e);i%6===4?n+=`
`+new Array(r.length+4).join(" "):i<t.length-2&&(n+=" ")}console.log(n)}function od(r,t,e){let n=new Date().getTime();const i=new Uint8Array(t);for(let o=0;o<t;o++)i[o]=o%256;const s=new Date().getTime();console.log("Generated random input in "+(s-n)+"ms"),n=s;for(let o=0;o<e;o++){const a=r(i),u=new Date().getTime(),p=u-n;n=u,console.log("Hashed in "+p+"ms: "+a.substring(0,20)+"..."),console.log(Math.round(t/(1<<20)/(p/1e3)*100)/100+" MB PER SECOND")}}var kc={normalizeInput:nd,toHex:id,debugPrint:sd,testSpeed:od};const ti=kc;function $n(r,t,e){const n=r[t]+r[e];let i=r[t+1]+r[e+1];n>=4294967296&&i++,r[t]=n,r[t+1]=i}function ya(r,t,e,n){let i=r[t]+e;e<0&&(i+=4294967296);let s=r[t+1]+n;i>=4294967296&&s++,r[t]=i,r[t+1]=s}function Bc(r,t){return r[t]^r[t+1]<<8^r[t+2]<<16^r[t+3]<<24}function cr(r,t,e,n,i,s){const o=gn[i],a=gn[i+1],u=gn[s],p=gn[s+1];$n(W,r,t),ya(W,r,o,a);let f=W[n]^W[r],m=W[n+1]^W[r+1];W[n]=m,W[n+1]=f,$n(W,e,n),f=W[t]^W[e],m=W[t+1]^W[e+1],W[t]=f>>>24^m<<8,W[t+1]=m>>>24^f<<8,$n(W,r,t),ya(W,r,u,p),f=W[n]^W[r],m=W[n+1]^W[r+1],W[n]=f>>>16^m<<16,W[n+1]=m>>>16^f<<16,$n(W,e,n),f=W[t]^W[e],m=W[t+1]^W[e+1],W[t]=m>>>31^f<<1,W[t+1]=f>>>31^m<<1}const Uc=new Uint32Array([4089235720,1779033703,2227873595,3144134277,4271175723,1013904242,1595750129,2773480762,2917565137,1359893119,725511199,2600822924,4215389547,528734635,327033209,1541459225]),ad=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3],Bt=new Uint8Array(ad.map(function(r){return r*2})),W=new Uint32Array(32),gn=new Uint32Array(32);function Hc(r,t){let e=0;for(e=0;e<16;e++)W[e]=r.h[e],W[e+16]=Uc[e];for(W[24]=W[24]^r.t,W[25]=W[25]^r.t/4294967296,t&&(W[28]=~W[28],W[29]=~W[29]),e=0;e<32;e++)gn[e]=Bc(r.b,4*e);for(e=0;e<12;e++)cr(0,8,16,24,Bt[e*16+0],Bt[e*16+1]),cr(2,10,18,26,Bt[e*16+2],Bt[e*16+3]),cr(4,12,20,28,Bt[e*16+4],Bt[e*16+5]),cr(6,14,22,30,Bt[e*16+6],Bt[e*16+7]),cr(0,10,20,30,Bt[e*16+8],Bt[e*16+9]),cr(2,12,22,24,Bt[e*16+10],Bt[e*16+11]),cr(4,14,16,26,Bt[e*16+12],Bt[e*16+13]),cr(6,8,18,28,Bt[e*16+14],Bt[e*16+15]);for(e=0;e<16;e++)r.h[e]=r.h[e]^W[e]^W[e+16]}const ur=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]);function $c(r,t,e,n){if(r===0||r>64)throw new Error("Illegal output length, expected 0 < length <= 64");if(t&&t.length>64)throw new Error("Illegal key, expected Uint8Array with 0 < length <= 64");if(e&&e.length!==16)throw new Error("Illegal salt, expected Uint8Array with length is 16");if(n&&n.length!==16)throw new Error("Illegal personal, expected Uint8Array with length is 16");const i={b:new Uint8Array(128),h:new Uint32Array(16),t:0,c:0,outlen:r};ur.fill(0),ur[0]=r,t&&(ur[1]=t.length),ur[2]=1,ur[3]=1,e&&ur.set(e,32),n&&ur.set(n,48);for(let s=0;s<16;s++)i.h[s]=Uc[s]^Bc(ur,s*4);return t&&(Fs(i,t),i.c=128),i}function Fs(r,t){for(let e=0;e<t.length;e++)r.c===128&&(r.t+=r.c,Hc(r,!1),r.c=0),r.b[r.c++]=t[e]}function jc(r){for(r.t+=r.c;r.c<128;)r.b[r.c++]=0;Hc(r,!0);const t=new Uint8Array(r.outlen);for(let e=0;e<r.outlen;e++)t[e]=r.h[e>>2]>>8*(e&3);return t}function Vc(r,t,e,n,i){e=e||64,r=ti.normalizeInput(r),n&&(n=ti.normalizeInput(n)),i&&(i=ti.normalizeInput(i));const s=$c(e,t,n,i);return Fs(s,r),jc(s)}function cd(r,t,e,n,i){const s=Vc(r,t,e,n,i);return ti.toHex(s)}var ud={blake2b:Vc,blake2bHex:cd,blake2bInit:$c,blake2bUpdate:Fs,blake2bFinal:jc};const Gc=kc;function ld(r,t){return r[t]^r[t+1]<<8^r[t+2]<<16^r[t+3]<<24}function lr(r,t,e,n,i,s){et[r]=et[r]+et[t]+i,et[n]=jn(et[n]^et[r],16),et[e]=et[e]+et[n],et[t]=jn(et[t]^et[e],12),et[r]=et[r]+et[t]+s,et[n]=jn(et[n]^et[r],8),et[e]=et[e]+et[n],et[t]=jn(et[t]^et[e],7)}function jn(r,t){return r>>>t^r<<32-t}const Kc=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Ut=new Uint8Array([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0]),et=new Uint32Array(16),Ct=new Uint32Array(16);function Fc(r,t){let e=0;for(e=0;e<8;e++)et[e]=r.h[e],et[e+8]=Kc[e];for(et[12]^=r.t,et[13]^=r.t/4294967296,t&&(et[14]=~et[14]),e=0;e<16;e++)Ct[e]=ld(r.b,4*e);for(e=0;e<10;e++)lr(0,4,8,12,Ct[Ut[e*16+0]],Ct[Ut[e*16+1]]),lr(1,5,9,13,Ct[Ut[e*16+2]],Ct[Ut[e*16+3]]),lr(2,6,10,14,Ct[Ut[e*16+4]],Ct[Ut[e*16+5]]),lr(3,7,11,15,Ct[Ut[e*16+6]],Ct[Ut[e*16+7]]),lr(0,5,10,15,Ct[Ut[e*16+8]],Ct[Ut[e*16+9]]),lr(1,6,11,12,Ct[Ut[e*16+10]],Ct[Ut[e*16+11]]),lr(2,7,8,13,Ct[Ut[e*16+12]],Ct[Ut[e*16+13]]),lr(3,4,9,14,Ct[Ut[e*16+14]],Ct[Ut[e*16+15]]);for(e=0;e<8;e++)r.h[e]^=et[e]^et[e+8]}function zc(r,t){if(!(r>0&&r<=32))throw new Error("Incorrect output length, should be in [1, 32]");const e=t?t.length:0;if(t&&!(e>0&&e<=32))throw new Error("Incorrect key length, should be in [1, 32]");const n={h:new Uint32Array(Kc),b:new Uint8Array(64),c:0,t:0,outlen:r};return n.h[0]^=16842752^e<<8^r,e>0&&(zs(n,t),n.c=64),n}function zs(r,t){for(let e=0;e<t.length;e++)r.c===64&&(r.t+=r.c,Fc(r,!1),r.c=0),r.b[r.c++]=t[e]}function qc(r){for(r.t+=r.c;r.c<64;)r.b[r.c++]=0;Fc(r,!0);const t=new Uint8Array(r.outlen);for(let e=0;e<r.outlen;e++)t[e]=r.h[e>>2]>>8*(e&3)&255;return t}function Wc(r,t,e){e=e||32,r=Gc.normalizeInput(r);const n=zc(e,t);return zs(n,r),qc(n)}function hd(r,t,e){const n=Wc(r,t,e);return Gc.toHex(n)}var dd={blake2s:Wc,blake2sHex:hd,blake2sInit:zc,blake2sUpdate:zs,blake2sFinal:qc};const dn=ud,pn=dd;var pd={blake2b:dn.blake2b,blake2bHex:dn.blake2bHex,blake2bInit:dn.blake2bInit,blake2bUpdate:dn.blake2bUpdate,blake2bFinal:dn.blake2bFinal,blake2s:pn.blake2s,blake2sHex:pn.blake2sHex,blake2sInit:pn.blake2sInit,blake2sUpdate:pn.blake2sUpdate,blake2sFinal:pn.blake2sFinal};const fd=wi(pd);var Vn=Ec.Buffer;function gd(r){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),e=0;e<t.length;e++)t[e]=255;for(var n=0;n<r.length;n++){var i=r.charAt(n),s=i.charCodeAt(0);if(t[s]!==255)throw new TypeError(i+" is ambiguous");t[s]=n}var o=r.length,a=r.charAt(0),u=Math.log(o)/Math.log(256),p=Math.log(256)/Math.log(o);function f(T){if((Array.isArray(T)||T instanceof Uint8Array)&&(T=Vn.from(T)),!Vn.isBuffer(T))throw new TypeError("Expected Buffer");if(T.length===0)return"";for(var x=0,B=0,C=0,L=T.length;C!==L&&T[C]===0;)C++,x++;for(var S=(L-C)*p+1>>>0,yt=new Uint8Array(S);C!==L;){for(var H=T[C],Lt=0,st=S-1;(H!==0||Lt<B)&&st!==-1;st--,Lt++)H+=256*yt[st]>>>0,yt[st]=H%o>>>0,H=H/o>>>0;if(H!==0)throw new Error("Non-zero carry");B=Lt,C++}for(var J=S-B;J!==S&&yt[J]===0;)J++;for(var h=a.repeat(x);J<S;++J)h+=r.charAt(yt[J]);return h}function m(T){if(typeof T!="string")throw new TypeError("Expected String");if(T.length===0)return Vn.alloc(0);for(var x=0,B=0,C=0;T[x]===a;)B++,x++;for(var L=(T.length-x)*u+1>>>0,S=new Uint8Array(L);T[x];){var yt=t[T.charCodeAt(x)];if(yt===255)return;for(var H=0,Lt=L-1;(yt!==0||H<C)&&Lt!==-1;Lt--,H++)yt+=o*S[Lt]>>>0,S[Lt]=yt%256>>>0,yt=yt/256>>>0;if(yt!==0)throw new Error("Non-zero carry");C=H,x++}for(var st=L-C;st!==L&&S[st]===0;)st++;var J=Vn.allocUnsafe(B+(L-st));J.fill(0,0,B);for(var h=B;st!==L;)J[h++]=S[st++];return J}function N(T){var x=m(T);if(x)return x;throw new Error("Non-base"+o+" character")}return{encode:f,decodeUnsafe:m,decode:N}}var md=gd,yd=md,bd="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz",Ed=yd(bd),cs=Ed,vd=Ec.Buffer,wd=function(r){function t(s){var o=r(s);return cs.encode(vd.concat([s,o],s.length+4))}function e(s){var o=s.slice(0,-4),a=s.slice(-4),u=r(o);if(!(a[0]^u[0]|a[1]^u[1]|a[2]^u[2]|a[3]^u[3]))return o}function n(s){var o=cs.decodeUnsafe(s);if(o)return e(o)}function i(s){var o=cs.decode(s),a=e(o);if(!a)throw new Error("Invalid checksum");return a}return{encode:t,decode:i,decodeUnsafe:n}},ba=Gl,_d=wd;function Ad(r){var t=ba("sha256").update(r).digest();return ba("sha256").update(t).digest()}var Sd=_d(Ad);const Tn=wi(Sd);class Zc extends Error{}class mt extends Zc{}class Yc extends Zc{}class at extends mt{constructor(t,e){super(),this.address=t,this.name="InvalidAddressError",this.message=`Invalid address "${t}"`,e&&(this.message+=`${e}`)}}class Rd extends mt{constructor(t,e){super(),this.blockHash=t,this.name="InvalidBlockHashError",this.message=`Invalid block hash "${t}"`,e&&(this.message+=`${e}`)}}class Xc extends mt{constructor(t,e){super(),this.hexString=t,this.name="InvalidHexStringError",this.message=`Invalid hex string "${t}"`,e&&(this.message+=`${e}`)}}class Od extends mt{constructor(t,e){super(),this.msg=t,this.name="InvalidMessageError",this.message=`Invalid message "${t}"`,e&&(this.message+=`${e}`)}}class Pd extends mt{constructor(t,e,n,i){super(),this.viewName=t,this.sigs=e,this.args=n,this.cause=i,this.name="InvalidViewParameterError",this.message=`Invalid view arguments ${JSON.stringify(n)} received for name "${t}" expecting one of the following signatures ${JSON.stringify(e)}`}}class Jc extends mt{constructor(t,e){super(),this.publicKey=t,this.name="InvalidPublicKeyError",this.message=`Invalid public key "${t}"`,e&&(this.message+=`${e}`)}}class Dr extends mt{constructor(t,e){super(),this.contractAddress=t,this.name="InvalidContractAddressError",this.message=`Invalid contract address "${t}"`,e&&(this.message+=`${e}`)}}class Td extends mt{constructor(t,e){super(),this.chainId=t,this.name="InvalidChainIdError",this.message=`Invalid chain id "${t}"`,e&&(this.message+=`${e}`)}}class qs extends mt{constructor(t,e){super(),this.keyHash=t,this.name="InvalidKeyHashError",this.message=`Invalid public key hash "${t}"`,e&&(this.message+=`${e}`)}}class Qc extends mt{constructor(t,e){super(),this.operationHash=t,this.name="InvalidOperationHashError",this.message=`Invalid operation hash "${t}"`,e&&(this.message+=`${e}`)}}class Ar extends mt{constructor(t,e){super(),this.operationKind=t,this.name="InvalidOperationKindError",this.message=`Invalid operation kind "${t}"`,e&&(this.message+=`${e}`)}}class tu extends Yc{constructor(t){super(),this.message=t,this.name="DeprecationError"}}Kl();var O;(function(r){r.TZ1="tz1",r.TZ2="tz2",r.TZ3="tz3",r.TZ4="tz4",r.KT="KT",r.KT1="KT1",r.EDSK2="edsk2",r.SPSK="spsk",r.P2SK="p2sk",r.EDPK="edpk",r.SPPK="sppk",r.P2PK="p2pk",r.BLPK="BLpk",r.EDESK="edesk",r.SPESK="spesk",r.P2ESK="p2esk",r.EDSK="edsk",r.EDSIG="edsig",r.SPSIG="spsig",r.P2SIG="p2sig",r.SIG="sig",r.NET="Net",r.NCE="nce",r.B="B",r.O="o",r.LO="Lo",r.LLO="LLo",r.P="P",r.CO="Co",r.ID="id",r.EXPR="expr",r.TZ="TZ",r.VH="vh",r.SASK="sask",r.ZET1="zet1",r.TXR1="txr1",r.TXI="txi",r.TXM="txm",r.TXC="txc",r.TXMR="txmr",r.TXRL="txM",r.TXW="txw",r.SR1="sr1",r.SRC1="src1"})(O||(O={}));const Vt={[O.TZ1]:new Uint8Array([6,161,159]),[O.TZ2]:new Uint8Array([6,161,161]),[O.TZ3]:new Uint8Array([6,161,164]),[O.TZ4]:new Uint8Array([6,161,166]),[O.KT]:new Uint8Array([2,90,121]),[O.KT1]:new Uint8Array([2,90,121]),[O.EDSK]:new Uint8Array([43,246,78,7]),[O.EDSK2]:new Uint8Array([13,15,58,7]),[O.SPSK]:new Uint8Array([17,162,224,201]),[O.P2SK]:new Uint8Array([16,81,238,189]),[O.EDPK]:new Uint8Array([13,15,37,217]),[O.SPPK]:new Uint8Array([3,254,226,86]),[O.P2PK]:new Uint8Array([3,178,139,127]),[O.BLPK]:new Uint8Array([6,149,135,204]),[O.EDESK]:new Uint8Array([7,90,60,179,41]),[O.SPESK]:new Uint8Array([9,237,241,174,150]),[O.P2ESK]:new Uint8Array([9,48,57,115,171]),[O.EDSIG]:new Uint8Array([9,245,205,134,18]),[O.SPSIG]:new Uint8Array([13,115,101,19,63]),[O.P2SIG]:new Uint8Array([54,240,44,52]),[O.SIG]:new Uint8Array([4,130,43]),[O.NET]:new Uint8Array([87,82,0]),[O.NCE]:new Uint8Array([69,220,169]),[O.B]:new Uint8Array([1,52]),[O.O]:new Uint8Array([5,116]),[O.LO]:new Uint8Array([133,233]),[O.LLO]:new Uint8Array([29,159,109]),[O.P]:new Uint8Array([2,170]),[O.CO]:new Uint8Array([79,179]),[O.ID]:new Uint8Array([153,103]),[O.EXPR]:new Uint8Array([13,44,64,27]),[O.TZ]:new Uint8Array([2,90,121]),[O.VH]:new Uint8Array([1,106,242]),[O.SASK]:new Uint8Array([11,237,20,92]),[O.ZET1]:new Uint8Array([18,71,40,223]),[O.TXR1]:new Uint8Array([1,128,120,31]),[O.TXI]:new Uint8Array([79,148,196]),[O.TXM]:new Uint8Array([79,149,30]),[O.TXC]:new Uint8Array([79,148,17]),[O.TXMR]:new Uint8Array([18,7,206,87]),[O.TXRL]:new Uint8Array([79,146,82]),[O.TXW]:new Uint8Array([79,150,72]),[O.SR1]:new Uint8Array([6,124,117]),[O.SRC1]:new Uint8Array([17,165,134,138])},eu={[O.TZ1]:20,[O.TZ2]:20,[O.TZ3]:20,[O.TZ4]:20,[O.KT]:20,[O.KT1]:20,[O.EDPK]:32,[O.SPPK]:33,[O.P2PK]:33,[O.BLPK]:48,[O.EDSIG]:64,[O.SPSIG]:64,[O.P2SIG]:64,[O.SIG]:64,[O.NET]:4,[O.B]:32,[O.P]:32,[O.O]:32,[O.VH]:32,[O.SASK]:169,[O.ZET1]:43,[O.TXR1]:20,[O.TXI]:32,[O.TXM]:32,[O.TXC]:32,[O.TXMR]:32,[O.TXRL]:32,[O.TXW]:32,[O.SR1]:20,[O.SRC1]:32};class Id extends Yc{constructor(t,e){super(),this.value=t,this.desiredType=e,this.name="ValueConversionError",this.message=`Unable to convert ${t} to a ${e}`}}var k;(function(r){r[r.NO_PREFIX_MATCHED=0]="NO_PREFIX_MATCHED",r[r.INVALID_CHECKSUM=1]="INVALID_CHECKSUM",r[r.INVALID_LENGTH=2]="INVALID_LENGTH",r[r.VALID=3]="VALID"})(k||(k={}));function Nd(r){return typeof r!="string"?!1:r in Vt}function Pr(r,t){const e=new RegExp(`^(${t.join("|")})`).exec(r);if(!e||e.length===0)return k.NO_PREFIX_MATCHED;const n=e[0];if(!Nd(n))return k.NO_PREFIX_MATCHED;if(r.includes("%")&&(r=r.split("%")[0]),!/^(KT1\w{33})$/.test(r)&&n==="KT1")return k.INVALID_CHECKSUM;let s=Tn.decodeUnsafe(r);return s?(s=s.slice(Vt[n].length),s.length!==eu[n]?k.INVALID_LENGTH:k.VALID):k.INVALID_CHECKSUM}const ru=[O.TZ1,O.TZ2,O.TZ3,O.TZ4],nu=[O.KT1,O.TXR1],xd=[O.EDSIG,O.P2SIG,O.SPSIG,O.SIG],Ld=[O.EDPK,O.SPPK,O.P2PK,O.BLPK],Cd=[O.O];O.P;const Dd=[O.B],Md=[O.SR1];function rt(r){return Pr(r,[...ru,...nu,...Md])}function iu(r){return Pr(r,[O.NET])}function Wr(r){return Pr(r,nu)}function Ws(r){return Pr(r,ru)}function kd(r){return Pr(r,xd)}function Bd(r){return Pr(r,Ld)}function su(r){return Pr(r,Cd)}function Ud(r){return Pr(r,Dd)}function V(r){switch(r){case k.NO_PREFIX_MATCHED:return": Invalid prefix";case k.INVALID_CHECKSUM:return": Checksum failed";case k.INVALID_LENGTH:return": Invalid length";default:return""}}const Hd=6,$d=3;function Ea(r){switch(r){case"tz":return Hd;case"mtz":return $d;case"mutez":default:return 0}}function Zs(r="mutez",t="mutez",e){const n=new U(e);return n.isNaN()?e:n.multipliedBy(Math.pow(10,Ea(r))).dividedBy(Math.pow(10,Ea(t)))}function jd(r){const t=fd.blake2b(Fd(r),void 0,32);return vr(t,Vt.expr)}function vr(r,t){const e=typeof r=="string"?Uint8Array.from(nt.Buffer.from(r,"hex")):r,n=new Uint8Array(t.length+e.length);return n.set(t),n.set(e,t.length),Tn.encode(nt.Buffer.from(n.buffer))}const ou=(r,t)=>Tn.decode(r).slice(t.length);function Vd(r){const t=Tn.decode(r),e={[Vt.tz1.toString()]:"0000",[Vt.tz2.toString()]:"0001",[Vt.tz3.toString()]:"0002"},n={[Vt.txr1.toString()]:"02"},i=e[new Uint8Array(t.slice(0,3)).toString()],s=n[new Uint8Array(t.slice(0,4)).toString()];if(i){const o=bn(t.slice(3));return i+o}else if(s){const o=bn(t.slice(4));return s+o+"00"}else return"01"+bn(t.slice(3,42))+"00"}function Gd(r){const t=Tn.decode(r);return bn(t.slice(3,42))}function ws(r){if(r.substring(0,2)==="00"){const t={"0000":Vt.tz1,"0001":Vt.tz2,"0002":Vt.tz3};return vr(r.substring(4),t[r.substring(0,4)])}else if(r.substring(0,2)==="02")return vr(r.substring(2,r.length-2),Vt.txr1);return vr(r.substring(2,42),Vt.KT)}function va(r){return vr(r,Vt.tz4)}function Kd(r){if(r[0]==="0"){const t={"00":new Uint8Array([13,15,37,217]),"01":new Uint8Array([3,254,226,86]),"02":new Uint8Array([3,178,139,127])};return vr(r.substring(2),t[r.substring(0,2)])}}function wa(r){if(r[0]==="0"){const t={"00":new Uint8Array([6,161,159]),"01":new Uint8Array([6,161,161]),"02":new Uint8Array([6,161,164])};return vr(r.substring(2),t[r.substring(0,2)])}}const Fd=r=>{const t=r.match(/[\da-f]{2}/gi);if(t)return new Uint8Array(t.map(e=>parseInt(e,16)));throw new Id(r,"Uint8Array")},bn=r=>{const t=new Uint8Array(r),e=[];return t.forEach(n=>{const s=`00${n.toString(16)}`.slice(-2);e.push(s)}),e.join("")};function zy(r){return nt.Buffer.from(r,"utf8").toString("hex")}function _a(r){return r.startsWith("0x")?r.slice(2):r}function Gn(r,t){var e={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&t.indexOf(n)<0&&(e[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,n=Object.getOwnPropertySymbols(r);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(r,n[i])&&(e[n[i]]=r[n[i]]);return e}function j(r,t,e,n){function i(s){return s instanceof e?s:new e(function(o){o(s)})}return new(e||(e=Promise))(function(s,o){function a(f){try{p(n.next(f))}catch(m){o(m)}}function u(f){try{p(n.throw(f))}catch(m){o(m)}}function p(f){f.done?s(f.value):i(f.value).then(a,u)}p((n=n.apply(r,t||[])).next())})}const zd="main",K={block:"head"};var Aa;(function(r){r.GET_BAKING_RIGHTS="getBakingRights",r.GET_BALLOTS="getBallots",r.GET_BALLOT_LIST="getBallotList",r.GET_BIG_MAP_KEY="getBigMapKey",r.GET_BIG_MAP_EXPR="getBigMapExpr",r.GET_BLOCK_HASH="getBlockHash",r.GET_BLOCK="getBlock",r.GET_BLOCK_HEADER="getBlockHeader",r.GET_BLOCK_METADATA="getBlockMetadata",r.GET_BALANCE="getBalance",r.GET_CHAIN_ID="getChainId",r.GET_CONSTANTS="getConstants",r.GET_CONTRACT="getContract",r.GET_CURRENT_PERIOD="getCurrentPeriod",r.GET_CURRENT_PROPOSAL="getCurrentProposal",r.GET_CURRENT_QUORUM="getCurrentQuorum",r.GET_DELEGATE="getDelegate",r.GET_DELEGATES="getDelegates",r.GET_VOTING_INFO="getVotingInfo",r.GET_ENDORSING_RIGHTS="getEndorsingRights",r.GET_ENTRYPOINTS="getEntrypoints",r.GET_LIVE_BLOCKS="getLiveBlocks",r.GET_MANAGER_KEY="getManagerKey",r.GET_NORMALIZED_SCRIPT="getNormalizedScript",r.GET_PROPOSALS="getProposals",r.GET_PROTOCOLS="getProtocols",r.GET_SAPLING_DIFF_BY_CONTRACT="getSaplingDiffByContract",r.GET_SAPLING_DIFF_BY_ID="getSaplingDiffById",r.GET_SCRIPT="getScript",r.GET_STORAGE="getStorage",r.GET_SUCCESSOR_PERIOD="getSuccessorPeriod",r.GET_TX_ROLLUP_INBOX="getTxRollupInbox",r.GET_TX_ROLLUP_STATE="getTxRollupState",r.GET_VOTES_LISTINGS="getVotesListings",r.PACK_DATA="packData",r.GET_STORAGE_USED_SPACE="getStorageUsedSpace",r.GET_STORAGE_PAID_SPACE="getStoragePaidSpace",r.GET_TICKET_BALANCE="getTicketBalance",r.GET_ALL_TICKET_BALANCES="getAllTicketBalances",r.GET_PENDING_OPERATIONS="getPendingOperations",r.GET_ORIGINATION_PROOF="getOriginationProof"})(Aa||(Aa={}));function mn(r,t){const e=Array.isArray(r);typeof t>"u"&&(t=Object.keys(r));const n=e?[]:{};return t.forEach(i=>{const s=r[i];let o;if(!(typeof s>"u")){if(Array.isArray(s)){o=mn(s),n[i]=o;return}o=new U(s),n[i]=o}}),n}var Sa;(function(r){r.TOO_LARGE="too large"})(Sa||(Sa={}));var Ra;(function(r){r.BAKING_REWARDS="baking rewards",r.REWARDS="rewards",r.FEES="fees",r.DEPOSITS="deposits",r.LEGACY_REWARDS="legacy_rewards",r.LEGACY_FEES="legacy_fees",r.LEGACY_DEPOSITS="legacy_deposits",r.BLOCK_FEES="block fees",r.NONCE_REVELATION_REWARDS="nonce revelation rewards",r.DOUBLE_SIGNING_EVIDENCE_REWARDS="double signing evidence rewards",r.ENDORSING_REWARDS="endorsing rewards",r.BAKING_BONUSES="baking bonuses",r.STORAGE_FEES="storage fees",r.PUNISHMENTS="punishments",r.LOST_ENDORSING_REWARDS="lost endorsing rewards",r.SUBSIDY="subsidy",r.BURNED="burned",r.COMMITMENT="commitment",r.BOOTSTRAP="bootstrap",r.INVOICE="invoice",r.MINTED="minted",r.TX_ROLLUP_REJECTION_REWARDS="tx_rollup_rejection_rewards",r.TX_ROLLUP_REJECTION_PUNISHMENTS="tx_rollup_rejection_punishments",r.BONDS="bonds"})(Ra||(Ra={}));var Oa;(function(r){r.WASM2="wasm_2_0_0",r.ARITH="arith"})(Oa||(Oa={}));var Pa;(function(r){r.START="start",r.MOVE="move"})(Pa||(Pa={}));var Ta;(function(r){r.INBOX_PROOF="inbox_proof",r.REVEAL_PROOF="reveal_proof",r.FIRST_INPUT="first_input"})(Ta||(Ta={}));var Ia;(function(r){r.RAW_DATA_PROOF="raw_data_proof",r.METADATA_PROOF="metadata_proof",r.DAL_PAGE_PROOF="dal_page_proof"})(Ia||(Ia={}));var Na;(function(r){r.ONGOING="ongoing",r.ENDED="ended"})(Na||(Na={}));var xa;(function(r){r.LOSER="loser",r.DRAW="draw"})(xa||(xa={}));var La;(function(r){r.CONFLICT_RESOLVED="conflict_resolved",r.TIMEOUT="timeout"})(La||(La={}));var I;(function(r){r.ORIGINATION="origination",r.DELEGATION="delegation",r.REVEAL="reveal",r.TRANSACTION="transaction",r.ACTIVATION="activate_account",r.ENDORSEMENT="endorsement",r.PREENDORSEMENT="preendorsement",r.SET_DEPOSITS_LIMIT="set_deposits_limit",r.DOUBLE_PREENDORSEMENT_EVIDENCE="double_preendorsement_evidence",r.ENDORSEMENT_WITH_SLOT="endorsement_with_slot",r.SEED_NONCE_REVELATION="seed_nonce_revelation",r.DOUBLE_ENDORSEMENT_EVIDENCE="double_endorsement_evidence",r.DOUBLE_BAKING_EVIDENCE="double_baking_evidence",r.PROPOSALS="proposals",r.BALLOT="ballot",r.FAILING_NOOP="failing_noop",r.REGISTER_GLOBAL_CONSTANT="register_global_constant",r.TX_ROLLUP_ORIGINATION="tx_rollup_origination",r.TX_ROLLUP_SUBMIT_BATCH="tx_rollup_submit_batch",r.TX_ROLLUP_COMMIT="tx_rollup_commit",r.TX_ROLLUP_RETURN_BOND="tx_rollup_return_bond",r.TX_ROLLUP_FINALIZE_COMMITMENT="tx_rollup_finalize_commitment",r.TX_ROLLUP_REMOVE_COMMITMENT="tx_rollup_remove_commitment",r.TX_ROLLUP_REJECTION="tx_rollup_rejection",r.TX_ROLLUP_DISPATCH_TICKETS="tx_rollup_dispatch_tickets",r.TRANSFER_TICKET="transfer_ticket",r.INCREASE_PAID_STORAGE="increase_paid_storage",r.UPDATE_CONSENSUS_KEY="update_consensus_key",r.DRAIN_DELEGATE="drain_delegate",r.VDF_REVELATION="vdf_revelation",r.EVENT="event",r.TICKET_UPDATES="ticket_updates",r.SMART_ROLLUP_ORIGINATE="smart_rollup_originate",r.SMART_ROLLUP_ADD_MESSAGES="smart_rollup_add_messages",r.SMART_ROLLUP_EXECUTE_OUTBOX_MESSAGE="smart_rollup_execute_outbox_message",r.SMART_ROLLUP_PUBLISH="smart_rollup_publish",r.SMART_ROLLUP_CEMENT="smart_rollup_cement",r.SMART_ROLLUP_RECOVER_BOND="smart_rollup_recover_bond",r.SMART_ROLLUP_REFUTE="smart_rollup_refute",r.SMART_ROLLUP_TIMEOUT="smart_rollup_timeout"})(I||(I={}));class ei{constructor(t,e=zd,n=new ed){this.url=t,this.chain=e,this.httpBackend=n}createURL(t){return`${this.url.replace(/\/+$/g,"")}${t}`}validateAddress(t){const e=rt(t);if(e!==k.VALID)throw new at(t,V(e))}validateContract(t){const e=Wr(t);if(e!==k.VALID)throw new Dr(t,V(e))}getBlockHash({block:t}=K){return j(this,void 0,void 0,function*(){return yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${t}/hash`),method:"GET"})})}getLiveBlocks({block:t}=K){return j(this,void 0,void 0,function*(){return yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${t}/live_blocks`),method:"GET"})})}getBalance(t,{block:e}=K){return j(this,void 0,void 0,function*(){this.validateAddress(t);const n=yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${e}/context/contracts/${t}/balance`),method:"GET"});return new U(n)})}getStorage(t,{block:e}=K){return j(this,void 0,void 0,function*(){return this.validateContract(t),this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${e}/context/contracts/${t}/storage`),method:"GET"})})}getScript(t,{block:e}=K){return j(this,void 0,void 0,function*(){return this.validateContract(t),this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${e}/context/contracts/${t}/script`),method:"GET"})})}getNormalizedScript(t,e={unparsing_mode:"Readable"},{block:n}=K){return j(this,void 0,void 0,function*(){return this.validateContract(t),this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${n}/context/contracts/${t}/script/normalized`),method:"POST"},e)})}getContract(t,{block:e}=K){return j(this,void 0,void 0,function*(){this.validateAddress(t);const n=yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${e}/context/contracts/${t}`),method:"GET"});return Object.assign(Object.assign({},n),{balance:new U(n.balance)})})}getManagerKey(t,{block:e}=K){return j(this,void 0,void 0,function*(){return this.validateAddress(t),this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${e}/context/contracts/${t}/manager_key`),method:"GET"})})}getDelegate(t,{block:e}=K){return j(this,void 0,void 0,function*(){this.validateAddress(t);let n;try{n=yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${e}/context/contracts/${t}/delegate`),method:"GET"})}catch(i){if(i instanceof on&&i.status===vn.NOT_FOUND)n=null;else throw i}return n})}getBigMapKey(t,e,{block:n}=K){return j(this,void 0,void 0,function*(){return this.validateAddress(t),this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${n}/context/contracts/${t}/big_map_get`),method:"POST"},e)})}getBigMapExpr(t,e,{block:n}=K){return j(this,void 0,void 0,function*(){return this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${n}/context/big_maps/${t}/${e}`),method:"GET"})})}getDelegates(t,{block:e}=K){return j(this,void 0,void 0,function*(){this.validateAddress(t);const n=yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${e}/context/delegates/${t}`),method:"GET"}),i=mn(n,["balance","full_balance","current_frozen_deposits","frozen_deposits","frozen_balance","frozen_deposits_limit","staking_balance","delegated_balance","voting_power"]);return Object.assign(Object.assign(Object.assign({},n),i),{frozen_balance_by_cycle:n.frozen_balance_by_cycle?n.frozen_balance_by_cycle.map(s=>{var{deposit:o,deposits:a,fees:u,rewards:p}=s,f=Gn(s,["deposit","deposits","fees","rewards"]);const m=mn({deposit:o,deposits:a,fees:u,rewards:p},["deposit","deposits","fees","rewards"]);return Object.assign(Object.assign({},f),{deposit:m.deposit,deposits:m.deposits,fees:m.fees,rewards:m.rewards})}):void 0})})}getVotingInfo(t,{block:e}=K){return j(this,void 0,void 0,function*(){return this.validateAddress(t),yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${e}/context/delegates/${t}/voting_info`),method:"GET"})})}getConstants({block:t}=K){return j(this,void 0,void 0,function*(){const e=yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${t}/context/constants`),method:"GET"}),n=mn(e,["time_between_blocks","hard_gas_limit_per_operation","hard_gas_limit_per_block","proof_of_work_threshold","tokens_per_roll","seed_nonce_revelation_tip","block_security_deposit","endorsement_security_deposit","block_reward","endorsement_reward","cost_per_byte","hard_storage_limit_per_operation","test_chain_duration","baking_reward_per_endorsement","delay_per_missing_endorsement","minimal_block_delay","liquidity_baking_subsidy","cache_layout","baking_reward_fixed_portion","baking_reward_bonus_per_slot","endorsing_reward_per_slot","double_baking_punishment","delay_increment_per_round","tx_rollup_commitment_bond","vdf_difficulty","sc_rollup_stake_amount","minimal_stake"]);return Object.assign(Object.assign({},e),n)})}getBlock({block:t}=K){return j(this,void 0,void 0,function*(){return yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${t}`),method:"GET"})})}getBlockHeader({block:t}=K){return j(this,void 0,void 0,function*(){return yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${t}/header`),method:"GET"})})}getBlockMetadata({block:t}=K){return j(this,void 0,void 0,function*(){return yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${t}/metadata`),method:"GET"})})}getBakingRights(t={},{block:e}=K){return j(this,void 0,void 0,function*(){return yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${e}/helpers/baking_rights`),method:"GET",query:t})})}getEndorsingRights(t={},{block:e}=K){return j(this,void 0,void 0,function*(){return yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${e}/helpers/endorsing_rights`),method:"GET",query:t})})}getBallotList({block:t}=K){return j(this,void 0,void 0,function*(){return yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${t}/votes/ballot_list`),method:"GET"})})}getBallots({block:t}=K){return j(this,void 0,void 0,function*(){const e=yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${t}/votes/ballots`),method:"GET"});return mn(e,["yay","nay","pass"])})}getCurrentProposal({block:t}=K){return j(this,void 0,void 0,function*(){return yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${t}/votes/current_proposal`),method:"GET"})})}getCurrentQuorum({block:t}=K){return j(this,void 0,void 0,function*(){return yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${t}/votes/current_quorum`),method:"GET"})})}getVotesListings({block:t}=K){return j(this,void 0,void 0,function*(){const e=yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${t}/votes/listings`),method:"GET"});return e.map(n=>(n.voting_power&&(n.voting_power=new U(n.voting_power)),n)),e})}getProposals({block:t}=K){return j(this,void 0,void 0,function*(){const e=yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${t}/votes/proposals`),method:"GET"});return e.map(n=>n[1]=new U(n[1])),e})}forgeOperations(t,{block:e}=K){return j(this,void 0,void 0,function*(){return this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${e}/helpers/forge/operations`),method:"POST"},t)})}injectOperation(t){return j(this,void 0,void 0,function*(){return this.httpBackend.createRequest({url:this.createURL("/injection/operation"),method:"POST"},t)})}preapplyOperations(t,{block:e}=K){return j(this,void 0,void 0,function*(){return yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${e}/helpers/preapply/operations`),method:"POST"},t)})}getEntrypoints(t,{block:e}=K){return j(this,void 0,void 0,function*(){return this.validateContract(t),yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${e}/context/contracts/${t}/entrypoints`),method:"GET"})})}runOperation(t,{block:e}=K){return j(this,void 0,void 0,function*(){return yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${e}/helpers/scripts/run_operation`),method:"POST"},t)})}runCode(t,{block:e}=K){return j(this,void 0,void 0,function*(){return yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${e}/helpers/scripts/run_code`),method:"POST"},t)})}runScriptView(t,{block:e}=K){var{unparsing_mode:n="Readable"}=t,i=Gn(t,["unparsing_mode"]);return j(this,void 0,void 0,function*(){return this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${e}/helpers/scripts/run_script_view`),method:"POST"},Object.assign({unparsing_mode:n},i))})}runView(t,{block:e}=K){var{unparsing_mode:n="Readable"}=t,i=Gn(t,["unparsing_mode"]);return j(this,void 0,void 0,function*(){return this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${e}/helpers/scripts/run_view`),method:"POST"},Object.assign({unparsing_mode:n},i))})}getChainId(){return j(this,void 0,void 0,function*(){return this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/chain_id`),method:"GET"})})}packData(t,{block:e}=K){return j(this,void 0,void 0,function*(){const n=yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${e}/helpers/scripts/pack_data`),method:"POST"},t),{gas:i}=n,s=Gn(n,["gas"]);let o=i;const a=new U(i||"");return a.isNaN()||(o=a),Object.assign({gas:o},s)})}getRpcUrl(){return this.url}getCurrentPeriod({block:t}=K){return j(this,void 0,void 0,function*(){return yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${t}/votes/current_period`),method:"GET"})})}getSuccessorPeriod({block:t}=K){return j(this,void 0,void 0,function*(){return yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${t}/votes/successor_period`),method:"GET"})})}getSaplingDiffById(t,{block:e}=K){return j(this,void 0,void 0,function*(){return this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${e}/context/sapling/${t}/get_diff`),method:"GET"})})}getSaplingDiffByContract(t,{block:e}=K){return j(this,void 0,void 0,function*(){return this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${e}/context/contracts/${t}/single_sapling_get_diff`),method:"GET"})})}getProtocols({block:t}=K){return j(this,void 0,void 0,function*(){return this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${t}/protocols`),method:"GET"})})}getTxRollupState(t,{block:e}=K){return j(this,void 0,void 0,function*(){return this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${e}/context/tx_rollup/${t}/state`),method:"GET"})})}getTxRollupInbox(t,e,{block:n}=K){return j(this,void 0,void 0,function*(){return this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${n}/context/tx_rollup/${t}/inbox/${e}`),method:"GET"})})}getStorageUsedSpace(t,{block:e}=K){return j(this,void 0,void 0,function*(){return this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${e}/context/contracts/${t}/storage/used_space`),method:"GET"})})}getStoragePaidSpace(t,{block:e}=K){return j(this,void 0,void 0,function*(){return this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${e}/context/contracts/${t}/storage/paid_space`),method:"GET"})})}getTicketBalance(t,e,{block:n}=K){return j(this,void 0,void 0,function*(){return this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${n}/context/contracts/${t}/ticket_balance`),method:"POST"},e)})}getAllTicketBalances(t,{block:e}=K){return j(this,void 0,void 0,function*(){return this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${e}/context/contracts/${t}/all_ticket_balances`),method:"GET"})})}getPendingOperations(t={}){return j(this,void 0,void 0,function*(){return this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/mempool/pending_operations`),method:"GET",query:t})})}getOriginationProof(t,{block:e}=K){return j(this,void 0,void 0,function*(){return this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${e}/context/smart_rollups/all/origination_proof`),method:"POST"},t)})}}/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var _s=function(r,t){return _s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var i in n)n.hasOwnProperty(i)&&(e[i]=n[i])},_s(r,t)};function Y(r,t){_s(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}function ci(r){return typeof r=="function"}var Ca=!1,Ce={Promise:void 0,set useDeprecatedSynchronousErrorHandling(r){if(r){var t=new Error;""+t.stack}Ca=r},get useDeprecatedSynchronousErrorHandling(){return Ca}};function Fr(r){setTimeout(function(){throw r},0)}var ui={closed:!0,next:function(r){},error:function(r){if(Ce.useDeprecatedSynchronousErrorHandling)throw r;Fr(r)},complete:function(){}},Ys=function(){return Array.isArray||function(r){return r&&typeof r.length=="number"}}();function au(r){return r!==null&&typeof r=="object"}var qd=function(){function r(t){return Error.call(this),this.message=t?t.length+` errors occurred during unsubscription:
`+t.map(function(e,n){return n+1+") "+e.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=t,this}return r.prototype=Object.create(Error.prototype),r}(),ri=qd,oe=function(){function r(t){this.closed=!1,this._parentOrParents=null,this._subscriptions=null,t&&(this._ctorUnsubscribe=!0,this._unsubscribe=t)}return r.prototype.unsubscribe=function(){var t;if(!this.closed){var e=this,n=e._parentOrParents,i=e._ctorUnsubscribe,s=e._unsubscribe,o=e._subscriptions;if(this.closed=!0,this._parentOrParents=null,this._subscriptions=null,n instanceof r)n.remove(this);else if(n!==null)for(var a=0;a<n.length;++a){var u=n[a];u.remove(this)}if(ci(s)){i&&(this._unsubscribe=void 0);try{s.call(this)}catch(m){t=m instanceof ri?Da(m.errors):[m]}}if(Ys(o))for(var a=-1,p=o.length;++a<p;){var f=o[a];if(au(f))try{f.unsubscribe()}catch(N){t=t||[],N instanceof ri?t=t.concat(Da(N.errors)):t.push(N)}}if(t)throw new ri(t)}},r.prototype.add=function(t){var e=t;if(!t)return r.EMPTY;switch(typeof t){case"function":e=new r(t);case"object":if(e===this||e.closed||typeof e.unsubscribe!="function")return e;if(this.closed)return e.unsubscribe(),e;if(!(e instanceof r)){var n=e;e=new r,e._subscriptions=[n]}break;default:throw new Error("unrecognized teardown "+t+" added to Subscription.")}var i=e._parentOrParents;if(i===null)e._parentOrParents=this;else if(i instanceof r){if(i===this)return e;e._parentOrParents=[i,this]}else if(i.indexOf(this)===-1)i.push(this);else return e;var s=this._subscriptions;return s===null?this._subscriptions=[e]:s.push(e),e},r.prototype.remove=function(t){var e=this._subscriptions;if(e){var n=e.indexOf(t);n!==-1&&e.splice(n,1)}},r.EMPTY=function(t){return t.closed=!0,t}(new r),r}();function Da(r){return r.reduce(function(t,e){return t.concat(e instanceof ri?e.errors:e)},[])}var li=function(){return typeof Symbol=="function"?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random()}(),_t=function(r){Y(t,r);function t(e,n,i){var s=r.call(this)||this;switch(s.syncErrorValue=null,s.syncErrorThrown=!1,s.syncErrorThrowable=!1,s.isStopped=!1,arguments.length){case 0:s.destination=ui;break;case 1:if(!e){s.destination=ui;break}if(typeof e=="object"){e instanceof t?(s.syncErrorThrowable=e.syncErrorThrowable,s.destination=e,e.add(s)):(s.syncErrorThrowable=!0,s.destination=new Ma(s,e));break}default:s.syncErrorThrowable=!0,s.destination=new Ma(s,e,n,i);break}return s}return t.prototype[li]=function(){return this},t.create=function(e,n,i){var s=new t(e,n,i);return s.syncErrorThrowable=!1,s},t.prototype.next=function(e){this.isStopped||this._next(e)},t.prototype.error=function(e){this.isStopped||(this.isStopped=!0,this._error(e))},t.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,r.prototype.unsubscribe.call(this))},t.prototype._next=function(e){this.destination.next(e)},t.prototype._error=function(e){this.destination.error(e),this.unsubscribe()},t.prototype._complete=function(){this.destination.complete(),this.unsubscribe()},t.prototype._unsubscribeAndRecycle=function(){var e=this._parentOrParents;return this._parentOrParents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parentOrParents=e,this},t}(oe),Ma=function(r){Y(t,r);function t(e,n,i,s){var o=r.call(this)||this;o._parentSubscriber=e;var a,u=o;return ci(n)?a=n:n&&(a=n.next,i=n.error,s=n.complete,n!==ui&&(u=Object.create(n),ci(u.unsubscribe)&&o.add(u.unsubscribe.bind(u)),u.unsubscribe=o.unsubscribe.bind(o))),o._context=u,o._next=a,o._error=i,o._complete=s,o}return t.prototype.next=function(e){if(!this.isStopped&&this._next){var n=this._parentSubscriber;!Ce.useDeprecatedSynchronousErrorHandling||!n.syncErrorThrowable?this.__tryOrUnsub(this._next,e):this.__tryOrSetError(n,this._next,e)&&this.unsubscribe()}},t.prototype.error=function(e){if(!this.isStopped){var n=this._parentSubscriber,i=Ce.useDeprecatedSynchronousErrorHandling;if(this._error)!i||!n.syncErrorThrowable?(this.__tryOrUnsub(this._error,e),this.unsubscribe()):(this.__tryOrSetError(n,this._error,e),this.unsubscribe());else if(n.syncErrorThrowable)i?(n.syncErrorValue=e,n.syncErrorThrown=!0):Fr(e),this.unsubscribe();else{if(this.unsubscribe(),i)throw e;Fr(e)}}},t.prototype.complete=function(){var e=this;if(!this.isStopped){var n=this._parentSubscriber;if(this._complete){var i=function(){return e._complete.call(e._context)};!Ce.useDeprecatedSynchronousErrorHandling||!n.syncErrorThrowable?(this.__tryOrUnsub(i),this.unsubscribe()):(this.__tryOrSetError(n,i),this.unsubscribe())}else this.unsubscribe()}},t.prototype.__tryOrUnsub=function(e,n){try{e.call(this._context,n)}catch(i){if(this.unsubscribe(),Ce.useDeprecatedSynchronousErrorHandling)throw i;Fr(i)}},t.prototype.__tryOrSetError=function(e,n,i){if(!Ce.useDeprecatedSynchronousErrorHandling)throw new Error("bad call");try{n.call(this._context,i)}catch(s){return Ce.useDeprecatedSynchronousErrorHandling?(e.syncErrorValue=s,e.syncErrorThrown=!0,!0):(Fr(s),!0)}return!1},t.prototype._unsubscribe=function(){var e=this._parentSubscriber;this._context=null,this._parentSubscriber=null,e.unsubscribe()},t}(_t);function Wd(r){for(;r;){var t=r,e=t.closed,n=t.destination,i=t.isStopped;if(e||i)return!1;n&&n instanceof _t?r=n:r=null}return!0}function Zd(r,t,e){if(r){if(r instanceof _t)return r;if(r[li])return r[li]()}return!r&&!t&&!e?new _t(ui):new _t(r,t,e)}var In=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}();function Xs(r){return r}function Yd(r){return r.length===0?Xs:r.length===1?r[0]:function(e){return r.reduce(function(n,i){return i(n)},e)}}var gt=function(){function r(t){this._isScalar=!1,t&&(this._subscribe=t)}return r.prototype.lift=function(t){var e=new r;return e.source=this,e.operator=t,e},r.prototype.subscribe=function(t,e,n){var i=this.operator,s=Zd(t,e,n);if(i?s.add(i.call(s,this.source)):s.add(this.source||Ce.useDeprecatedSynchronousErrorHandling&&!s.syncErrorThrowable?this._subscribe(s):this._trySubscribe(s)),Ce.useDeprecatedSynchronousErrorHandling&&s.syncErrorThrowable&&(s.syncErrorThrowable=!1,s.syncErrorThrown))throw s.syncErrorValue;return s},r.prototype._trySubscribe=function(t){try{return this._subscribe(t)}catch(e){Ce.useDeprecatedSynchronousErrorHandling&&(t.syncErrorThrown=!0,t.syncErrorValue=e),Wd(t)?t.error(e):console.warn(e)}},r.prototype.forEach=function(t,e){var n=this;return e=ka(e),new e(function(i,s){var o;o=n.subscribe(function(a){try{t(a)}catch(u){s(u),o&&o.unsubscribe()}},s,i)})},r.prototype._subscribe=function(t){var e=this.source;return e&&e.subscribe(t)},r.prototype[In]=function(){return this},r.prototype.pipe=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return t.length===0?this:Yd(t)(this)},r.prototype.toPromise=function(t){var e=this;return t=ka(t),new t(function(n,i){var s;e.subscribe(function(o){return s=o},function(o){return i(o)},function(){return n(s)})})},r.create=function(t){return new r(t)},r}();function ka(r){if(r||(r=Promise),!r)throw new Error("no Promise impl found");return r}var Xd=function(){function r(){return Error.call(this),this.message="object unsubscribed",this.name="ObjectUnsubscribedError",this}return r.prototype=Object.create(Error.prototype),r}(),Tr=Xd,cu=function(r){Y(t,r);function t(e,n){var i=r.call(this)||this;return i.subject=e,i.subscriber=n,i.closed=!1,i}return t.prototype.unsubscribe=function(){if(!this.closed){this.closed=!0;var e=this.subject,n=e.observers;if(this.subject=null,!(!n||n.length===0||e.isStopped||e.closed)){var i=n.indexOf(this.subscriber);i!==-1&&n.splice(i,1)}}},t}(oe),uu=function(r){Y(t,r);function t(e){var n=r.call(this,e)||this;return n.destination=e,n}return t}(_t),Jr=function(r){Y(t,r);function t(){var e=r.call(this)||this;return e.observers=[],e.closed=!1,e.isStopped=!1,e.hasError=!1,e.thrownError=null,e}return t.prototype[li]=function(){return new uu(this)},t.prototype.lift=function(e){var n=new Ba(this,this);return n.operator=e,n},t.prototype.next=function(e){if(this.closed)throw new Tr;if(!this.isStopped)for(var n=this.observers,i=n.length,s=n.slice(),o=0;o<i;o++)s[o].next(e)},t.prototype.error=function(e){if(this.closed)throw new Tr;this.hasError=!0,this.thrownError=e,this.isStopped=!0;for(var n=this.observers,i=n.length,s=n.slice(),o=0;o<i;o++)s[o].error(e);this.observers.length=0},t.prototype.complete=function(){if(this.closed)throw new Tr;this.isStopped=!0;for(var e=this.observers,n=e.length,i=e.slice(),s=0;s<n;s++)i[s].complete();this.observers.length=0},t.prototype.unsubscribe=function(){this.isStopped=!0,this.closed=!0,this.observers=null},t.prototype._trySubscribe=function(e){if(this.closed)throw new Tr;return r.prototype._trySubscribe.call(this,e)},t.prototype._subscribe=function(e){if(this.closed)throw new Tr;return this.hasError?(e.error(this.thrownError),oe.EMPTY):this.isStopped?(e.complete(),oe.EMPTY):(this.observers.push(e),new cu(this,e))},t.prototype.asObservable=function(){var e=new gt;return e.source=this,e},t.create=function(e,n){return new Ba(e,n)},t}(gt),Ba=function(r){Y(t,r);function t(e,n){var i=r.call(this)||this;return i.destination=e,i.source=n,i}return t.prototype.next=function(e){var n=this.destination;n&&n.next&&n.next(e)},t.prototype.error=function(e){var n=this.destination;n&&n.error&&this.destination.error(e)},t.prototype.complete=function(){var e=this.destination;e&&e.complete&&this.destination.complete()},t.prototype._subscribe=function(e){var n=this.source;return n?this.source.subscribe(e):oe.EMPTY},t}(Jr);function wn(){return function(t){return t.lift(new Jd(t))}}var Jd=function(){function r(t){this.connectable=t}return r.prototype.call=function(t,e){var n=this.connectable;n._refCount++;var i=new Qd(t,n),s=e.subscribe(i);return i.closed||(i.connection=n.connect()),s},r}(),Qd=function(r){Y(t,r);function t(e,n){var i=r.call(this,e)||this;return i.connectable=n,i}return t.prototype._unsubscribe=function(){var e=this.connectable;if(!e){this.connection=null;return}this.connectable=null;var n=e._refCount;if(n<=0){this.connection=null;return}if(e._refCount=n-1,n>1){this.connection=null;return}var i=this.connection,s=e._connection;this.connection=null,s&&(!i||s===i)&&s.unsubscribe()},t}(_t),tp=function(r){Y(t,r);function t(e,n){var i=r.call(this)||this;return i.source=e,i.subjectFactory=n,i._refCount=0,i._isComplete=!1,i}return t.prototype._subscribe=function(e){return this.getSubject().subscribe(e)},t.prototype.getSubject=function(){var e=this._subject;return(!e||e.isStopped)&&(this._subject=this.subjectFactory()),this._subject},t.prototype.connect=function(){var e=this._connection;return e||(this._isComplete=!1,e=this._connection=new oe,e.add(this.source.subscribe(new rp(this.getSubject(),this))),e.closed&&(this._connection=null,e=oe.EMPTY)),e},t.prototype.refCount=function(){return wn()(this)},t}(gt),ep=function(){var r=tp.prototype;return{operator:{value:null},_refCount:{value:0,writable:!0},_subject:{value:null,writable:!0},_connection:{value:null,writable:!0},_subscribe:{value:r._subscribe},_isComplete:{value:r._isComplete,writable:!0},getSubject:{value:r.getSubject},connect:{value:r.connect},refCount:{value:r.refCount}}}(),rp=function(r){Y(t,r);function t(e,n){var i=r.call(this,e)||this;return i.connectable=n,i}return t.prototype._error=function(e){this._unsubscribe(),r.prototype._error.call(this,e)},t.prototype._complete=function(){this.connectable._isComplete=!0,this._unsubscribe(),r.prototype._complete.call(this)},t.prototype._unsubscribe=function(){var e=this.connectable;if(e){this.connectable=null;var n=e._connection;e._refCount=0,e._subject=null,e._connection=null,n&&n.unsubscribe()}},t}(uu),Oi=function(r){Y(t,r);function t(e){var n=r.call(this)||this;return n._value=e,n}return Object.defineProperty(t.prototype,"value",{get:function(){return this.getValue()},enumerable:!0,configurable:!0}),t.prototype._subscribe=function(e){var n=r.prototype._subscribe.call(this,e);return n&&!n.closed&&e.next(this._value),n},t.prototype.getValue=function(){if(this.hasError)throw this.thrownError;if(this.closed)throw new Tr;return this._value},t.prototype.next=function(e){r.prototype.next.call(this,this._value=e)},t}(Jr),np=function(r){Y(t,r);function t(e,n){return r.call(this)||this}return t.prototype.schedule=function(e,n){return this},t}(oe),lu=function(r){Y(t,r);function t(e,n){var i=r.call(this,e,n)||this;return i.scheduler=e,i.work=n,i.pending=!1,i}return t.prototype.schedule=function(e,n){if(n===void 0&&(n=0),this.closed)return this;this.state=e;var i=this.id,s=this.scheduler;return i!=null&&(this.id=this.recycleAsyncId(s,i,n)),this.pending=!0,this.delay=n,this.id=this.id||this.requestAsyncId(s,this.id,n),this},t.prototype.requestAsyncId=function(e,n,i){return i===void 0&&(i=0),setInterval(e.flush.bind(e,this),i)},t.prototype.recycleAsyncId=function(e,n,i){if(i===void 0&&(i=0),i!==null&&this.delay===i&&this.pending===!1)return n;clearInterval(n)},t.prototype.execute=function(e,n){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var i=this._execute(e,n);if(i)return i;this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},t.prototype._execute=function(e,n){var i=!1,s=void 0;try{this.work(e)}catch(o){i=!0,s=!!o&&o||new Error(o)}if(i)return this.unsubscribe(),s},t.prototype._unsubscribe=function(){var e=this.id,n=this.scheduler,i=n.actions,s=i.indexOf(this);this.work=null,this.state=null,this.pending=!1,this.scheduler=null,s!==-1&&i.splice(s,1),e!=null&&(this.id=this.recycleAsyncId(n,e,null)),this.delay=null},t}(np),ip=function(r){Y(t,r);function t(e,n){var i=r.call(this,e,n)||this;return i.scheduler=e,i.work=n,i}return t.prototype.schedule=function(e,n){return n===void 0&&(n=0),n>0?r.prototype.schedule.call(this,e,n):(this.delay=n,this.state=e,this.scheduler.flush(this),this)},t.prototype.execute=function(e,n){return n>0||this.closed?r.prototype.execute.call(this,e,n):this._execute(e,n)},t.prototype.requestAsyncId=function(e,n,i){return i===void 0&&(i=0),i!==null&&i>0||i===null&&this.delay>0?r.prototype.requestAsyncId.call(this,e,n,i):e.flush(this)},t}(lu),Ua=function(){function r(t,e){e===void 0&&(e=r.now),this.SchedulerAction=t,this.now=e}return r.prototype.schedule=function(t,e,n){return e===void 0&&(e=0),new this.SchedulerAction(this,t).schedule(n,e)},r.now=function(){return Date.now()},r}(),hu=function(r){Y(t,r);function t(e,n){n===void 0&&(n=Ua.now);var i=r.call(this,e,function(){return t.delegate&&t.delegate!==i?t.delegate.now():n()})||this;return i.actions=[],i.active=!1,i.scheduled=void 0,i}return t.prototype.schedule=function(e,n,i){return n===void 0&&(n=0),t.delegate&&t.delegate!==this?t.delegate.schedule(e,n,i):r.prototype.schedule.call(this,e,n,i)},t.prototype.flush=function(e){var n=this.actions;if(this.active){n.push(e);return}var i;this.active=!0;do if(i=e.execute(e.state,e.delay))break;while(e=n.shift());if(this.active=!1,i){for(;e=n.shift();)e.unsubscribe();throw i}},t}(Ua),sp=function(r){Y(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t}(hu),op=new sp(ip),ap=op,du=new gt(function(r){return r.complete()});function Js(r){return r?cp(r):du}function cp(r){return new gt(function(t){return r.schedule(function(){return t.complete()})})}function _n(r){return r&&typeof r.schedule=="function"}var pu=function(r){return function(t){for(var e=0,n=r.length;e<n&&!t.closed;e++)t.next(r[e]);t.complete()}};function Qs(r,t){return new gt(function(e){var n=new oe,i=0;return n.add(t.schedule(function(){if(i===r.length){e.complete();return}e.next(r[i++]),e.closed||n.add(this.schedule())})),n})}function fu(r,t){return t?Qs(r,t):new gt(pu(r))}function an(){for(var r=[],t=0;t<arguments.length;t++)r[t]=arguments[t];var e=r[r.length-1];return _n(e)?(r.pop(),Qs(r,e)):fu(r)}function to(r,t){return t?new gt(function(e){return t.schedule(up,0,{error:r,subscriber:e})}):new gt(function(e){return e.error(r)})}function up(r){var t=r.error,e=r.subscriber;e.error(t)}var us=function(){function r(t,e,n){this.kind=t,this.value=e,this.error=n,this.hasValue=t==="N"}return r.prototype.observe=function(t){switch(this.kind){case"N":return t.next&&t.next(this.value);case"E":return t.error&&t.error(this.error);case"C":return t.complete&&t.complete()}},r.prototype.do=function(t,e,n){var i=this.kind;switch(i){case"N":return t&&t(this.value);case"E":return e&&e(this.error);case"C":return n&&n()}},r.prototype.accept=function(t,e,n){return t&&typeof t.next=="function"?this.observe(t):this.do(t,e,n)},r.prototype.toObservable=function(){var t=this.kind;switch(t){case"N":return an(this.value);case"E":return to(this.error);case"C":return Js()}throw new Error("unexpected notification kind value")},r.createNext=function(t){return typeof t<"u"?new r("N",t):r.undefinedValueNotification},r.createError=function(t){return new r("E",void 0,t)},r.createComplete=function(){return r.completeNotification},r.completeNotification=new r("C"),r.undefinedValueNotification=new r("N",void 0),r}(),lp=function(r){Y(t,r);function t(e,n,i){i===void 0&&(i=0);var s=r.call(this,e)||this;return s.scheduler=n,s.delay=i,s}return t.dispatch=function(e){var n=e.notification,i=e.destination;n.observe(i),this.unsubscribe()},t.prototype.scheduleMessage=function(e){var n=this.destination;n.add(this.scheduler.schedule(t.dispatch,this.delay,new hp(e,this.destination)))},t.prototype._next=function(e){this.scheduleMessage(us.createNext(e))},t.prototype._error=function(e){this.scheduleMessage(us.createError(e)),this.unsubscribe()},t.prototype._complete=function(){this.scheduleMessage(us.createComplete()),this.unsubscribe()},t}(_t),hp=function(){function r(t,e){this.notification=t,this.destination=e}return r}(),An=function(r){Y(t,r);function t(e,n,i){e===void 0&&(e=Number.POSITIVE_INFINITY),n===void 0&&(n=Number.POSITIVE_INFINITY);var s=r.call(this)||this;return s.scheduler=i,s._events=[],s._infiniteTimeWindow=!1,s._bufferSize=e<1?1:e,s._windowTime=n<1?1:n,n===Number.POSITIVE_INFINITY?(s._infiniteTimeWindow=!0,s.next=s.nextInfiniteTimeWindow):s.next=s.nextTimeWindow,s}return t.prototype.nextInfiniteTimeWindow=function(e){if(!this.isStopped){var n=this._events;n.push(e),n.length>this._bufferSize&&n.shift()}r.prototype.next.call(this,e)},t.prototype.nextTimeWindow=function(e){this.isStopped||(this._events.push(new dp(this._getNow(),e)),this._trimBufferThenGetEvents()),r.prototype.next.call(this,e)},t.prototype._subscribe=function(e){var n=this._infiniteTimeWindow,i=n?this._events:this._trimBufferThenGetEvents(),s=this.scheduler,o=i.length,a;if(this.closed)throw new Tr;if(this.isStopped||this.hasError?a=oe.EMPTY:(this.observers.push(e),a=new cu(this,e)),s&&e.add(e=new lp(e,s)),n)for(var u=0;u<o&&!e.closed;u++)e.next(i[u]);else for(var u=0;u<o&&!e.closed;u++)e.next(i[u].value);return this.hasError?e.error(this.thrownError):this.isStopped&&e.complete(),a},t.prototype._getNow=function(){return(this.scheduler||ap).now()},t.prototype._trimBufferThenGetEvents=function(){for(var e=this._getNow(),n=this._bufferSize,i=this._windowTime,s=this._events,o=s.length,a=0;a<o&&!(e-s[a].time<i);)a++;return o>n&&(a=Math.max(a,o-n)),a>0&&s.splice(0,a),s},t}(Jr),dp=function(){function r(t,e){this.time=t,this.value=e}return r}(),pp=new hu(lu),gu=pp;function Fe(){}var fp=function(){function r(){return Error.call(this),this.message="argument out of range",this.name="ArgumentOutOfRangeError",this}return r.prototype=Object.create(Error.prototype),r}(),gp=fp,mp=function(){function r(){return Error.call(this),this.message="no elements in sequence",this.name="EmptyError",this}return r.prototype=Object.create(Error.prototype),r}(),mu=mp;function Mr(r,t){return function(n){if(typeof r!="function")throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return n.lift(new yp(r,t))}}var yp=function(){function r(t,e){this.project=t,this.thisArg=e}return r.prototype.call=function(t,e){return e.subscribe(new bp(t,this.project,this.thisArg))},r}(),bp=function(r){Y(t,r);function t(e,n,i){var s=r.call(this,e)||this;return s.project=n,s.count=0,s.thisArg=i||s,s}return t.prototype._next=function(e){var n;try{n=this.project.call(this.thisArg,e,this.count++)}catch(i){this.destination.error(i);return}this.destination.next(n)},t}(_t),Ep=function(r){Y(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.notifyNext=function(e,n,i,s,o){this.destination.next(n)},t.prototype.notifyError=function(e,n){this.destination.error(e)},t.prototype.notifyComplete=function(e){this.destination.complete()},t}(_t),vp=function(r){Y(t,r);function t(e,n,i){var s=r.call(this)||this;return s.parent=e,s.outerValue=n,s.outerIndex=i,s.index=0,s}return t.prototype._next=function(e){this.parent.notifyNext(this.outerValue,e,this.outerIndex,this.index++,this)},t.prototype._error=function(e){this.parent.notifyError(e,this),this.unsubscribe()},t.prototype._complete=function(){this.parent.notifyComplete(this),this.unsubscribe()},t}(_t),wp=function(r){return function(t){return r.then(function(e){t.closed||(t.next(e),t.complete())},function(e){return t.error(e)}).then(null,Fr),t}};function _p(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var Pi=_p(),Ap=function(r){return function(t){var e=r[Pi]();do{var n=void 0;try{n=e.next()}catch(i){return t.error(i),t}if(n.done){t.complete();break}if(t.next(n.value),t.closed)break}while(!0);return typeof e.return=="function"&&t.add(function(){e.return&&e.return()}),t}},Sp=function(r){return function(t){var e=r[In]();if(typeof e.subscribe!="function")throw new TypeError("Provided object does not correctly implement Symbol.observable");return e.subscribe(t)}},yu=function(r){return r&&typeof r.length=="number"&&typeof r!="function"};function bu(r){return!!r&&typeof r.subscribe!="function"&&typeof r.then=="function"}var eo=function(r){if(r&&typeof r[In]=="function")return Sp(r);if(yu(r))return pu(r);if(bu(r))return wp(r);if(r&&typeof r[Pi]=="function")return Ap(r);var t=au(r)?"an invalid object":"'"+r+"'",e="You provided "+t+" where a stream was expected. You can provide an Observable, Promise, Array, or Iterable.";throw new TypeError(e)};function Rp(r,t,e,n,i){if(i===void 0&&(i=new vp(r,e,n)),!i.closed)return t instanceof gt?t.subscribe(i):eo(t)(i)}var Ha={};function $a(){for(var r=[],t=0;t<arguments.length;t++)r[t]=arguments[t];var e=void 0,n=void 0;return _n(r[r.length-1])&&(n=r.pop()),typeof r[r.length-1]=="function"&&(e=r.pop()),r.length===1&&Ys(r[0])&&(r=r[0]),fu(r,n).lift(new Op(e))}var Op=function(){function r(t){this.resultSelector=t}return r.prototype.call=function(t,e){return e.subscribe(new Pp(t,this.resultSelector))},r}(),Pp=function(r){Y(t,r);function t(e,n){var i=r.call(this,e)||this;return i.resultSelector=n,i.active=0,i.values=[],i.observables=[],i}return t.prototype._next=function(e){this.values.push(Ha),this.observables.push(e)},t.prototype._complete=function(){var e=this.observables,n=e.length;if(n===0)this.destination.complete();else{this.active=n,this.toRespond=n;for(var i=0;i<n;i++){var s=e[i];this.add(Rp(this,s,void 0,i))}}},t.prototype.notifyComplete=function(e){(this.active-=1)===0&&this.destination.complete()},t.prototype.notifyNext=function(e,n,i){var s=this.values,o=s[i],a=this.toRespond?o===Ha?--this.toRespond:this.toRespond:0;s[i]=n,a===0&&(this.resultSelector?this._tryResultSelector(s):this.destination.next(s.slice()))},t.prototype._tryResultSelector=function(e){var n;try{n=this.resultSelector.apply(this,e)}catch(i){this.destination.error(i);return}this.destination.next(n)},t}(Ep);function Tp(r,t){return new gt(function(e){var n=new oe;return n.add(t.schedule(function(){var i=r[In]();n.add(i.subscribe({next:function(s){n.add(t.schedule(function(){return e.next(s)}))},error:function(s){n.add(t.schedule(function(){return e.error(s)}))},complete:function(){n.add(t.schedule(function(){return e.complete()}))}}))})),n})}function Ip(r,t){return new gt(function(e){var n=new oe;return n.add(t.schedule(function(){return r.then(function(i){n.add(t.schedule(function(){e.next(i),n.add(t.schedule(function(){return e.complete()}))}))},function(i){n.add(t.schedule(function(){return e.error(i)}))})})),n})}function Np(r,t){if(!r)throw new Error("Iterable cannot be null");return new gt(function(e){var n=new oe,i;return n.add(function(){i&&typeof i.return=="function"&&i.return()}),n.add(t.schedule(function(){i=r[Pi](),n.add(t.schedule(function(){if(!e.closed){var s,o;try{var a=i.next();s=a.value,o=a.done}catch(u){e.error(u);return}o?e.complete():(e.next(s),this.schedule())}}))})),n})}function xp(r){return r&&typeof r[In]=="function"}function Lp(r){return r&&typeof r[Pi]=="function"}function Cp(r,t){if(r!=null){if(xp(r))return Tp(r,t);if(bu(r))return Ip(r,t);if(yu(r))return Qs(r,t);if(Lp(r)||typeof r=="string")return Np(r,t)}throw new TypeError((r!==null&&typeof r||r)+" is not observable")}function Br(r,t){return t?Cp(r,t):r instanceof gt?r:new gt(eo(r))}var Nn=function(r){Y(t,r);function t(e){var n=r.call(this)||this;return n.parent=e,n}return t.prototype._next=function(e){this.parent.notifyNext(e)},t.prototype._error=function(e){this.parent.notifyError(e),this.unsubscribe()},t.prototype._complete=function(){this.parent.notifyComplete(),this.unsubscribe()},t}(_t),xn=function(r){Y(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.notifyNext=function(e){this.destination.next(e)},t.prototype.notifyError=function(e){this.destination.error(e)},t.prototype.notifyComplete=function(){this.destination.complete()},t}(_t);function Ln(r,t){if(!t.closed){if(r instanceof gt)return r.subscribe(t);var e;try{e=eo(r)(t)}catch(n){t.error(n)}return e}}function Ti(r,t,e){return e===void 0&&(e=Number.POSITIVE_INFINITY),typeof t=="function"?function(n){return n.pipe(Ti(function(i,s){return Br(r(i,s)).pipe(Mr(function(o,a){return t(i,o,s,a)}))},e))}:(typeof t=="number"&&(e=t),function(n){return n.lift(new Dp(r,e))})}var Dp=function(){function r(t,e){e===void 0&&(e=Number.POSITIVE_INFINITY),this.project=t,this.concurrent=e}return r.prototype.call=function(t,e){return e.subscribe(new Mp(t,this.project,this.concurrent))},r}(),Mp=function(r){Y(t,r);function t(e,n,i){i===void 0&&(i=Number.POSITIVE_INFINITY);var s=r.call(this,e)||this;return s.project=n,s.concurrent=i,s.hasCompleted=!1,s.buffer=[],s.active=0,s.index=0,s}return t.prototype._next=function(e){this.active<this.concurrent?this._tryNext(e):this.buffer.push(e)},t.prototype._tryNext=function(e){var n,i=this.index++;try{n=this.project(e,i)}catch(s){this.destination.error(s);return}this.active++,this._innerSub(n)},t.prototype._innerSub=function(e){var n=new Nn(this),i=this.destination;i.add(n);var s=Ln(e,n);s!==n&&i.add(s)},t.prototype._complete=function(){this.hasCompleted=!0,this.active===0&&this.buffer.length===0&&this.destination.complete(),this.unsubscribe()},t.prototype.notifyNext=function(e){this.destination.next(e)},t.prototype.notifyComplete=function(){var e=this.buffer;this.active--,e.length>0?this._next(e.shift()):this.active===0&&this.hasCompleted&&this.destination.complete()},t}(xn);function kp(r){return r===void 0&&(r=Number.POSITIVE_INFINITY),Ti(Xs,r)}function Bp(){return kp(1)}function hi(){for(var r=[],t=0;t<arguments.length;t++)r[t]=arguments[t];return Bp()(an.apply(void 0,r))}function Eu(r){return new gt(function(t){var e;try{e=r()}catch(i){t.error(i);return}var n=e?Br(e):Js();return n.subscribe(t)})}function ja(r){return!Ys(r)&&r-parseFloat(r)+1>=0}var Up=new gt(Fe);function di(r,t){return function(n){return n.lift(new Hp(r,t))}}var Hp=function(){function r(t,e){this.predicate=t,this.thisArg=e}return r.prototype.call=function(t,e){return e.subscribe(new $p(t,this.predicate,this.thisArg))},r}(),$p=function(r){Y(t,r);function t(e,n,i){var s=r.call(this,e)||this;return s.predicate=n,s.thisArg=i,s.count=0,s}return t.prototype._next=function(e){var n;try{n=this.predicate.call(this.thisArg,e,this.count++)}catch(i){this.destination.error(i);return}n&&this.destination.next(e)},t}(_t);function ro(r,t,e){return r===void 0&&(r=0),new gt(function(n){t===void 0&&(t=r,r=0);var i=0,s=r;if(e)return e.schedule(jp,0,{index:i,count:t,start:r,subscriber:n});do{if(i++>=t){n.complete();break}if(n.next(s++),n.closed)break}while(!0)})}function jp(r){var t=r.start,e=r.index,n=r.count,i=r.subscriber;if(e>=n){i.complete();return}i.next(t),!i.closed&&(r.index=e+1,r.start=t+1,this.schedule(r))}function Va(r,t,e){r===void 0&&(r=0);var n=-1;return ja(t)?n=Number(t)<1&&1||Number(t):_n(t)&&(e=t),_n(e)||(e=gu),new gt(function(i){var s=ja(r)?r:+r-e.now();return e.schedule(Vp,s,{index:0,period:n,subscriber:i})})}function Vp(r){var t=r.index,e=r.period,n=r.subscriber;if(n.next(t),!n.closed){if(e===-1)return n.complete();r.index=t+1,this.schedule(r,e)}}function no(r){return function(e){var n=new Gp(r),i=e.lift(n);return n.caught=i}}var Gp=function(){function r(t){this.selector=t}return r.prototype.call=function(t,e){return e.subscribe(new Kp(t,this.selector,this.caught))},r}(),Kp=function(r){Y(t,r);function t(e,n,i){var s=r.call(this,e)||this;return s.selector=n,s.caught=i,s}return t.prototype.error=function(e){if(!this.isStopped){var n=void 0;try{n=this.selector(e,this.caught)}catch(o){r.prototype.error.call(this,o);return}this._unsubscribeAndRecycle();var i=new Nn(this);this.add(i);var s=Ln(n,i);s!==i&&this.add(s)}},t}(xn);function Cn(r,t){return Ti(r,t,1)}function Fp(r){return r===void 0&&(r=null),function(t){return t.lift(new zp(r))}}var zp=function(){function r(t){this.defaultValue=t}return r.prototype.call=function(t,e){return e.subscribe(new qp(t,this.defaultValue))},r}(),qp=function(r){Y(t,r);function t(e,n){var i=r.call(this,e)||this;return i.defaultValue=n,i.isEmpty=!0,i}return t.prototype._next=function(e){this.isEmpty=!1,this.destination.next(e)},t.prototype._complete=function(){this.isEmpty&&this.destination.next(this.defaultValue),this.destination.complete()},t}(_t);function Wp(r){return r instanceof Date&&!isNaN(+r)}function vu(r,t){return function(e){return e.lift(new Zp(r,t))}}var Zp=function(){function r(t,e){this.compare=t,this.keySelector=e}return r.prototype.call=function(t,e){return e.subscribe(new Yp(t,this.compare,this.keySelector))},r}(),Yp=function(r){Y(t,r);function t(e,n,i){var s=r.call(this,e)||this;return s.keySelector=i,s.hasKey=!1,typeof n=="function"&&(s.compare=n),s}return t.prototype.compare=function(e,n){return e===n},t.prototype._next=function(e){var n;try{var i=this.keySelector;n=i?i(e):e}catch(a){return this.destination.error(a)}var s=!1;if(this.hasKey)try{var o=this.compare;s=o(this.key,n)}catch(a){return this.destination.error(a)}else this.hasKey=!0;s||(this.key=n,this.destination.next(e))},t}(_t);function Xp(r,t){return vu(function(e,n){return t?t(e[r],n[r]):e[r]===n[r]})}function Jp(r){return r===void 0&&(r=ef),function(t){return t.lift(new Qp(r))}}var Qp=function(){function r(t){this.errorFactory=t}return r.prototype.call=function(t,e){return e.subscribe(new tf(t,this.errorFactory))},r}(),tf=function(r){Y(t,r);function t(e,n){var i=r.call(this,e)||this;return i.errorFactory=n,i.hasValue=!1,i}return t.prototype._next=function(e){this.hasValue=!0,this.destination.next(e)},t.prototype._complete=function(){if(this.hasValue)return this.destination.complete();var e=void 0;try{e=this.errorFactory()}catch(n){e=n}this.destination.error(e)},t}(_t);function ef(){return new mu}function rf(r){return function(t){return r===0?Js():t.lift(new nf(r))}}var nf=function(){function r(t){if(this.total=t,this.total<0)throw new gp}return r.prototype.call=function(t,e){return e.subscribe(new sf(t,this.total))},r}(),sf=function(r){Y(t,r);function t(e,n){var i=r.call(this,e)||this;return i.total=n,i.count=0,i}return t.prototype._next=function(e){var n=this.total,i=++this.count;i<=n&&(this.destination.next(e),i===n&&(this.destination.complete(),this.unsubscribe()))},t}(_t);function wu(){for(var r=[],t=0;t<arguments.length;t++)r[t]=arguments[t];return function(e){return hi(e,an.apply(void 0,r))}}function er(r,t){var e=arguments.length>=2;return function(n){return n.pipe(r?di(function(i,s){return r(i,s,n)}):Xs,rf(1),e?Fp(t):Jp(function(){return new mu}))}}function As(r,t){return function(n){var i;if(typeof r=="function"?i=r:i=function(){return r},typeof t=="function")return n.lift(new of(i,t));var s=Object.create(n,ep);return s.source=n,s.subjectFactory=i,s}}var of=function(){function r(t,e){this.subjectFactory=t,this.selector=e}return r.prototype.call=function(t,e){var n=this.selector,i=this.subjectFactory(),s=n(i).subscribe(t);return s.add(e.subscribe(i)),s},r}();function Ga(){for(var r=[],t=0;t<arguments.length;t++)r[t]=arguments[t];var e=r.length;if(e===0)throw new Error("list of properties cannot be empty.");return function(n){return Mr(af(r,e))(n)}}function af(r,t){var e=function(n){for(var i=n,s=0;s<t;s++){var o=i!=null?i[r[s]]:void 0;if(o!==void 0)i=o;else return}return i};return e}function cf(r){return r?As(function(){return new Jr},r):As(new Jr)}function Ss(r,t,e,n){e&&typeof e!="function"&&(n=e);var i=typeof e=="function"?e:void 0,s=new An(r,t,n);return function(o){return As(function(){return s},i)(o)}}function _u(r){return r===void 0&&(r=-1),function(t){return t.lift(new uf(r,t))}}var uf=function(){function r(t,e){this.count=t,this.source=e}return r.prototype.call=function(t,e){return e.subscribe(new lf(t,this.count,this.source))},r}(),lf=function(r){Y(t,r);function t(e,n,i){var s=r.call(this,e)||this;return s.count=n,s.source=i,s}return t.prototype.error=function(e){if(!this.isStopped){var n=this,i=n.source,s=n.count;if(s===0)return r.prototype.error.call(this,e);s>-1&&(this.count=s-1),i.subscribe(this._unsubscribeAndRecycle())}},t}(_t);function Ka(r,t,e){var n;return r&&typeof r=="object"?n=r:n={bufferSize:r,windowTime:t,refCount:!1,scheduler:e},function(i){return i.lift(hf(n))}}function hf(r){var t=r.bufferSize,e=t===void 0?Number.POSITIVE_INFINITY:t,n=r.windowTime,i=n===void 0?Number.POSITIVE_INFINITY:n,s=r.refCount,o=r.scheduler,a,u=0,p,f=!1,m=!1;return function(T){u++;var x;!a||f?(f=!1,a=new An(e,i,o),x=a.subscribe(this),p=T.subscribe({next:function(B){a.next(B)},error:function(B){f=!0,a.error(B)},complete:function(){m=!0,p=void 0,a.complete()}}),m&&(p=void 0)):x=a.subscribe(this),this.add(function(){u--,x.unsubscribe(),x=void 0,p&&!m&&s&&u===0&&(p.unsubscribe(),p=void 0,a=void 0)})}}function df(){for(var r=[],t=0;t<arguments.length;t++)r[t]=arguments[t];var e=r[r.length-1];return _n(e)?(r.pop(),function(n){return hi(r,n,e)}):function(n){return hi(r,n)}}function ke(r,t){return typeof t=="function"?function(e){return e.pipe(ke(function(n,i){return Br(r(n,i)).pipe(Mr(function(s,o){return t(n,s,i,o)}))}))}:function(e){return e.lift(new pf(r))}}var pf=function(){function r(t){this.project=t}return r.prototype.call=function(t,e){return e.subscribe(new ff(t,this.project))},r}(),ff=function(r){Y(t,r);function t(e,n){var i=r.call(this,e)||this;return i.project=n,i.index=0,i}return t.prototype._next=function(e){var n,i=this.index++;try{n=this.project(e,i)}catch(s){this.destination.error(s);return}this._innerSub(n)},t.prototype._innerSub=function(e){var n=this.innerSubscription;n&&n.unsubscribe();var i=new Nn(this),s=this.destination;s.add(i),this.innerSubscription=Ln(e,i),this.innerSubscription!==i&&s.add(this.innerSubscription)},t.prototype._complete=function(){var e=this.innerSubscription;(!e||e.closed)&&r.prototype._complete.call(this),this.unsubscribe()},t.prototype._unsubscribe=function(){this.innerSubscription=void 0},t.prototype.notifyComplete=function(){this.innerSubscription=void 0,this.isStopped&&r.prototype._complete.call(this)},t.prototype.notifyNext=function(e){this.destination.next(e)},t}(xn);function gf(r){return function(t){return t.lift(new mf(r))}}var mf=function(){function r(t){this.notifier=t}return r.prototype.call=function(t,e){var n=new yf(t),i=Ln(this.notifier,new Nn(n));return i&&!n.seenValue?(n.add(i),e.subscribe(n)):n},r}(),yf=function(r){Y(t,r);function t(e){var n=r.call(this,e)||this;return n.seenValue=!1,n}return t.prototype.notifyNext=function(){this.seenValue=!0,this.complete()},t.prototype.notifyComplete=function(){},t}(xn);function bf(r,t){return t===void 0&&(t=!1),function(e){return e.lift(new Ef(r,t))}}var Ef=function(){function r(t,e){this.predicate=t,this.inclusive=e}return r.prototype.call=function(t,e){return e.subscribe(new vf(t,this.predicate,this.inclusive))},r}(),vf=function(r){Y(t,r);function t(e,n,i){var s=r.call(this,e)||this;return s.predicate=n,s.inclusive=i,s.index=0,s}return t.prototype._next=function(e){var n=this.destination,i;try{i=this.predicate(e,this.index++)}catch(s){n.error(s);return}this.nextOrComplete(e,i)},t.prototype.nextOrComplete=function(e,n){var i=this.destination;n?i.next(e):(this.inclusive&&i.next(e),i.complete())},t}(_t);function pi(r,t,e){return function(i){return i.lift(new wf(r,t,e))}}var wf=function(){function r(t,e,n){this.nextOrObserver=t,this.error=e,this.complete=n}return r.prototype.call=function(t,e){return e.subscribe(new _f(t,this.nextOrObserver,this.error,this.complete))},r}(),_f=function(r){Y(t,r);function t(e,n,i,s){var o=r.call(this,e)||this;return o._tapNext=Fe,o._tapError=Fe,o._tapComplete=Fe,o._tapError=i||Fe,o._tapComplete=s||Fe,ci(n)?(o._context=o,o._tapNext=n):n&&(o._context=n,o._tapNext=n.next||Fe,o._tapError=n.error||Fe,o._tapComplete=n.complete||Fe),o}return t.prototype._next=function(e){try{this._tapNext.call(this._context,e)}catch(n){this.destination.error(n);return}this.destination.next(e)},t.prototype._error=function(e){try{this._tapError.call(this._context,e)}catch(n){this.destination.error(n);return}this.destination.error(e)},t.prototype._complete=function(){try{this._tapComplete.call(this._context)}catch(e){this.destination.error(e);return}return this.destination.complete()},t}(_t);function Au(r,t,e){return e===void 0&&(e=gu),function(n){var i=Wp(r),s=i?+r-e.now():Math.abs(r);return n.lift(new Af(s,i,t,e))}}var Af=function(){function r(t,e,n,i){this.waitFor=t,this.absoluteTimeout=e,this.withObservable=n,this.scheduler=i}return r.prototype.call=function(t,e){return e.subscribe(new Sf(t,this.absoluteTimeout,this.waitFor,this.withObservable,this.scheduler))},r}(),Sf=function(r){Y(t,r);function t(e,n,i,s,o){var a=r.call(this,e)||this;return a.absoluteTimeout=n,a.waitFor=i,a.withObservable=s,a.scheduler=o,a.scheduleTimeout(),a}return t.dispatchTimeout=function(e){var n=e.withObservable;e._unsubscribeAndRecycle(),e.add(Ln(n,new Nn(e)))},t.prototype.scheduleTimeout=function(){var e=this.action;e?this.action=e.schedule(this,this.waitFor):this.add(this.action=this.scheduler.schedule(t.dispatchTimeout,this.waitFor,this))},t.prototype._next=function(e){this.absoluteTimeout||this.scheduleTimeout(),r.prototype._next.call(this,e)},t.prototype._unsubscribe=function(){this.action=void 0,this.scheduler=null,this.withObservable=null},t}(xn),Rf=function(r,t){t||(t={}),typeof t=="function"&&(t={cmp:t});var e=typeof t.cycles=="boolean"?t.cycles:!1,n=t.cmp&&function(s){return function(o){return function(a,u){var p={key:a,value:o[a]},f={key:u,value:o[u]};return s(p,f)}}}(t.cmp),i=[];return function s(o){if(o&&o.toJSON&&typeof o.toJSON=="function"&&(o=o.toJSON()),o!==void 0){if(typeof o=="number")return isFinite(o)?""+o:"null";if(typeof o!="object")return JSON.stringify(o);var a,u;if(Array.isArray(o)){for(u="[",a=0;a<o.length;a++)a&&(u+=","),u+=s(o[a])||"null";return u+"]"}if(o===null)return"null";if(i.indexOf(o)!==-1){if(e)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}var p=i.push(o)-1,f=Object.keys(o).sort(n&&n(o));for(u="",a=0;a<f.length;a++){var m=f[a],N=s(o[m]);N&&(u&&(u+=","),u+=JSON.stringify(m)+":"+N)}return i.splice(p,1),"{"+u+"}"}}(r)};const Of=wi(Rf);var Su;class Pf extends Error{constructor(t){super(`The map type '${t}' is invalid`),this.mapType=t,this.name="InvalidMapTypeError"}}const Ru=Symbol.for("taquito-michelson-map-type-symbol"),Tf=r=>"args"in r&&Array.isArray(r.args)&&r.args.length===2;class Fa extends Error{constructor(t,e,n){super(`${n} not compliant with underlying michelson type`),this.value=t,this.type=e,this.name="MapTypecheckError"}}class Xt{constructor(t){this.valueMap=new Map,this.keyMap=new Map,this[Su]=!0,t&&this.setType(t)}static isMichelsonMap(t){return t&&t[Ru]===!0}setType(t){if(!Tf(t))throw new Pf(t.toString());this.keySchema=new ne(t.args[0]),this.valueSchema=new ne(t.args[1])}removeType(){this.keySchema=void 0,this.valueSchema=void 0}static fromLiteral(t,e){const n=new Xt(e);return Object.keys(t).forEach(i=>{n.set(i,t[i])}),n}typecheckKey(t){return this.keySchema?this.keySchema.Typecheck(t):!0}typecheckValue(t){return this.valueSchema?this.valueSchema.Typecheck(t):!0}assertTypecheckValue(t){if(!this.typecheckValue(t))throw new Fa(t,this.valueSchema,"value")}assertTypecheckKey(t){if(!this.typecheckKey(t))throw new Fa(t,this.keySchema,"key")}serializeDeterministically(t){return Of(t)}*keys(){for(const[t]of this.entries())yield t}*values(){for(const[,t]of this.entries())yield t}*entries(){for(const t of this.valueMap.keys())yield[this.keyMap.get(t),this.valueMap.get(t)]}get(t){this.assertTypecheckKey(t);const e=this.serializeDeterministically(t);return this.valueMap.get(e)}set(t,e){this.assertTypecheckKey(t),this.assertTypecheckValue(e);const n=this.serializeDeterministically(t);this.keyMap.set(n,t),this.valueMap.set(n,e)}delete(t){this.assertTypecheckKey(t),this.keyMap.delete(this.serializeDeterministically(t)),this.valueMap.delete(this.serializeDeterministically(t))}has(t){this.assertTypecheckKey(t);const e=this.serializeDeterministically(t);return this.keyMap.has(e)&&this.valueMap.has(e)}clear(){this.keyMap.clear(),this.valueMap.clear()}get size(){return this.keyMap.size}forEach(t){for(const[e,n]of this.entries())t(n,e,this)}}Su=Ru;class ct extends Error{constructor(t,e,n){super(),this.value=t,this.token=e,this.name="ValidationError";const i=this.token.annot(),s=i?`[${i}] `:"";this.message=`${s}${n}`}}class Pt{constructor(t,e,n){this.val=t,this.idx=e,this.fac=n,this.createToken=this.fac}typeWithoutAnnotations(){const t=n=>{if(typeof n=="object"){if(Array.isArray(n))return n.map(o=>t(o));const i=n;return i.args?{prim:i.prim,args:i.args.map(s=>t(s))}:{prim:i.prim}}return n};return(n=>n.args?{prim:n.prim,args:n.args.map(i=>t(i))}:{prim:n.prim})(this.val)}annot(){return(Array.isArray(this.val.annots)&&this.val.annots.length>0?this.val.annots[0]:String(this.idx)).replace(/(%|:)(_Liq_entry_)?/,"")}hasAnnotations(){return Array.isArray(this.val.annots)&&this.val.annots.length}get tokenVal(){return this.val}ExtractSignature(){return[[this.ExtractSchema()]]}}class wt extends Pt{compare(t,e){return t===e?0:t<e?-1:1}}class za extends ct{constructor(t,e,n){super(t,e,n),this.value=t,this.token=e,this.name="BigMapValidationError"}}class re extends Pt{constructor(t,e,n){super(t,e,n),this.val=t,this.idx=e,this.fac=n}get ValueSchema(){return this.createToken(this.val.args[1],0)}get KeySchema(){return this.createToken(this.val.args[0],0)}ExtractSchema(){return{big_map:{key:this.KeySchema.ExtractSchema(),value:this.ValueSchema.ExtractSchema()}}}generateSchema(){return{__michelsonType:re.prim,schema:{key:this.KeySchema.generateSchema(),value:this.ValueSchema.generateSchema()}}}isValid(t){return Xt.isMichelsonMap(t)?null:new za(t,this,"Value must be a MichelsonMap")}objLitToMichelsonMap(t){return t instanceof Xt?t:typeof t=="object"?Object.keys(t).length===0?new Xt:Xt.fromLiteral(t):t}Encode(t){const e=this.objLitToMichelsonMap(t.pop()),n=this.isValid(e);if(n)throw n;return Array.from(e.keys()).sort((i,s)=>this.KeySchema.compare(i,s)).map(i=>({prim:"Elt",args:[this.KeySchema.EncodeObject(i),this.ValueSchema.EncodeObject(e.get(i))]}))}EncodeObject(t,e){const n=this.objLitToMichelsonMap(t),i=this.isValid(n);if(i)throw i;return e&&e[re.prim]?e[re.prim](n,this.val):Array.from(n.keys()).sort((s,o)=>this.KeySchema.compare(s,o)).map(s=>({prim:"Elt",args:[this.KeySchema.EncodeObject(s),this.ValueSchema.EncodeObject(n.get(s))]}))}Execute(t,e){if(e&&e[re.prim])return e[re.prim](t,this.val);if(Array.isArray(t)){const n=new Xt(this.val);return t.forEach(i=>{n.set(this.KeySchema.ToKey(i.args[0]),this.ValueSchema.Execute(i.args[1]))}),n}else{if("int"in t)return t.int;throw new za(t,this,`Big map is expecting either an array (Athens) or an object with an int property (Babylon). Got ${JSON.stringify(t)}`)}}findAndReturnTokens(t,e){return re.prim===t&&e.push(this),this.KeySchema.findAndReturnTokens(t,e),this.ValueSchema.findAndReturnTokens(t,e),e}}re.prim="big_map";class If extends Error{constructor(t){super(t),this.message=t,this.name="OrTokenDecodingError"}}class Q extends wt{constructor(t,e,n){super(t,e,n),this.val=t,this.idx=e,this.fac=n}Encode(t){const e=t[t.length-1],n=this.createToken(this.val.args[0],this.idx);let i=1;n instanceof Q&&(i=Object.keys(n.ExtractSchema()).length);const s=this.createToken(this.val.args[1],this.idx+i);if(String(n.annot())===String(e)&&!(n instanceof Q))return t.pop(),{prim:"Left",args:[n.Encode(t)]};if(String(s.annot())===String(e)&&!(s instanceof Q))return t.pop(),{prim:"Right",args:[s.Encode(t)]};if(n instanceof Q){const o=n.Encode(t);if(o)return{prim:"Left",args:[o]}}if(s instanceof Q){const o=s.Encode(t);if(o)return{prim:"Right",args:[o]}}return null}ExtractSignature(){const t=this.createToken(this.val.args[0],this.idx);let e=1;t instanceof Q&&(e=Object.keys(t.ExtractSchema()).length);const n=this.createToken(this.val.args[1],this.idx+e),i=[];if(t instanceof Q)i.push(...t.ExtractSignature());else for(const s of t.ExtractSignature())i.push([t.annot(),...s]);if(n instanceof Q)i.push(...n.ExtractSignature());else for(const s of n.ExtractSignature())i.push([n.annot(),...s]);return i}EncodeObject(t,e){const n=Object.keys(t)[0],i=this.createToken(this.val.args[0],this.idx);let s=1;i instanceof Q&&(s=Object.keys(i.ExtractSchema()).length);const o=this.createToken(this.val.args[1],this.idx+s);if(String(i.annot())===String(n)&&!(i instanceof Q))return{prim:"Left",args:[i.EncodeObject(t[n],e)]};if(String(o.annot())===String(n)&&!(o instanceof Q))return{prim:"Right",args:[o.EncodeObject(t[n],e)]};if(i instanceof Q){const a=i.EncodeObject(t,e);if(a)return{prim:"Left",args:[a]}}if(o instanceof Q){const a=o.EncodeObject(t,e);if(a)return{prim:"Right",args:[a]}}return null}Execute(t,e){const n=this.createToken(this.val.args[0],this.idx);let i=1;n instanceof Q&&(i=Object.keys(n.ExtractSchema()).length);const s=this.createToken(this.val.args[1],this.idx+i);if(t.prim==="Right")return s instanceof Q?s.Execute(t.args[0],e):{[s.annot()]:s.Execute(t.args[0],e)};if(t.prim==="Left")return n instanceof Q?n.Execute(t.args[0],e):{[n.annot()]:n.Execute(t.args[0],e)};throw new If(`Was expecting Left or Right prim but got: ${t.prim}`)}traversal(t,e,n){const i=this.createToken(this.val.args[0],this.idx);let s=1,o;i instanceof Q&&!i.hasAnnotations()?(o=t(i),s=Object.keys(i.ExtractSchema()).length):o={[i.annot()]:t(i)};const a=this.createToken(this.val.args[1],this.idx+s);let u;return a instanceof Q&&!a.hasAnnotations()?u=e(a):u={[a.annot()]:e(a)},n(o,u)}ExtractSchema(){return this.traversal(t=>t.ExtractSchema(),t=>t.ExtractSchema(),(t,e)=>Object.assign(Object.assign({},t),e))}generateSchema(){return{__michelsonType:Q.prim,schema:this.traversal(t=>t instanceof Q&&!t.hasAnnotations()?t.generateSchema().schema:t.generateSchema(),t=>t instanceof Q&&!t.hasAnnotations()?t.generateSchema().schema:t.generateSchema(),(t,e)=>Object.assign(Object.assign({},t),e))}}findToken(t){const e=this.createToken(this.val.args[0],this.idx);let n=1;e instanceof Q&&(n=Object.keys(e.ExtractSchema()).length);const i=this.createToken(this.val.args[1],this.idx+n);if(String(e.annot())===String(t)&&!(e instanceof Q)&&e instanceof wt)return e;if(String(i.annot())===String(t)&&!(i instanceof Q)&&i instanceof wt)return i;if(e instanceof Q){const s=e.findToken(t);if(s)return s}if(i instanceof Q){const s=i.findToken(t);if(s)return s}return null}compare(t,e){const n=Object.keys(t)[0],i=Object.keys(e)[0];if(n===i){const s=this.findToken(n);if(s instanceof wt)return s.compare(t[n],e[n])}else{const s=JSON.stringify(this.EncodeObject(t)),o=JSON.stringify(this.EncodeObject(e));return s<o?-1:1}}ToKey(t){return this.Execute(t)}ToBigMapKey(t){return{key:this.EncodeObject(t),type:this.typeWithoutAnnotations()}}findAndReturnTokens(t,e){return Q.prim===t&&e.push(this),this.traversal(n=>n.findAndReturnTokens(t,e),n=>n.findAndReturnTokens(t,e),(n,i)=>Object.assign(Object.assign({},n),i)),e}}Q.prim="or";class Nf extends Error{constructor(t){super(t),this.message=t,this.name="TokenArgumentValidationError"}}class xf extends Error{constructor(t,e){super(`Tokens ${t} and ${e} are not comparable`),this.val1=t,this.val2=e,this.name="TokenComparisonError"}}function Rs(r,t=Ot.prim){if(Array.isArray(r))return Rs({prim:t,args:r},t);if(r.args===void 0)throw new Nf("Encountered an invalid PairToken with no arguments, a pair must have two or more arguments");return r.args.length>2?[r.args[0],{prim:t,args:r.args.slice(1)}]:[r.args[0],r.args[1]]}class Ot extends wt{constructor(t,e,n){super(Array.isArray(t)?{prim:Ot.prim,args:t}:t.prim?t:{prim:Ot.prim,args:t},e,n)}args(){return Rs(this.val)}tokens(){let t=0;return this.args().map(e=>{const n=this.createToken(e,this.idx+t);return n instanceof Ot?t+=Object.keys(n.ExtractSchema()).length:t++,n})}Encode(t){return{prim:"Pair",args:this.tokens().map(e=>e.Encode(t))}}ExtractSignature(){const t=this.args(),e=this.createToken(t[0],this.idx);let n=1;e instanceof Q&&(n=Object.keys(e.ExtractSchema()).length);const i=this.createToken(t[1],this.idx+n),s=[];for(const o of e.ExtractSignature())for(const a of i.ExtractSignature())s.push([...o,...a]);return s}ToBigMapKey(t){return{key:this.EncodeObject(t),type:this.typeWithoutAnnotations()}}ToKey(t){return this.Execute(t)}EncodeObject(t,e){const[n,i]=this.tokens();let s;n instanceof Ot&&!n.hasAnnotations()?s=t:s=t[n.annot()];let o;return i instanceof Ot&&!i.hasAnnotations()?o=t:o=t[i.annot()],{prim:"Pair",args:[n.EncodeObject(s,e),i.EncodeObject(o,e)]}}traversal(t,e){const n=this.args(),i=this.createToken(n[0],this.idx);let s=1,o;i instanceof Ot&&(s=Object.keys(i.ExtractSchema()).length),i instanceof Ot&&!i.hasAnnotations()?o=t(i):o={[i.annot()]:t(i)};const a=this.createToken(n[1],this.idx+s);let u;return a instanceof Ot&&!a.hasAnnotations()?u=e(a):u={[a.annot()]:e(a)},Object.assign(Object.assign({},o),u)}Execute(t,e){const n=Rs(t,"Pair");return this.traversal(i=>i.Execute(n[0],e),i=>i.Execute(n[1],e))}ExtractSchema(){return this.traversal(t=>t.ExtractSchema(),t=>t.ExtractSchema())}generateSchema(){return{__michelsonType:Ot.prim,schema:this.traversal(t=>t instanceof Ot&&!t.hasAnnotations()?t.generateSchema().schema:t.generateSchema(),t=>t instanceof Ot&&!t.hasAnnotations()?t.generateSchema().schema:t.generateSchema())}}compare(t,e){const[n,i]=this.tokens(),s=(o,a)=>o instanceof Ot&&!o.hasAnnotations()?a:a[o.annot()];if(n instanceof wt&&i instanceof wt){const o=n.compare(s(n,t),s(n,e));return o===0?i.compare(s(i,t),s(i,e)):o}throw new xf(t,e)}findAndReturnTokens(t,e){return Ot.prim===t&&e.push(this),this.tokens().map(n=>n.findAndReturnTokens(t,e)),e}}Ot.prim="pair";class qa extends ct{constructor(t,e,n){super(t,e,n),this.value=t,this.token=e,this.name="NatValidationError"}}class ve extends wt{constructor(t,e,n){super(t,e,n),this.val=t,this.idx=e,this.fac=n}Execute(t){return new U(t[Object.keys(t)[0]])}Encode(t){const e=t.pop(),n=this.isValid(e);if(n)throw n;return{int:new U(e).toFixed()}}isValid(t){const e=new U(t);return e.isNaN()?new qa(t,this,`Value is not a number: ${t}`):e.isNegative()?new qa(t,this,`Value cannot be negative: ${t}`):null}EncodeObject(t,e){const n=this.isValid(t);if(n)throw n;return e&&e[ve.prim]?e[ve.prim](t):{int:new U(t).toFixed()}}ExtractSchema(){return ve.prim}generateSchema(){return{__michelsonType:ve.prim,schema:ve.prim}}ToBigMapKey(t){return{key:{int:String(t)},type:{prim:ve.prim}}}ToKey({int:t}){return new U(t)}compare(t,e){const n=Number(t),i=Number(e);return n===i?0:n<i?-1:1}findAndReturnTokens(t,e){return ve.prim===t&&e.push(this),e}}ve.prim="nat";class we extends wt{constructor(t,e,n){super(t,e,n),this.val=t,this.idx=e,this.fac=n}Execute(t){return t[Object.keys(t)[0]]}ExtractSchema(){return we.prim}generateSchema(){return{__michelsonType:we.prim,schema:we.prim}}Encode(t){return{string:t.pop()}}EncodeObject(t,e){return e&&e[we.prim]?e[we.prim](t):{string:t}}ToKey({string:t}){return t}ToBigMapKey(t){return{key:{string:t},type:{prim:we.prim}}}findAndReturnTokens(t,e){return we.prim===t&&e.push(this),e}}we.prim="string";class ls extends ct{constructor(t,e,n){super(t,e,n),this.value=t,this.token=e,this.name="AddressValidationError"}}class ze extends wt{constructor(t,e,n){super(t,e,n),this.val=t,this.idx=e,this.fac=n}ToBigMapKey(t){return{key:{bytes:Vd(t)},type:{prim:"bytes"}}}isValid(t){return rt(t)!==k.VALID?new ls(t,this,`Address is not valid: ${t}`):null}Encode(t){const e=t.pop(),n=this.isValid(e);if(n)throw n;return{string:e}}EncodeObject(t,e){const n=this.isValid(t);if(n)throw n;return e&&e[ze.prim]?e[ze.prim](t):{string:t}}Execute(t){if(t.string)return t.string;if(!t.bytes)throw new ls(t,this,`cannot be missing both string and bytes: ${t}`);return ws(t.bytes)}ExtractSchema(){return ze.prim}generateSchema(){return{__michelsonType:ze.prim,schema:ze.prim}}ToKey({bytes:t,string:e}){if(e)return e;if(!t)throw new ls({bytes:t,string:e},this,`cannot be missing both string and bytes ${{string:e,bytes:t}}`);return ws(t)}compare(t,e){const n=o=>o.startsWith("tz"),i=n(t),s=n(e);return i&&!s?-1:s&&!i?1:super.compare(t,e)}findAndReturnTokens(t,e){return ze.prim===t&&e.push(this),e}}ze.prim="address";class Lf extends ct{constructor(t,e,n){super(t,e,n),this.value=t,this.token=e,this.name="MapValidationError"}}class Er extends Pt{constructor(t,e,n){super(t,e,n),this.val=t,this.idx=e,this.fac=n}get ValueSchema(){return this.createToken(this.val.args[1],0)}get KeySchema(){return this.createToken(this.val.args[0],0)}isValid(t){return Xt.isMichelsonMap(t)?null:new Lf(t,this,"Value must be a MichelsonMap")}Execute(t,e){const n=new Xt(this.val);return t.forEach(i=>{n.set(this.KeySchema.ToKey(i.args[0]),this.ValueSchema.Execute(i.args[1],e))}),n}objLitToMichelsonMap(t){return t instanceof Xt?t:typeof t=="object"?Object.keys(t).length===0?new Xt:Xt.fromLiteral(t):t}Encode(t){const e=this.objLitToMichelsonMap(t.pop()),n=this.isValid(e);if(n)throw n;return Array.from(e.keys()).sort((i,s)=>this.KeySchema.compare(i,s)).map(i=>({prim:"Elt",args:[this.KeySchema.EncodeObject(i),this.ValueSchema.EncodeObject(e.get(i))]}))}EncodeObject(t,e){const n=this.objLitToMichelsonMap(t),i=this.isValid(n);if(i)throw i;return e&&e[Er.prim]?e[Er.prim](n):Array.from(n.keys()).sort((s,o)=>this.KeySchema.compare(s,o)).map(s=>({prim:"Elt",args:[this.KeySchema.EncodeObject(s),this.ValueSchema.EncodeObject(n.get(s))]}))}ExtractSchema(){return{map:{key:this.KeySchema.ExtractSchema(),value:this.ValueSchema.ExtractSchema()}}}generateSchema(){return{__michelsonType:Er.prim,schema:{key:this.KeySchema.generateSchema(),value:this.ValueSchema.generateSchema()}}}findAndReturnTokens(t,e){return Er.prim===t&&e.push(this),this.KeySchema.findAndReturnTokens(t,e),this.ValueSchema.findAndReturnTokens(t,e),e}}Er.prim="map";class _e extends wt{constructor(t,e,n){super(t,e,n),this.val=t,this.idx=e,this.fac=n}Execute(t){return String(t.prim).toLowerCase()==="true"}Encode(t){return{prim:t.pop()?"True":"False"}}EncodeObject(t,e){return e&&e[_e.prim]?e[_e.prim](t):{prim:t?"True":"False"}}ExtractSchema(){return _e.prim}generateSchema(){return{__michelsonType:_e.prim,schema:_e.prim}}ToBigMapKey(t){return{key:this.EncodeObject(t),type:{prim:_e.prim}}}ToKey(t){return this.EncodeObject(t)}compare(t,e){return t&&e||!t&&!e?0:t?1:-1}findAndReturnTokens(t,e){return _e.prim===t&&e.push(this),e}}_e.prim="bool";class Kn extends ct{constructor(t,e,n){super(t,e,n),this.value=t,this.token=e,this.name="TxRollupL2AddressValidationError"}}class qe extends wt{constructor(t,e,n){super(t,e,n),this.val=t,this.idx=e,this.fac=n}ToBigMapKey(t){return{key:{bytes:Gd(t)},type:{prim:"bytes"}}}isValid(t){if(rt(t)!==k.VALID)throw new Kn(t,this,`tx_rollup_l2_address is not valid: ${t}`);return null}Encode(t){const e=t.pop();if(!e)throw new Kn(e,this,`arg missing to encode: this -> "${e}"`);return this.isValid(e),{string:e}}EncodeObject(t,e){return this.isValid(t),e&&e[qe.prim]?e[qe.prim](t):{string:t}}Execute(t){if(t.string)return t.string;if(!t.bytes)throw new Kn(t,this,`value cannot be missing string and byte value. must have one ${JSON.stringify(t)}`);return va(t.bytes)}ExtractSchema(){return qe.prim}generateSchema(){return{__michelsonType:qe.prim,schema:qe.prim}}ToKey({bytes:t,string:e}){if(e)return e;if(!t)throw new Kn(t,this,`value cannot be missing string and byte value. must have one: bytes = ${t}`);return va(t)}findAndReturnTokens(t,e){return qe.prim===t&&e.push(this),e}}qe.prim="tx_rollup_l2_address";class Wa extends ct{constructor(t,e,n){super(t,e,n),this.value=t,this.token=e,this.name="ContractValidationError"}}class Jt extends Pt{constructor(t,e,n){super(t,e,n),this.val=t,this.idx=e,this.fac=n}isValid(t){return rt(t)!==k.VALID?new Wa(t,this,"Contract address is not valid"):null}Execute(t){if(t.string)return t.string;if(!t.bytes)throw new Wa(t,this,"must contain bytes or string");return ws(t.bytes)}Encode(t){const e=t.pop(),n=this.isValid(e);if(n)throw n;return{string:e}}EncodeObject(t,e){const n=this.isValid(t);if(n)throw n;return e&&e[Jt.prim]?e[Jt.prim](t):{string:t}}ExtractSchema(){return Jt.prim}generateSchema(){const t=this.createToken(this.val.args[0],0);return{__michelsonType:Jt.prim,schema:{parameter:this.val.args[0]?t.generateSchema():{}}}}findAndReturnTokens(t,e){return Jt.prim===t&&e.push(this),e}}Jt.prim="contract";class Cf extends ct{constructor(t,e,n){super(t,e,n),this.value=t,this.token=e,this.name="ListValidationError"}}class pr extends Pt{constructor(t,e,n){super(t,e,n),this.val=t,this.idx=e,this.fac=n}get valueSchema(){return this.createToken(this.val.args[0],this.idx)}isValid(t){return Array.isArray(t)?null:new Cf(t,this,"Value must be an array")}Encode(t){const e=t.pop(),n=this.isValid(e);if(n)throw n;const i=this.createToken(this.val.args[0],0);return e.reduce((s,o)=>[...s,i.EncodeObject(o)],[])}Execute(t,e){const n=this.createToken(this.val.args[0],0),i=this.isValid(t);if(i)throw i;return t.reduce((s,o)=>[...s,n.Execute(o,e)],[])}EncodeObject(t,e){const n=this.createToken(this.val.args[0],0),i=this.isValid(t);if(i)throw i;return e&&e[pr.prim]?e[pr.prim](t):t.reduce((s,o)=>[...s,n.EncodeObject(o)],[])}ExtractSchema(){return{[pr.prim]:this.valueSchema.ExtractSchema()}}generateSchema(){return{__michelsonType:pr.prim,schema:this.valueSchema.generateSchema()}}findAndReturnTokens(t,e){return pr.prim===t&&e.push(this),this.createToken(this.val.args[0],this.idx).findAndReturnTokens(t,e),e}}pr.prim="list";class Df extends ct{constructor(t,e,n){super(t,e,n),this.value=t,this.token=e,this.name="MutezValidationError"}}class Ae extends wt{constructor(t,e,n){super(t,e,n),this.val=t,this.idx=e,this.fac=n}Execute(t){return new U(t[Object.keys(t)[0]])}ExtractSchema(){return Ae.prim}generateSchema(){return{__michelsonType:Ae.prim,schema:Ae.prim}}isValid(t){return new U(t).isNaN()?new Df(t,this,`Value is not a number: ${t}`):null}Encode(t){const e=t.pop(),n=this.isValid(e);if(n)throw n;return{int:String(e).toString()}}EncodeObject(t,e){const n=this.isValid(t);if(n)throw n;return e&&e[Ae.prim]?e[Ae.prim](t):{int:String(t).toString()}}ToBigMapKey(t){return{key:{int:String(t)},type:{prim:Ae.prim}}}ToKey({int:t}){return t}compare(t,e){const n=Number(t),i=Number(e);return n===i?0:n<i?-1:1}findAndReturnTokens(t,e){return Ae.prim===t&&e.push(this),e}}Ae.prim="mutez";class Mf extends ct{constructor(t,e,n){super(t,e,n),this.value=t,this.token=e,this.name="BytesValidationError"}}class Se extends wt{constructor(t,e,n){super(t,e,n),this.val=t,this.idx=e,this.fac=n}ToBigMapKey(t){return{key:{bytes:t},type:{prim:Se.prim}}}isValid(t){return typeof t=="string"&&/^[0-9a-fA-F]*$/.test(t)&&t.length%2===0?null:new Mf(t,this,`Invalid bytes: ${t}`)}convertUint8ArrayToHexString(t){return t.constructor===Uint8Array?nt.Buffer.from(t).toString("hex"):t}Encode(t){let e=t.pop();e=_a(this.convertUint8ArrayToHexString(e));const n=this.isValid(e);if(n)throw n;return{bytes:String(e).toString()}}EncodeObject(t,e){t=this.convertUint8ArrayToHexString(t),typeof t=="string"&&(t=_a(t));const n=this.isValid(t);if(n)throw n;return e&&e[Se.prim]?e[Se.prim](t):{bytes:String(t).toString()}}Execute(t){return t.bytes}ExtractSchema(){return Se.prim}generateSchema(){return{__michelsonType:Se.prim,schema:Se.prim}}ToKey({bytes:t,string:e}){return e||t}findAndReturnTokens(t,e){return Se.prim===t&&e.push(this),e}}Se.prim="bytes";class Qr extends wt{constructor(t,e,n){super(t,e,n),this.val=t,this.idx=e,this.fac=n}subToken(){return this.createToken(this.val.args[0],this.idx)}schema(){return this.createToken(this.val.args[0],0)}annot(){return Array.isArray(this.val.annots)?super.annot():this.createToken(this.val.args[0],this.idx).annot()}Encode(t){const e=t;return e==null?{prim:"None"}:Array.isArray(e)&&(e[e.length-1]===void 0||e[e.length-1]===null)?(e.pop(),{prim:"None"}):{prim:"Some",args:[this.schema().Encode(t)]}}EncodeObject(t,e){let n=t;return n==null?{prim:"None"}:(n=typeof n=="object"&&"Some"in n?n.Some:n,{prim:"Some",args:[this.schema().EncodeObject(n,e)]})}Execute(t,e){return t.prim==="None"?null:{Some:this.schema().Execute(t.args[0],e)}}ExtractSchema(){return{Some:this.schema().ExtractSchema()}}generateSchema(){return{__michelsonType:Qr.prim,schema:this.schema().generateSchema()}}ExtractSignature(){return[...this.schema().ExtractSignature()]}get KeySchema(){return this.schema()}compare(t,e){if(t){if(!e)return 1}else return-1;return this.KeySchema.compare(t,e)}ToKey(t){return this.Execute(t)}ToBigMapKey(t){return{key:this.EncodeObject(t),type:this.typeWithoutAnnotations()}}findAndReturnTokens(t,e){return Qr.prim===t&&e.push(this),this.subToken().findAndReturnTokens(t,e),e}}Qr.prim="option";class Re extends wt{constructor(t,e,n){super(t,e,n),this.val=t,this.idx=e,this.fac=n}Execute(t){if(t.string&&/^\d+$/.test(t.string))return new Date(Number(t.string)*1e3).toISOString();if(t.string)return new Date(t.string).toISOString();if(t.int)return new Date(Number(t.int)*1e3).toISOString()}Encode(t){const e=t.pop();return typeof e=="number"?{int:String(e)}:{string:e}}EncodeObject(t,e){return e&&e[Re.prim]?e[Re.prim](t):typeof t=="number"?{int:String(t)}:{string:t}}ExtractSchema(){return Re.prim}generateSchema(){return{__michelsonType:Re.prim,schema:Re.prim}}ToKey({string:t}){return t}ToBigMapKey(t){return{key:{string:t},type:{prim:Re.prim}}}findAndReturnTokens(t,e){return Re.prim===t&&e.push(this),e}}Re.prim="timestamp";class kf extends ct{constructor(t,e,n){super(t,e,n),this.value=t,this.token=e,this.name="IntValidationError"}}class jt extends wt{constructor(t,e,n){super(t,e,n),this.val=t,this.idx=e,this.fac=n}Execute(t){return new U(t[Object.keys(t)[0]])}ExtractSchema(){return jt.prim}generateSchema(){return{__michelsonType:jt.prim,schema:jt.prim}}isValid(t){return new U(t).isNaN()?new kf(t,this,`Value is not a number: ${t}`):null}Encode(t){const e=t.pop(),n=this.isValid(e);if(n)throw n;return{int:new U(e).toFixed()}}EncodeObject(t,e){const n=this.isValid(t);if(n)throw n;return e&&e[jt.prim]?e[jt.prim](t):{int:new U(t).toFixed()}}ToBigMapKey(t){return{key:{int:String(t)},type:{prim:jt.prim}}}ToKey({int:t}){return t}compare(t,e){const n=Number(t),i=Number(e);return n===i?0:n<i?-1:1}findAndReturnTokens(t,e){return jt.prim===t&&e.push(this),e}}jt.prim="int";class Oe extends wt{constructor(t,e,n){super(t,e,n),this.val=t,this.idx=e,this.fac=n}Encode(t){return t.pop(),{prim:"Unit"}}EncodeObject(t,e){return e&&e[Oe.prim]?e[Oe.prim](t):{prim:"Unit"}}Execute(t){return Os}ExtractSchema(){return Oe.prim}generateSchema(){return{__michelsonType:Oe.prim,schema:Oe.prim}}compare(t,e){return 0}ToKey(t){return Os}ToBigMapKey(t){return{key:{prim:"Unit"},type:{prim:Oe.prim}}}findAndReturnTokens(t,e){return Oe.prim===t&&e.push(this),e}}Oe.prim="unit";const Bf=4;class Uf extends ct{constructor(t,e,n){super(t,e,n),this.value=t,this.token=e,this.name="KeyValidationError"}}class Pe extends wt{constructor(t,e,n){super(t,e,n),this.val=t,this.idx=e,this.fac=n}Execute(t){return t.string?t.string:Kd(t.bytes)}isValid(t){return Bd(t)!==k.VALID?new Uf(t,this,"Key is not valid"):null}Encode(t){const e=t.pop(),n=this.isValid(e);if(n)throw n;return{string:e}}EncodeObject(t,e){const n=this.isValid(t);if(n)throw n;return e&&e[Pe.prim]?e[Pe.prim](t):{string:t}}ExtractSchema(){return Pe.prim}generateSchema(){return{__michelsonType:Pe.prim,schema:Pe.prim}}ToKey(t){return this.Execute(t)}ToBigMapKey(t){return{key:{string:t},type:{prim:Pe.prim}}}compare(t,e){const n=this.getPrefix(t),i=this.getPrefix(e);if(n===O.EDPK&&i!==O.EDPK)return-1;if(n===O.SPPK&&i!==O.SPPK)return i===O.EDPK?1:-1;if(n===O.P2PK){if(i!==O.P2PK)return 1;const s=this.getP256PublicKeyComparableBytes(t),o=this.getP256PublicKeyComparableBytes(e);return nt.Buffer.compare(s,o)}return super.compare(t,e)}getPrefix(t){return t.substring(0,Bf)}getP256PublicKeyComparableBytes(t){return ou(t,Vt[O.P2PK]).slice(1)}findAndReturnTokens(t,e){return Pe.prim===t&&e.push(this),e}}Pe.prim="key";class Hf extends ct{constructor(t,e,n){super(t,e,n),this.value=t,this.token=e,this.name="KeyHashValidationError"}}class Te extends wt{constructor(t,e,n){super(t,e,n),this.val=t,this.idx=e,this.fac=n}Execute(t){return t.string?t.string:wa(t.bytes)}isValid(t){return Ws(t)!==k.VALID?new Hf(t,this,`KeyHash is not valid: ${t}`):null}Encode(t){const e=t.pop(),n=this.isValid(e);if(n)throw n;return{string:e}}EncodeObject(t,e){const n=this.isValid(t);if(n)throw n;return e&&e[Te.prim]?e[Te.prim](t):{string:t}}ExtractSchema(){return Te.prim}generateSchema(){return{__michelsonType:Te.prim,schema:Te.prim}}ToKey({string:t,bytes:e}){return t||wa(e)}ToBigMapKey(t){return{key:{string:t},type:{prim:Te.prim}}}findAndReturnTokens(t,e){return Te.prim===t&&e.push(this),e}}Te.prim="key_hash";class $f extends ct{constructor(t,e,n){super(t,e,n),this.value=t,this.token=e,this.name="SignatureValidationError"}}class Ie extends wt{constructor(t,e,n){super(t,e,n),this.val=t,this.idx=e,this.fac=n}Execute(t){return t.string?t.string:t.bytes}isValid(t){return kd(t)!==k.VALID?new $f(t,this,"Signature is not valid"):null}Encode(t){const e=t.pop(),n=this.isValid(e);if(n)throw n;return{string:e}}EncodeObject(t,e){const n=this.isValid(t);if(n)throw n;return e&&e[Ie.prim]?e[Ie.prim](t):{string:t}}ExtractSchema(){return Ie.prim}generateSchema(){return{__michelsonType:Ie.prim,schema:Ie.prim}}ToKey(t){return this.Execute(t)}ToBigMapKey(t){return{key:{string:t},type:{prim:Ie.prim}}}findAndReturnTokens(t,e){return Ie.prim===t&&e.push(this),e}}Ie.prim="signature";class fr extends Pt{constructor(t,e,n){super(t,e,n),this.val=t,this.idx=e,this.fac=n}get paramSchema(){return this.createToken(this.val.args[0],this.idx)}get returnSchema(){return this.createToken(this.val.args[1],this.idx+1)}Execute(t){return t.string?t.string:t}Encode(t){return t.pop()}EncodeObject(t,e){return e&&e[fr.prim]?e[fr.prim](t):t}ExtractSchema(){return{[fr.prim]:{parameters:this.paramSchema.ExtractSchema(),returns:this.returnSchema.ExtractSchema()}}}generateSchema(){return{__michelsonType:fr.prim,schema:{parameters:this.paramSchema.generateSchema(),returns:this.returnSchema.generateSchema()}}}findAndReturnTokens(t,e){return fr.prim===t&&e.push(this),this.createToken(this.val.args[0],this.idx).findAndReturnTokens(t,e),this.createToken(this.val.args[1],this.idx).findAndReturnTokens(t,e),e}}fr.prim="lambda";class We extends Pt{constructor(t,e,n){super(t,e,n),this.val=t,this.idx=e,this.fac=n}Execute(t){return t.string}Encode(...t){return{string:t.pop()}}EncodeObject(t,e){return e&&e[We.prim]?e[We.prim](t):{string:t}}ExtractSchema(){return We.prim}generateSchema(){return{__michelsonType:We.prim,schema:We.prim}}findAndReturnTokens(t,e){return We.prim===t&&e.push(this),e}}We.prim="operation";class jf extends ct{constructor(t,e,n){super(t,e,n),this.value=t,this.token=e,this.name="SetValidationError"}}class gr extends Pt{constructor(t,e,n){super(t,e,n),this.val=t,this.idx=e,this.fac=n}get KeySchema(){return this.createToken(this.val.args[0],0)}isValid(t){return Array.isArray(t)?null:new jf(t,this,"Value must be an array")}Encode(t){const e=t.pop(),n=this.isValid(e);if(n)throw n;return e.sort((i,s)=>this.KeySchema.compare(i,s)).reduce((i,s)=>[...i,this.KeySchema.EncodeObject(s)],[])}Execute(t,e){return t.reduce((n,i)=>[...n,this.KeySchema.Execute(i,e)],[])}EncodeObject(t,e){const n=this.isValid(t);if(n)throw n;return e&&e[gr.prim]?e[gr.prim](t):t.sort((i,s)=>this.KeySchema.compare(i,s)).reduce((i,s)=>[...i,this.KeySchema.EncodeObject(s)],[])}ExtractSchema(){return gr.prim}generateSchema(){return{__michelsonType:gr.prim,schema:this.KeySchema.generateSchema()}}findAndReturnTokens(t,e){return gr.prim===t&&e.push(this),this.KeySchema.findAndReturnTokens(t,e),e}}gr.prim="set";class Vf extends ct{constructor(t,e,n){super(t,e,n),this.value=t,this.token=e,this.name="ChainIDValidationError"}}class Ne extends wt{constructor(t,e,n){super(t,e,n),this.val=t,this.idx=e,this.fac=n}isValid(t){return iu(t)!==k.VALID?new Vf(t,this,"ChainID is not valid"):null}Execute(t){return t[Object.keys(t)[0]]}ExtractSchema(){return Ne.prim}generateSchema(){return{__michelsonType:Ne.prim,schema:Ne.prim}}Encode(t){const e=t.pop(),n=this.isValid(e);if(n)throw n;return{string:e}}EncodeObject(t,e){const n=this.isValid(t);if(n)throw n;return e&&e[Ne.prim]?e[Ne.prim](t):{string:t}}ToKey({string:t}){return t}ToBigMapKey(t){return{key:{string:t},type:{prim:Ne.prim}}}findAndReturnTokens(t,e){return Ne.prim===t&&e.push(this),e}}Ne.prim="chain_id";class Za extends Error{constructor(){super("Tickets cannot be sent to the blockchain; they are created on-chain"),this.name="TicketEncodeError"}}const Gf={prim:"contract"},Kf={prim:"int"};class De extends Pt{constructor(t,e,n){super(t,e,n),this.val=t,this.idx=e,this.fac=n}get valueToken(){return this.createToken(this.val.args[0],this.idx)}Encode(t){throw new Za}EncodeObject(t,e){if(e&&e[De.prim])return e[De.prim](t,this.val);throw new Za}Execute(t,e){if(e&&e[De.prim])return e[De.prim](t,this.val);const n=this.createToken(Gf,this.idx),i=this.valueToken,s=this.createToken(Kf,this.idx);return t.args[2]===void 0&&t.args[1].args!==void 0?{ticketer:n.Execute(t.args[0],e),value:i.Execute(t.args[1].args[0],e),amount:s.Execute(t.args[1].args[1],e)}:{ticketer:n.Execute(t.args[0],e),value:i.Execute(t.args[1],e),amount:s.Execute(t.args[2],e)}}ExtractSchema(){return{ticketer:Jt.prim,value:this.valueToken.ExtractSchema(),amount:jt.prim}}generateSchema(){return{__michelsonType:De.prim,schema:{value:this.valueToken.generateSchema(),ticketer:{__michelsonType:Jt.prim,schema:Jt.prim},amount:{__michelsonType:jt.prim,schema:jt.prim}}}}findAndReturnTokens(t,e){return De.prim===t&&e.push(this),this.valueToken.findAndReturnTokens(t,e),e}}De.prim="ticket";class Ya extends Error{constructor(){super("Ticket_deprecated cannot be sent to the blockchain; they are created on-chain"),this.name="TicketDeprecatedEncodeError"}}const Ff={prim:"contract"},zf={prim:"int"};class Me extends Pt{constructor(t,e,n){super(t,e,n),this.val=t,this.idx=e,this.fac=n}get valueToken(){return this.createToken(this.val.args[0],this.idx)}Encode(t){throw new Ya}EncodeObject(t,e){if(e&&e[Me.prim])return e[Me.prim](t,this.val);throw new Ya}Execute(t,e){if(e&&e[Me.prim])return e[Me.prim](t,this.val);const n=this.createToken(Ff,this.idx),i=this.valueToken,s=this.createToken(zf,this.idx);return t.args[2]===void 0&&t.args[1].args!==void 0?{ticketer:n.Execute(t.args[0],e),value:i.Execute(t.args[1].args[0],e),amount:s.Execute(t.args[1].args[1],e)}:{ticketer:n.Execute(t.args[0],e),value:i.Execute(t.args[1],e),amount:s.Execute(t.args[2],e)}}ExtractSchema(){return{ticketer:Jt.prim,value:this.valueToken.ExtractSchema(),amount:jt.prim}}generateSchema(){return{__michelsonType:Me.prim,schema:{value:this.valueToken.generateSchema(),ticketer:{__michelsonType:Jt.prim,schema:Jt.prim},amount:{__michelsonType:jt.prim,schema:jt.prim}}}}findAndReturnTokens(t,e){return Me.prim===t&&e.push(this),this.valueToken.findAndReturnTokens(t,e),e}}Me.prim="ticket_deprecated";class hs extends ct{constructor(t,e,n){super(t,e,n),this.value=t,this.token=e,this.name="NeverTokenError"}}class Ze extends Pt{constructor(t,e,n){super(t,e,n),this.val=t,this.idx=e,this.fac=n}Encode(t){const e=t.pop();throw new hs(e,this,"Assigning a value to the type never is forbidden.")}EncodeObject(t,e){if(e&&e[Ze.prim])return e[Ze.prim](t);throw new hs(t,this,"Assigning a value to the type never is forbidden.")}Execute(t){throw new hs(t,this,"There is no literal value for the type never.")}ExtractSchema(){return Ze.prim}generateSchema(){return{__michelsonType:Ze.prim,schema:Ze.prim}}findAndReturnTokens(t,e){return Ze.prim===t&&e.push(this),e}}Ze.prim="never";class ds extends ct{constructor(t,e,n){super(t,e,n),this.value=t,this.token=e,this.name="SaplingStateValidationError"}}class xe extends Pt{constructor(t,e,n){super(t,e,n),this.val=t,this.idx=e,this.fac=n}isValid(t){return typeof t=="object"&&Object.keys(t).length===0}Execute(t,e){if(e&&e[xe.prim])return e[xe.prim](t,this.val);if("int"in t)return t.int;throw new ds(t,this,`Sapling state is expecting an object with an int property. Got ${JSON.stringify(t)}`)}Encode(t){const e=t.pop();if(this.isValid(e))return[];throw new ds(e,this,`Invalid sapling_state. Received: ${e} while expecting: {}`)}EncodeObject(t,e){if(e&&e[xe.prim])return e[xe.prim](t);if(this.isValid(t))return[];throw new ds(t,this,`Invalid sapling_state. Received: ${t} while expecting: {}`)}ExtractSchema(){return{[xe.prim]:{"memo-size":Number(this.val.args[0].int)}}}generateSchema(){return{__michelsonType:xe.prim,schema:{memoSize:this.val.args[0].int}}}findAndReturnTokens(t,e){return xe.prim===t&&e.push(this),e}}xe.prim="sapling_state";class Xa extends ct{constructor(t,e,n){super(t,e,n),this.value=t,this.token=e,this.name="SaplingTransactionValidationError"}}class mr extends Pt{constructor(t,e,n){super(t,e,n),this.val=t,this.idx=e,this.fac=n}Execute(t){throw new Xa(t,this,"There is no literal value for the sapling_transaction type.")}validateBytes(t){const e=/^(0x|0X)?([0-9a-fA-F]*$)/.exec(t);if(e&&e[2].length%2===0)return e[2];throw new Xa(t,this,`Invalid bytes: ${t}`)}convertUint8ArrayToHexString(t){return t.constructor===Uint8Array?nt.Buffer.from(t).toString("hex"):t}Encode(t){let e=t.pop();return e=this.validateBytes(this.convertUint8ArrayToHexString(e)),{bytes:String(e).toString()}}EncodeObject(t,e){return t=this.validateBytes(this.convertUint8ArrayToHexString(t)),e&&e[mr.prim]?e[mr.prim](t):{bytes:String(t).toString()}}ExtractSchema(){return{[mr.prim]:{"memo-size":Number(this.val.args[0].int)}}}generateSchema(){return{__michelsonType:mr.prim,schema:{memoSize:this.val.args[0].int}}}findAndReturnTokens(t,e){return mr.prim===t&&e.push(this),e}}mr.prim="sapling_transaction";class Ja extends ct{constructor(t,e,n){super(t,e,n),this.value=t,this.token=e,this.name="SaplingTransactionDeprecatedValidationError"}}class yr extends Pt{constructor(t,e,n){super(t,e,n),this.val=t,this.idx=e,this.fac=n}Execute(t){throw new Ja(t,this,"There is no literal value for the sapling_transaction_deprecated type.")}validateBytes(t){const e=/^(0x|0X)?([0-9a-fA-F]*$)/.exec(t);if(e&&e[2].length%2===0)return e[2];throw new Ja(t,this,`Invalid bytes: ${t}`)}convertUint8ArrayToHexString(t){return t.constructor===Uint8Array?nt.Buffer.from(t).toString("hex"):t}Encode(t){let e=t.pop();return e=this.validateBytes(this.convertUint8ArrayToHexString(e)),{bytes:String(e).toString()}}EncodeObject(t,e){return t=this.validateBytes(this.convertUint8ArrayToHexString(t)),e&&e[yr.prim]?e[yr.prim](t):{bytes:String(t).toString()}}ExtractSchema(){return{[yr.prim]:{"memo-size":Number(this.val.args[0].int)}}}generateSchema(){return{__michelsonType:yr.prim,schema:{memoSize:this.val.args[0].int}}}findAndReturnTokens(t,e){return yr.prim===t&&e.push(this),e}}yr.prim="sapling_transaction_deprecated";class qf extends ct{constructor(t,e,n){super(t,e,n),this.value=t,this.token=e,this.name="Bls12381frValidationError"}}class Ye extends Pt{constructor(t,e,n){super(t,e,n),this.val=t,this.idx=e,this.fac=n}isValid(t){return/^[0-9a-fA-F]*$/.test(t)&&t.length%2===0?null:new qf(t,this,`Invalid bytes: ${t}`)}convertUint8ArrayToHexString(t){return t.constructor===Uint8Array?nt.Buffer.from(t).toString("hex"):t}Encode(t){let e=t.pop();if(typeof e=="number")return{int:e.toString()};{e=this.convertUint8ArrayToHexString(e);const n=this.isValid(e);if(n)throw n;return{bytes:e}}}EncodeObject(t,e){if(e&&e[Ye.prim])return e[Ye.prim](t);if(typeof t=="number")return{int:t.toString()};{t=this.convertUint8ArrayToHexString(t);const n=this.isValid(t);if(n)throw n;return{bytes:t}}}Execute(t){return t.bytes}ExtractSchema(){return Ye.prim}generateSchema(){return{__michelsonType:Ye.prim,schema:Ye.prim}}findAndReturnTokens(t,e){return Ye.prim===t&&e.push(this),e}}Ye.prim="bls12_381_fr";class Wf extends ct{constructor(t,e,n){super(t,e,n),this.value=t,this.token=e,this.name="Bls12381g1ValidationError"}}class Xe extends Pt{constructor(t,e,n){super(t,e,n),this.val=t,this.idx=e,this.fac=n}isValid(t){return/^[0-9a-fA-F]*$/.test(t)&&t.length%2===0?null:new Wf(t,this,`Invalid bytes: ${t}`)}convertUint8ArrayToHexString(t){return t.constructor===Uint8Array?nt.Buffer.from(t).toString("hex"):t}Encode(t){let e=t.pop();e=this.convertUint8ArrayToHexString(e);const n=this.isValid(e);if(n)throw n;return{bytes:e}}EncodeObject(t,e){t=this.convertUint8ArrayToHexString(t);const n=this.isValid(t);if(n)throw n;return e&&e[Xe.prim]?e[Xe.prim](t):{bytes:t}}Execute(t){return t.bytes}ExtractSchema(){return Xe.prim}generateSchema(){return{__michelsonType:Xe.prim,schema:Xe.prim}}findAndReturnTokens(t,e){return Xe.prim===t&&e.push(this),e}}Xe.prim="bls12_381_g1";class Zf extends ct{constructor(t,e,n){super(t,e,n),this.value=t,this.token=e,this.name="Bls12381g2ValidationError"}}class Je extends Pt{constructor(t,e,n){super(t,e,n),this.val=t,this.idx=e,this.fac=n}isValid(t){return/^[0-9a-fA-F]*$/.test(t)&&t.length%2===0?null:new Zf(t,this,`Invalid bytes: ${t}`)}convertUint8ArrayToHexString(t){return t.constructor===Uint8Array?nt.Buffer.from(t).toString("hex"):t}Encode(t){let e=t.pop();e=this.convertUint8ArrayToHexString(e);const n=this.isValid(e);if(n)throw n;return{bytes:e}}EncodeObject(t,e){t=this.convertUint8ArrayToHexString(t);const n=this.isValid(t);if(n)throw n;return e&&e[Je.prim]?e[Je.prim](t):{bytes:t}}Execute(t){return t.bytes}ExtractSchema(){return Je.prim}generateSchema(){return{__michelsonType:Je.prim,schema:Je.prim}}findAndReturnTokens(t,e){return Je.prim===t&&e.push(this),e}}Je.prim="bls12_381_g2";class Yf extends ct{constructor(t,e,n){super(t,e,n),this.value=t,this.token=e,this.name="ChestValidationError"}}class Qe extends Pt{constructor(t,e,n){super(t,e,n),this.val=t,this.idx=e,this.fac=n}isValid(t){return/^[0-9a-fA-F]*$/.test(t)&&t.length%2===0?null:new Yf(t,this,`Invalid bytes: ${t}`)}convertUint8ArrayToHexString(t){return t.constructor===Uint8Array?nt.Buffer.from(t).toString("hex"):t}Encode(t){let e=t.pop();e=this.convertUint8ArrayToHexString(e);const n=this.isValid(e);if(n)throw n;return{bytes:e}}EncodeObject(t,e){t=this.convertUint8ArrayToHexString(t);const n=this.isValid(t);if(n)throw n;return e&&e[Qe.prim]?e[Qe.prim](t):{bytes:t}}Execute(t){return t.bytes}ExtractSchema(){return Qe.prim}generateSchema(){return{__michelsonType:Qe.prim,schema:Qe.prim}}findAndReturnTokens(t,e){return Qe.prim===t&&e.push(this),e}}Qe.prim="chest";class Xf extends ct{constructor(t,e,n){super(t,e,n),this.value=t,this.token=e,this.name="ChestKeyValidationError"}}class tr extends Pt{constructor(t,e,n){super(t,e,n),this.val=t,this.idx=e,this.fac=n}isValid(t){return/^[0-9a-fA-F]*$/.test(t)&&t.length%2===0?null:new Xf(t,this,`Invalid bytes: ${t}`)}convertUint8ArrayToHexString(t){return t.constructor===Uint8Array?nt.Buffer.from(t).toString("hex"):t}Encode(t){let e=t.pop();e=this.convertUint8ArrayToHexString(e);const n=this.isValid(e);if(n)throw n;return{bytes:e}}EncodeObject(t,e){t=this.convertUint8ArrayToHexString(t);const n=this.isValid(t);if(n)throw n;return e&&e[tr.prim]?e[tr.prim](t):{bytes:t}}Execute(t){return t.bytes}ExtractSchema(){return tr.prim}generateSchema(){return{__michelsonType:tr.prim,schema:tr.prim}}findAndReturnTokens(t,e){return tr.prim===t&&e.push(this),e}}tr.prim="chest_key";class Qa extends ct{constructor(t,e,n){super(t,e,n),this.value=t,this.token=e,this.name="GlobalConstantEncodingError"}}class Jf extends ct{constructor(t,e,n){super(t,e,n),this.value=t,this.token=e,this.name="GlobalConstantDecodingError"}}class Le extends Pt{constructor(t,e,n){super(t,e,n),this.val=t,this.idx=e,this.fac=n}Execute(t,e){if(e&&e[Le.prim])return e[Le.prim](t,this.val);throw new Jf(t,this,`Unable to decode a value represented by a global constants. Please provide an expanded script to the Michelson-Encoder or semantics for the decoding. The following global constant hash was encountered: ${this.val.args[0].string}.`)}Encode(t){throw new Qa(t,this,`Unable to encode a script containing global constants. Please provide an expanded script to the Michelson-Encoder. The following global constant hash was encountered: ${this.val.args[0].string}.`)}EncodeObject(t,e){if(e&&e[Le.prim])return e[Le.prim](t);throw new Qa(t,this,`Unable to encode a script containing global constants. Please provide an expanded script to the Michelson-Encoder. The following global constant hash was encountered: ${this.val.args[0].string}.`)}ExtractSchema(){return Le.prim}generateSchema(){return{__michelsonType:Le.prim,schema:{hash:this.val.args[0].string}}}findAndReturnTokens(t,e){return Le.prim===t&&e.push(this),e}}Le.prim="constant";const Qf=[Ot,ve,we,re,ze,qe,Er,_e,Q,Jt,pr,Ae,Se,Qr,Re,jt,Oe,Pe,Te,Ie,fr,We,gr,Ne,De,Me,Ze,xe,mr,yr,Ye,Xe,Je,Qe,tr,Le];class tg extends Error{constructor(t,e){super(t),this.message=t,this.data=e,this.name="Invalid token error"}}function kr(r,t){if(Array.isArray(r))return new Ot(r,t,kr);const e=Qf.find(n=>n.prim===r.prim);if(!e)throw new tg("Malformed data expected a value with a valid prim property",r);return new e(r,t,kr)}class eg extends Error{constructor(t,e){super(`Unable to encode the parameter of the view: ${t}.`),this.smartContractViewName=t,this.originalError=e,this.name="ViewEncodingError"}}class tc extends Error{constructor(t){super(t),this.message=t,this.name="InvalidScriptError"}}class Ou extends Error{constructor(t){super("Invalid RPC response passed as argument(s)"),this.script=t,this.name="InvalidRpcResponseError"}}class ec extends Error{constructor(t,e,n){super(`
      ${t}. Error encountered when trying to encode arguments: 

      [${e}]
    `),this.message=t,this.args=e,this.originalError=n,this.name="ParameterEncodingError"}}class Fn extends Error{constructor(t){super(t),this.message=t,this.name="InvalidBigMapSchema"}}class rg extends Error{constructor(t){super(t),this.message=t,this.name="InvalidBigMapDiff"}}class ng extends Error{constructor(t,e){super(`Unable to encode ${t}. ${e}`),this.obj=t,this.details=e,this.name="BigMapEncodingError"}}class ig extends Error{constructor(t,e){super(`Unable to encode ${t}. ${e}`),this.obj=t,this.details=e,this.name="StorageEncodingError"}}class sg extends Error{constructor(t){super(t),this.message=t,this.name="MissingArgumentError"}}var Pu;const Tu=Symbol.for("taquito-schema-type-symbol");function Sn(r,t=Ot.prim){var e,n;if(Array.isArray(r))return Sn({prim:t,args:r},t);const i=r;return i.prim===t&&i.args&&i.args.length>2?Object.assign(Object.assign({},i),{args:[(e=i.args)===null||e===void 0?void 0:e[0],{prim:t,args:(n=i.args)===null||n===void 0?void 0:n.slice(1)}]}):i}function Iu(r,t){const e=Sn(r),n=Sn(t);return e.prim===n.prim&&(e.args===void 0&&n.args===void 0||e.args!==void 0&&n.args!==void 0&&e.args.length===n.args.length&&e.args.every((i,s)=>{var o,a;return Iu(i,(a=(o=n.args)===null||o===void 0?void 0:o[s])!==null&&a!==void 0?a:{})}))&&(e.annots===void 0&&n.annots===void 0||e.annots!==void 0&&n.annots!==void 0&&e.annots.length===n.annots.length&&e.annots.every((i,s)=>{var o;return i===((o=n.annots)===null||o===void 0?void 0:o[s])}))}class ne{constructor(t){if(this.val=t,this[Pu]=!0,this.root=kr(t,0),this.root instanceof re)this.bigMap=this.root;else if(this.isExpressionExtended(t)&&t.prim==="pair"){const e=t.args[0];this.isExpressionExtended(e)&&e.prim==="big_map"&&(this.bigMap=new re(e,0,kr))}}static isSchema(t){return t&&t[Tu]===!0}static fromRPCResponse(t){const e=t&&t.script&&Array.isArray(t.script.code)&&t.script.code.find(n=>{if(Array.isArray(n))this.fromRPCResponse({script:{code:n,storage:t.script.storage}});else{const i=n;return i.prim?i.prim==="storage":!1}});if(!e||!Array.isArray(e.args))throw new Ou(t.script);return new ne(e.args[0])}isExpressionExtended(t){return"prim"in t&&Array.isArray(t.args)}removeTopLevelAnnotation(t){return(this.root instanceof Ot||this.root instanceof Q)&&this.root.hasAnnotations()&&typeof t=="object"&&Object.keys(t).length===1?t[Object.keys(t)[0]]:t}Execute(t,e){const n=this.root.Execute(t,e);return this.removeTopLevelAnnotation(n)}Typecheck(t){if(this.root instanceof re&&Number.isInteger(Number(t))||this.root instanceof De&&t.ticketer&&t.value&&t.amount||this.root instanceof Me&&t.ticketer&&t.value&&t.amount||this.root instanceof Er&&this.root.ValueSchema instanceof re)return!0;try{return this.root.EncodeObject(t),!0}catch{return!1}}ExecuteOnBigMapDiff(t,e){if(!this.bigMap)throw new Fn("Big map schema is undefined");if(!Array.isArray(t))throw new rg("Big map diff must be an array");const n=t.map(({key:i,value:s})=>({args:[i,s]}));return this.bigMap.Execute(n,e)}ExecuteOnBigMapValue(t,e){if(!this.bigMap)throw new Fn("No big map schema");return this.bigMap.ValueSchema.Execute(t,e)}EncodeBigMapKey(t){if(!this.bigMap)throw new Fn("Big map schema is undefined");try{return this.bigMap.KeySchema.ToBigMapKey(t)}catch(e){throw new ng("big map key",e)}}Encode(t,e){try{return this.root.EncodeObject(t,e)}catch(n){throw n instanceof ct?n:new ig("storage object",n)}}ExtractSchema(){return this.removeTopLevelAnnotation(this.root.ExtractSchema())}generateSchema(){return this.removeTopLevelAnnotation(this.root.generateSchema())}ComputeState(t,e){if(!this.bigMap)throw new Fn("Big map schema is undefined");const n=t.reduce((i,s)=>Object.assign(Object.assign({},i),this.ExecuteOnBigMapDiff(s.contents[0].metadata.operation_result.big_map_diff)),{});return Object.assign(Object.assign({},this.Execute(e)),{[this.bigMap.annot()]:n})}FindFirstInTopLevelPair(t,e){return this.findValue(this.root.val,t,e)}findValue(t,e,n){if(Iu(n,t))return e;if(Array.isArray(t)||t.prim==="pair"){const i=Sn(t),s=Sn(e,"Pair");if(i.args===void 0||s.args===void 0)throw new sg("Tokens have no arguments");if(i.args[0])return this.findValue(i.args[0],s.args[0],n)||this.findValue(i.args[1],s.args[1],n)}}findToken(t){const e=[];return this.root.findAndReturnTokens(t,e)}}Pu=Tu;class zr{constructor(t){this.root=kr(t,0)}static fromRPCResponse(t){const e=t&&t.script&&Array.isArray(t.script.code)&&t.script.code.find(n=>n.prim==="parameter");if(!e||!Array.isArray(e.args))throw new Ou(t.script);return new zr(e.args[0])}get isMultipleEntryPoint(){return this.root instanceof Q||this.root instanceof Qr&&this.root.subToken()instanceof Q}get hasAnnotation(){return this.isMultipleEntryPoint?Object.keys(this.ExtractSchema())[0]!=="0":!0}Execute(t,e){return this.root.Execute(t,e)}Encode(...t){try{return this.root.Encode(t.reverse())}catch(e){throw e instanceof ct?e:new ec("Unable to encode parameter",t.toString(),e)}}EncodeObject(t,e){try{return this.root.EncodeObject(t,e)}catch(n){throw n instanceof ct?n:new ec("Unable to encode parameter object",t,n)}}ExtractSchema(){return this.root.ExtractSchema()}generateSchema(){return this.root.generateSchema()}ExtractSignatures(){return this.root.ExtractSignature()}}class io{constructor(t){if(t.length!==4||!("string"in t[0]))throw new tc(`Invalid on-chain view: ${JSON.stringify(t)}`);this.viewName=t[0].string,this.viewArgsType=t[1],this.viewReturnType=t[2],this.instructions=t[3],this.rootArgsType=kr(this.viewArgsType,0),this.rootReturnType=kr(this.viewReturnType,0)}static fromRPCResponse(t){const e=[],n=t&&t.script&&Array.isArray(t.script.code)&&t.script.code.filter(i=>i.prim==="view");return n&&n.forEach(i=>{if(!i.args||i.args.length!==4)throw new tc(`Invalid on-chain view found in the script: ${JSON.stringify(i)}`);e.push(new io(i.args))}),e}encodeViewArgs(t){try{return this.rootArgsType.EncodeObject(t)}catch(e){throw new eg(this.viewName,e)}}decodeViewResult(t,e){return this.rootReturnType.Execute(t,e)}extractArgsSchema(){return this.rootArgsType.ExtractSchema()}extractResultSchema(){return this.rootReturnType.ExtractSchema()}}const Os=Symbol(),zt=Symbol("source_reference");class Ir extends Error{constructor(t,e,n){super(n),this.src=t,this.idx=e,Object.setPrototypeOf(this,Ir.prototype)}}var qt;(function(r){r[r.Comment=0]="Comment",r[r.Number=1]="Number",r[r.String=2]="String",r[r.Bytes=3]="Bytes",r[r.Ident=4]="Ident"})(qt||(qt={}));const og=new RegExp("\\s"),ag=new RegExp("[:@%_A-Za-z]"),cg=new RegExp("[@%_\\.A-Za-z0-9]"),rc=new RegExp("[0-9]"),ug=new RegExp("[0-9a-fA-F]");function*ps(r,t=!1){let e=0;for(;e<r.length;){for(;e<r.length&&og.test(r[e]);)e++;if(e===r.length)return;const n=r[e],i=e;if(ag.test(n)){for(e++;e<r.length&&cg.test(r[e]);)e++;yield{t:qt.Ident,v:r.slice(i,e),first:i,last:e}}else if(r.length-e>1&&r.substring(e,e+2)==="0x"){for(e+=2;e<r.length&&ug.test(r[e]);)e++;if(e-i&1)throw new Ir(r,e,"Bytes literal length is expected to be power of two");yield{t:qt.Bytes,v:r.slice(i,e),first:i,last:e}}else if(rc.test(n)||n==="-"){n==="-"&&e++;const s=e;for(;e<r.length&&rc.test(r[e]);)e++;if(s===e)throw new Ir(r,e,"Number literal is too short");yield{t:qt.Number,v:r.slice(i,e),first:i,last:e}}else if(n==='"'){e++;let s=!1;for(;e<r.length&&(s||r[e]!=='"');e++)!s&&r[e]==="\\"?s=!0:s=!1;if(e===r.length)throw new Ir(r,e,"Unterminated string literal");e++,yield{t:qt.String,v:r.slice(i,e),first:i,last:e}}else if(n==="#"){for(e++;e<r.length&&r[e]!==`
`;)e++;t&&(yield{t:qt.Comment,v:r.slice(i,e),first:i,last:e})}else if(r.length-e>1&&r.substring(e,e+2)==="/*"){for(e+=2;e<r.length&&!(r.length-e>1&&r.substring(e,e+2)==="*/");)e++;if(e===r.length)throw new Ir(r,e,"Unterminated C style comment");e+=2,t&&(yield{t:qt.Comment,v:r.slice(i,e),first:i,last:e})}else if(n==="("||n===")"||n==="{"||n==="}"||n===";")e++,yield{t:n,v:n,first:i,last:e};else throw new Ir(r,e,`Invalid character at offset ${e}: \`${n}'`)}}const zn=Symbol("ref_contract");var sr;(function(r){r.Ps9mPmXa="Ps9mPmXaRzmzk35gbAYNCAw6UXdE2qoABTHbN2oEEc1qM7CwT9P",r.PtCJ7pwo="PtCJ7pwoxe8JasnHY8YonnLYjcVHmhiARPJvqcC6VfHT5s8k8sY",r.PsYLVpVv="PsYLVpVvgbLhAhoqAkMFUo6gudkJ9weNXhUYCiLDzcUpFpkk8Wt",r.PsddFKi3="PsddFKi32cMJ2qPjf43Qv5GDWLDPZb3T3bF6fLKiF5HtvHNU7aP",r.Pt24m4xi="Pt24m4xiPbLDhVgVfABUjirbmda3yohdN82Sp9FeuAXJ4eV9otd",r.PsBABY5H="PsBABY5HQTSkA4297zNHfsZNKtxULfL18y95qb3m53QJiXGmrbU",r.PsBabyM1="PsBabyM1eUXZseaJdmXFApDSBqj8YBfwELoxZHHW77EMcAbbwAS",r.PsCARTHA="PsCARTHAGazKbHtnKfLzQg3kms52kSRpgnDY982a9oYsSXRLQEb",r.PsDELPH1="PsDELPH1Kxsxt8f9eWbxQeRxkjfbxoqM52jvs5Y5fBxWWh4ifpo",r.PtEdoTez="PtEdoTezd3RHSC31mpxxo1npxFjoWWcFgQtxapi51Z8TLu6v6Uq",r.PtEdo2Zk="PtEdo2ZkT9oKpimTah6x2embF25oss54njMuPzkJTEi5RqfdZFA",r.PsFLoren="PsFLorenaUUuikDWvMDr6fGBRG8kt3e3D3fHoXK1j1BFRxeSH4i",r.PsFLorena="PsFLorenaUUuikDWvMDr6fGBRG8kt3e3D3fHoXK1j1BFRxeSH4i",r.PtGRANAD="PtGRANADsDU8R9daYKAgWnQYAJ64omN1o3KMGVCykShA97vQbvV",r.PtGRANADs="PtGRANADsDU8R9daYKAgWnQYAJ64omN1o3KMGVCykShA97vQbvV",r.PtHangzH="PtHangzHogokSuiMHemCuowEavgYTP8J5qQ9fQS793MHYFpCY3r",r.PtHangz2="PtHangz2aRngywmSRGGvrcTyMbbdpWdpFKuS4uMWxg2RaH9i1qx",r.PsiThaCa="PsiThaCaT47Zboaw71QWScM8sXeMM7bbQFncK9FLqYc6EKdpjVP",r.Psithaca2="Psithaca2MLRFYargivpo7YvUr7wUDqyxrdhC5CQq78mRvimz6A",r.PtJakarta="PtJakartaiDz69SfDDLXJSiuZqTSeSKRDbKVZC8MNzJnvRjvnGw",r.PtJakart2="PtJakart2xVj7pYXJBXrqHgd82rdkLey5ZeeGwDgPp9rhQUbSqY",r.PtKathman="PtKathmankSpLLDALzWw7CGD2j2MtyveTwboEYokqUCP4a1LxMg",r.PtLimaPtL="PtLimaPtLMwfNinJi9rCfDPWea8dFgTZ1MeJ9f1m2SRic6ayiwW",r.PtMumbaii="PtMumbaiiFFEGbew1rRjzSPyzRbA51Tm3RVZL5suHPxSZYDhCEc",r.PtMumbai2="PtMumbai2TmsJHNGRkD8v8YDbtao7BLUC3wjASn1inAKLFCjaH1",r.ProtoALpha="ProtoALphaALphaALphaALphaALphaALphaALphaALphaDdp3zK"})(sr||(sr={}));const Nu=sr.Psithaca2,nc={Ps9mPmXaRzmzk35gbAYNCAw6UXdE2qoABTHbN2oEEc1qM7CwT9P:0,PtCJ7pwoxe8JasnHY8YonnLYjcVHmhiARPJvqcC6VfHT5s8k8sY:1,PsYLVpVvgbLhAhoqAkMFUo6gudkJ9weNXhUYCiLDzcUpFpkk8Wt:2,PsddFKi32cMJ2qPjf43Qv5GDWLDPZb3T3bF6fLKiF5HtvHNU7aP:3,Pt24m4xiPbLDhVgVfABUjirbmda3yohdN82Sp9FeuAXJ4eV9otd:4,PsBABY5HQTSkA4297zNHfsZNKtxULfL18y95qb3m53QJiXGmrbU:5,PsBabyM1eUXZseaJdmXFApDSBqj8YBfwELoxZHHW77EMcAbbwAS:5,PsCARTHAGazKbHtnKfLzQg3kms52kSRpgnDY982a9oYsSXRLQEb:6,PsDELPH1Kxsxt8f9eWbxQeRxkjfbxoqM52jvs5Y5fBxWWh4ifpo:7,PtEdoTezd3RHSC31mpxxo1npxFjoWWcFgQtxapi51Z8TLu6v6Uq:8,PtEdo2ZkT9oKpimTah6x2embF25oss54njMuPzkJTEi5RqfdZFA:8,PsFLorenaUUuikDWvMDr6fGBRG8kt3e3D3fHoXK1j1BFRxeSH4i:9,PtGRANADsDU8R9daYKAgWnQYAJ64omN1o3KMGVCykShA97vQbvV:10,PtHangzHogokSuiMHemCuowEavgYTP8J5qQ9fQS793MHYFpCY3r:11,PtHangz2aRngywmSRGGvrcTyMbbdpWdpFKuS4uMWxg2RaH9i1qx:11,PsiThaCaT47Zboaw71QWScM8sXeMM7bbQFncK9FLqYc6EKdpjVP:12,Psithaca2MLRFYargivpo7YvUr7wUDqyxrdhC5CQq78mRvimz6A:12,PtJakartaiDz69SfDDLXJSiuZqTSeSKRDbKVZC8MNzJnvRjvnGw:13,PtJakart2xVj7pYXJBXrqHgd82rdkLey5ZeeGwDgPp9rhQUbSqY:13,PtKathmankSpLLDALzWw7CGD2j2MtyveTwboEYokqUCP4a1LxMg:14,PtLimaPtLMwfNinJi9rCfDPWea8dFgTZ1MeJ9f1m2SRic6ayiwW:15,PtMumbaiiFFEGbew1rRjzSPyzRbA51Tm3RVZL5suHPxSZYDhCEc:16,PtMumbai2TmsJHNGRkD8v8YDbtao7BLUC3wjASn1inAKLFCjaH1:16,ProtoALphaALphaALphaALphaALphaALphaALphaALphaDdp3zK:17};function qr(r,t){return nc[r]<nc[t]}class ie extends Error{constructor(t,e){super(e),this.prim=t,Object.setPrototypeOf(this,ie.prototype)}}function ht(r,t){var e,n;if(t===0&&r.args===void 0||((e=r.args)===null||e===void 0?void 0:e.length)===t)return!0;throw new ie(r,`macro ${r.prim} expects ${t} arguments, was given ${(n=r.args)===null||n===void 0?void 0:n.length}`)}function fn(r){if(r.annots===void 0)return!0;throw new ie(r,`unexpected annotation on macro ${r.prim}: ${r.annots}`)}function ic(r,t){if("int"in t)return!0;throw new ie(r,`macro ${r.prim} expects int argument`)}function En(r,t,e,n){let i=0,s=0;const o=[null,null];let a;if(i===t.length)throw new ie(r,`unexpected end: ${r.prim}`);let u=t[i++];switch(u){case"P":{const{r:f,n:m,an:N}=En(r,t.slice(i),e.slice(s),n);a=f,i+=m,s+=N;break}case"A":s!==e.length&&(o[0]=e[s++]);break;default:throw new ie(r,`${r.prim}: unexpected character: ${u}`)}let p;if(i===t.length)throw new ie(r,`unexpected end: ${r.prim}`);switch(u=t[i++],u){case"P":{const{r:f,n:m,an:N}=En(r,t.slice(i),e.slice(s),n);p=f.map(([T,x])=>[T+1,x]),i+=m,s+=N;break}case"I":s!==e.length&&(o[1]=e[s++]);break;default:throw new ie(r,`${r.prim}: unexpected character: ${u}`)}return{r:n(a,p,[0,o]),n:i,an:s}}function fi(r,t,e,n){const i=t[0];switch(i){case"A":return t.length>1?[{prim:"DUP"},{prim:"DIP",args:[[{prim:"CAR",annots:["@%%"]},fi(r,t.slice(1),[],n)]]},{prim:"CDR",annots:["@%%"]},{prim:"SWAP"},{prim:"PAIR",annots:["%@","%@",...e]}]:n.a;case"D":return t.length>1?[{prim:"DUP"},{prim:"DIP",args:[[{prim:"CDR",annots:["@%%"]},fi(r,t.slice(1),[],n)]]},{prim:"CAR",annots:["@%%"]},{prim:"PAIR",annots:["%@","%@",...e]}]:n.d;default:throw new ie(r,`${r.prim}: unexpected character: ${i}`)}}function lg(r,t){let e=r.length;for(;e>0&&r[e-1]===t;)e--;return r.slice(0,e)}function fs(r){const t=[],e=[];if(r!==void 0)for(const n of r)(n.length!==0&&n[0]==="%"?t:e).push(n);return{fields:t,rest:e}}function Tt({prim:r,annots:t,args:e}){return Object.assign(Object.assign({prim:r},t&&{annots:t}),e&&{args:e})}const hg=/^P[PAI]{3,}R$/,dg=/^UNP[PAI]{2,}R$/,pg=/^C[AD]{2,}R$/,fg=/^SET_C[AD]+R$/,gg=/^MAP_C[AD]+R$/,mg=/^DI{2,}P$/,yg=/^DU+P$/;function bg(r,t){const e=(t==null?void 0:t.protocol)||Nu;function n(i){return i!==void 0?[{prim:"RENAME",annots:i}]:[]}switch(r.prim){case"CMPEQ":case"CMPNEQ":case"CMPLT":case"CMPGT":case"CMPLE":case"CMPGE":if(ht(r,0))return[{prim:"COMPARE"},Tt({prim:r.prim.slice(3),annots:r.annots})];break;case"IFEQ":case"IFNEQ":case"IFLT":case"IFGT":case"IFLE":case"IFGE":if(ht(r,2))return[{prim:r.prim.slice(2)},Tt({prim:"IF",annots:r.annots,args:r.args})];break;case"IFCMPEQ":case"IFCMPNEQ":case"IFCMPLT":case"IFCMPGT":case"IFCMPLE":case"IFCMPGE":if(ht(r,2))return[{prim:"COMPARE"},{prim:r.prim.slice(5)},Tt({prim:"IF",annots:r.annots,args:r.args})];break;case"FAIL":if(ht(r,0)&&fn(r))return[{prim:"UNIT"},{prim:"FAILWITH"}];break;case"ASSERT":if(ht(r,0)&&fn(r))return[{prim:"IF",args:[[],[[{prim:"UNIT"},{prim:"FAILWITH"}]]]}];break;case"ASSERT_EQ":case"ASSERT_NEQ":case"ASSERT_LT":case"ASSERT_GT":case"ASSERT_LE":case"ASSERT_GE":if(ht(r,0)&&fn(r))return[{prim:r.prim.slice(7)},{prim:"IF",args:[[],[[{prim:"UNIT"},{prim:"FAILWITH"}]]]}];break;case"ASSERT_CMPEQ":case"ASSERT_CMPNEQ":case"ASSERT_CMPLT":case"ASSERT_CMPGT":case"ASSERT_CMPLE":case"ASSERT_CMPGE":if(ht(r,0)&&fn(r))return[[{prim:"COMPARE"},{prim:r.prim.slice(10)}],{prim:"IF",args:[[],[[{prim:"UNIT"},{prim:"FAILWITH"}]]]}];break;case"ASSERT_NONE":if(ht(r,0)&&fn(r))return[{prim:"IF_NONE",args:[[],[[{prim:"UNIT"},{prim:"FAILWITH"}]]]}];break;case"ASSERT_SOME":if(ht(r,0))return[{prim:"IF_NONE",args:[[[{prim:"UNIT"},{prim:"FAILWITH"}]],n(r.annots)]}];break;case"ASSERT_LEFT":if(ht(r,0))return[{prim:"IF_LEFT",args:[n(r.annots),[[{prim:"UNIT"},{prim:"FAILWITH"}]]]}];break;case"ASSERT_RIGHT":if(ht(r,0))return[{prim:"IF_LEFT",args:[[[{prim:"UNIT"},{prim:"FAILWITH"}]],n(r.annots)]}];break;case"IF_SOME":if(ht(r,2))return[Tt({prim:"IF_NONE",annots:r.annots,args:[r.args[1],r.args[0]]})];break;case"IF_RIGHT":if(ht(r,2))return[Tt({prim:"IF_LEFT",annots:r.annots,args:[r.args[1],r.args[0]]})];break;case"CAR":case"CDR":if(r.args!==void 0){if(ht(r,1)&&ic(r,r.args[0])){const i=parseInt(r.args[0].int,10);return Tt({prim:"GET",args:[{int:r.prim==="CAR"?String(i*2+1):String(i*2)}],annots:r.annots})}}else return r}if(hg.test(r.prim)&&ht(r,0)){const{fields:i,rest:s}=fs(r.annots),{r:o}=En(r,r.prim.slice(1),i,(a,u,p)=>[...a||[],...u||[],p]);return o.map(([a,u],p)=>{const f=[...lg(u,null).map(N=>N===null?"%":N),...a===0&&p===o.length-1?s:[]],m=Tt({prim:"PAIR",annots:f.length!==0?f:void 0});return a===0?m:{prim:"DIP",args:a===1?[[m]]:[{int:String(a)},[m]]}})}if(dg.test(r.prim))if(qr(e,sr.PtEdo2Zk)&&ht(r,0)){const{r:i}=En(r,r.prim.slice(3),r.annots||[],(s,o,a)=>[a,...o||[],...s||[]]);return i.map(([s,o])=>{const a=[{prim:"DUP"},Tt({prim:"CAR",annots:o[0]!==null?[o[0]]:void 0}),{prim:"DIP",args:[[Tt({prim:"CDR",annots:o[1]!==null?[o[1]]:void 0})]]}];return s===0?a:{prim:"DIP",args:s===1?[[a]]:[{int:String(s)},[a]]}})}else{if(r.prim==="UNPAIR")return r;if(ht(r,0)){const{r:i}=En(r,r.prim.slice(3),[],(s,o,a)=>[a,...o||[],...s||[]]);return i.map(([s])=>{const o=Tt({prim:"UNPAIR"});return s===0?o:{prim:"DIP",args:s===1?[[o]]:[{int:String(s)},[o]]}})}}if(pg.test(r.prim)&&ht(r,0)){const i=[...r.prim.slice(1,r.prim.length-1)];return i.map((s,o)=>{const a=o===i.length-1?r.annots:void 0;switch(s){case"A":return Tt({prim:"CAR",annots:a});case"D":return Tt({prim:"CDR",annots:a});default:throw new ie(r,`unexpected character: ${s}`)}})}if(fg.test(r.prim)&&ht(r,0)){const{fields:i,rest:s}=fs(r.annots);if(i.length>1)throw new ie(r,`unexpected annotation on macro ${r.prim}: ${i}`);const o=i.length!==0?{a:[{prim:"DUP"},{prim:"CAR",annots:i},{prim:"DROP"},{prim:"CDR",annots:["@%%"]},{prim:"SWAP"},{prim:"PAIR",annots:[i[0],"%@"]}],d:[{prim:"DUP"},{prim:"CDR",annots:i},{prim:"DROP"},{prim:"CAR",annots:["@%%"]},{prim:"PAIR",annots:["%@",i[0]]}]}:{a:[{prim:"CDR",annots:["@%%"]},{prim:"SWAP"},{prim:"PAIR",annots:["%","%@"]}],d:[{prim:"CAR",annots:["@%%"]},{prim:"PAIR",annots:["%@","%"]}]};return fi(r,r.prim.slice(5,r.prim.length-1),s,o)}if(gg.test(r.prim)&&ht(r,1)){const{fields:i}=fs(r.annots);if(i.length>1)throw new ie(r,`unexpected annotation on macro ${r.prim}: ${i}`);const s={a:[{prim:"DUP"},{prim:"CDR",annots:["@%%"]},{prim:"DIP",args:[[Tt({prim:"CAR",annots:i.length!==0?["@"+i[0].slice(1)]:void 0}),r.args[0]]]},{prim:"SWAP"},{prim:"PAIR",annots:[i.length!==0?i[0]:"%","%@"]}],d:[{prim:"DUP"},Tt({prim:"CDR",annots:i.length!==0?["@"+i[0].slice(1)]:void 0}),r.args[0],{prim:"SWAP"},{prim:"CAR",annots:["@%%"]},{prim:"PAIR",annots:["%@",i.length!==0?i[0]:"%"]}]};return fi(r,r.prim.slice(5,r.prim.length-1),[],s)}if(mg.test(r.prim)&&ht(r,1)){let i=0;for(;r.prim[1+i]==="I";)i++;return Tt({prim:"DIP",args:[{int:String(i)},r.args[0]]})}if(yg.test(r.prim)){let i=0;for(;r.prim[1+i]==="U";)i++;if(qr(e,sr.PtEdo2Zk)){if(i===1){if(r.args===void 0)return r;ht(r,1)&&ic(r,r.args[0])&&(i=parseInt(r.args[0].int,10))}else ht(r,0);return i===1?[Tt({prim:"DUP",annots:r.annots})]:i===2?[{prim:"DIP",args:[[Tt({prim:"DUP",annots:r.annots})]]},{prim:"SWAP"}]:[{prim:"DIP",args:[{int:String(i-1)},[Tt({prim:"DUP",annots:r.annots})]]},{prim:"DIG",args:[{int:String(i)}]}]}else{if(i===1)return r;if(ht(r,0))return Tt({prim:"DUP",args:[{int:String(i)}],annots:r.annots})}}return r}function Eg(r,t){return r.args!==void 0&&r.args.length===1&&"string"in r.args[0]&&r.args[0].string in t?t[r.args[0].string]:r}class Zr extends Error{constructor(t,e){super(e),this.token=t,Object.setPrototypeOf(this,Zr.prototype)}}class be extends Error{constructor(t,e){super(e),this.node=t,Object.setPrototypeOf(this,be.prototype)}}const gs=new Zr(null,"Unexpected EOF");function sc(r){return r.t===qt.Ident&&(r.v[0]==="@"||r.v[0]==="%"||r.v[0]===":")}const vg=new RegExp("^-?[0-9]+$"),wg=new RegExp("^([0-9a-fA-F]{2})*$");class Lr{constructor(t){this.opt=t}expand(t){var e,n,i;if(((e=this.opt)===null||e===void 0?void 0:e.expandGlobalConstant)!==void 0&&t.prim==="constant"){const s=Eg(t,this.opt.expandGlobalConstant);return s!==t&&(s[zt]=Object.assign(Object.assign({},t[zt]||{first:0,last:0}),{globalConstant:t})),s}if(((n=this.opt)===null||n===void 0?void 0:n.expandMacros)===void 0||!((i=this.opt)===null||i===void 0)&&i.expandMacros){const s=bg(t,this.opt);return s!==t&&(s[zt]=Object.assign(Object.assign({},t[zt]||{first:0,last:0}),{macro:t})),s}else return t}parseListExpr(t,e){var n;const i={first:e.first,last:e.last},s=e.t==="(";let o;if(s){if(o=t.next(),o.done)throw gs;i.last=o.value.last}else o={value:e};if(o.value.t!==qt.Ident)throw new Zr(o.value,`not an identifier: ${o.value.v}`);const a={prim:o.value.v,[zt]:i};for(;;){const u=t.next();if(u.done){if(s)throw gs;break}else if(u.value.t===")"){if(!s)throw new Zr(u.value,"unexpected closing bracket");i.last=u.value.last;break}else if(sc(u.value))a.annots=a.annots||[],a.annots.push(u.value.v),i.last=u.value.last;else{a.args=a.args||[];const p=this.parseExpr(t,u.value);i.last=((n=p[zt])===null||n===void 0?void 0:n.last)||i.last,a.args.push(p)}}return this.expand(a)}parseArgs(t,e){var n;const i={first:e.first,last:e.last},s={prim:e.v,[zt]:i};for(;;){const o=t.next();if(o.done||o.value.t==="}"||o.value.t===";")return[s,o];if(sc(o.value))i.last=o.value.last,s.annots=s.annots||[],s.annots.push(o.value.v);else{const a=this.parseExpr(t,o.value);i.last=((n=a[zt])===null||n===void 0?void 0:n.last)||i.last,s.args=s.args||[],s.args.push(a)}}}parseSequenceExpr(t,e){var n,i;const s={first:e.first,last:e.last},o=[];o[zt]=s;const a=e.t==="{";let u=e.t==="{"?null:{value:e};for(;;){if(u===null&&(u=t.next(),u.done||(s.last=u.value.last)),u.done){if(a)throw gs;return o}if(u.value.t==="}"){if(a)return o;throw new Zr(u.value,"unexpected closing bracket")}else if(u.value.t===qt.Ident){const[p,f]=this.parseArgs(t,u.value);s.last=((n=p[zt])===null||n===void 0?void 0:n.last)||s.last,o.push(this.expand(p)),u=f}else{const p=this.parseExpr(t,u.value);s.last=((i=p[zt])===null||i===void 0?void 0:i.last)||s.last,o.push(p),u=null}u===null&&(u=t.next(),u.done||(s.last=u.value.last)),!u.done&&u.value.t===";"&&(u=null)}}parseExpr(t,e){switch(e.t){case qt.Ident:return this.expand({prim:e.v,[zt]:{first:e.first,last:e.last}});case qt.Number:return{int:e.v,[zt]:{first:e.first,last:e.last}};case qt.String:return{string:JSON.parse(e.v),[zt]:{first:e.first,last:e.last}};case qt.Bytes:return{bytes:e.v.slice(2),[zt]:{first:e.first,last:e.last}};case"{":return this.parseSequenceExpr(t,e);default:return this.parseListExpr(t,e)}}parseSequence(t){if(typeof t!="string")throw new TypeError(`string type was expected, got ${typeof t} instead`);const e=ps(t),n=e.next();return n.done?null:this.parseSequenceExpr(e,n.value)}parseList(t){if(typeof t!="string")throw new TypeError(`string type was expected, got ${typeof t} instead`);const e=ps(t),n=e.next();return n.done?null:this.parseListExpr(e,n.value)}parseMichelineExpression(t){if(typeof t!="string")throw new TypeError(`string type was expected, got ${typeof t} instead`);const e=ps(t),n=e.next();return n.done?null:this.parseExpr(e,n.value)}parseScript(t){return this.parseSequence(t)}parseData(t){return this.parseList(t)}parseJSON(t){if(typeof t!="object")throw new TypeError(`object type was expected, got ${typeof t} instead`);if(Array.isArray(t)){const e=[];for(const n of t){if(n===null||typeof n!="object")throw new be(n,`unexpected sequence element: ${n}`);e.push(this.parseJSON(n))}return e}else if("prim"in t){const e=t;if(typeof e.prim=="string"&&(e.annots===void 0||Array.isArray(e.annots))&&(e.args===void 0||Array.isArray(e.args))){const n={prim:e.prim};if(e.annots!==void 0){for(const i of e.annots)if(typeof i!="string")throw new be(i,`string expected: ${i}`);n.annots=e.annots}if(e.args!==void 0){n.args=[];for(const i of e.args){if(i===null||typeof i!="object")throw new be(i,`unexpected argument: ${i}`);n.args.push(this.parseJSON(i))}}return this.expand(n)}throw new be(t,`malformed prim expression: ${t}`)}else if("string"in t){if(typeof t.string=="string")return{string:t.string};throw new be(t,`malformed string literal: ${t}`)}else if("int"in t){if(typeof t.int=="string"&&vg.test(t.int))return{int:t.int};throw new be(t,`malformed int literal: ${t}`)}else if("bytes"in t){if(typeof t.bytes=="string"&&wg.test(t.bytes))return{bytes:t.bytes};throw new be(t,`malformed bytes literal: ${t}`)}else throw new be(t,`unexpected object: ${t}`)}}const _g=[1779033703,-1150833019,1013904242,-1521486534,1359893119,-1694144372,528734635,1541459225],Ag=[1116352408,1899447441,-1245643825,-373957723,961987163,1508970993,-1841331548,-1424204075,-670586216,310598401,607225278,1426881987,1925078388,-2132889090,-1680079193,-1046744716,-459576895,-272742522,264347078,604807628,770255983,1249150122,1555081692,1996064986,-1740746414,-1473132947,-1341970488,-1084653625,-958395405,-710438585,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,-2117940946,-1838011259,-1564481375,-1474664885,-1035236496,-949202525,-778901479,-694614492,-200395387,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,-2067236844,-1933114872,-1866530822,-1538233109,-1090935817,-965641998];class Ps extends Error{constructor(t){super(t),this.message=t,this.name="Base58DecodingError"}}function oc(r){const t=(r.length+9)%64,e=t===0?0:64-t;if(r.length>268435455)throw new Od("",`: Invalid length ${r.length} is too big -- SHA-256.`);const n=r.length<<3,i=[...r,128,...new Array(e).fill(0),0,0,0,0,n>>24&255,n>>16&255,n>>8&255,n&255];function s(f,m){return f>>>m|f<<32-m}const o=[..._g],a=new Array(64),u=new Array(8);for(let f=0;f<i.length;f+=64){let m=f,N=0;for(;N<16;)a[N]=i[m]<<24|i[m+1]<<16|i[m+2]<<8|i[m+3],m+=4,N++;for(;N<64;){const T=s(a[N-15],7)^s(a[N-15],18)^a[N-15]>>>3,x=s(a[N-2],17)^s(a[N-2],19)^a[N-2]>>>10;a[N]=(x|0)+a[N-7]+T+a[N-16]|0,N++}for(let T=0;T<8;T++)u[T]=o[T];for(let T=0;T<64;T++){const x=s(u[0],2)^s(u[0],13)^s(u[0],22),B=s(u[4],6)^s(u[4],11)^s(u[4],25),C=u[7]+B+(u[4]&u[5]^~u[4]&u[6])+Ag[T]+a[T]|0,L=x+(u[0]&u[1]^u[0]&u[2]^u[1]&u[2])|0;u[7]=u[6],u[6]=u[5],u[5]=u[4],u[4]=u[3]+C|0,u[3]=u[2],u[2]=u[1],u[1]=u[0],u[0]=C+L|0}for(let T=0;T<8;T++)o[T]=o[T]+u[T]|0}const p=[];for(const f of o)p.push(f>>24&255),p.push(f>>16&255),p.push(f>>8&255),p.push(f&255);return p}const ms=[0,1,2,3,4,5,6,7,8,-1,-1,-1,-1,-1,-1,-1,9,10,11,12,13,14,15,16,-1,17,18,19,20,21,-1,22,23,24,25,26,27,28,29,30,31,32,-1,-1,-1,-1,-1,-1,33,34,35,36,37,38,39,40,41,42,43,-1,44,45,46,47,48,49,50,51,52,53,54,55,56,57];function ac(r,t){const e=r.charCodeAt(t)-49;if(e>=ms.length||ms[e]===-1)throw new Ps(`Unexpected character at position ${t}: ${r[t]}`);return ms[e]}function Sg(r){const t=[];let e=0;for(;e<r.length&&ac(r,e)===0;)e++;let n=e;for(;e<r.length;){let i=ac(r,e++),s=0;for(;i!==0||s<t.length;){const o=(t[s]||0)*58+i;t[s++]=o%256,i=Math.floor(o/256)}}for(;n-- >0;)t.push(0);return t.reverse()}function xu(r){const t=Sg(r);if(t.length<4)throw new Ps(`Data is too short ${t.length}`);const e=t.slice(0,t.length-4),n=t.slice(t.length-4),i=oc(oc(e));if(n[0]!==i[0]||n[1]!==i[1]||n[2]!==i[2]||n[3]!==i[3])throw new Ps("Invalid checksum");return e}class Rg extends Error{constructor(t){super(t),this.message=t,this.name="InvalidContractError"}}class Og extends Error{constructor(t){super(t),this.message=t,this.name="InvalidTypeExpressionError"}}class Pg extends Error{constructor(t){super(t),this.message=t,this.name="InvalidDataExpressionError"}}class Tg extends Error{constructor(t){super(`Contract has no entrypoint named: '${t}'`),this.entrypoint=t,this.name="InvalidEntrypointError"}}class Ig extends Error{constructor(t){super(t),this.message=t,this.name="LongIntegerError"}}class Ng extends Error{constructor(t){super(`Unable to parse hex byte: ${t}`),this.hexByte=t,this.name="HexParseError"}}class se extends Error{constructor(t,e){super(e),this.val=t,Object.setPrototypeOf(this,se.prototype)}}class $ extends se{constructor(t,e,n){super(t,n),e!==void 0&&(this.data=e),Object.setPrototypeOf(this,$.prototype)}}class Lu{constructor(t){if(this.neg=!1,this.buf=[],t!==void 0)if(typeof t=="string")for(let e=0;e<t.length;e++){const n=t.charCodeAt(e);if(e===0&&n===45)this.neg=!0;else{if(n<48||n>57)throw new Ig(`unexpected character in integer constant: ${t[e]}`);this.append(n-48)}}else t<0?(this.neg=!0,this.append(-t)):this.append(t)}append(t){let e=0;for(;t!==0||e<this.buf.length;){const n=(this.buf[e]||0)*10+t;this.buf[e++]=n%256,t=Math.floor(n/256)}}cmp(t){if(this.neg!==t.neg)return(t.neg?1:0)-(this.neg?1:0);{let e=0;if(this.buf.length!==t.buf.length)e=this.buf.length<t.buf.length?-1:1;else if(this.buf.length!==0){let n=t.buf.length-1;for(;n>=0&&this.buf[n]===t.buf[n];)n--;e=n<0?0:this.buf[n]<t.buf[n]?-1:1}return this.neg?e===0?0:-e:e}}get sign(){return this.buf.length===0?0:this.neg?-1:1}}function Yr(r){const t=[];for(let e=0;e<r.length;e+=2){const n=parseInt(r.slice(e,e+2),16);if(Number.isNaN(n))return null;t.push(n)}return t}function Ts(r){try{return new Lu(r),!0}catch{return!1}}function Cu(r){try{return new Lu(r).sign>=0}catch{return!1}}const xg=/^(@%|@%%|%@|[@:%]([_0-9a-zA-Z][_0-9a-zA-Z.%@]*)?)$/;function tn(r,t){if(Array.isArray(r))return{};let e,n,i;if(r.annots!==void 0){for(const s of r.annots)if(s.length!==0){if(!xg.test(s)||!(t!=null&&t.specialVar)&&(s==="@%"||s==="@%%")||!(t!=null&&t.specialFields)&&s==="%@")throw new se(r,`${r.prim}: unexpected annotation: ${s}`);switch(s[0]){case"%":(t!=null&&t.emptyFields||s.length>1)&&(e=e||[],e.push(s));break;case":":s.length>1&&(n=n||[],n.push(s));break;case"@":(t!=null&&t.emptyVar||s.length>1)&&(i=i||[],i.push(s));break}}}return{f:e,t:n,v:i}}const Lg={BlockHash:[32,[1,52]],OperationHash:[32,[5,116]],OperationListHash:[32,[133,233]],OperationListListHash:[32,[29,159,109]],ProtocolHash:[32,[2,170]],ContextHash:[32,[79,199]],ED25519PublicKeyHash:[20,[6,161,159]],SECP256K1PublicKeyHash:[20,[6,161,161]],P256PublicKeyHash:[20,[6,161,164]],ContractHash:[20,[2,90,121]],CryptoboxPublicKeyHash:[16,[153,103]],ED25519Seed:[32,[13,15,58,7]],ED25519PublicKey:[32,[13,15,37,217]],SECP256K1SecretKey:[32,[17,162,224,201]],P256SecretKey:[32,[16,81,238,189]],ED25519EncryptedSeed:[56,[7,90,60,179,41]],SECP256K1EncryptedSecretKey:[56,[9,237,241,174,150]],P256EncryptedSecretKey:[56,[9,48,57,115,171]],SECP256K1PublicKey:[33,[3,254,226,86]],P256PublicKey:[33,[3,178,139,127]],SECP256K1Scalar:[33,[38,248,136]],SECP256K1Element:[33,[5,92,0]],ED25519SecretKey:[64,[43,246,78,7]],ED25519Signature:[64,[9,245,205,134,18]],SECP256K1Signature:[64,[13,115,101,19,63]],P256Signature:[64,[54,240,44,52]],GenericSignature:[64,[4,130,43]],ChainID:[4,[87,82,0]],RollupAddress:[20,[1,128,120,31]],TxRollupL2Address:[20,[6,161,166]]};function rr(r,...t){const e=xu(r);for(const n of t){const[i,s]=Lg[n];if(e.length===i+s.length){let o=0;for(;o<s.length&&e[o]===s[o];)o++;if(o===s.length)return[n,e.slice(s.length)]}}return null}function ee(r,t){const e=t,n=Array.isArray(e)?e:e.args;return n.length===2?r==="pair"?{prim:"pair",args:n}:{prim:"Pair",args:n}:Object.assign(Object.assign({},Array.isArray(e)?{prim:r}:e),{args:[n[0],{prim:r,args:n.slice(1)}]})}function nr(r){return Array.isArray(r)||r.prim==="pair"}function Du(r){return Array.isArray(r)||"prim"in r&&r.prim==="Pair"}const Cg=/^[0-9]{4}-(0[1-9]|1[0-2])-(0[1-9]|[12][0-9]|3[01])[T ]([01][0-9]|2[0-3]):([0-5][0-9]):([0-5][0-9]|60)(\.[0-9]+)?(Z|[+-]([01][0-9]|2[0-3]):([0-5][0-9]))$/;function Mu(r){if("string"in r){if(Cu(r.string))return new Date(parseInt(r.string,10));if(Cg.test(r.string)){const t=new Date(r.string);if(!Number.isNaN(t.valueOf))return t}}else if(Ts(r.int))return new Date(parseInt(r.int,10));return null}function Dg(r){const t=[];for(let e=0;e<r.length;e+=2){const n=r.slice(e,e+2),i=parseInt(n,16);if(Number.isNaN(i))throw new Ng(n);t.push(i)}return t}function Gr(r){return r.map(t=>(t>>4&15).toString(16)+(t&15).toString(16)).join("")}const Mg=31,ku={ABS:!0,ADD:!0,ADDRESS:!0,AMOUNT:!0,AND:!0,APPLY:!0,BALANCE:!0,BLAKE2B:!0,CAR:!0,CDR:!0,CHAIN_ID:!0,CHECK_SIGNATURE:!0,COMPARE:!0,CONCAT:!0,CONS:!0,EDIV:!0,EQ:!0,EXEC:!0,FAILWITH:!0,GE:!0,GET_AND_UPDATE:!0,GT:!0,HASH_KEY:!0,IMPLICIT_ACCOUNT:!0,INT:!0,ISNAT:!0,JOIN_TICKETS:!0,KECCAK:!0,LE:!0,LEVEL:!0,LSL:!0,LSR:!0,LT:!0,MEM:!0,MUL:!0,NEG:!0,NEQ:!0,NEVER:!0,NOT:!0,NOW:!0,OR:!0,PACK:!0,PAIRING_CHECK:!0,READ_TICKET:!0,SAPLING_VERIFY_UPDATE:!0,SELF:!0,SELF_ADDRESS:!0,SENDER:!0,SET_DELEGATE:!0,SHA256:!0,SHA3:!0,SHA512:!0,SIZE:!0,SLICE:!0,SOME:!0,SOURCE:!0,SPLIT_TICKET:!0,SUB:!0,SWAP:!0,TICKET:!0,TICKET_DEPRECATED:!0,TOTAL_VOTING_POWER:!0,TRANSFER_TOKENS:!0,UNIT:!0,VOTING_POWER:!0,XOR:!0,RENAME:!0,OPEN_CHEST:!0,SUB_MUTEZ:!0,MIN_BLOCK_TIME:!0,BYTES:!0,NAT:!0},Bu=Object.assign({},ku,{CONTRACT:!0,CREATE_CONTRACT:!0,DIG:!0,DIP:!0,DROP:!0,DUG:!0,DUP:!0,EMIT:!0,EMPTY_BIG_MAP:!0,EMPTY_MAP:!0,EMPTY_SET:!0,GET:!0,IF:!0,IF_CONS:!0,IF_LEFT:!0,IF_NONE:!0,ITER:!0,LAMBDA:!0,LAMBDA_REC:!0,LEFT:!0,LOOP:!0,LOOP_LEFT:!0,MAP:!0,NIL:!0,NONE:!0,PAIR:!0,PUSH:!0,RIGHT:!0,SAPLING_EMPTY_STATE:!0,UNPACK:!0,UNPAIR:!0,UPDATE:!0,CAST:!0,VIEW:!0}),Uu={unit:!0,never:!0,bool:!0,int:!0,nat:!0,string:!0,chain_id:!0,bytes:!0,mutez:!0,key_hash:!0,key:!0,signature:!0,timestamp:!0,address:!0,tx_rollup_l2_address:!0},cn=Object.assign({},Uu,{or:!0,pair:!0,set:!0,big_map:!0,contract:!0,lambda:!0,list:!0,map:!0,operation:!0,option:!0,bls12_381_g1:!0,bls12_381_g2:!0,bls12_381_fr:!0,sapling_transaction:!0,sapling_transaction_deprecated:!0,sapling_state:!0,ticket:!0,chest_key:!0,chest:!0});class it extends se{constructor(t,e){super(t,e),this.val=t,Object.setPrototypeOf(this,it.prototype)}}function He(r){return"prim"in r}function kg(r){return Array.isArray(r)||"prim"in r}function Hu(r){if(He(r))return!0;throw new it(r,"prim expression expected")}function br(r){if(Array.isArray(r))return!0;throw new it(r,"sequence expression expected")}function Ht(r){if(kg(r))return!0;throw new it(r,"prim or sequence expression expected")}function ys(r){if(r.int[0]==="-")throw new it(r,"natural number expected")}function ni(r){if("int"in r)return!0;throw new it(r,"int literal expected")}function $u(r){if("string"in r)return!0;throw new it(r,"string literal expected")}function tt(r,t){var e;if(t===0&&r.args===void 0||((e=r.args)===null||e===void 0?void 0:e.length)===t)return!0;throw new it(r,`${t} arguments expected`)}function he(r){var t,e;if(Array.isArray(r)){for(const n of r){if(!Array.isArray(n)&&!He(n))throw new it(r,"sequence or prim expected");he(n)}return!0}if(Hu(r)){if(Object.prototype.hasOwnProperty.call(ku,r.prim))return tt(r,0),!0;switch(r.prim){case"DROP":case"PAIR":case"UNPAIR":case"DUP":case"UPDATE":case"GET":r.args!==void 0&&tt(r,1)&&ni(r.args[0])&&ys(r.args[0]);break;case"DIG":case"DUG":case"SAPLING_EMPTY_STATE":tt(r,1)&&ni(r.args[0])&&ys(r.args[0]);break;case"NONE":case"LEFT":case"RIGHT":case"NIL":case"CAST":tt(r,1)&&ir(r.args[0]);break;case"UNPACK":tt(r,1)&&so(r.args[0]);break;case"CONTRACT":tt(r,1)&&Ii(r.args[0]);break;case"IF_NONE":case"IF_LEFT":case"IF_CONS":case"IF":tt(r,2)&&(br(r.args[0])&&he(r.args[0]),br(r.args[1])&&he(r.args[1]));break;case"MAP":case"ITER":case"LOOP":case"LOOP_LEFT":tt(r,1)&&he(r.args[0]);break;case"CREATE_CONTRACT":tt(r,1)&&Vu(r.args[0]);break;case"DIP":if(((t=r.args)===null||t===void 0?void 0:t.length)===2)ni(r.args[0])&&ys(r.args[0]),br(r.args[1])&&he(r.args[1]);else if(((e=r.args)===null||e===void 0?void 0:e.length)===1)br(r.args[0])&&he(r.args[0]);else throw new it(r,"1 or 2 arguments expected");break;case"PUSH":tt(r,2)&&(en(r.args[0]),Nr(r.args[1]));break;case"EMPTY_SET":tt(r,1)&&or(r.args[0]);break;case"EMPTY_MAP":tt(r,2)&&(or(r.args[0]),ir(r.args[1]));break;case"EMPTY_BIG_MAP":tt(r,2)&&(or(r.args[0]),Ni(r.args[1]));break;case"LAMBDA_REC":case"LAMBDA":tt(r,3)&&(ir(r.args[0]),ir(r.args[1]),br(r.args[2])&&he(r.args[2]));break;case"VIEW":tt(r,2)&&($u(r.args[0])&&ju(r.args[0]),ir(r.args[1])&&en(r.args[1]));break;case"EMIT":r.args&&r.args.length>0?tt(r,1):tt(r,0);break;default:throw new it(r,"instruction expected")}}return!0}function or(r){if(Ht(r)){if(Array.isArray(r)||r.prim==="pair"||r.prim==="or"||r.prim==="option")Ur(r,t=>or(t));else if(!Object.prototype.hasOwnProperty.call(Uu,r.prim))throw new it(r,`${r.prim}: type is not comparable`)}return!0}function so(r){if(Ht(r)&&He(r)){if(!Object.prototype.hasOwnProperty.call(cn,r.prim)||r.prim==="big_map"||r.prim==="operation"||r.prim==="sapling_state"||r.prim==="ticket")throw new it(r,`${r.prim}: type can't be used inside PACK/UNPACK instructions`);Ur(r,t=>so(t))}return!0}function en(r){if(Ht(r)&&He(r)){if(!Object.prototype.hasOwnProperty.call(cn,r.prim)||r.prim==="big_map"||r.prim==="operation"||r.prim==="sapling_state"||r.prim==="ticket"||r.prim==="contract")throw new it(r,`${r.prim}: type can't be pushed`);Ur(r,t=>en(t))}return!0}function oo(r){if(Ht(r)&&He(r)){if(!Object.prototype.hasOwnProperty.call(cn,r.prim)||r.prim==="operation"||r.prim==="contract")throw new it(r,`${r.prim}: type can't be used as part of a storage`);Ur(r,t=>oo(t))}return!0}function Ii(r){if(Ht(r)&&He(r)){if(!Object.prototype.hasOwnProperty.call(cn,r.prim)||r.prim==="operation")throw new it(r,`${r.prim}: type can't be used as part of a parameter`);Ur(r,t=>Ii(t))}return!0}function Ni(r){if(Ht(r)&&He(r)){if(!Object.prototype.hasOwnProperty.call(cn,r.prim)||r.prim==="big_map"||r.prim==="operation"||r.prim==="sapling_state")throw new it(r,`${r.prim}: type can't be used inside a big_map`);Ur(r,t=>Ni(t))}return!0}const Bg=new RegExp("^[a-zA-Z0-9_.%@]*$");function ju(r){if(r.string.length>Mg)throw new it(r,`view name too long: ${r.string}`);if(!Bg.test(r.string))throw new it(r,`invalid character(s) in view name: ${r.string}`)}function ir(r){if(Ht(r)&&He(r)){if(!Object.prototype.hasOwnProperty.call(cn,r.prim))throw new it(r,"type expected");Ur(r,t=>ir(t))}return!0}function Ur(r,t){if(Array.isArray(r)||r.prim==="pair"){const e=Array.isArray(r)?r:r.args;if(e===void 0||e.length<2)throw new it(r,"at least 2 arguments expected");return e.forEach(n=>{Ht(n)&&t(n)}),!0}switch(r.prim){case"option":case"list":tt(r,1)&&Ht(r.args[0])&&t(r.args[0]);break;case"contract":tt(r,1)&&Ii(r.args[0]);break;case"or":tt(r,2)&&Ht(r.args[0])&&Ht(r.args[1])&&(t(r.args[0]),t(r.args[1]));break;case"lambda":tt(r,2)&&(ir(r.args[0]),ir(r.args[1]));break;case"set":tt(r,1)&&or(r.args[0]);break;case"map":tt(r,2)&&Ht(r.args[0])&&Ht(r.args[1])&&(or(r.args[0]),t(r.args[1]));break;case"big_map":tt(r,2)&&Ht(r.args[0])&&Ht(r.args[1])&&(or(r.args[0]),Ni(r.args[1]),t(r.args[1]));break;case"ticket":tt(r,1)&&Ht(r.args[0])&&or(r.args[0]);break;case"sapling_state":case"sapling_transaction":tt(r,1)&&ni(r.args[0]);break;default:tt(r,0)}return!0}function Nr(r){if("int"in r||"string"in r||"bytes"in r)return!0;if(Array.isArray(r)){let t=0;for(const e of r)He(e)&&e.prim==="Elt"?(tt(e,2)&&(Nr(e.args[0]),Nr(e.args[1])),t++):Nr(e);if(t!==0&&t!==r.length)throw new it(r,"data entries and map elements can't be intermixed");return!0}if(He(r))switch(r.prim){case"Unit":case"True":case"False":case"None":tt(r,0);break;case"Pair":if(r.args===void 0||r.args.length<2)throw new it(r,"at least 2 arguments expected");for(const t of r.args)Nr(t);break;case"Left":case"Right":case"Some":tt(r,1)&&Nr(r.args[0]);break;case"Lambda_rec":r.args&&he(r.args);break;default:if(Object.prototype.hasOwnProperty.call(Bu,r.prim))he(r);else throw new it(r,"data entry or instruction expected")}else throw new it(r,"data entry expected");return!0}function Vu(r){if(br(r)){const t={},e={};for(const n of r)if(Hu(n)){if(n.prim!=="view"){if(n.prim in t)throw new it(r,`duplicate contract section: ${n.prim}`);t[n.prim]=!0}switch(n.prim){case"code":tt(n,1)&&br(n.args[0])&&he(n.args[0]);break;case"parameter":if(tt(n,1)&&Ii(n.args[0]),n.annots)throw new it(n,"Annotation must be part of the parameter type");break;case"storage":tt(n,1)&&oo(n.args[0]);break;case"view":if(tt(n,4)){if($u(n.args[0])){const i=n.args[0];if(i.string in e)throw new it(r,`duplicate view name: ${i.string}`);e[i.string]=!0,ju(i)}en(n.args[1]),en(n.args[2]),br(n.args[3])&&he(n.args[3])}break;default:throw new it(r,`unexpected contract section: ${n.prim}`)}}}return!0}function Gu(r){return Object.prototype.hasOwnProperty.call(Bu,r.prim)}function Is(r){if(!Array.isArray(r))return!1;for(const t of r)if("prim"in t){if(Gu(t))throw new se(r,`Instruction outside of a lambda: ${JSON.stringify(r)}`);if(t.prim==="Elt")throw new se(r,`Elt item outside of a map literal: ${JSON.stringify(r)}`)}return!0}function Ug(r,t){var e={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&t.indexOf(n)<0&&(e[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,n=Object.getOwnPropertySymbols(r);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(r,n[i])&&(e[n[i]]=r[n[i]]);return e}const Hg=["parameter","storage","code","False","Elt","Left","None","Pair","Right","Some","True","Unit","PACK","UNPACK","BLAKE2B","SHA256","SHA512","ABS","ADD","AMOUNT","AND","BALANCE","CAR","CDR","CHECK_SIGNATURE","COMPARE","CONCAT","CONS","CREATE_ACCOUNT","CREATE_CONTRACT","IMPLICIT_ACCOUNT","DIP","DROP","DUP","EDIV","EMPTY_MAP","EMPTY_SET","EQ","EXEC","FAILWITH","GE","GET","GT","HASH_KEY","IF","IF_CONS","IF_LEFT","IF_NONE","INT","LAMBDA","LE","LEFT","LOOP","LSL","LSR","LT","MAP","MEM","MUL","NEG","NEQ","NIL","NONE","NOT","NOW","OR","PAIR","PUSH","RIGHT","SIZE","SOME","SOURCE","SENDER","SELF","STEPS_TO_QUOTA","SUB","SWAP","TRANSFER_TOKENS","SET_DELEGATE","UNIT","UPDATE","XOR","ITER","LOOP_LEFT","ADDRESS","CONTRACT","ISNAT","CAST","RENAME","bool","contract","int","key","key_hash","lambda","list","map","big_map","nat","option","or","pair","set","signature","string","bytes","mutez","timestamp","unit","operation","address","SLICE","DIG","DUG","EMPTY_BIG_MAP","APPLY","chain_id","CHAIN_ID","LEVEL","SELF_ADDRESS","never","NEVER","UNPAIR","VOTING_POWER","TOTAL_VOTING_POWER","KECCAK","SHA3","PAIRING_CHECK","bls12_381_g1","bls12_381_g2","bls12_381_fr","sapling_state","sapling_transaction_deprecated","SAPLING_EMPTY_STATE","SAPLING_VERIFY_UPDATE","ticket","TICKET_DEPRECATED","READ_TICKET","SPLIT_TICKET","JOIN_TICKETS","GET_AND_UPDATE","chest","chest_key","OPEN_CHEST","VIEW","view","constant","SUB_MUTEZ","tx_rollup_l2_address","MIN_BLOCK_TIME","sapling_transaction","EMIT","Lambda_rec","LAMBDA_REC","TICKET","BYTES","NAT"],$g=Object.assign({},...Hg.map((r,t)=>({[r]:t})));var dr;(function(r){r[r.Int=0]="Int",r[r.String=1]="String",r[r.Sequence=2]="Sequence",r[r.Prim0=3]="Prim0",r[r.Prim0Annot=4]="Prim0Annot",r[r.Prim1=5]="Prim1",r[r.Prim1Annot=6]="Prim1Annot",r[r.Prim2=7]="Prim2",r[r.Prim2Annot=8]="Prim2Annot",r[r.Prim=9]="Prim",r[r.Bytes=10]="Bytes"})(dr||(dr={}));class Xr{constructor(){this.buffer=[]}get length(){return this.buffer.length}writeBytes(t){this.buffer.push(...t.map(e=>e&255))}writeUint8(t){const e=t|0;this.buffer.push(e&255)}writeUint16(t){const e=t|0;this.buffer.push(e>>8&255),this.buffer.push(e&255)}writeUint32(t){const e=t|0;this.buffer.push(e>>24&255),this.buffer.push(e>>16&255),this.buffer.push(e>>8&255),this.buffer.push(e&255)}writeInt8(t){this.writeUint8(t)}writeInt16(t){this.writeUint16(t)}writeInt32(t){this.writeUint32(t)}}const hr=new Error("bounds out of range");class rn{constructor(t,e=0,n=t.length){this.buffer=t,this.idx=e,this.cap=n}get length(){return this.cap-this.idx}readBytes(t){if(this.cap-this.idx<t)throw hr;const e=this.buffer.slice(this.idx,this.idx+t);return this.idx+=t,e}reader(t){if(this.cap-this.idx<t)throw hr;const e=new rn(this.buffer,this.idx,this.idx+t);return this.idx+=t,e}copy(){return new rn(this.buffer,this.idx,this.cap)}readUint8(){if(this.cap-this.idx<1)throw hr;return this.buffer[this.idx++]>>>0}readUint16(){if(this.cap-this.idx<2)throw hr;const t=this.buffer[this.idx++],e=this.buffer[this.idx++];return(t<<8|e)>>>0}readUint32(){if(this.cap-this.idx<4)throw hr;const t=this.buffer[this.idx++],e=this.buffer[this.idx++],n=this.buffer[this.idx++],i=this.buffer[this.idx++];return(t<<24|e<<16|n<<8|i)>>>0}readInt8(){if(this.cap-this.idx<1)throw hr;return this.buffer[this.idx++]<<24>>24}readInt16(){if(this.cap-this.idx<2)throw hr;const t=this.buffer[this.idx++],e=this.buffer[this.idx++];return(t<<8|e)<<16>>16}readInt32(){if(this.cap-this.idx<4)throw hr;const t=this.buffer[this.idx++],e=this.buffer[this.idx++],n=this.buffer[this.idx++],i=this.buffer[this.idx++];return t<<24|e<<16|n<<8|i}}var nn;(function(r){r[r.Implicit=0]="Implicit",r[r.Originated=1]="Originated"})(nn||(nn={}));var wr;(function(r){r[r.ED25519=0]="ED25519",r[r.SECP256K1=1]="SECP256K1",r[r.P256=2]="P256"})(wr||(wr={}));function Ku(r){let t;const e=r.readUint8();switch(e){case wr.ED25519:t="ED25519PublicKeyHash";break;case wr.SECP256K1:t="SECP256K1PublicKeyHash";break;case wr.P256:t="P256PublicKeyHash";break;default:throw new Error(`unknown public key hash tag: ${e}`)}return{type:t,hash:r.readBytes(20)}}function jg(r){let t;const e=r.readUint8();switch(e){case nn.Implicit:t=Ku(r);break;case nn.Originated:t={type:"ContractHash",hash:r.readBytes(20)},r.readBytes(1);break;default:throw new Error(`unknown address tag: ${e}`)}if(r.length!==0){const n=new TextDecoder;t.entryPoint=n.decode(new Uint8Array(r.readBytes(r.length)))}return t}function Fu(r,t){let e;switch(r.type){case"ED25519PublicKeyHash":e=wr.ED25519;break;case"SECP256K1PublicKeyHash":e=wr.SECP256K1;break;case"P256PublicKeyHash":e=wr.P256;break;default:throw new Error(`unexpected address type: ${r.type}`)}t.writeUint8(e),t.writeBytes(Array.from(r.hash))}function Vg(r,t){if(r.type==="ContractHash"?(t.writeUint8(nn.Originated),t.writeBytes(Array.from(r.hash)),t.writeUint8(0)):(t.writeUint8(nn.Implicit),Fu(r,t)),r.entryPoint!==void 0&&r.entryPoint!==""&&r.entryPoint!=="default"){const n=new TextEncoder().encode(r.entryPoint);t.writeBytes(Array.from(n))}}var _r;(function(r){r[r.ED25519=0]="ED25519",r[r.SECP256K1=1]="SECP256K1",r[r.P256=2]="P256"})(_r||(_r={}));function Gg(r){let t,e;const n=r.readUint8();switch(n){case _r.ED25519:e="ED25519PublicKey",t=32;break;case _r.SECP256K1:e="SECP256K1PublicKey",t=33;break;case _r.P256:e="P256PublicKey",t=33;break;default:throw new Error(`unknown public key tag: ${n}`)}return{type:e,publicKey:r.readBytes(t)}}function Kg(r,t){let e;switch(r.type){case"ED25519PublicKey":e=_r.ED25519;break;case"SECP256K1PublicKey":e=_r.SECP256K1;break;case"P256PublicKey":e=_r.P256;break;default:throw new Error(`unexpected public key type: ${r.type}`)}t.writeUint8(e),t.writeBytes(Array.from(r.publicKey))}function ii(r,t,e){var n,i;const[s,o]=e(r);if(Array.isArray(s)){const p=new Xr;for(const f of s){const m=o.next();if(m.done)throw new Error("REPORT ME: iterator is done");ii(f,p,m.value)}t.writeUint8(dr.Sequence),t.writeUint32(p.length),t.writeBytes(p.buffer);return}if("string"in s){const f=new TextEncoder().encode(s.string);t.writeUint8(dr.String),t.writeUint32(f.length),t.writeBytes(Array.from(f));return}if("int"in s){t.writeUint8(dr.Int);let p=BigInt(s.int);const f=p<0;f&&(p=-p);let m=0;do{const N=BigInt(m===0?6:7);let T=p&(BigInt(1)<<N)-BigInt(1);p>>=N,p&&(T|=BigInt(128)),m===0&&f&&(T|=BigInt(64)),t.writeUint8(Number(T)),m++}while(p);return}if("bytes"in s){const p=Dg(s.bytes);t.writeUint8(dr.Bytes),t.writeUint32(p.length),t.writeBytes(p);return}const a=$g[s.prim];if(a===void 0)throw new TypeError(`Can't encode primary: ${s.prim}`);const u=(((n=s.args)===null||n===void 0?void 0:n.length)||0)<3?dr.Prim0+(((i=s.args)===null||i===void 0?void 0:i.length)||0)*2+(s.annots===void 0||s.annots.length===0?0:1):dr.Prim;if(t.writeUint8(u),t.writeUint8(a),s.args!==void 0)if(s.args.length<3)for(const p of s.args){const f=o.next();if(f.done)throw new Error("REPORT ME: iterator is done");ii(p,t,f.value)}else{const p=new Xr;for(const f of s.args){const m=o.next();if(m.done)throw new Error("REPORT ME: iterator is done");ii(f,p,m.value)}t.writeUint32(p.length),t.writeBytes(p.buffer)}if(s.annots!==void 0&&s.annots.length!==0){const f=new TextEncoder().encode(s.annots.join(" "));t.writeUint32(f.length),t.writeBytes(Array.from(f))}else s.args!==void 0&&s.args.length>=3&&t.writeUint32(0)}const Fg=r=>"prim"in r&&(r.prim==="Left"||r.prim==="Right"),zg=r=>"prim"in r&&(r.prim==="Some"||r.prim==="None"),xr=r=>{if(nr(r))return t=>{if(!Du(t))throw new $(r,t,`pair expected: ${JSON.stringify(t)}`);Is(t);const e=ee("pair",r);return[ee("Pair",t),function*(){for(const i of e.args)yield xr(i)}()]};switch(r.prim){case"or":return t=>{if(!Fg(t))throw new $(r,t,`or expected: ${JSON.stringify(t)}`);return[t,function*(){yield xr(r.args[t.prim==="Left"?0:1])}()]};case"option":return t=>{if(!zg(t))throw new $(r,t,`option expected: ${JSON.stringify(t)}`);return[t,function*(){t.prim==="Some"&&(yield xr(r.args[0]))}()]};case"list":case"set":return t=>{if(!Array.isArray(t))throw new $(r,t,`${r.prim} expected: ${JSON.stringify(t)}`);return[t,function*(){for(const e of t)yield xr(r.args[0])}()]};case"map":return t=>{if(!Array.isArray(t))throw new $(r,t,`map expected: ${JSON.stringify(t)}`);return[t,function*(){for(const e of t)yield n=>{if(!("prim"in n)||n.prim!=="Elt")throw new $(r,n,`map element expected: ${JSON.stringify(n)}`);return[n,function*(){for(const i of r.args)yield xr(i)}()]}}()]};case"chain_id":return t=>{if(!("bytes"in t)&&!("string"in t))throw new $(r,t,`chain id expected: ${JSON.stringify(t)}`);let e;if("string"in t){const n=rr(t.string,"ChainID");if(n===null)throw new $(r,t,`chain id base58 expected: ${t.string}`);e={bytes:Gr(n[1])}}else e=t;return[e,[][Symbol.iterator]()]};case"signature":return t=>{if(!("bytes"in t)&&!("string"in t))throw new $(r,t,`signature expected: ${JSON.stringify(t)}`);let e;if("string"in t){const n=rr(t.string,"ED25519Signature","SECP256K1Signature","P256Signature","GenericSignature");if(n===null)throw new $(r,t,`signature base58 expected: ${t.string}`);e={bytes:Gr(n[1])}}else e=t;return[e,[][Symbol.iterator]()]};case"key_hash":return t=>{if(!("bytes"in t)&&!("string"in t))throw new $(r,t,`key hash expected: ${JSON.stringify(t)}`);let e;if("string"in t){const n=rr(t.string,"ED25519PublicKeyHash","SECP256K1PublicKeyHash","P256PublicKeyHash");if(n===null)throw new $(r,t,`key hash base58 expected: ${t.string}`);const i=new Xr;Fu({type:n[0],hash:n[1]},i),e={bytes:Gr(i.buffer)}}else e=t;return[e,[][Symbol.iterator]()]};case"key":return t=>{if(!("bytes"in t)&&!("string"in t))throw new $(r,t,`public key expected: ${JSON.stringify(t)}`);let e;if("string"in t){const n=rr(t.string,"ED25519PublicKey","SECP256K1PublicKey","P256PublicKey");if(n===null)throw new $(r,t,`public key base58 expected: ${t.string}`);const i=new Xr;Kg({type:n[0],publicKey:n[1]},i),e={bytes:Gr(i.buffer)}}else e=t;return[e,[][Symbol.iterator]()]};case"address":return t=>{if(!("bytes"in t)&&!("string"in t))throw new $(r,t,`address expected: ${JSON.stringify(t)}`);let e;if("string"in t){const n=t.string.split("%"),i=rr(n[0],"ED25519PublicKeyHash","SECP256K1PublicKeyHash","P256PublicKeyHash","ContractHash");if(i===null)throw new $(r,t,`address base58 expected: ${t.string}`);const s=new Xr;Vg({type:i[0],hash:i[1],entryPoint:n.length>1?n[1]:void 0},s),e={bytes:Gr(s.buffer)}}else e=t;return[e,[][Symbol.iterator]()]};case"timestamp":return t=>{if(!("string"in t)&&!("int"in t))throw new $(r,t,`timestamp expected: ${JSON.stringify(t)}`);let e;if("string"in t){const n=Mu(t);if(n===null)throw new $(r,t,`can't parse date: ${t.string}`);e={int:String(Math.floor(n.getTime()/1e3))}}else e=t;return[e,[][Symbol.iterator]()]};default:return gi}},qg=r=>"prim"in r&&r.prim==="PUSH",gi=r=>qg(r)?(he(r),[r,function*(){yield gi,yield xr(r.args[0])}()]):[r,function*(){for(;;)yield gi}()];function Wg(r,t){const e=new Xr;return e.writeUint8(5),ii(r,e,t!==void 0?xr(t):gi),e.buffer}function Zg(r,t){return{bytes:Gr(Wg(r,t))}}function Yg(r){const t=Yr(r.bytes);if(t===null)throw new Error(`can't parse bytes: "${r.bytes}"`);const e=new rn(new Uint8Array(t));return jg(e)}function Xg(r){const t=Yr(r.bytes);if(t===null)throw new Error(`can't parse bytes: "${r.bytes}"`);const e=new rn(new Uint8Array(t));return Ku(e)}function Jg(r){const t=Yr(r.bytes);if(t===null)throw new Error(`can't parse bytes: "${r.bytes}"`);const e=new rn(new Uint8Array(t));return Gg(e)}class Z extends se{constructor(t,e,n){super(t,n),this.stackState=e,Object.setPrototypeOf(this,Z.prototype)}}function ot(r){return Array.isArray(r)?"pair":r.prim}function mi(r){return"prim"in r?r.args:r}function fe(r,t,e=!1){if(ot(r)!==ot(t))throw new $(r,void 0,`types mismatch: ${ot(r)} != ${ot(t)}`);const n=[tn(r),tn(t)];if(n[0].t&&n[1].t&&n[0].t[0]!==n[1].t[0])throw new $(r,void 0,`${ot(r)}: type names mismatch: ${n[0].t[0]} != ${n[1].t[0]}`);if(e&&n[0].f&&n[1].f&&n[0].f[0]!==n[1].f[0])throw new $(r,void 0,`${ot(r)}: field names mismatch: ${n[0].f[0]} != ${n[1].f}`);if(nr(r)){const i=ee("pair",r),s=ee("pair",t);fe(i.args[0],s.args[0],!0),fe(i.args[1],s.args[1],!0);return}switch(r.prim){case"option":case"list":case"contract":case"set":case"ticket":fe(r.args[0],t.args[0]);break;case"or":fe(r.args[0],t.args[0],!0),fe(r.args[1],t.args[1],!0);break;case"lambda":case"map":case"big_map":fe(r.args[0],t.args[0]),fe(r.args[1],t.args[1]);break;case"sapling_state":case"sapling_transaction":if(parseInt(r.args[0].int,10)!==parseInt(t.args[0].int,10))throw new $(r,void 0,`${ot(r)}: type argument mismatch: ${r.args[0].int} != ${t.args[0].int}`)}}function zu(r,t){if(r.length!==t.length)throw new $(r,void 0,`stack length mismatch: ${r.length} != ${t.length}`);for(let e=0;e<r.length;e++)fe(r[e],t[e])}function pt(r,t=!1){var e,n,i;if(!Array.isArray(r)){const s=tn(r);if((((e=s.t)===null||e===void 0?void 0:e.length)||0)>1)throw new $(r,void 0,`${r.prim}: at most one type annotation allowed: ${r.annots}`);if(t){if((((n=s.f)===null||n===void 0?void 0:n.length)||0)>1)throw new $(r,void 0,`${r.prim}: at most one field annotation allowed: ${r.annots}`)}else if((((i=s.f)===null||i===void 0?void 0:i.length)||0)>0)throw new $(r,void 0,`${r.prim}: field annotations aren't allowed: ${r.annots}`)}if(nr(r)){const s=mi(r);for(const o of s)pt(o,!0);return}switch(r.prim){case"option":case"list":case"contract":case"set":pt(r.args[0]);break;case"or":for(const s of r.args)pt(s,!0);break;case"lambda":case"map":case"big_map":pt(r.args[0]),pt(r.args[1])}}function qu(r){if(!Array.isArray(r))return!1;for(const t of r)if(!(Array.isArray(t)&&qu(t)||"prim"in t&&Gu(t)))return!1;return!0}function pe(r,t,e){if(nr(t)){if(Du(r)){Is(r);const n=ee("Pair",r),i=ee("pair",t);pe(n.args[0],i.args[0],e),pe(n.args[1],i.args[1],e);return}throw new $(t,r,`pair expected: ${JSON.stringify(r)}`)}switch(t.prim){case"int":if("int"in r&&Ts(r.int))return;throw new $(t,r,`integer value expected: ${JSON.stringify(r)}`);case"nat":case"mutez":if("int"in r&&Cu(r.int))return;throw new $(t,r,`natural value expected: ${JSON.stringify(r)}`);case"string":if("string"in r)return;throw new $(t,r,`string value expected: ${JSON.stringify(r)}`);case"bytes":case"bls12_381_g1":case"bls12_381_g2":if("bytes"in r&&Yr(r.bytes)!==null)return;throw new $(t,r,`bytes value expected: ${JSON.stringify(r)}`);case"bool":if("prim"in r&&(r.prim==="True"||r.prim==="False"))return;throw new $(t,r,`boolean value expected: ${JSON.stringify(r)}`);case"key_hash":if("string"in r&&rr(r.string,"ED25519PublicKeyHash","SECP256K1PublicKeyHash","P256PublicKeyHash")!==null)return;if("bytes"in r)try{Xg(r);return}catch{}throw new $(t,r,`key hash expected: ${JSON.stringify(r)}`);case"timestamp":if(("string"in r||"int"in r)&&Mu(r)!==null)return;throw new $(t,r,`timestamp expected: ${JSON.stringify(r)}`);case"address":if("string"in r){let n=r.string;const i=r.string.indexOf("%");if(i>=0&&(n=r.string.slice(0,i)),rr(n,"ED25519PublicKeyHash","SECP256K1PublicKeyHash","P256PublicKeyHash","ContractHash","TxRollupL2Address","RollupAddress")!==null)return}else if("bytes"in r)try{Yg(r);return}catch{}throw new $(t,r,`address expected: ${JSON.stringify(r)}`);case"key":if("string"in r&&rr(r.string,"ED25519PublicKey","SECP256K1PublicKey","P256PublicKey")!==null)return;if("bytes"in r)try{Jg(r);return}catch{}throw new $(t,r,`public key expected: ${JSON.stringify(r)}`);case"unit":if("prim"in r&&r.prim==="Unit")return;throw new $(t,r,`unit value expected: ${JSON.stringify(r)}`);case"signature":if("bytes"in r||"string"in r&&rr(r.string,"ED25519Signature","SECP256K1Signature","P256Signature","GenericSignature")!==null)return;throw new $(t,r,`signature expected: ${JSON.stringify(r)}`);case"chain_id":if(("bytes"in r||"string"in r)&&("string"in r?xu(r.string):Yr(r.bytes))!==null)return;throw new $(t,r,`chain id expected: ${JSON.stringify(r)}`);case"option":if("prim"in r){if(r.prim==="None")return;if(r.prim==="Some"){pe(r.args[0],t.args[0],e);return}}throw new $(t,r,`option expected: ${JSON.stringify(r)}`);case"list":case"set":if(Is(r)){for(const n of r)pe(n,t.args[0],e);return}throw new $(t,r,`${t.prim} expected: ${JSON.stringify(r)}`);case"or":if("prim"in r){if(r.prim==="Left"){pe(r.args[0],t.args[0],e);return}else if(r.prim==="Right"){pe(r.args[0],t.args[1],e);return}}throw new $(t,r,`union (or) expected: ${JSON.stringify(r)}`);case"lambda":if(qu(r)){const n=It(r,[t.args[0]],e);if("failed"in n)throw new $(t,r,`function is failed with error type: ${n.failed}`);if(n.length!==1)throw new $(t,r,"function must return a value");fe(t.args[1],n[0]);return}throw new $(t,r,`function expected: ${JSON.stringify(r)}`);case"map":case"big_map":if(Array.isArray(r)){for(const n of r){if(!("prim"in n)||n.prim!=="Elt")throw new $(t,r,`map elements expected: ${JSON.stringify(r)}`);pe(n.args[0],t.args[0],e),pe(n.args[1],t.args[1],e)}return}throw new $(t,r,`${t.prim} expected: ${JSON.stringify(r)}`);case"bls12_381_fr":if("int"in r&&Ts(r.int)||"bytes"in r&&Yr(r.bytes)!==null)return;throw new $(t,r,`BLS12-381 element expected: ${JSON.stringify(r)}`);case"sapling_state":if(Array.isArray(r))return;throw new $(t,r,`sapling state expected: ${JSON.stringify(r)}`);case"ticket":pe(r,{prim:"pair",args:[{prim:"address"},t.args[0],{prim:"nat"}]},e);return;default:throw new $(t,r,`type ${ot(t)} don't have Michelson literal representation`)}}function Qg(r,t,e){let n=t,i=t,s=0;for(const o of r){const a=It(o,i,e);if(n=a,"failed"in a)break;i=a,s++}if("failed"in n&&n.level==0&&(!("prim"in n.failed)||n.failed.prim!=="never")&&s!==r.length-1)throw new Z(r,n,"FAIL must appear in a tail position");if((e==null?void 0:e.traceCallback)!==void 0){const o={op:r,in:t,out:n};e.traceCallback(o)}return"failed"in n?{failed:n.failed,level:n.level+1}:n}function It(r,t,e){const n=(e==null?void 0:e.protocol)||Nu;if(Array.isArray(r))return Qg(r,t,e);const i=r;function s(l,...v){if(t.length<v.length+l)throw new Z(i,t,`${i.prim}: stack must have at least ${v.length} element(s)`);let b=l;for(const _ of v){if(_!==null&&_.length!==0){let R=0;for(;R<_.length&&_[R]!==ot(t[b]);)R++;if(R===_.length)throw new Z(i,t,`${i.prim}: stack type mismatch: [${b}] expected to be ${_}, got ${ot(t[b])} instead`)}b++}return t.slice(l,v.length+l)}function o(l){return(...v)=>{try{return l(...v)}catch(b){throw b instanceof se?new Z(i,t,b.message):b}}}function a(l){return v=>{try{return l(v)}catch(b){throw b instanceof se?new Z(i,t,b.message):b}}}const u=o(tn),p=o(zu),f=o(fe),m=a(or),N=a(so),T=a(oo),x=a(en),B=a(Ni);function C(l,v){const b=u(i,Object.assign(Object.assign({},v),{emptyFields:l.f!==void 0&&l.f>1,emptyVar:l.v!==void 0&&l.v>1})),_=(R,w,c)=>{if(R&&R.length>(w||0))throw new Z(i,t,`${i.prim}: at most ${w||0} ${c} annotations allowed`)};return _(b.f,l.f,"field"),_(b.t,l.t,"type"),_(b.v,l.v,"variable"),b}function L(l,v){const b=l,_=Array.isArray(b)?{prim:"pair",args:b}:b,R=u(_),w=v.v!==void 0||v.t!==void 0||v.f!==void 0?[...(v.v===null?R.v:v.v)||[],...(v.t===null?R.t:v.t)||[],...(v.f===null?R.f:v.f)||[]]:void 0,c=Ug(_,["annots"]);return Object.assign(Object.assign({},c),w&&w.length!==0&&{annots:w})}function S(l,v){const b=C({v:1});return L(l,{v:b.v!==void 0?b.v:v!==void 0?[v]:null,t:null})}function yt(l,v,b,_,R){var w,c,d,E;const P=(w=u(v).f)===null||w===void 0?void 0:w[0],D=(c=b.f)===null||c===void 0?void 0:c[_];if(D!==void 0&&D!=="%"&&P!==void 0&&D!==P)throw new Z(i,t,`${i.prim}: field names doesn't match: ${D} !== ${P}`);const M=(d=b.v)===null||d===void 0?void 0:d[_],G=(E=u(l).v)===null||E===void 0?void 0:E[0];return L(v,{t:null,v:M?M==="@%"?P?["@"+P.slice(1)]:void 0:M==="@%%"?G?["@"+G.slice(1)+"."+(P?P.slice(1):R)]:P?["@"+P.slice(1)]:void 0:[M]:null})}function H(l,v,b=v){const _=ee("pair",l);if(b===1)return[_.args[0]];if(b===2)return _.args;const R=_.args[1];if(nr(R))return[_.args[0],...H(R,v,b-1)];throw new Z(i,t,`${i.prim}: at least ${v} fields are expected`)}function Lt(l,v,b=v){if(b===0)return l;const _=ee("pair",l);if(b===1)return _.args[0];const R=_.args[1];if(nr(R))return Lt(R,v,b-2);if(b===2)return R;throw new Z(i,t,`${i.prim}: at least ${v+1} fields are expected`)}function st(l,v,b,_=b){if(_===0)return v;const R=ee("pair",l);if(_===1)return Object.assign(Object.assign({},R),{args:[v,R.args[1]]});const w=R.args[1];if(nr(w))return Object.assign(Object.assign({},R),{args:[R.args[0],st(w,v,b,_-2)]});if(_===2)return Object.assign(Object.assign({},R),{args:[R.args[0],v]});throw new Z(i,t,`${i.prim}: at least ${b+1} fields are expected`)}const J=(l,v)=>["@"+(l.v?l.v[0].slice(1)+".":"")+v];function h(l,v){return"failed"in l||"failed"in v?"failed"in l?v:l:(p(l,v),l)}const g=(l=>{var v,b,_,R,w;switch(l.prim){case"DUP":{const c=l.args?parseInt(l.args[0].int,10):1;if(c===0)throw new Z(l,t,"DUP 0 is forbidden");const d=s(c-1,null)[0];if(ot(d)==="ticket")throw new Z(l,t,"ticket can't be DUPed");return[d,...t]}case"SWAP":{const c=s(0,null,null);return C({}),[c[1],c[0],...t.slice(2)]}case"SOME":return[L({prim:"option",args:[s(0,null)[0]]},C({t:1,v:1})),...t.slice(1)];case"UNIT":return[L({prim:"unit"},C({v:1,t:1})),...t];case"PAIR":{const c=l.args?parseInt(l.args[0].int,10):2;if(c<2)throw new Z(l,t,`PAIR ${c} is forbidden`);const d=s(0,...new Array(c).fill(null)),E=C({f:c,t:1,v:1},{specialFields:!0}),P=M=>{const G=M.lastIndexOf(".");return M.slice(G>0?G+1:1)},D=d.map((M,G)=>{var lt;const bt=u(M),X=E.f&&E.f.length>G&&E.f[G]!=="%"?E.f[G]==="%@"?bt.v?["%"+P(((lt=bt.v)===null||lt===void 0?void 0:lt[0])||"")]:void 0:[E.f[G]]:void 0;return L(M,{v:null,t:null,f:X})});return[L({prim:"pair",args:D},{t:E.t,v:E.v}),...t.slice(c)]}case"UNPAIR":{const c=l.args?parseInt(l.args[0].int,10):2;if(c<2)throw new Z(l,t,`UNPAIR ${c} is forbidden`);const d=s(0,["pair"])[0],E=C({f:2,v:2},{specialVar:!0});return[...H(d,c).map((D,M)=>yt(d,D,E,M,M===0?"car":"cdr")),...t.slice(1)]}case"CAR":case"CDR":{const c=ee("pair",s(0,["pair"])[0]),d=c.args[l.prim==="CAR"?0:1],E=C({f:1,v:1},{specialVar:!0});return[yt(c,d,E,0,l.prim.toLocaleLowerCase()),...t.slice(1)]}case"CONS":{const c=s(0,null,["list"]);return f(c[0],c[1].args[0]),[S({prim:"list",args:[c[1].args[0]]}),...t.slice(2)]}case"SIZE":return s(0,["string","list","set","map","bytes"]),[S({prim:"nat"}),...t.slice(1)];case"MEM":{const c=s(0,null,["set","map","big_map"]);return m(c[0]),f(c[0],c[1].args[0]),[S({prim:"bool"}),...t.slice(2)]}case"GET":if(l.args){const c=parseInt(l.args[0].int,10),d=s(0,["pair"])[0];return[S(Lt(d,c)),...t.slice(1)]}else{const c=s(0,null,["map","big_map"]);return m(c[0]),f(c[0],c[1].args[0]),[S({prim:"option",args:[c[1].args[1]]}),...t.slice(2)]}case"UPDATE":if(l.args){const c=parseInt(l.args[0].int,10),d=s(0,null,["pair"]);return[S(st(d[1],d[0],c)),...t.slice(2)]}else{const c=s(0,null,["bool","option"]);if(m(c[0]),c[1].prim==="bool"){const E=s(2,["set"]);return f(c[0],E[0].args[0]),[S({prim:"set",args:[L(c[0],{t:null})]}),...t.slice(3)]}const d=s(2,["map","big_map"]);return f(c[0],d[0].args[0]),d[0].prim==="map"?[S({prim:"map",args:[L(c[0],{t:null}),L(c[1].args[0],{t:null})]}),...t.slice(3)]:(B(c[1].args[0]),[S({prim:"big_map",args:[L(c[0],{t:null}),L(c[1].args[0],{t:null})]}),...t.slice(3)])}case"GET_AND_UPDATE":{const c=C({v:2}),d=s(0,null,["option"],["map","big_map"]);m(d[0]),f(d[0],d[2].args[0]),f(d[1].args[0],d[2].args[1]);const E=(v=c.v)===null||v===void 0?void 0:v.map(P=>P!=="@"?[P]:void 0);return d[2].prim==="map"?[L({prim:"option",args:[d[2].args[1]]},{v:E==null?void 0:E[0]}),L({prim:"map",args:[L(d[0],{t:null}),L(d[1].args[0],{t:null})]},{v:E==null?void 0:E[1]}),...t.slice(3)]:(B(d[1].args[0]),[L({prim:"option",args:[d[2].args[1]]},{v:E==null?void 0:E[0]}),L({prim:"big_map",args:[L(d[0],{t:null}),L(d[1].args[0],{t:null})]},{v:E==null?void 0:E[1]}),...t.slice(3)])}case"EXEC":{const c=s(0,null,["lambda"]);return f(c[0],c[1].args[0]),[S(c[1].args[1]),...t.slice(2)]}case"APPLY":{const c=s(0,null,["lambda"]);if(T(c[0]),x(c[0]),!nr(c[1].args[0]))throw new Z(l,t,`${l.prim}: function's argument must be a pair: ${ot(c[1].args[0])}`);const d=c[1].args[0];return f(c[0],mi(d)[0]),[S({prim:"lambda",args:[mi(d)[1],c[1].args[1]]}),...t.slice(2)]}case"FAILWITH":{const c=s(0,null)[0];return qr(n,sr.PtEdo2Zk)||N(c),{failed:c,level:0}}case"NEVER":return s(0,["never"]),{failed:{prim:"never"},level:0};case"RENAME":return[S(s(0,null)[0]),...t.slice(1)];case"CONCAT":{const c=s(0,["string","list","bytes"]);if(c[0].prim==="list"){if(ot(c[0].args[0])!=="string"&&ot(c[0].args[0])!=="bytes")throw new Z(l,t,`${l.prim}: can't concatenate list of ${ot(c[0].args[0])}'s`);return[S(c[0].args[0]),...t.slice(1)]}const d=s(1,["string","bytes"]);if(c[0].prim!==d[0].prim)throw new Z(l,t,`${l.prim}: can't concatenate ${c[0].prim} with ${d[0].prim}`);return[S(d[0]),...t.slice(2)]}case"SLICE":return[S({prim:"option",args:[s(0,["nat"],["nat"],["string","bytes"])[2]]},"@slice"),...t.slice(3)];case"PACK":{const c=s(0,null)[0];return N(c),[S({prim:"bytes"},"@packed"),...t.slice(1)]}case"ADD":{const c=s(0,["nat","int","timestamp","mutez","bls12_381_g1","bls12_381_g2","bls12_381_fr"],["nat","int","timestamp","mutez","bls12_381_g1","bls12_381_g2","bls12_381_fr"]);if(c[0].prim==="nat"&&c[1].prim==="int"||c[0].prim==="int"&&c[1].prim==="nat")return[S({prim:"int"}),...t.slice(2)];if(c[0].prim==="int"&&c[1].prim==="timestamp"||c[0].prim==="timestamp"&&c[1].prim==="int")return[S({prim:"timestamp"}),...t.slice(2)];if((c[0].prim==="int"||c[0].prim==="nat"||c[0].prim==="mutez"||c[0].prim==="bls12_381_g1"||c[0].prim==="bls12_381_g2"||c[0].prim==="bls12_381_fr")&&c[0].prim===c[1].prim)return[S(c[0]),...t.slice(2)];throw new Z(l,t,`${l.prim}: can't add ${c[0].prim} to ${c[1].prim}`)}case"SUB":{const c=qr(n,sr.PsiThaCa)?s(0,["nat","int","timestamp","mutez"],["nat","int","timestamp","mutez"]):s(0,["nat","int","timestamp"],["nat","int","timestamp"]);if((c[0].prim==="nat"||c[0].prim==="int")&&(c[1].prim==="nat"||c[1].prim==="int")||c[0].prim==="timestamp"&&c[1].prim==="timestamp")return[S({prim:"int"}),...t.slice(2)];if(c[0].prim==="timestamp"&&c[1].prim==="int")return[S({prim:"timestamp"}),...t.slice(2)];if(c[0].prim==="mutez"&&c[1].prim==="mutez")return[S({prim:"mutez"}),...t.slice(2)];throw new Z(l,t,`${l.prim}: can't subtract ${c[0].prim} from ${c[1].prim}`)}case"SUB_MUTEZ":return s(0,["mutez"],["mutez"]),[S({prim:"option",args:[{prim:"mutez"}]}),...t.slice(2)];case"MUL":{const c=s(0,["nat","int","mutez","bls12_381_g1","bls12_381_g2","bls12_381_fr"],["nat","int","mutez","bls12_381_g1","bls12_381_g2","bls12_381_fr"]);if(c[0].prim==="nat"&&c[1].prim==="int"||c[0].prim==="int"&&c[1].prim==="nat")return[S({prim:"int"}),...t.slice(2)];if(c[0].prim==="nat"&&c[1].prim==="mutez"||c[0].prim==="mutez"&&c[1].prim==="nat")return[S({prim:"mutez"}),...t.slice(2)];if((c[0].prim==="bls12_381_g1"||c[0].prim==="bls12_381_g2"||c[0].prim==="bls12_381_fr")&&c[1].prim==="bls12_381_fr"||(c[0].prim==="nat"||c[0].prim==="int")&&c[0].prim===c[1].prim)return[S(c[0]),...t.slice(2)];if((c[0].prim==="nat"||c[0].prim==="int")&&c[1].prim==="bls12_381_fr"||(c[1].prim==="nat"||c[1].prim==="int")&&c[0].prim==="bls12_381_fr")return[S({prim:"bls12_381_fr"}),...t.slice(2)];throw new Z(l,t,`${l.prim}: can't multiply ${c[0].prim} by ${c[1].prim}`)}case"EDIV":{const c=(E,P)=>({prim:"option",args:[{prim:"pair",args:[{prim:E},{prim:P}]}]}),d=s(0,["nat","int","mutez"],["nat","int","mutez"]);if(d[0].prim==="nat"&&d[1].prim==="nat")return[S(c("nat","nat")),...t.slice(2)];if((d[0].prim==="nat"||d[0].prim==="int")&&(d[1].prim==="nat"||d[1].prim==="int"))return[S(c("int","nat")),...t.slice(2)];if(d[0].prim==="mutez"&&d[1].prim==="nat")return[S(c("mutez","mutez")),...t.slice(2)];if(d[0].prim==="mutez"&&d[1].prim==="mutez")return[S(c("nat","mutez")),...t.slice(2)];throw new Z(l,t,`${l.prim}: can't euclideally divide ${d[0].prim} by ${d[1].prim}`)}case"ABS":return s(0,["int"]),[S({prim:"nat"}),...t.slice(1)];case"ISNAT":return s(0,["int"]),[S({prim:"option",args:[{prim:"nat"}]}),...t.slice(1)];case"INT":return s(0,["nat","bls12_381_fr","bytes"]),[S({prim:"int"}),...t.slice(1)];case"BYTES":return s(0,["nat","int"]),[S({prim:"bytes"}),...t.slice(1)];case"NAT":return s(0,["bytes"]),[S({prim:"nat"}),...t.slice(1)];case"NEG":{const c=s(0,["nat","int","bls12_381_g1","bls12_381_g2","bls12_381_fr"])[0];return c.prim==="nat"||c.prim==="int"?[S({prim:"int"}),...t.slice(1)]:[S(c),...t.slice(1)]}case"LSL":case"LSR":return s(0,["nat","bytes"],["nat","bytes"]),[S({prim:"nat"}),...t.slice(2)];case"OR":case"XOR":{const c=s(0,["nat","bytes","bool"],["nat","bytes","bool"]);if(c[0].prim!==c[1].prim)throw new Z(l,t,`${l.prim}: both arguments must be of the same type: ${c[0].prim}, ${c[1].prim}`);return[S(c[1]),...t.slice(2)]}case"AND":{const c=s(0,["nat","bytes","bool","int"],["nat","bytes","bool"]);if((c[0].prim!=="int"||c[1].prim!=="nat")&&c[0].prim!==c[1].prim)throw new Z(l,t,`${l.prim}: both arguments must be of the same type: ${c[0].prim}, ${c[1].prim}`);return[S(c[1]),...t.slice(2)]}case"NOT":return s(0,["nat","bytes","bool","int"])[0].prim==="bool"?[S({prim:"bool"}),...t.slice(1)]:[S({prim:"int"}),...t.slice(1)];case"COMPARE":{const c=s(0,null,null);return m(c[0]),m(c[1]),[S({prim:"int"}),...t.slice(2)]}case"EQ":case"NEQ":case"LT":case"GT":case"LE":case"GE":return s(0,["int"]),[S({prim:"bool"}),...t.slice(1)];case"SELF":{if((e==null?void 0:e.contract)===void 0)throw new Z(l,t,`${l.prim}: contract required`);const c=C({f:1,v:1}),d=Ns(e.contract,(b=c.f)===null||b===void 0?void 0:b[0]);if(d===null)throw new Z(l,t,`${l.prim}: contract has no entrypoint ${d}`);return[L({prim:"contract",args:[d]},{v:c.v?c.v:["@self"]}),...t]}case"TRANSFER_TOKENS":{const c=s(0,null,["mutez"],["contract"]);return f(c[0],c[2].args[0]),[S({prim:"operation"}),...t.slice(3)]}case"SET_DELEGATE":{const c=s(0,["option"])[0];if(ot(c.args[0])!=="key_hash")throw new Z(l,t,`${l.prim}: key hash expected: ${ot(c.args[0])}`);return[S({prim:"operation"}),...t.slice(1)]}case"IMPLICIT_ACCOUNT":return s(0,["key_hash"]),[S({prim:"contract",args:[{prim:"unit"}]}),...t.slice(1)];case"NOW":return[S({prim:"timestamp"},"@now"),...t];case"AMOUNT":return[S({prim:"mutez"},"@amount"),...t];case"BALANCE":return[S({prim:"mutez"},"@balance"),...t];case"CHECK_SIGNATURE":return s(0,["key"],["signature"],["bytes"]),[S({prim:"bool"}),...t.slice(3)];case"BLAKE2B":case"SHA256":case"SHA512":case"KECCAK":case"SHA3":return s(0,["bytes"]),[S({prim:"bytes"}),...t.slice(1)];case"HASH_KEY":return s(0,["key"]),[S({prim:"key_hash"}),...t.slice(1)];case"SOURCE":return[S({prim:"address"},"@source"),...t];case"SENDER":return[S({prim:"address"},"@sender"),...t];case"ADDRESS":{const c=s(0,["contract"])[0],d=C({v:1});return[L({prim:"address",[zn]:c},{v:d.v?d.v:J(u(c),"address")}),...t.slice(1)]}case"SELF_ADDRESS":{const c={prim:"address"};return(e==null?void 0:e.contract)!==void 0&&(c[zn]={prim:"contract",args:[Be(e.contract,"parameter").args[0]]}),[S(c,"@address"),...t]}case"CHAIN_ID":return[S({prim:"chain_id"}),...t];case"DROP":{C({});const c=l.args!==void 0?parseInt(l.args[0].int,10):1;return s(c-1,null),t.slice(c)}case"DIG":{C({});const c=parseInt(l.args[0].int,10);return[s(c,null)[0],...t.slice(0,c),...t.slice(c+1)]}case"DUG":{C({});const c=parseInt(l.args[0].int,10);return[...t.slice(1,c+1),s(0,null)[0],...t.slice(c+1)]}case"NONE":return pt(l.args[0]),[L({prim:"option",args:[l.args[0]]},C({t:1,v:1})),...t];case"LEFT":case"RIGHT":{const c=s(0,null)[0],d=C({f:2,t:1,v:1},{specialFields:!0}),E=u(c),P=[L(c,{t:null,v:null,f:d.f&&d.f.length>0&&d.f[0]!=="%"?d.f[0]==="%@"?E.v?["%"+E.v[0].slice(1)]:void 0:d.f:void 0}),L(l.args[0],{t:null,f:d.f&&d.f.length>1&&d.f[1]!=="%"?d.f:void 0})];return[L({prim:"or",args:l.prim==="LEFT"?P:[P[1],P[0]]},{t:d.t,v:d.v}),...t.slice(1)]}case"NIL":return pt(l.args[0]),[L({prim:"list",args:[l.args[0]]},C({t:1,v:1})),...t];case"UNPACK":return s(0,["bytes"]),pt(l.args[0]),[S({prim:"option",args:[l.args[0]]},"@unpacked"),...t.slice(1)];case"CONTRACT":{const c=s(0,["address"])[0];pt(l.args[0]);const d=C({v:1,f:1}),E=c[zn];if(E!==void 0){const P=Ns(E,(_=d.f)===null||_===void 0?void 0:_[0]);if(P===null)throw new Z(l,t,`${l.prim}: contract has no entrypoint ${P}`);f(P,l.args[0])}return[L({prim:"option",args:[{prim:"contract",args:[l.args[0]]}]},{v:d.v?d.v:J(u(c),"contract")}),...t.slice(1)]}case"CAST":{C({});const c=s(0,null)[0];return pt(l.args[0]),f(l.args[0],c),[l.args[0],...t.slice(1)]}case"IF_NONE":{C({});const c=s(0,["option"])[0],d=t.slice(1),E=It(l.args[0],d,e),P=It(l.args[1],[L(c.args[0],{t:null,v:J(u(c),"some")}),...d],e);return h(E,P)}case"IF_LEFT":{C({});const c=s(0,["or"])[0],d=u(c),E=u(c.args[0]),P=u(c.args[1]),D=t.slice(1),M=It(l.args[0],[L(c.args[0],{t:null,v:J(d,E.f?E.f[0].slice(1):"left")}),...D],e),G=It(l.args[1],[L(c.args[1],{t:null,v:J(d,P.f?P.f[0].slice(1):"right")}),...D],e);return h(M,G)}case"IF_CONS":{C({});const c=s(0,["list"])[0],d=u(c),E=t.slice(1),P=It(l.args[0],[L(c.args[0],{t:null,v:J(d,"hd")}),L(c,{t:null,v:J(d,"tl")}),...E],e),D=It(l.args[1],E,e);return h(P,D)}case"IF":{C({}),s(0,["bool"]);const c=t.slice(1),d=It(l.args[0],c,e),E=It(l.args[1],c,e);return h(d,E)}case"MAP":{const c=s(0,["list","map","option"])[0],d=t.slice(1),E=c.prim==="map"?{prim:"pair",args:c.args}:c.args[0],P=It(l.args[0],[L(E,{t:null,v:J(u(c),"elt")}),...d],e);if("failed"in P){if(!("prim"in P.failed)||P.failed.prim!=="never")throw new Z(l,t,`${l.prim}: FAIL is not allowed in MAP`);return{failed:P.failed,level:P.level+1}}if(P.length<1)throw new Z(l,t,`${l.prim}: function must return a value`);return p(P.slice(1),d),c.prim==="list"?[S({prim:"list",args:[P[0]]}),...d]:c.prim==="map"?[S({prim:"map",args:[c.args[0],P[0]]}),...d]:[S({prim:"option",args:[P[0]]}),...d]}case"ITER":{C({});const c=s(0,["set","list","map"])[0],d=t.slice(1),E=c.prim==="map"?{prim:"pair",args:c.args}:c.args[0],P=It(l.args[0],[L(E,{t:null,v:J(u(c),"elt")}),...d],e);return"failed"in P?{failed:P.failed,level:P.level+1}:(p(P,d),d)}case"LOOP":{C({}),s(0,["bool"]);const c=t.slice(1),d=It(l.args[0],c,e);return"failed"in d?{failed:d.failed,level:d.level+1}:(p(d,[{prim:"bool"},...c]),c)}case"LOOP_LEFT":{C({});const c=s(0,["or"])[0],d=t.slice(1),E=It(l.args[0],[L(c.args[0],{t:null,v:J(u(c),"left")}),...d],e);return"failed"in E?{failed:E.failed,level:E.level+1}:(p(E,[c,...d]),[L(c.args[1],{t:null,v:C({v:1}).v}),...d])}case"DIP":{C({});const c=l.args.length===2?parseInt(l.args[0].int,10):1;s(c-1,null);const d=t.slice(0,c),E=t.slice(c),P=l.args.length===2?It(l.args[1],E,e):It(l.args[0],E,e);return"failed"in P?{failed:P.failed,level:P.level+1}:[...d,...P]}case"CREATE_CONTRACT":{const c=C({v:2}),d=s(0,["option"],["mutez"],null);if(ot(d[0].args[0])!=="key_hash")throw new Z(l,t,`${l.prim}: key hash expected: ${ot(d[0].args[0])}`);T(d[2])&&(Zu(l.args[0]),fe(Be(l.args[0],"storage").args[0],d[2]));const E=(R=c.v)===null||R===void 0?void 0:R.map(P=>P!=="@"?[P]:void 0);return[L({prim:"operation"},{v:E==null?void 0:E[0]}),L({prim:"address",[zn]:{prim:"contract",args:[Be(l.args[0],"parameter").args[0]]}},{v:E==null?void 0:E[1]}),...t.slice(3)]}case"PUSH":return pt(l.args[0]),pe(l.args[1],l.args[0],Object.assign(Object.assign({},e),{contract:void 0})),[S(l.args[0]),...t];case"EMPTY_SET":return pt(l.args[0]),m(l.args[0]),[L({prim:"set",args:l.args},C({t:1,v:1})),...t];case"EMPTY_MAP":return pt(l.args[0]),m(l.args[0]),pt(l.args[1]),[L({prim:"map",args:l.args},C({t:1,v:1})),...t];case"EMPTY_BIG_MAP":return pt(l.args[0]),m(l.args[0]),pt(l.args[1]),B(l.args[0]),[L({prim:"big_map",args:l.args},C({t:1,v:1})),...t];case"LAMBDA_REC":case"LAMBDA":{pt(l.args[0]),pt(l.args[1]);const c=[l.args[0]];l.prim==="LAMBDA_REC"&&c.push({prim:"lambda",args:[l.args[0],l.args[1]]});const d=It(l.args[2],c,Object.assign(Object.assign({},e),{contract:void 0}));if("failed"in d)return{failed:d.failed,level:d.level+1};if(d.length!==1)throw new Z(l,t,`${l.prim}: function must return a value`);return f(l.args[1],d[0]),[S({prim:"lambda",args:[l.args[0],l.args[1]]}),...t]}case"LEVEL":return[S({prim:"nat"},"@level"),...t];case"TOTAL_VOTING_POWER":return[S({prim:"nat"}),...t];case"VOTING_POWER":return s(0,["key_hash"]),[S({prim:"nat"}),...t.slice(1)];case"TICKET":{const c=s(0,null,["nat"])[0];return m(c),qr(n,sr.PtLimaPtL)?[L({prim:"ticket",args:[c]},C({t:1,v:1})),...t.slice(2)]:[S({prim:"option",args:[L({prim:"ticket",args:[c]},C({t:1,v:1}))]}),...t.slice(2)]}case"JOIN_TICKETS":{const c=ee("pair",s(0,["pair"])[0]);if(ot(c.args[0])!=="ticket")throw new Z(l,t,`${l.prim}: ticket expected: ${ot(c.args[0])}`);return f(c.args[0],c.args[1]),[S({prim:"option",args:[L(c.args[0],{t:null})]}),...t.slice(1)]}case"SPLIT_TICKET":{const c=s(0,["ticket"],["pair"]),d=ee("pair",c[1]);if(ot(d.args[0])!=="nat")throw new Z(l,t,`${l.prim}: nat expected: ${ot(d.args[0])}`);return f(d.args[0],d.args[1]),[S({prim:"option",args:[{prim:"pair",args:[L(c[0],{t:null}),L(c[0],{t:null})]}]}),...t.slice(2)]}case"READ_TICKET":{const c=C({v:2}),d=s(0,["ticket"])[0],E=(w=c.v)===null||w===void 0?void 0:w.map(P=>P!=="@"?[P]:void 0);return[L({prim:"pair",args:[{prim:"address"},L(d.args[0],{t:null}),{prim:"nat"}]},{v:E==null?void 0:E[0]}),L(d,{v:E==null?void 0:E[1],t:null}),...t.slice(1)]}case"PAIRING_CHECK":{const c=s(0,["list"])[0].args[0];if(!nr(c))throw new Z(l,t,`${l.prim}: pair expected: ${ot(c)}`);const d=ee("pair",c);if(ot(d.args[0])!=="bls12_381_g1")throw new Z(l,t,`${l.prim}: bls12_381_g1 expected: ${ot(d.args[0])}`);if(ot(d.args[1])!=="bls12_381_g2")throw new Z(l,t,`${l.prim}: bls12_381_g2 expected: ${ot(d.args[1])}`);return[S({prim:"bool"}),...t.slice(1)]}case"SAPLING_EMPTY_STATE":return[L({prim:"sapling_state",args:[l.args[0]]},C({v:1,t:1})),...t];case"SAPLING_VERIFY_UPDATE":{const c=s(0,["sapling_transaction"],["sapling_state"]);if(parseInt(c[0].args[0].int,10)!==parseInt(c[1].args[0].int,10))throw new Z(l,t,`${l.prim}: sapling memo size mismatch: ${c[0].args[0].int} != ${c[1].args[0].int}`);return qr(n,sr.PtJakarta)?[S({prim:"option",args:[{prim:"pair",args:[{prim:"int"},L(c[1],{t:null})]}]}),...t.slice(2)]:[S({prim:"option",args:[{prim:"pair",args:[{prim:"bytes"},{prim:"pair",args:[{prim:"int"},L(c[1],{t:null})]}]}]}),...t.slice(2)]}case"OPEN_CHEST":return s(0,["chest_key"],["chest"],["nat"]),[S({prim:"or",args:[{prim:"bytes"},{prim:"bool"}]}),...t.slice(3)];case"VIEW":{const c=s(0,null,["address"]);return x(c[0]),[S({prim:"option",args:[l.args[1]]}),...t.slice(2)]}case"MIN_BLOCK_TIME":return[S({prim:"nat"}),...t];case"EMIT":{const c=C({f:1,t:1});if(l.args){const d=s(0,null);return f(d[0],l.args[0]),[L({prim:"operation"},c),...t.slice(1)]}return[L({prim:"operation"},c),...t.slice(1)]}default:throw new se(l,`unexpected instruction: ${l.prim}`)}})(i);if((e==null?void 0:e.traceCallback)!==void 0){const l={op:i,in:t,out:g};e.traceCallback(l)}return g}function Be(r,t){for(const e of r)if(e.prim===t)return e;throw new se(r,`missing contract section: ${t}`)}function tm(r){const t={};for(const e of r)e.prim==="view"&&(t[e.args[0].string]=e);return t}function Wu(r){if(Array.isArray(r)){for(const t of r)if("prim"in t&&(t.prim==="parameter"||t.prim==="storage"||t.prim==="code"))return!0}return!1}function Ns(r,t){t=t||"%default";const e=yi(r).find(n=>n[0]===t);return e!==void 0?e[1]:t==="%default"?Wu(r)?Be(r,"parameter").args[0]:r:null}function em(r){return Array.isArray(r)||r.prim==="or"}function yi(r){if(Wu(r)){const t=Be(r,"parameter"),e=yi(t.args[0]),n=tn(t);return n.f?[[n.f[0],t.args[0]],...e]:e}if(em(r)){const t=mi(r),e=n=>{const i=tn(t[n]);if(ot(t[n])==="or"){const s=yi(t[n]);return i.f?[[i.f[0],t[n]],...s]:s}return i.f?[[i.f[0],t[n]]]:[]};return[...e(0),...e(1)]}return[]}function Zu(r,t){const e=(u,p,f,m)=>{pt(u,!0),pt(p);const N={prim:"pair",args:[Object.assign(Object.assign({},u),{annots:["@parameter"]}),Object.assign(Object.assign({},p),{annots:["@storage"]})]},T=It(m,[N],Object.assign(Object.assign({},t),{contract:r}));if("failed"in T)return T;try{zu(T,[f])}catch(x){throw x instanceof se?new Z(m,T,x.message):x}return T},n=Be(r,"parameter").args[0],i=Be(r,"storage").args[0],s=Be(r,"code").args[0],a=e(n,i,{prim:"pair",args:[{prim:"list",args:[{prim:"operation"}]},i]},s);for(const u of Object.values(tm(r)))e(u.args[1],i,u.args[2],u.args[3]);return a}function Yu(r,t,e){pt(t),pe(r,t,e||null)}function rm(r,t,e){for(const n of t)pt(n);if((e==null?void 0:e.contract)!==void 0)for(const n of["parameter","storage"]){const i=Be(e.contract,n).args[0];pt(i)}return It(r,t,e||null)}function nm(r,t,e){try{return Yu(r,t,e),!0}catch{return!1}}class ao{constructor(t,e){this.contract=t,this.ctx=Object.assign({contract:t},e),this.output=Zu(t,this.ctx)}static parse(t,e){const n=new Lr(e),i=typeof t=="string"?n.parseScript(t):n.parseJSON(t);if(i===null)throw new Rg("empty contract");if(Vu(i))return new ao(i,e)}static parseTypeExpression(t,e){const n=new Lr(e),i=typeof t=="string"?n.parseScript(t):n.parseJSON(t);if(i===null)throw new Og("empty type expression");if(ir(i))return pt(i),i}static parseDataExpression(t,e){const n=new Lr(e),i=typeof t=="string"?n.parseScript(t):n.parseJSON(t);if(i===null)throw new Pg("empty data expression");if(Nr(i))return i;throw void 0}section(t){return Be(this.contract,t)}entryPoints(){return yi(this.contract)}entryPoint(t){return Ns(this.contract,t)}assertDataValid(t,e){Yu(t,e,this.ctx)}isDataValid(t,e){return nm(t,e,this.ctx)}assertParameterValid(t,e){const n=this.entryPoint(t||void 0);if(n===null)throw new Tg(t==null?void 0:t.toString());this.assertDataValid(e,n)}isParameterValid(t,e){try{return this.assertParameterValid(t,e),!0}catch{return!1}}functionType(t,e){return rm(t,e,this.ctx)}}new ao([{prim:"parameter",args:[{prim:"unit"}]},{prim:"storage",args:[{prim:"unit"}]},{prim:"code",args:[[{prim:"CAR"},{prim:"NIL",args:[{prim:"operation"}]},{prim:"PAIR"}]]}]);const cc=r=>r.reduce((t,e)=>t+e.toString(16).padStart(2,"0"),""),vt=(r,t=8)=>r.toString(16).padStart(t,"0"),co=31;var y;(function(r){r.SECRET="secret",r.RAW="raw",r.TZ1="tz1",r.BRANCH="branch",r.ZARITH="zarith",r.PUBLIC_KEY="public_key",r.PKH="pkh",r.DELEGATE="delegate",r.SCRIPT="script",r.BALLOT_STATEMENT="ballotStmt",r.PROPOSAL="proposal",r.PROPOSAL_ARR="proposalArr",r.INT32="int32",r.INT16="int16",r.PARAMETERS="parameters",r.ADDRESS="address",r.SMART_CONTRACT_ADDRESS="smart_contract_address",r.SMART_ROLLUP_ADDRESS="smart_rollup_address",r.SMART_ROLLUP_COMMITMENT_HASH="smart_rollup_commitment_hash",r.VALUE="value",r.PADDED_BYTES="padded_bytes",r.SMART_ROLLUP_MESSAGE="smart_rollup_message",r.MANAGER="manager",r.BLOCK_PAYLOAD_HASH="blockPayloadHash",r.ENTRYPOINT="entrypoint",r.OPERATION="operation",r.OP_ACTIVATE_ACCOUNT="activate_account",r.OP_DELEGATION="delegation",r.OP_TRANSACTION="transaction",r.OP_ORIGINATION="origination",r.OP_BALLOT="ballot",r.OP_ENDORSEMENT="endorsement",r.OP_SEED_NONCE_REVELATION="seed_nonce_revelation",r.OP_REVEAL="reveal",r.OP_PROPOSALS="proposals",r.OP_REGISTER_GLOBAL_CONSTANT="register_global_constant",r.OP_TRANSFER_TICKET="transfer_ticket",r.OP_TX_ROLLUP_ORIGINATION="tx_rollup_origination",r.OP_TX_ROLLUP_SUBMIT_BATCH="tx_rollup_submit_batch",r.BURN_LIMIT="burn_limit",r.TX_ROLLUP_ORIGINATION_PARAM="tx_rollup_origination_param",r.TX_ROLLUP_ID="tx_rollup_id",r.TX_ROLLUP_BATCH_CONTENT="tx_rollup_batch_content",r.OP_INCREASE_PAID_STORAGE="increase_paid_storage",r.OP_UPDATE_CONSENSUS_KEY="update_consensus_key",r.OP_DRAIN_DELEGATE="drain_delegate",r.DEPOSITS_LIMIT="deposits_limit",r.OP_SET_DEPOSITS_LIMIT="set_deposits_limit",r.OP_SMART_ROLLUP_ORIGINATE="smart_rollup_originate",r.PVM_KIND="pvm_kind",r.OP_SMART_ROLLUP_ADD_MESSAGES="smart_rollup_add_messages",r.OP_SMART_ROLLUP_EXECUTE_OUTBOX_MESSAGE="smart_rollup_execute_outbox_message"})(y||(y={}));const Ee={"00":"parameter","01":"storage","02":"code","03":"False","04":"Elt","05":"Left","06":"None","07":"Pair","08":"Right","09":"Some","0a":"True","0b":"Unit","0c":"PACK","0d":"UNPACK","0e":"BLAKE2B","0f":"SHA256",10:"SHA512",11:"ABS",12:"ADD",13:"AMOUNT",14:"AND",15:"BALANCE",16:"CAR",17:"CDR",18:"CHECK_SIGNATURE",19:"COMPARE","1a":"CONCAT","1b":"CONS","1c":"CREATE_ACCOUNT","1d":"CREATE_CONTRACT","1e":"IMPLICIT_ACCOUNT","1f":"DIP",20:"DROP",21:"DUP",22:"EDIV",23:"EMPTY_MAP",24:"EMPTY_SET",25:"EQ",26:"EXEC",27:"FAILWITH",28:"GE",29:"GET","2a":"GT","2b":"HASH_KEY","2c":"IF","2d":"IF_CONS","2e":"IF_LEFT","2f":"IF_NONE",30:"INT",31:"LAMBDA",32:"LE",33:"LEFT",34:"LOOP",35:"LSL",36:"LSR",37:"LT",38:"MAP",39:"MEM","3a":"MUL","3b":"NEG","3c":"NEQ","3d":"NIL","3e":"NONE","3f":"NOT",40:"NOW",41:"OR",42:"PAIR",43:"PUSH",44:"RIGHT",45:"SIZE",46:"SOME",47:"SOURCE",48:"SENDER",49:"SELF","4a":"STEPS_TO_QUOTA","4b":"SUB","4c":"SWAP","4d":"TRANSFER_TOKENS","4e":"SET_DELEGATE","4f":"UNIT",50:"UPDATE",51:"XOR",52:"ITER",53:"LOOP_LEFT",54:"ADDRESS",55:"CONTRACT",56:"ISNAT",57:"CAST",58:"RENAME",59:"bool","5a":"contract","5b":"int","5c":"key","5d":"key_hash","5e":"lambda","5f":"list",60:"map",61:"big_map",62:"nat",63:"option",64:"or",65:"pair",66:"set",67:"signature",68:"string",69:"bytes","6a":"mutez","6b":"timestamp","6c":"unit","6d":"operation","6e":"address","6f":"SLICE",70:"DIG",71:"DUG",72:"EMPTY_BIG_MAP",73:"APPLY",74:"chain_id",75:"CHAIN_ID",76:"LEVEL",77:"SELF_ADDRESS",78:"never",79:"NEVER","7a":"UNPAIR","7b":"VOTING_POWER","7c":"TOTAL_VOTING_POWER","7d":"KECCAK","7e":"SHA3","7f":"PAIRING_CHECK",80:"bls12_381_g1",81:"bls12_381_g2",82:"bls12_381_fr",83:"sapling_state",84:"sapling_transaction_deprecated",85:"SAPLING_EMPTY_STATE",86:"SAPLING_VERIFY_UPDATE",87:"ticket",88:"TICKET_DEPRECATED",89:"READ_TICKET","8a":"SPLIT_TICKET","8b":"JOIN_TICKETS","8c":"GET_AND_UPDATE","8d":"chest","8e":"chest_key","8f":"OPEN_CHEST",90:"VIEW",91:"view",92:"constant",93:"SUB_MUTEZ",94:"tx_rollup_l2_address",95:"MIN_BLOCK_TIME",96:"sapling_transaction",97:"EMIT",98:"Lambda_rec",99:"LAMBDA_REC","9a":"TICKET","9b":"BYTES","9c":"NAT"},im=(()=>{const r={};return Object.keys(Ee).forEach(t=>{r[Ee[t]]=t}),r})(),xs={4:"activate_account",107:"reveal",110:"delegation",108:"transaction",109:"origination",6:"ballot",21:"endorsement",1:"seed_nonce_revelation",5:"proposals",111:"register_global_constant",150:"tx_rollup_origination",151:"tx_rollup_submit_batch",158:"transfer_ticket",112:"set_deposits_limit",113:"increase_paid_storage",114:"update_consensus_key",9:"drain_delegate",200:"smart_rollup_originate",201:"smart_rollup_add_messages",206:"smart_rollup_execute_outbox_message"},uc=(()=>{const r={};return Object.keys(xs).forEach(t=>{const e=typeof t=="string"?parseInt(t,10):t;r[xs[e]]=vt(e,2)}),r})(),bi={"00":"default","01":"root","02":"do","03":"set_delegate","04":"remove_delegate","05":"deposit"},lc=(()=>{const r={};return Object.keys(bi).forEach(t=>{r[bi[t]]=t}),r})();class hc extends mt{constructor(t,e){super(),this.operation=t,this.name="InvalidOperationSchemaError",this.message="Invalid operation content recevied",e&&(this.message+=` ${e}.`)}}class Xu extends mt{constructor(t){super(),this.entrypoint=t,this.name="OversizedEntryPointError",this.message=`Invalid entrypoint length "${t.length}", maximum length is "${co}".`}}class sm extends mt{constructor(t){super(),this.ballotValue=t,this.name="InvalidBallotValueError",this.message=`Invalid ballot value "${t}" expecting one of the following: "yay", "nay", "pass".`}}class om extends mt{constructor(t){super(),this.ballotValue=t,this.name="DecodeBallotValueError",this.message=`Invalid ballot value "${t}", cannot be decoded.`}}class am extends mt{constructor(t){super(),this.value=t,this.name="UnexpectedMichelsonValueError",this.message=`Invalid Michelson value "${t}", unalbe to encode.`}}class Ju extends mt{constructor(t){super(),this.message=t,this.name="OperationDecodingError"}}class cm extends mt{constructor(t){super(),this.message=t,this.name="OperationEncodingError"}}class um extends mt{constructor(t){super(),this.op=t,this.name="UnsupportedOperationError",this.message=`Unsupported operation "${t}", can submit an issue on our github for feature request.`}}class lm extends mt{constructor(t){super(),this.pvm=t,this.name="UnsupportedPvmKindError",this.message=`Invalid Pvm kind "${t}" expecting either "arith" or "wasm_2_0_0".`}}class hm extends mt{constructor(t){super(),this.pvm=t,this.name="DecodePvmKindError",this.message=`Invalid Pvm kind "${t}", cannot be decoded.`}}class Qu extends mt{constructor(t,e){super(),this.address=t,this.name="InvalidSmartRollupAddress",this.message=`Invalid smart rollup address "${t}"`,e&&(this.message+=` ${e}.`)}}class tl extends mt{constructor(t,e){super(),this.hash=t,this.name="InvalidSmartRollupCommitmentHashError",this.message=`Invalid smart rollup commitment hash "${t}"`,e&&(this.message+=` ${e}.`)}}class ge{constructor(t,e=0){this.arr=t,this.offset=e}static fromHexString(t){const e=t.toLowerCase();if(/^(([a-f]|\d){2})*$/.test(e)){const n=new Uint8Array((e.match(/([a-z]|\d){2}/g)||[]).map(i=>parseInt(i,16)));return new ge(n)}else throw new Xc(e)}consume(t){const e=this.arr.subarray(this.offset,this.offset+t);return this.offset+=t,e}get(t){return this.arr[this.offset+t]}length(){return this.arr.length-this.offset}slice(t,e){return new ge(this.arr.slice(t,e))}}const dm=r=>"prim"in r,pm=r=>"bytes"in r&&typeof r.bytes=="string",fm=r=>"string"in r&&typeof r.string=="string",gm=r=>"int"in r&&typeof r.int=="string",mm=r=>{const t=Sr(r.code),e=Sr(r.storage);return`${vt(t.length/2,8)}${t}${vt(e.length/2,8)}${e}`},ym=r=>{const t=ae(r),e=ae(r);return{code:Rr(new ge(t)),storage:Rr(new ge(e))}},Sr=r=>{if(Array.isArray(r)){const t=r.map(n=>Sr(n)).join(""),e=t.length/2;return`02${vt(e)}${t}`}else{if(dm(r))return Rm(r);if(pm(r))return Em(r);if(fm(r))return wm(r);if(gm(r))return Am(r)}throw new am(JSON.stringify(r))},Rr=r=>{const t=r.consume(1);switch(t[0]){case 10:return vm(r);case 1:return _m(r);case 0:return Sm(r);case 2:{const e=new ge(ae(r)),n=[];for(;e.length()>0;)n.push(Rr(e));return n}default:return Om(r,t)}},ae=(r,t=4)=>{const e=r.consume(t),n=parseInt(nt.Buffer.from(e).toString("hex"),16);return r.consume(n)},bm=(r,t=4)=>{const e=[];let n=r;for(;n.length();){const i=n.consume(t),s=parseInt(nt.Buffer.from(i).toString("hex"),16);e.push(n.consume(s)),n=n.slice(s+t)}return e},Em=r=>{if(!/^([A-Fa-f0-9]{2})*$/.test(r.bytes))throw new Xc(r.bytes);const t=r.bytes.length/2;return`0a${vt(t)}${r.bytes}`},vm=r=>{const t=ae(r);return{bytes:nt.Buffer.from(t).toString("hex")}},wm=r=>{const t=nt.Buffer.from(r.string,"utf8").toString("hex"),e=t.length/2;return`01${vt(e)}${t}`},_m=r=>{const t=ae(r);return{string:nt.Buffer.from(t).toString("utf8")}},Am=({int:r})=>{const t=new U(r,10),e=t.toString(2)[0]==="-"?"1":"0",n=t.toString(2).replace(/-/g,""),i=n.length<=6?6:(n.length-6)%7?n.length+7-(n.length-6)%7:n.length,o=n.padStart(i,"0").match(/\d{6,7}/g).reverse();return o[0]=e+o[0],`00${o.map((u,p)=>parseInt((p===o.length-1?"0":"1")+u,2).toString(16).padStart(2,"0")).join("")}`},Sm=r=>{let t=r.consume(1)[0];const e=[],n=128;for(;t&n;)e.push(t),t=r.consume(1)[0];e.push(t);const i=!!(64&e[0]);e[0]=e[0]&127;const s=e.map((a,u)=>a.toString(2).slice(u===0?-6:-7).padStart(u===0?6:7,"0")).reverse();let o=new U(s.join(""),2);return i&&(o=o.times(-1)),{int:o.toFixed()}},Rm=r=>{const t=+Array.isArray(r.annots),e=Array.isArray(r.args)?r.args.length:0,n=vt(Math.min(2*e+t+3,9),2),i=im[r.prim];let s=(r.args||[]).map(a=>Sr(a)).join("");const o=Array.isArray(r.annots)?Im(r.annots):"";return(r.prim==="LAMBDA"||r.prim==="LAMBDA_REC")&&e&&(s=vt(s.length/2)+s+vt(0)),(r.prim==="pair"||r.prim==="Pair")&&e>2&&(s=o===""?vt(s.length/2)+s+vt(0):vt(s.length/2)+s),r.prim==="view"&&r.args&&(s=vt(s.length/2)+s+vt(0)),`${n}${i}${s}${o}`},Om=(r,t)=>{const e=(t[0]-3)%2===1;let n=Math.floor((t[0]-3)/2);const i=r.consume(1)[0].toString(16).padStart(2,"0"),s={prim:Ee[i]};if((Ee[i]==="LAMBDA"||Ee[i]==="LAMBDA_REC")&&r.consume(4),Ee[i]==="view")return n!=0?Pm(r,s):s;let o,a;(Ee[i]==="pair"||Ee[i]==="Pair")&&n>2&&(o=Tm(r),n=0,a=dc(r));const u=new Array(n).fill(0).map(()=>Rr(r));return(Ee[i]==="LAMBDA"||Ee[i]==="LAMBDA_REC")&&r.consume(4),o?s.args=o:u.length&&(s.args=u),a&&a[0]!==""?s.annots=a:e&&(s.annots=dc(r)),s},Pm=(r,t)=>(r.consume(4),t.args=new Array(4).fill(0).map(()=>Rr(r)),r.consume(4),t),Tm=r=>{const t=new ge(ae(r)),e=[];for(;t.length()>0;)e.push(Rr(t));return e},Im=r=>{const t=r.map(n=>nt.Buffer.from(n,"utf8").toString("hex")).join("20"),e=t.length/2;return`${vt(e)}${t}`},dc=r=>{const t=r.consume(4),e=parseInt(nt.Buffer.from(t).toString("hex"),16),n=r.consume(e);return nt.Buffer.from(n).toString("hex").split("20").map(s=>nt.Buffer.from(s,"hex").toString("utf8"))},Gt=r=>t=>bn(nt.Buffer.from(ou(t,Vt[r]))),Wt=r=>t=>{const e=t.consume(eu[r]);return vr(e,Vt[r])},Nm=Wt(O.TZ1),xm=Wt(O.B),uo=r=>{const t=r.consume(1);if(t[0]===0)return Wt(O.TZ1)(r);if(t[0]===1)return Wt(O.TZ2)(r);if(t[0]===2)return Wt(O.TZ3)(r)},Lm=Gt(O.B),Cm=Gt(O.TZ1),pc=r=>r?"ff":"00",el=r=>Gt(O.P)(r),rl=r=>Wt(O.P)(r),Dm=r=>{const t=[];for(r.consume(4);r.length()>0;)t.push(rl(r));return t},Mm=r=>vt(32*r.length)+r.map(t=>el(t)).join(""),km=r=>{switch(r){case"yay":return"00";case"nay":return"01";case"pass":return"02";default:throw new sm(r)}},Bm=r=>{const t=r.consume(1);switch(t[0]){case 0:return"yay";case 1:return"nay";case 2:return"pass";default:throw new om(t[0].toString())}},Um=r=>{switch(r){case"arith":return"00";case"wasm_2_0_0":return"01";default:throw new lm(r)}},Hm=r=>{const t=r.consume(1);switch(t[0]){case 0:return"arith";case 1:return"wasm_2_0_0";default:throw new hm(t[0].toString())}},$m=r=>r?pc(!0)+lo(r):pc(!1),jm=r=>{const t=parseInt(String(r),10),e=[];for(let n=0;n<4;n++){const i=(4-(n+1))*8;e.push((t&255<<i)>>i)}return nt.Buffer.from(e).toString("hex")},Vm=r=>{const t=r.consume(4);let e=0;for(let n=0;n<t.length;n++)e=e|t[n]<<(t.length-(n+1))*8;return e},Gm=r=>{const t=parseInt(String(r),10),e=[];for(let n=0;n<2;n++){const i=(2-(n+1))*8;e.push((t&255<<i)>>i)}return nt.Buffer.from(e).toString("hex")},Km=r=>{const t=r.consume(2);let e=0;for(let n=0;n<t.length;n++)e=e|t[n]<<(t.length-(n+1))*8;return e},Fm=r=>r.consume(1)[0]===255,zm=r=>{if(Fm(r))return uo(r)},lo=r=>{switch(r.substring(0,3)){case O.TZ1:return"00"+Gt(O.TZ1)(r);case O.TZ2:return"01"+Gt(O.TZ2)(r);case O.TZ3:return"02"+Gt(O.TZ3)(r);case O.TZ4:return"03"+Gt(O.TZ4)(r);default:throw new qs(r,V(k.NO_PREFIX_MATCHED)+` expecting one for the following "${O.TZ1}", "${O.TZ2}", "${O.TZ3}" or "${O.TZ4}".`)}},qm=r=>{switch(r.substring(0,4)){case O.EDPK:return"00"+Gt(O.EDPK)(r);case O.SPPK:return"01"+Gt(O.SPPK)(r);case O.P2PK:return"02"+Gt(O.P2PK)(r);default:throw new Jc(r,V(k.NO_PREFIX_MATCHED)+` expecting one of the following '${O.EDPK}', '${O.SPPK}', '${O.P2PK}' or '${O.BLPK}'.`)}},Wm=r=>{switch(r.substring(0,3)){case O.TZ1:case O.TZ2:case O.TZ3:case O.TZ4:return"00"+lo(r);case O.KT1:return"01"+Gt(O.KT1)(r)+"00";default:throw new at(r,V(k.NO_PREFIX_MATCHED)+` expecting one of the following prefix '${O.TZ1}', ${O.TZ2}', '${O.TZ3}', '${O.TZ4}' or '${O.KT1}'.`)}},Zm=r=>{if(r.substring(0,3)!==O.SR1)throw new Qu(r,V(k.NO_PREFIX_MATCHED)+` expecting prefix '${O.SR1}'.`);return Gt(O.SR1)(r)},Ym=r=>{if(r.substring(0,3)===O.KT1)return"01"+Gt(O.KT1)(r)+"00";throw new Dr(r,V(k.NO_PREFIX_MATCHED)+` expecting prefix '${O.KT1}'.`)},Xm=r=>{switch(r.consume(1)[0]){case 0:return Wt(O.EDPK)(r);case 1:return Wt(O.SPPK)(r);case 2:return Wt(O.P2PK)(r);default:throw new Jc(r.toString(),V(k.NO_PREFIX_MATCHED))}},Jm=r=>{if(r.substring(0,4)===O.SRC1)return Gt(O.SRC1)(r);throw new tl(r,V(k.NO_PREFIX_MATCHED)+` expecting prefix '${O.SRC1}'`)},Qm=r=>{switch(r.consume(1)[0]){case 0:return uo(r);case 1:{const e=Wt(O.KT1)(r);return r.consume(1),e}default:throw new at(r.toString(),": Unable to decode.")}},t0=r=>{const t=Wt(O.SR1)(r);if(t.substring(0,3)!==O.SR1)throw new Qu(t,V(k.NO_PREFIX_MATCHED)+` expecting prefix '${O.SR1}'.`);return t},e0=r=>{if(r.consume(1)[0]===1){const e=Wt(O.KT1)(r);return r.consume(1),e}throw new Dr(r.toString(),V(k.NO_PREFIX_MATCHED))},r0=r=>{const t=Wt(O.SRC1)(r);if(t.substring(0,4)!==O.SRC1)throw new tl(t,V(k.NO_PREFIX_MATCHED)+` expecting prefix '${O.SRC1}'`);return t},ho=r=>{const t=[];let e=new U(r,10);if(e.isNaN())throw new TypeError(`Invalid zarith number ${r}`);for(;;)if(e.lt(128)){e.lt(16)&&t.push("0"),t.push(e.toString(16));break}else{let n=e.mod(128);e=e.minus(n),e=e.dividedBy(128),n=n.plus(128),t.push(n.toString(16))}return t.join("")},po=r=>{let t=0;for(;t<r.length()&&r.get(t)&128;)t+=1;let e=new U(0);for(let n=t;n>=0;n-=1){const i=r.get(n)&127;e=e.multipliedBy(128),e=e.plus(i)}return r.consume(t+1),new U(e).toString()},n0=r=>{const t=vt(r.consume(1)[0],2);if(t in bi)return bi[t];{const e=ae(r,1),n=nt.Buffer.from(e).toString("utf8");if(n.length>co)throw new Xu(n);return n}},i0=r=>{if(r.consume(1)[0]!==0){const e=n0(r),n=ae(r),i=Rr(new ge(n));return{entrypoint:e,value:i}}},s0=r=>{if(r in lc)return`${lc[r]}`;if(r.length>co)throw new Xu(r);return`ff${Sr({string:r}).slice(8)}`},o0=r=>{if(!r||r.entrypoint==="default"&&"prim"in r.value&&r.value.prim==="Unit")return"00";const t=s0(r.entrypoint),e=Sr(r.value),n=(e.length/2).toString(16).padStart(8,"0");return`ff${t}${n}${e}`},a0=r=>{const t=Sr(r);return`${vt(t.length/2)}${t}`},c0=r=>{const t=ae(r);return Rr(new ge(t))},u0=Gt(O.VH),l0=Wt(O.VH),h0=r=>`${Sr({string:r}).slice(2)}`,d0=r=>{const t=ae(r);return nt.Buffer.from(t).toString("utf8")},p0=r=>"",f0=r=>({}),g0=Gt(O.TXR1),m0=Wt(O.TXR1),y0=r=>`${vt(r.length/2)}${r}`,b0=r=>{const t=ae(r);return nt.Buffer.from(t).toString("hex")},E0=r=>r?`ff${ho(r)}`:"00",v0=r=>{const t=r.consume(1);if(nt.Buffer.from(t).toString("hex")!=="00")return po(r)},w0=r=>r?`ff${ho(r)}`:"00",_0=r=>{const t=r.consume(1);if(nt.Buffer.from(t).toString("hex")!=="00")return po(r)},A0=(r,t=8)=>`${vt(r.length/2,t)}${r}`,S0=r=>{const t=ae(r);return nt.Buffer.from(t).toString("hex")},R0=r=>{const t=r.reduce((e,n)=>e+`${vt(n.length/2)}${n}`,"");return`${vt(t.length/2)}${t}`},O0=r=>{const t=ae(r);return bm(new ge(t)).map(n=>nt.Buffer.from(n).toString("hex"))},nl={branch:y.BRANCH,contents:[y.OPERATION]},fo={pkh:y.TZ1,secret:y.SECRET},go={source:y.PKH,fee:y.ZARITH,counter:y.ZARITH,gas_limit:y.ZARITH,storage_limit:y.ZARITH,public_key:y.PUBLIC_KEY},mo={source:y.PKH,fee:y.ZARITH,counter:y.ZARITH,gas_limit:y.ZARITH,storage_limit:y.ZARITH,delegate:y.DELEGATE},yo={source:y.PKH,fee:y.ZARITH,counter:y.ZARITH,gas_limit:y.ZARITH,storage_limit:y.ZARITH,amount:y.ZARITH,destination:y.ADDRESS,parameters:y.PARAMETERS},bo={source:y.PKH,fee:y.ZARITH,counter:y.ZARITH,gas_limit:y.ZARITH,storage_limit:y.ZARITH,balance:y.ZARITH,delegate:y.DELEGATE,script:y.SCRIPT},Eo={source:y.PKH,period:y.INT32,proposal:y.PROPOSAL,ballot:y.BALLOT_STATEMENT},vo={slot:y.INT16,level:y.INT32,round:y.INT32,block_payload_hash:y.BLOCK_PAYLOAD_HASH},wo={level:y.INT32,nonce:y.RAW},_o={source:y.PKH,period:y.INT32,proposals:y.PROPOSAL_ARR},Ao={source:y.PKH,fee:y.ZARITH,counter:y.ZARITH,gas_limit:y.ZARITH,storage_limit:y.ZARITH,value:y.VALUE},So={source:y.PKH,fee:y.ZARITH,counter:y.ZARITH,gas_limit:y.ZARITH,storage_limit:y.ZARITH,ticket_contents:y.VALUE,ticket_ty:y.VALUE,ticket_ticketer:y.ADDRESS,ticket_amount:y.ZARITH,destination:y.ADDRESS,entrypoint:y.ENTRYPOINT},Ro={source:y.PKH,fee:y.ZARITH,counter:y.ZARITH,gas_limit:y.ZARITH,storage_limit:y.ZARITH,tx_rollup_origination:y.TX_ROLLUP_ORIGINATION_PARAM},Oo={source:y.PKH,fee:y.ZARITH,counter:y.ZARITH,gas_limit:y.ZARITH,storage_limit:y.ZARITH,rollup:y.TX_ROLLUP_ID,content:y.TX_ROLLUP_BATCH_CONTENT,burn_limit:y.BURN_LIMIT},Po={source:y.PKH,fee:y.ZARITH,counter:y.ZARITH,gas_limit:y.ZARITH,storage_limit:y.ZARITH,amount:y.ZARITH,destination:y.SMART_CONTRACT_ADDRESS},To={source:y.PKH,fee:y.ZARITH,counter:y.ZARITH,gas_limit:y.ZARITH,storage_limit:y.ZARITH,pk:y.PUBLIC_KEY},Io={consensus_key:y.PKH,delegate:y.PKH,destination:y.PKH},No={source:y.PKH,fee:y.ZARITH,counter:y.ZARITH,gas_limit:y.ZARITH,storage_limit:y.ZARITH,limit:y.DEPOSITS_LIMIT},xo={source:y.PKH,fee:y.ZARITH,counter:y.ZARITH,gas_limit:y.ZARITH,storage_limit:y.ZARITH,pvm_kind:y.PVM_KIND,kernel:y.PADDED_BYTES,origination_proof:y.PADDED_BYTES,parameters_ty:y.VALUE},Lo={source:y.PKH,fee:y.ZARITH,counter:y.ZARITH,gas_limit:y.ZARITH,storage_limit:y.ZARITH,message:y.SMART_ROLLUP_MESSAGE},Co={source:y.PKH,fee:y.ZARITH,counter:y.ZARITH,gas_limit:y.ZARITH,storage_limit:y.ZARITH,rollup:y.SMART_ROLLUP_ADDRESS,cemented_commitment:y.SMART_ROLLUP_COMMITMENT_HASH,output_proof:y.PADDED_BYTES},P0=r=>t=>{if(!(t.kind in r)||!(t.kind in uc))throw new Ar(t.kind);return uc[t.kind]+r[t.kind](t)},T0=r=>t=>{const e=t.consume(1),n=xs[e[0]];if(n===void 0)throw new um(e[0].toString());const i=r[n](t);if(typeof i!="object")throw new Ju("Invalid operation, cannot be decoded.");return Object.assign({kind:n},i)},At=r=>t=>e=>Object.keys(t).reduce((i,s)=>{const o=t[s];if(e&&Array.isArray(o)){const a=r[o[0]],u=e[s];if(!Array.isArray(u))throw new cm(`Invalid operation value "${JSON.stringify(u)}" of key "${s}, expected value to be Array.`);return i+u.reduce((p,f)=>p+a(f),"")}else{const a=r[o];return i+a(e[s])}},""),St=r=>t=>e=>Object.keys(t).reduce((i,s)=>{const o=t[s];if(Array.isArray(o)){const a=r[o[0]],u=[],p=e.length();for(;e.length()>0;)if(u.push(a(e)),p===e.length())throw new Ju("Unable to decode value");return Object.assign(Object.assign({},i),{[s]:u})}else{const a=r[o],u=a(e);return typeof u<"u"?Object.assign(Object.assign({},i),{[s]:u}):Object.assign({},i)}},{}),F={[y.SECRET]:r=>cc(r.consume(20)),[y.RAW]:r=>cc(r.consume(32)),[y.TZ1]:Nm,[y.BRANCH]:xm,[y.ZARITH]:po,[y.PUBLIC_KEY]:Xm,[y.PKH]:uo,[y.DELEGATE]:zm,[y.INT32]:Vm,[y.SCRIPT]:ym,[y.BALLOT_STATEMENT]:Bm,[y.PROPOSAL]:rl,[y.PROPOSAL_ARR]:Dm,[y.PARAMETERS]:i0,[y.ADDRESS]:Qm,[y.SMART_ROLLUP_ADDRESS]:t0,[y.SMART_CONTRACT_ADDRESS]:e0,[y.SMART_ROLLUP_COMMITMENT_HASH]:r0,[y.VALUE]:c0,[y.INT16]:Km,[y.BLOCK_PAYLOAD_HASH]:l0,[y.ENTRYPOINT]:d0,[y.TX_ROLLUP_ORIGINATION_PARAM]:f0,[y.TX_ROLLUP_ID]:m0,[y.TX_ROLLUP_BATCH_CONTENT]:b0,[y.BURN_LIMIT]:v0,[y.DEPOSITS_LIMIT]:_0,[y.PVM_KIND]:Hm,[y.PADDED_BYTES]:S0,[y.SMART_ROLLUP_MESSAGE]:O0};F[y.OPERATION]=T0(F);F[y.OP_ACTIVATE_ACCOUNT]=r=>St(F)(fo)(r);F[y.OP_DELEGATION]=r=>St(F)(mo)(r);F[y.OP_TRANSACTION]=r=>St(F)(yo)(r);F[y.OP_ORIGINATION]=r=>St(F)(bo)(r);F[y.OP_BALLOT]=r=>St(F)(Eo)(r);F[y.OP_ENDORSEMENT]=r=>St(F)(vo)(r);F[y.OP_SEED_NONCE_REVELATION]=r=>St(F)(wo)(r);F[y.OP_PROPOSALS]=r=>St(F)(_o)(r);F[y.OP_REVEAL]=r=>St(F)(go)(r);F[y.OP_REGISTER_GLOBAL_CONSTANT]=r=>St(F)(Ao)(r);F[y.OP_TRANSFER_TICKET]=r=>St(F)(So)(r);F[y.OP_TX_ROLLUP_ORIGINATION]=r=>St(F)(Ro)(r);F[y.OP_TX_ROLLUP_SUBMIT_BATCH]=r=>St(F)(Oo)(r);F[y.OP_INCREASE_PAID_STORAGE]=r=>St(F)(Po)(r);F[y.OP_UPDATE_CONSENSUS_KEY]=r=>St(F)(To)(r);F[y.OP_DRAIN_DELEGATE]=r=>St(F)(Io)(r);F[y.OP_SMART_ROLLUP_ORIGINATE]=r=>St(F)(xo)(r);F[y.OP_SMART_ROLLUP_ADD_MESSAGES]=r=>St(F)(Lo)(r);F[y.OP_SMART_ROLLUP_EXECUTE_OUTBOX_MESSAGE]=r=>St(F)(Co)(r);F[y.MANAGER]=St(F)(nl);F[y.OP_SET_DEPOSITS_LIMIT]=r=>St(F)(No)(r);const z={[y.SECRET]:r=>r,[y.RAW]:r=>r,[y.TZ1]:Cm,[y.BRANCH]:Lm,[y.ZARITH]:ho,[y.PUBLIC_KEY]:qm,[y.PKH]:lo,[y.DELEGATE]:$m,[y.SCRIPT]:mm,[y.BALLOT_STATEMENT]:km,[y.PROPOSAL]:el,[y.PROPOSAL_ARR]:Mm,[y.INT32]:jm,[y.PARAMETERS]:o0,[y.ADDRESS]:Wm,[y.SMART_ROLLUP_ADDRESS]:Zm,[y.SMART_CONTRACT_ADDRESS]:Ym,[y.SMART_ROLLUP_COMMITMENT_HASH]:Jm,[y.VALUE]:a0,[y.INT16]:Gm,[y.BLOCK_PAYLOAD_HASH]:u0,[y.ENTRYPOINT]:h0,[y.TX_ROLLUP_ORIGINATION_PARAM]:p0,[y.TX_ROLLUP_ID]:g0,[y.TX_ROLLUP_BATCH_CONTENT]:y0,[y.BURN_LIMIT]:E0,[y.DEPOSITS_LIMIT]:w0,[y.PVM_KIND]:Um,[y.PADDED_BYTES]:A0,[y.SMART_ROLLUP_MESSAGE]:R0};z[y.OPERATION]=P0(z);z[y.OP_ACTIVATE_ACCOUNT]=r=>At(z)(fo)(r);z[y.OP_DELEGATION]=r=>At(z)(mo)(r);z[y.OP_TRANSACTION]=r=>At(z)(yo)(r);z[y.OP_ORIGINATION]=r=>At(z)(bo)(r);z[y.OP_BALLOT]=r=>At(z)(Eo)(r);z[y.OP_ENDORSEMENT]=r=>At(z)(vo)(r);z[y.OP_SEED_NONCE_REVELATION]=r=>At(z)(wo)(r);z[y.OP_PROPOSALS]=r=>At(z)(_o)(r);z[y.OP_REVEAL]=r=>At(z)(go)(r);z[y.OP_REGISTER_GLOBAL_CONSTANT]=r=>At(z)(Ao)(r);z[y.OP_TRANSFER_TICKET]=r=>At(z)(So)(r);z[y.OP_TX_ROLLUP_ORIGINATION]=r=>At(z)(Ro)(r);z[y.OP_TX_ROLLUP_SUBMIT_BATCH]=r=>At(z)(Oo)(r);z[y.OP_INCREASE_PAID_STORAGE]=r=>At(z)(Po)(r);z[y.OP_UPDATE_CONSENSUS_KEY]=r=>At(z)(To)(r);z[y.OP_DRAIN_DELEGATE]=r=>At(z)(Io)(r);z[y.OP_SMART_ROLLUP_ORIGINATE]=r=>At(z)(xo)(r);z[y.OP_SMART_ROLLUP_ADD_MESSAGES]=r=>At(z)(Lo)(r);z[y.OP_SMART_ROLLUP_EXECUTE_OUTBOX_MESSAGE]=r=>At(z)(Co)(r);z[y.MANAGER]=At(z)(nl);z[y.OP_SET_DEPOSITS_LIMIT]=r=>At(z)(No)(r);const il={activate_account:fo,reveal:go,delegation:mo,transaction:yo,origination:bo,ballot:Eo,endorsement:vo,seed_nonce_revelation:wo,proposals:_o,register_global_constant:Ao,transfer_ticket:So,tx_rollup_origination:Ro,tx_rollup_submit_batch:Oo,increase_paid_storage:Po,update_consensus_key:To,drain_delegate:Io,set_deposits_limit:No,smart_rollup_originate:xo,smart_rollup_add_messages:Lo,smart_rollup_execute_outbox_message:Co},I0=(r,t)=>t.filter(e=>!r.includes(e)),N0=(r,t)=>r.filter(e=>e!==t),x0=r=>Object.keys(il).includes(r),L0=r=>{const t=r.kind,e=Object.keys(r),n=N0(e,"kind"),i=Object.keys(il[t]);return I0(n,i)};var Ls;(function(r){r.Pt24m4xi="Pt24m4xiPbLDhVgVfABUjirbmda3yohdN82Sp9FeuAXJ4eV9otd",r.PsBABY5H="PsBABY5HQTSkA4297zNHfsZNKtxULfL18y95qb3m53QJiXGmrbU",r.PsBabyM1="PsBabyM1eUXZseaJdmXFApDSBqj8YBfwELoxZHHW77EMcAbbwAS",r.PsCARTHA="PsCARTHAGazKbHtnKfLzQg3kms52kSRpgnDY982a9oYsSXRLQEb",r.PsDELPH1="PsDELPH1Kxsxt8f9eWbxQeRxkjfbxoqM52jvs5Y5fBxWWh4ifpo",r.PtEdo2Zk="PtEdo2ZkT9oKpimTah6x2embF25oss54njMuPzkJTEi5RqfdZFA",r.PsFLorena="PsFLorenaUUuikDWvMDr6fGBRG8kt3e3D3fHoXK1j1BFRxeSH4i",r.PtGRANADs="PtGRANADsDU8R9daYKAgWnQYAJ64omN1o3KMGVCykShA97vQbvV",r.PtHangz2="PtHangz2aRngywmSRGGvrcTyMbbdpWdpFKuS4uMWxg2RaH9i1qx",r.Psithaca2="Psithaca2MLRFYargivpo7YvUr7wUDqyxrdhC5CQq78mRvimz6A",r.PtJakart2="PtJakart2xVj7pYXJBXrqHgd82rdkLey5ZeeGwDgPp9rhQUbSqY",r.PtKathman="PtKathmankSpLLDALzWw7CGD2j2MtyveTwboEYokqUCP4a1LxMg",r.PtLimaPtL="PtLimaPtLMwfNinJi9rCfDPWea8dFgTZ1MeJ9f1m2SRic6ayiwW",r.PtMumbaii="PtMumbaiiFFEGbew1rRjzSPyzRbA51Tm3RVZL5suHPxSZYDhCEc",r.PtMumbai2="PtMumbai2TmsJHNGRkD8v8YDbtao7BLUC3wjASn1inAKLFCjaH1",r.ProtoALpha="ProtoALphaALphaALphaALphaALphaALphaALphaALphaDdp3zK"})(Ls||(Ls={}));const C0=Ls.PtMumbai2;function D0(r,t){return{encoder:z[r],decoder:e=>{const n=ge.fromHexString(e);return F[r](n)}}}class sl{constructor(t=C0){this.protocolHash=t,this.codec=D0(y.MANAGER,this.protocolHash)}forge(t){const e=Ud(t.branch);if(e!==k.VALID)throw new Rd(t.branch,V(e));for(const i of t.contents){if(!x0(i.kind))throw new Ar(i.kind);const s=L0(i);if(s.length===1){if(i.kind==="delegation"&&s[0]==="delegate")continue;if(i.kind==="origination"&&s[0]==="delegate")continue;if(i.kind==="transaction"&&s[0]==="parameters")continue;if(i.kind==="set_deposits_limit"&&s[0]==="limit")continue;if(i.kind==="tx_rollup_submit_batch"&&s[0]==="burn_limit")continue;throw new hc(i,`missing properties "${s.join(", ")}"`)}else if(s.length>1)throw new hc(i,`missing properties "${s.join(", ")}"`)}const n=this.codec.encoder(t).toLowerCase();return Promise.resolve(n)}parse(t){return Promise.resolve(this.codec.decoder(t))}}new sl;function $t(r,t){var e={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&t.indexOf(n)<0&&(e[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,n=Object.getOwnPropertySymbols(r);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(r,n[i])&&(e[n[i]]=r[n[i]]);return e}function A(r,t,e,n){function i(s){return s instanceof e?s:new e(function(o){o(s)})}return new(e||(e=Promise))(function(s,o){function a(f){try{p(n.next(f))}catch(m){o(m)}}function u(f){try{p(n.throw(f))}catch(m){o(m)}}function p(f){f.done?s(f.value):i(f.value).then(a,u)}p((n=n.apply(r,t||[])).next())})}function qn(r,t,e,n){if(e==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?r!==t||!n:!t.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return e==="m"?n:e==="a"?n.call(r):n?n.value:t.get(r)}function xt(r,t,e,n,i){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!i)throw new TypeError("Private accessor was defined without a setter");if(typeof t=="function"?r!==t||!i:!t.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?i.call(r,e):i?i.value=e:t.set(r,e),e}function M0(r,t){const e=JSON.parse(r.body);if(e[0]&&e[0].kind&&e[0].msg){const n=JSON.stringify({kind:e[0].kind,id:e[0].id,msg:e[0].msg.replace(t,"")});return new on(`Http error response: (${r.status}) ${n}`,r.status,r.statusText,n,r.url)}else return r}class k0{constructor(t){this.context=t}inject(t){return A(this,void 0,void 0,function*(){let e;try{e=yield this.context.rpc.injectOperation(t)}catch(n){const i=". You may want to use --replace to provide adequate fee and replace it";throw n instanceof on&&n.message.includes(i)?M0(n,i):n}return e})}}class Wn extends Error{constructor(){super("No signer has been configured. Please configure one by calling setProvider({signer}) on your TezosToolkit instance."),this.name="UnconfiguredSignerError"}}class Cs{publicKey(){return A(this,void 0,void 0,function*(){throw new Wn})}publicKeyHash(){return A(this,void 0,void 0,function*(){throw new Wn})}secretKey(){return A(this,void 0,void 0,function*(){throw new Wn})}sign(t,e){return A(this,void 0,void 0,function*(){throw new Wn})}}function ol(r){return new gt(t=>(r.on("data",e=>{t.next(e)}),r.on("error",e=>{t.error(e)}),r.on("close",()=>{t.complete()}),()=>{r.close()}))}var $e;(function(r){r[r.DELEGATION=10600]="DELEGATION",r[r.ORIGINATION=10600]="ORIGINATION",r[r.TRANSFER=10600]="TRANSFER",r[r.REVEAL=1100]="REVEAL"})($e||($e={}));var je;(function(r){r[r.DELEGATION=1257]="DELEGATION",r[r.ORIGINATION=1e4]="ORIGINATION",r[r.TRANSFER=1e4]="TRANSFER",r[r.REVEAL=374]="REVEAL"})(je||(je={}));var Ve;(function(r){r[r.DELEGATION=0]="DELEGATION",r[r.ORIGINATION=257]="ORIGINATION",r[r.TRANSFER=257]="TRANSFER",r[r.REVEAL=0]="REVEAL"})(Ve||(Ve={}));const al=250;var Rt;(function(r){r.Pt24m4xi="Pt24m4xiPbLDhVgVfABUjirbmda3yohdN82Sp9FeuAXJ4eV9otd",r.PsBABY5H="PsBABY5HQTSkA4297zNHfsZNKtxULfL18y95qb3m53QJiXGmrbU",r.PsBabyM1="PsBabyM1eUXZseaJdmXFApDSBqj8YBfwELoxZHHW77EMcAbbwAS",r.PsCARTHA="PsCARTHAGazKbHtnKfLzQg3kms52kSRpgnDY982a9oYsSXRLQEb",r.PsDELPH1="PsDELPH1Kxsxt8f9eWbxQeRxkjfbxoqM52jvs5Y5fBxWWh4ifpo",r.PtEdo2Zk="PtEdo2ZkT9oKpimTah6x2embF25oss54njMuPzkJTEi5RqfdZFA",r.PsFLorena="PsFLorenaUUuikDWvMDr6fGBRG8kt3e3D3fHoXK1j1BFRxeSH4i",r.PtGRANADs="PtGRANADsDU8R9daYKAgWnQYAJ64omN1o3KMGVCykShA97vQbvV",r.PtHangz2="PtHangz2aRngywmSRGGvrcTyMbbdpWdpFKuS4uMWxg2RaH9i1qx",r.PsiThaCa="PsiThaCaT47Zboaw71QWScM8sXeMM7bbQFncK9FLqYc6EKdpjVP",r.Psithaca2="Psithaca2MLRFYargivpo7YvUr7wUDqyxrdhC5CQq78mRvimz6A",r.PtJakart2="PtJakart2xVj7pYXJBXrqHgd82rdkLey5ZeeGwDgPp9rhQUbSqY",r.PtKathman="PtKathmankSpLLDALzWw7CGD2j2MtyveTwboEYokqUCP4a1LxMg",r.PtLimaPtL="PtLimaPtLMwfNinJi9rCfDPWea8dFgTZ1MeJ9f1m2SRic6ayiwW",r.PtMumbaii="PtMumbaiiFFEGbew1rRjzSPyzRbA51Tm3RVZL5suHPxSZYDhCEc",r.PtMumbai2="PtMumbai2TmsJHNGRkD8v8YDbtao7BLUC3wjASn1inAKLFCjaH1",r.ProtoALpha="ProtoALphaALphaALphaALphaALphaALphaALphaALphaDdp3zK"})(Rt||(Rt={}));const B0={"004":[Rt.Pt24m4xi],"005":[Rt.PsBABY5H,Rt.PsBabyM1],"006":[Rt.PsCARTHA],"007":[Rt.PsDELPH1],"008":[Rt.PtEdo2Zk],"009":[Rt.PsFLorena],"010":[Rt.PtGRANADs],"011":[Rt.PtHangz2],"012":[Rt.PsiThaCa,Rt.Psithaca2],"013":[Rt.PtJakart2],"014":[Rt.PtKathman],"015":[Rt.PtLimaPtL],"016":[Rt.PtMumbai2],"017":[Rt.ProtoALpha]};var Ds;(function(r){r.MAINNET="NetXdQprcVkpaWU",r.CARTHAGENET="NetXjD3HPJJjmcd",r.DELPHINET="NetXm8tYqnMWky1",r.EDONET="NetXSgo1ZT2DRUG",r.FLORENCENET="NetXxkAx4woPLyu",r.GRANADANET="NetXz969SFaFn8k",r.HANGZHOUNET="NetXZSsxBpMQeAT",r.ITHACANET="NetXbhmtAbMukLc",r.ITHACANET2="NetXnHfVqm9iesp",r.JAKARTANET2="NetXLH1uAxK7CCh",r.KATHMANDUNET="NetXazhm4yetmff",r.LIMANET="NetXizpkH94bocH",r.MUMBAINET="NetXQw6nWSnrJ5t",r.MUMBAINET2="NetXgbcrNtXD2yA"})(Ds||(Ds={}));class Do extends Error{constructor(t,e,n){super(`${t} Received ${n.length} arguments while expecting one of the following signatures (${JSON.stringify(e)})`),this.smartContractMethodName=t,this.sigs=e,this.args=n,this.name="Invalid parameters error"}}class cl extends Error{constructor(t){super(`Since Babylon delegation source can no longer be a contract address ${t}. Please use the smart contract abstraction to set your delegate.`),this.source=t,this.name="Invalid delegation source error"}}class Rn extends Error{constructor(t,e){super(t),this.message=t,this.data=e,this.name="InvalidCodeParameter"}}class Mo extends Error{constructor(t,e){super(t),this.message=t,this.data=e,this.name="InvalidInitParameter"}}class ul extends Error{constructor(t,e,n,i){super(t),this.message=t,this.viewName=e,this.failWith=n,this.originalError=i,this.name="ViewSimulationError"}}const ll=r=>{if(U0(r.body)){const t=JSON.parse(r.body);if(Array.isArray(t)&&"with"in t[t.length-1])return t[t.length-1].with}},U0=r=>{try{JSON.parse(r)}catch{return!1}return!0};class Ms extends Error{constructor(t){super(`${t} Please configure the context of the view execution in the executeView method.`),this.info=t,this.name="InvalidViewSimulationContext"}}class hl extends Error{constructor(t){super(t),this.message=t,this.name="RevealOperationError"}}class dl extends Error{constructor(t){super(t),this.message=t,this.name="OriginationParameterError"}}class pl extends Error{constructor(t){super(t),this.message=t,this.name="IntegerError"}}const fl=({pkh:r,secret:t})=>A(void 0,void 0,void 0,function*(){return{kind:I.ACTIVATION,pkh:r,secret:t}}),xi=({code:r,init:t,balance:e="0",delegate:n,storage:i,fee:s=je.ORIGINATION,gasLimit:o=$e.ORIGINATION,storageLimit:a=Ve.ORIGINATION,mutez:u=!1})=>A(void 0,void 0,void 0,function*(){if(i!==void 0&&t!==void 0)throw new dl("Storage and Init cannot be set a the same time. Please either use storage or init but not both.");if(!Array.isArray(r))throw new Rn("Wrong code parameter type, expected an array",r);let p;if(i!==void 0){const N=r.find(x=>"prim"in x&&x.prim==="storage");if((N==null?void 0:N.args)===void 0)throw new Rn("The storage section is missing from the script",r);p=new ne(N.args[0]).Encode(i)}else if(t!==void 0&&typeof t=="object")p=t;else throw new Mo("Wrong init parameter type, expected JSON Michelson",t);const f={code:r,storage:p};if(isNaN(Number(e)))throw new pl(`Unexpected Invalid Integer ${e}`);const m={kind:I.ORIGINATION,fee:s,gas_limit:o,storage_limit:a,balance:u?e.toString():Zs("tz","mutez",e).toString(),script:f};return n&&(m.delegate=n),m}),Li=({to:r,amount:t,parameter:e,fee:n=je.TRANSFER,gasLimit:i=$e.TRANSFER,storageLimit:s=Ve.TRANSFER,mutez:o=!1})=>A(void 0,void 0,void 0,function*(){return{kind:I.TRANSACTION,fee:n,gas_limit:i,storage_limit:s,amount:o?t.toString():Zs("tz","mutez",t).toString(),destination:r,parameters:e}}),Ci=({delegate:r,source:t,fee:e=je.DELEGATION,gasLimit:n=$e.DELEGATION,storageLimit:i=Ve.DELEGATION})=>A(void 0,void 0,void 0,function*(){return{kind:I.DELEGATION,source:t,fee:e,gas_limit:n,storage_limit:i,delegate:r}}),gl=({fee:r=je.DELEGATION,gasLimit:t=$e.DELEGATION,storageLimit:e=Ve.DELEGATION},n)=>A(void 0,void 0,void 0,function*(){return{kind:I.DELEGATION,fee:r,gas_limit:t,storage_limit:e,delegate:n}}),si=({fee:r=je.REVEAL,gasLimit:t=$e.REVEAL,storageLimit:e=Ve.REVEAL},n,i)=>A(void 0,void 0,void 0,function*(){return{kind:I.REVEAL,fee:r,public_key:i,source:n,gas_limit:t,storage_limit:e}}),Di=({value:r,source:t,fee:e,gasLimit:n,storageLimit:i})=>A(void 0,void 0,void 0,function*(){return{kind:I.REGISTER_GLOBAL_CONSTANT,value:r,fee:e,gas_limit:n,storage_limit:i,source:t}}),Mi=({ticketContents:r,ticketTy:t,ticketTicketer:e,ticketAmount:n,destination:i,entrypoint:s,source:o,fee:a,gasLimit:u,storageLimit:p})=>A(void 0,void 0,void 0,function*(){return{kind:I.TRANSFER_TICKET,fee:a,gas_limit:u,storage_limit:p,source:o,ticket_contents:r,ticket_ty:t,ticket_ticketer:e,ticket_amount:n,destination:i,entrypoint:s}}),ki=({source:r,fee:t,gasLimit:e,storageLimit:n,amount:i,destination:s})=>A(void 0,void 0,void 0,function*(){return{kind:I.INCREASE_PAID_STORAGE,source:r,fee:t,gas_limit:e,storage_limit:n,amount:i,destination:s}}),ml=({consensus_key:r,delegate:t,destination:e})=>A(void 0,void 0,void 0,function*(){return{kind:I.DRAIN_DELEGATE,consensus_key:r,delegate:t,destination:e}}),yl=({source:r,proposal:t,ballot:e})=>A(void 0,void 0,void 0,function*(){return{kind:I.BALLOT,source:r,proposal:t,ballot:e}}),bl=({source:r,proposals:t})=>A(void 0,void 0,void 0,function*(){return{kind:I.PROPOSALS,source:r,proposals:t}}),El=({source:r,fee:t,gasLimit:e,storageLimit:n,pk:i})=>A(void 0,void 0,void 0,function*(){return{kind:I.UPDATE_CONSENSUS_KEY,source:r,fee:t,gas_limit:e,storage_limit:n,pk:i}}),Bi=({source:r,fee:t,gasLimit:e,storageLimit:n,message:i})=>A(void 0,void 0,void 0,function*(){return{kind:I.SMART_ROLLUP_ADD_MESSAGES,source:r,fee:t,gas_limit:e,storage_limit:n,message:i}}),Ui=({source:r,fee:t,gasLimit:e,storageLimit:n,pvmKind:i,kernel:s,originationProof:o,parametersType:a})=>A(void 0,void 0,void 0,function*(){return{kind:I.SMART_ROLLUP_ORIGINATE,source:r,fee:t,gas_limit:e,storage_limit:n,pvm_kind:i,kernel:s,origination_proof:o,parameters_ty:a}}),Zn=(r,t)=>Object.assign(Object.assign({},r),{kind:t}),fc=(r,t)=>{if(Array.isArray(r)){const e=r.find(n=>n.kind===t);if(e&&H0(e,t))return e}},H0=(r,t)=>r.kind===t,ks=r=>["transaction","delegation","origination","reveal","register_global_constant","increase_paid_storage","tx_rollup_origination","tx_rollup_submit_batch","transfer_ticket","update_consensus_key","smart_rollup_add_messages","smart_rollup_originate"].indexOf(r.kind)!==-1,vl=r=>["transaction","delegation","origination","register_global_constant","increase_paid_storage","tx_rollup_origination","tx_rollup_submit_batch","transfer_ticket","update_consensus_key","smart_rollup_add_messages","smart_rollup_originate"].indexOf(r.kind)!==-1,ko=r=>"metadata"in r,un=r=>ko(r)&&"operation_result"in r.metadata,$0=r=>ko(r)&&"internal_operation_results"in r.metadata,j0=r=>"with"in r;class Bo extends Error{constructor(t,e){super(),this.errors=t,this.errorDetails=e,this.name="TezosOperationError";const n=t[t.length-1];this.id=n.id,this.kind=n.kind,this.message=`(${this.kind}) ${this.id}`,j0(n)&&(n.with.string?this.message=n.with.string:n.with.int?this.message=n.with.int:this.message=JSON.stringify(n.with))}}class wl extends Error{constructor(t){super("Preapply returned an unexpected result"),this.result=t,this.name="TezosPreapplyFailureError"}}const Ue=r=>{const t=Array.isArray(r)?r:[r],e=[];for(let n=0;n<t.length;n++)for(let i=0;i<t[n].contents.length;i++){const s=t[n].contents[i];un(s)&&(e.push(Object.assign({fee:s.fee},s.metadata.operation_result)),Array.isArray(s.metadata.internal_operation_results)&&s.metadata.internal_operation_results.forEach(o=>e.push(o.result)))}return e},sn=(r,t="failed")=>{const e=Array.isArray(r)?r:[r];let n=[];for(let i=0;i<e.length;i++)for(let s=0;s<e[i].contents.length;s++){const o=e[i].contents[s];if(ko(o)&&(un(o)&&o.metadata.operation_result.status===t&&(n=n.concat(o.metadata.operation_result.errors||[])),$0(o)&&Array.isArray(o.metadata.internal_operation_results)))for(const a of o.metadata.internal_operation_results)"result"in a&&a.result.status===t&&(n=n.concat(a.result.errors||[]))}return n};class V0 extends Error{constructor(t){super(t),this.message=t,this.name="OriginationOperationError"}}class oi extends Error{constructor(t){super(t),this.message=t,this.name="InvalidEstimateValueError"}}class _l extends Error{constructor(t){super(t),this.message=t,this.name="InvalidConfirmationCountError"}}class G0 extends Error{constructor(t){super(t),this.message=t,this.name="ConfirmationUndefinedError"}}class K0 extends Error{constructor(t){super(t),this.message=t,this.name="InvalidFilterExpressionError"}}class Yn extends Error{constructor(t){super(t),this.message=t,this.name="RPCResponseError"}}class F0 extends Error{constructor(){super("Unable to retrieve public key from signer. If you are using a wallet, make sure your account is revealed"),this.name="PublicKeyNotFoundError"}}class Kt{constructor(t,e,n,i){if(this.hash=t,this.raw=e,this.results=n,this.context=i,this._pollingConfig$=new An(1),this.currentHead$=this._pollingConfig$.pipe(ke(s=>new Oi(s).pipe(Au(s.timeout*1e3,to(new Error("Confirmation polling timed out"))))),ke(()=>Eu(()=>ol(this.context.stream.subscribeBlock("head"))).pipe(ke(s=>{var o,a;const u=(a=(o=this.lastHead)===null||o===void 0?void 0:o.header.level)!==null&&a!==void 0?a:s.header.level-1;return ro(u+1,s.header.level-u-1).pipe(Cn(p=>this.context.readProvider.getBlock(p)),wu(s))}),pi(s=>this.lastHead=s))),Ka({refCount:!0})),this.confirmed$=this.currentHead$.pipe(Mr(s=>{for(let o=3;o>=0;o--)s.operations[o].forEach(a=>{a.hash===this.hash&&(this._foundAt=s.header.level)});if(s.header.level-this._foundAt>=0)return this._foundAt}),di(s=>s!==void 0),er(),Ka()),this._foundAt=Number.POSITIVE_INFINITY,su(this.hash)!==k.VALID)throw new Qc(this.hash);this.confirmed$.pipe(er(),no(()=>an(du))).subscribe()}get includedInBlock(){return this._foundAt}get revealOperation(){return Array.isArray(this.results)&&this.results.find(t=>t.kind==="reveal")}get revealStatus(){return this.revealOperation?this.revealOperation.metadata.operation_result.status:"unknown"}get status(){return this.results.map(t=>un(t)?t.metadata.operation_result.status:"unknown")[0]||"unknown"}confirmation(t,e){return A(this,void 0,void 0,function*(){if(typeof t<"u"&&t<1)throw new _l("Confirmation count must be at least 1");const{defaultConfirmationCount:n,confirmationPollingTimeoutSecond:i}=this.context.config;this._pollingConfig$.next({timeout:e||i});const s=t!==void 0?t:n;return new Promise((o,a)=>{this.confirmed$.pipe(ke(()=>this.currentHead$),di(u=>u.header.level-this._foundAt>=s-1),er()).subscribe(u=>{o(this._foundAt+(s-1))},a)})})}}class Al extends Kt{constructor(t,e,n,i,s,o){super(t,i,s,o),this.params=e,this.source=n}sumProp(t,e){return t.reduce((n,i)=>e in i?Number(i[e])+n:n,0)}getOriginatedContractAddresses(){const t=this.results.filter(n=>n.kind==="origination");let e=[];for(const n of t)n.metadata.operation_result.originated_contracts&&(e=[...e,...n.metadata.operation_result.originated_contracts]);return e}get status(){return this.results.filter(t=>Cl.indexOf(t.kind)!==-1).map(t=>un(t)?t.metadata.operation_result.status:"unknown")[0]||"unknown"}get fee(){return this.sumProp(this.params,"fee")}get gasLimit(){return this.sumProp(this.params,"gas_limit")}get storageLimit(){return this.sumProp(this.params,"storage_limit")}get consumedGas(){return U.config({DECIMAL_PLACES:0,ROUNDING_MODE:U.ROUND_UP}),new U(this.consumedMilliGas).dividedBy(1e3).toString()}get consumedMilliGas(){return String(this.sumProp(Ue({contents:this.results}),"consumed_milligas"))}get storageDiff(){return String(this.sumProp(Ue({contents:this.results}),"paid_storage_size_diff"))}get errors(){return sn({contents:this.results})}}class Dn{constructor(t){this.context=t}get rpc(){return this.context.rpc}get signer(){return this.context.signer}forge({opOb:{branch:t,contents:e,protocol:n},counter:i}){return A(this,void 0,void 0,function*(){return{opbytes:yield this.context.forger.forge({branch:t,contents:e}),opOb:{branch:t,contents:e,protocol:n},counter:i}})}estimate(t,e){var{fee:n,gasLimit:i,storageLimit:s}=t,o=$t(t,["fee","gasLimit","storageLimit"]);return A(this,void 0,void 0,function*(){let a=n,u=i,p=s;if(a&&a%1!==0)throw new oi(`Fee value must not be a decimal: ${a}`);if(u&&u%1!==0)throw new oi(`Gas Limit value must not be a decimal: ${u}`);if(p&&p%1!==0)throw new oi(`Storage Limit value must not be a decimal: ${p}`);if(n===void 0||i===void 0||s===void 0){const f=yield e(Object.assign({fee:n,gasLimit:i,storageLimit:s},o));a??(a=f.suggestedFeeMutez),u??(u=f.gasLimit),p??(p=f.storageLimit)}return{fee:a,gasLimit:u,storageLimit:p}})}getRPCOp(t){return A(this,void 0,void 0,function*(){switch(t.kind){case I.TRANSACTION:return Li(Object.assign({},t));case I.ORIGINATION:return xi(yield this.context.parser.prepareCodeOrigination(Object.assign({},t)));case I.DELEGATION:return Ci(Object.assign({},t));case I.REGISTER_GLOBAL_CONSTANT:return Di(Object.assign({},t));case I.INCREASE_PAID_STORAGE:return ki(Object.assign({},t));case I.TRANSFER_TICKET:return Mi(Object.assign({},t));case I.SMART_ROLLUP_ADD_MESSAGES:return Bi(Object.assign({},t));case I.SMART_ROLLUP_ORIGINATE:return Ui(Object.assign({},t));default:throw new Ar(t.kind)}})}simulate(t){return A(this,void 0,void 0,function*(){return{opResponse:yield this.rpc.runOperation(t),op:t,context:this.context.clone()}})}isRevealOpNeeded(t,e){return A(this,void 0,void 0,function*(){return!(!(yield this.isAccountRevealRequired(e))||!this.isRevealRequiredForOpType(t))})}isAccountRevealRequired(t){return A(this,void 0,void 0,function*(){return!(yield this.context.readProvider.isAccountRevealed(t,"head"))})}isRevealRequiredForOpType(t){let e=!1;for(const n of t)vl(n)&&(e=!0);return e}signAndInject(t){return A(this,void 0,void 0,function*(){const e=yield this.signer.sign(t.opbytes,new Uint8Array([3]));t.opbytes=e.sbytes,t.opOb.signature=e.prefixSig;const n=[],i=yield this.rpc.preapplyOperations([t.opOb]);if(!Array.isArray(i))throw new wl(i);for(let o=0;o<i.length;o++)for(let a=0;a<i[o].contents.length;a++)n.push(i[o].contents[a]);const s=sn(i);if(s.length)throw new Bo(s,"Error occurred during validation simulation of operation");return{hash:yield this.context.injector.inject(t.opbytes),forgedBytes:t,opResponse:n,context:this.context.clone()}})}}class Sl{constructor(t,e){this.walletProvider=t,this.context=e,this.operations=[]}withTransfer(t){const e=rt(t.to);if(e!==k.VALID)throw new at(t.to,V(e));return this.operations.push(Object.assign({kind:I.TRANSACTION},t)),this}withContractCall(t,e={}){return this.withTransfer(t.toTransferParams(e))}withDelegation(t){var e;const n=rt((e=t.delegate)!==null&&e!==void 0?e:"");if(t.delegate&&n!==k.VALID)throw new at(t.delegate,V(n));return this.operations.push(Object.assign({kind:I.DELEGATION},t)),this}withOrigination(t){return this.operations.push(Object.assign({kind:I.ORIGINATION},t)),this}withIncreasePaidStorage(t){const e=rt(t.destination);if(e!==k.VALID)throw new at(t.destination,V(e));return this.operations.push(Object.assign({kind:I.INCREASE_PAID_STORAGE},t)),this}mapOperation(t){return A(this,void 0,void 0,function*(){switch(t.kind){case I.TRANSACTION:return this.walletProvider.mapTransferParamsToWalletParams(()=>A(this,void 0,void 0,function*(){return t}));case I.ORIGINATION:return this.walletProvider.mapOriginateParamsToWalletParams(()=>A(this,void 0,void 0,function*(){return this.context.parser.prepareCodeOrigination(Object.assign({},t))}));case I.DELEGATION:return this.walletProvider.mapDelegateParamsToWalletParams(()=>A(this,void 0,void 0,function*(){return t}));case I.INCREASE_PAID_STORAGE:return this.walletProvider.mapIncreasePaidStorageWalletParams(()=>A(this,void 0,void 0,function*(){return t}));default:throw new Ar(JSON.stringify(t.kind))}})}with(t){for(const e of t)switch(e.kind){case I.TRANSACTION:this.withTransfer(e);break;case I.ORIGINATION:this.withOrigination(e);break;case I.DELEGATION:this.withDelegation(e);break;case I.INCREASE_PAID_STORAGE:this.withIncreasePaidStorage(e);break;default:throw new Ar(JSON.stringify(e.kind))}return this}send(){return A(this,void 0,void 0,function*(){const t=[];for(const n of this.operations)t.push(yield this.mapOperation(n));const e=yield this.walletProvider.sendOperations(t);return this.context.operationFactory.createBatchOperation(e)})}}class Mn{constructor(t){this.context=t,this.walletCommand=e=>({send:e})}get walletProvider(){return this.context.walletProvider}pkh({forceRefetch:t}={}){return A(this,void 0,void 0,function*(){return(!this._pkh||t)&&(this._pkh=yield this.walletProvider.getPKH()),this._pkh})}originate(t){return this.walletCommand(()=>A(this,void 0,void 0,function*(){const e=yield this.walletProvider.mapOriginateParamsToWalletParams(()=>this.context.parser.prepareCodeOrigination(Object.assign({},t))),n=yield this.walletProvider.sendOperations([e]);return this.context.operationFactory.createOriginationOperation(n)}))}setDelegate(t){var e;const n=rt((e=t.delegate)!==null&&e!==void 0?e:"");if(t.delegate&&n!==k.VALID)throw new at(t.delegate,V(n));return this.walletCommand(()=>A(this,void 0,void 0,function*(){const i=yield this.walletProvider.mapDelegateParamsToWalletParams(()=>A(this,void 0,void 0,function*(){return t})),s=yield this.walletProvider.sendOperations([i]);return this.context.operationFactory.createDelegationOperation(s)}))}registerDelegate(){return this.walletCommand(()=>A(this,void 0,void 0,function*(){const t=yield this.walletProvider.mapDelegateParamsToWalletParams(()=>A(this,void 0,void 0,function*(){return{delegate:yield this.pkh()}})),e=yield this.walletProvider.sendOperations([t]);return this.context.operationFactory.createDelegationOperation(e)}))}transfer(t){const e=rt(t.to);if(e!==k.VALID)throw new at(t.to,V(e));return this.walletCommand(()=>A(this,void 0,void 0,function*(){const n=yield this.walletProvider.mapTransferParamsToWalletParams(()=>A(this,void 0,void 0,function*(){return t})),i=yield this.walletProvider.sendOperations([n]);return this.context.operationFactory.createTransactionOperation(i)}))}increasePaidStorage(t){const e=rt(t.destination);if(e!==k.VALID)throw new at(t.destination,V(e));return this.walletCommand(()=>A(this,void 0,void 0,function*(){const n=yield this.walletProvider.mapIncreasePaidStorageWalletParams(()=>A(this,void 0,void 0,function*(){return t})),i=yield this.walletProvider.sendOperations([n]);return this.context.operationFactory.createIncreasePaidStorageOperation(i)}))}batch(t){const e=new Sl(this.walletProvider,this.context);return Array.isArray(t)&&e.with(t),e}at(t,e=n=>n){return A(this,void 0,void 0,function*(){const n=Wr(t);if(n!==k.VALID)throw new Dr(t,V(n));const i=this.context.withExtensions().rpc,s=this.context.withExtensions().readProvider,o=yield s.getScript(t,"head"),a=yield s.getEntrypoints(t),u=new Ho(t,o,this,this.context.contract,a,i,s);return e(u,this.context)})}}const z0=(r,{ALLOCATION_BURN:t,ORIGINATION_BURN:e}={ALLOCATION_BURN:257,ORIGINATION_BURN:257})=>{U.config({DECIMAL_PLACES:0,ROUNDING_MODE:U.ROUND_UP});const n=Ue({contents:r});let i=new U(0),s=new U(0),o=new U(0),a=new U(0),u=new U(0),p=new U(0);return n.forEach(f=>{o=o.plus(f.fee||0),a=a.plus(Array.isArray(f.originated_contracts)?f.originated_contracts.length*e:0),u=u.plus("allocated_destination_contract"in f?t:0),i=i.plus(f.consumed_milligas||0),p=p.plus("paid_storage_size_diff"in f&&Number(f.paid_storage_size_diff)||0)}),s=s.plus(u).plus(a).plus(p),{totalFee:o,totalMilliGas:i,totalGas:i.dividedBy(1e3),totalStorage:s,totalAllocationBurn:u,totalOriginationBurn:a,totalPaidStorageDiff:p,totalStorageBurn:new U(s.multipliedBy(al))}},q0=60;class Hr{constructor(t,e,n){if(this.opHash=t,this.context=e,this._newHead$=n,this._operationResult=new An(1),this._includedInBlock=new An(1),this._included=!1,this.newHead$=this._newHead$.pipe(ke(i=>{var s,o;const a=(o=(s=this.lastHead)===null||s===void 0?void 0:s.header.level)!==null&&o!==void 0?o:i.header.level-1;return ro(a+1,i.header.level-a-1).pipe(Cn(u=>this.context.readProvider.getBlock(u)),wu(i))}),pi(i=>this.lastHead=i),Ss(1),wn()),this.confirmed$=this.newHead$.pipe(Mr(i=>{for(const s of i.operations)for(const o of s)if(o.hash===this.opHash)return this._included=!0,this._includedInBlock.next(i),this._operationResult.next(o.contents),i}),di(i=>typeof i<"u"),er(),Ss(1),wn()),su(this.opHash)!==k.VALID)throw new Qc(this.opHash);this.confirmed$.pipe(er(),no(()=>an(void 0))).subscribe()}operationResults(){return A(this,void 0,void 0,function*(){return this._operationResult.pipe(er()).toPromise()})}receipt(){return A(this,void 0,void 0,function*(){return z0(yield this.operationResults())})}getCurrentConfirmation(){return A(this,void 0,void 0,function*(){return this._included?$a([this._includedInBlock,Br(this.context.readProvider.getBlock("head"))]).pipe(Mr(([t,e])=>e.header.level-t.header.level+1),er()).toPromise():0})}isInCurrentBranch(t="head"){return A(this,void 0,void 0,function*(){if(!this._included)return!0;const e=yield this.context.readProvider.getBlockLevel(t),n=yield this._includedInBlock.pipe(er()).toPromise(),i=e-n.header.level;if(i<=0)return!0;const s=Math.min(n.header.level+i,n.header.level+q0);return new Set(yield this.context.readProvider.getLiveBlocks(s)).has(n.hash)})}confirmationObservable(t){if(typeof t<"u"&&t<1)throw new _l("Confirmation count must be at least 1");const{defaultConfirmationCount:e}=this.context.config,n=t!==void 0?t:e;if(n===void 0)throw new G0("Default confirmation count can not be undefined!");return $a([this._includedInBlock,this.newHead$]).pipe(vu(([,i],[,s])=>i.hash===s.hash),Mr(([i,s])=>({block:s,expectedConfirmation:n,currentConfirmation:s.header.level-i.header.level+1,completed:s.header.level-i.header.level>=n-1,isInCurrentBranch:()=>this.isInCurrentBranch(s.hash)})),bf(({completed:i})=>!i,!0))}confirmation(t){return this.confirmationObservable(t).toPromise()}}class Rl extends Hr{constructor(t,e,n){super(t,e,n),this.opHash=t,this.context=e}revealOperation(){return A(this,void 0,void 0,function*(){return(yield this.operationResults()).find(e=>e.kind===I.REVEAL)})}transactionOperation(){return A(this,void 0,void 0,function*(){return(yield this.operationResults()).find(e=>e.kind===I.TRANSACTION)})}status(){return A(this,void 0,void 0,function*(){if(!this._included)return"pending";const t=yield this.transactionOperation();return t?t.metadata.operation_result.status:"unknown"})}}class Ol extends Hr{constructor(t,e,n){super(t,e,n),this.opHash=t,this.context=e}originationOperation(){return A(this,void 0,void 0,function*(){const t=yield this.operationResults();return fc(t,I.ORIGINATION)})}revealOperation(){return A(this,void 0,void 0,function*(){const t=yield this.operationResults();return fc(t,I.REVEAL)})}status(){return A(this,void 0,void 0,function*(){if(!this._included)return"pending";const t=yield this.originationOperation();return t?t.metadata.operation_result.status:"unknown"})}contract(){return A(this,void 0,void 0,function*(){const t=yield this.originationOperation(),e=((t==null?void 0:t.metadata.operation_result.originated_contracts)||[])[0];return this.context.wallet.at(e)})}}class Pl extends Hr{constructor(t,e,n){super(t,e,n),this.opHash=t,this.context=e}revealOperation(){return A(this,void 0,void 0,function*(){return(yield this.operationResults()).find(e=>e.kind===I.REVEAL)})}delegationOperation(){return A(this,void 0,void 0,function*(){return(yield this.operationResults()).find(e=>e.kind===I.DELEGATION)})}status(){return A(this,void 0,void 0,function*(){if(!this._included)return"pending";const t=yield this.delegationOperation();return t?t.metadata.operation_result.status:"unknown"})}}class Uo{constructor(t){this.context=t}getPKH(){return A(this,void 0,void 0,function*(){return this.context.signer.publicKeyHash()})}mapTransferParamsToWalletParams(t){return A(this,void 0,void 0,function*(){return Zn(yield t(),I.TRANSACTION)})}mapOriginateParamsToWalletParams(t){return A(this,void 0,void 0,function*(){return Zn(yield t(),I.ORIGINATION)})}mapDelegateParamsToWalletParams(t){return A(this,void 0,void 0,function*(){return Zn(yield t(),I.DELEGATION)})}mapIncreasePaidStorageWalletParams(t){return A(this,void 0,void 0,function*(){return Zn(yield t(),I.INCREASE_PAID_STORAGE)})}sendOperations(t){return A(this,void 0,void 0,function*(){return(yield this.context.batch.batch(t).send()).hash})}}class Tl{constructor(t,e,n,i,s="unit",o=!0,a=!1){this.provider=t,this.address=e,this.parameterSchema=n,this.name=i,this.args=s,this.isMultipleEntrypoint=o,this.isAnonymous=a}getSignature(){return this.isAnonymous?this.parameterSchema.ExtractSchema()[this.name]:this.parameterSchema.ExtractSchema()}send(t={}){return this.provider instanceof Mn?this.provider.transfer(this.toTransferParams(t)).send():this.provider.transfer(this.toTransferParams(t))}toTransferParams({fee:t,gasLimit:e,storageLimit:n,source:i,amount:s=0,mutez:o=!1}={}){return{to:this.address,amount:s,fee:t,mutez:o,source:i,gasLimit:e,storageLimit:n,parameter:{entrypoint:this.isMultipleEntrypoint?this.name:Cr,value:this.isAnonymous?this.parameterSchema.EncodeObject({[this.name]:this.args}):this.parameterSchema.EncodeObject(this.args)}}}}class Il{constructor(t,e,n,i,s,o=!0,a=!1){this.provider=t,this.address=e,this.parameterSchema=n,this.name=i,this.args=s,this.isMultipleEntrypoint=o,this.isAnonymous=a}validateArgs(t,e,n){const i=e.ExtractSignatures();if(!i.find(s=>s.length===t.length))throw new Do(n,i,t)}get schema(){return this.isAnonymous?this.parameterSchema.ExtractSchema()[this.name]:this.parameterSchema.ExtractSchema()}getSignature(){if(this.isAnonymous){const t=this.parameterSchema.ExtractSignatures().find(e=>e[0]===this.name);if(t)return t.shift(),t}else{const t=this.parameterSchema.ExtractSignatures();return t.length==1?t[0]:t}}send(t={}){return this.provider instanceof Mn?this.provider.transfer(this.toTransferParams(t)).send():this.provider.transfer(this.toTransferParams(t))}toTransferParams({fee:t,gasLimit:e,storageLimit:n,source:i,amount:s=0,mutez:o=!1}={}){return{to:this.address,amount:s,fee:t,mutez:o,source:i,gasLimit:e,storageLimit:n,parameter:{entrypoint:this.isMultipleEntrypoint?this.name:Cr,value:this.isAnonymous?this.parameterSchema.Encode(this.name,...this.args):this.parameterSchema.Encode(...this.args)}}}}class W0{constructor(t,e,n,i,s,o="Unit"){this._rpc=t,this._readProvider=e,this._contractAddress=n,this._smartContractViewSchema=i,this._contractStorageType=s,this._args=o}getSignature(){return{parameter:this._smartContractViewSchema.extractArgsSchema(),result:this._smartContractViewSchema.extractResultSchema()}}executeView(t){return A(this,void 0,void 0,function*(){this.verifyContextExecution(t);const e=yield this._readProvider.getChainId(),n=this.transformArgsToMichelson(),i={contract:this._contractAddress,view:this._smartContractViewSchema.viewName,input:n,chain_id:e,source:t.viewCaller};return t.source&&(i.payer=t.source),this.executeViewAndDecodeResult(i)})}verifyContextExecution(t){if(t.source&&rt(t.source)!==k.VALID)throw new Ms(`The source account who initialized the view execution is invalid: ${t.source}.`);if(!t.viewCaller||rt(t.viewCaller)!==k.VALID)throw new Ms(`The contract which is the caller of view is invalid: ${t.viewCaller}.`)}transformArgsToMichelson(){try{return this._smartContractViewSchema.encodeViewArgs(this._args)}catch(t){throw new Pd(this._smartContractViewSchema.viewName,this.getSignature(),this._args,t)}}adaptViewCodeToContext(t,e,n){const i={BALANCE:[{prim:"PUSH",args:[{prim:"mutez"},{int:n}]}],SENDER:[{prim:"PUSH",args:[{prim:"address"},{string:e}]}],SELF_ADDRESS:[{prim:"PUSH",args:[{prim:"address"},{string:this._contractAddress}]}],AMOUNT:[{prim:"PUSH",args:[{prim:"mutez"},{int:"0"}]}]};return t.forEach((s,o)=>{s.prim in i&&(t[o]=Object(i)[s.prim]),s.args&&s.args.length!==0?this.adaptViewCodeToContext(s.args,e,n):Array.isArray(s)&&this.adaptViewCodeToContext(s,e,n)}),t}executeViewAndDecodeResult(t){return A(this,void 0,void 0,function*(){let e;try{e=(yield this._rpc.runScriptView(t)).data}catch(n){const i=ll(n);throw i?new ul(`The simulation of the on-chain view named ${this._smartContractViewSchema.viewName} failed with: ${JSON.stringify(i)}`,this._smartContractViewSchema.viewName,i,n):n}return this._smartContractViewSchema.decodeViewResult(e)})}}class Z0{constructor(t,e){this.provider=t,this.contractAddress=e}createContractMethodFlatParams(t,e,n,i=!0,s=!1){return new Il(this.provider,this.contractAddress,t,e,n,i,s)}createContractMethodObjectParam(t,e,n,i=!0,s=!1){return new Tl(this.provider,this.contractAddress,t,e,n,i,s)}createContractViewObjectParam(t,e,n,i,s){return new W0(t,e,this.contractAddress,n,i,s)}}const Cr="default";class Nl{constructor(t,e,n,i,s,o,a){this.currentContract=t,this.name=e,this.callbackParametersSchema=n,this.parameterSchema=i,this.args=s,this.rpc=o,this.readProvider=a}read(t){return A(this,void 0,void 0,function*(){const e=iu(t??"");if(Wr(t??"")==k.VALID)throw new tu("Since version 12, the lambda view no longer depends on a lambda contract. The read method no longer accepts a contract address as a parameter.");if(t&&e!==k.VALID)throw new Td(t,V(e));const n=this.parameterSchema.Encode(...this.args),i=yield this.rpc.runView({contract:this.currentContract.address,entrypoint:this.name,input:n,chain_id:t||(yield this.readProvider.getChainId())});return this.callbackParametersSchema.Execute(i.data)})}}const Y0=(r,t,e)=>{const n=t.ExtractSignatures();if(!n.find(i=>i.length===r.length))throw new Do(e,n,r)},X0=r=>{let t=!1;if("prim"in r&&r.prim==="pair"&&r.args){const e=r.args[r.args.length-1];"prim"in e&&e.prim==="contract"&&(t=!0)}return t};class Ho{constructor(t,e,n,i,s,o,a){this.address=t,this.script=e,this.storageProvider=i,this.entrypoints=s,this.rpc=o,this.readProvider=a,this.methods={},this.methodsObject={},this.views={},this.contractViews={},this.contractMethodFactory=new Z0(n,t),this.schema=ne.fromRPCResponse({script:this.script}),this.parameterSchema=zr.fromRPCResponse({script:this.script}),this.viewSchema=io.fromRPCResponse({script:this.script}),this.viewSchema.length!==0&&this._initializeOnChainViews(this,o,this.readProvider,this.viewSchema),this._initializeMethods(this,this.entrypoints.entrypoints,this.rpc,this.readProvider)}_initializeMethods(t,e,n,i){const s=this.parameterSchema,o=Object.keys(e);if(s.isMultipleEntryPoint)o.forEach(u=>{const p=new zr(e[u]);if(this.methods[u]=function(...f){return t.contractMethodFactory.createContractMethodFlatParams(p,u,f)},this.methodsObject[u]=function(f){return t.contractMethodFactory.createContractMethodObjectParam(p,u,f)},X0(e[u])){const f=function(...m){const N=e[u].args[0],T=new zr(N),x=e[u].args[1].args[0],B=new zr(x);return Y0(m,T,u),new Nl(t,u,B,T,m,n,i)};this.views[u]=f}}),Object.keys(s.ExtractSchema()).filter(u=>Object.keys(e).indexOf(u)===-1).forEach(u=>{this.methods[u]=function(...p){return t.contractMethodFactory.createContractMethodFlatParams(s,u,p,!1,!0)},this.methodsObject[u]=function(p){return t.contractMethodFactory.createContractMethodObjectParam(s,u,p,!1,!0)}});else{const a=this.parameterSchema;this.methods[Cr]=function(...u){return t.contractMethodFactory.createContractMethodFlatParams(a,Cr,u,!1)},this.methodsObject[Cr]=function(u){return t.contractMethodFactory.createContractMethodObjectParam(a,Cr,u,!1)}}}_initializeOnChainViews(t,e,n,i){const s=this.schema.val;i.forEach(o=>{this.contractViews[o.viewName]=function(a){return t.contractMethodFactory.createContractViewObjectParam(e,n,o,s,a)}})}storage(){return this.storageProvider.getStorage(this.address,this.schema)}bigMap(t){return this.storageProvider.getBigMapKey(this.address,t,this.schema)}}const J0=r=>[{prim:"DROP"},{prim:"NIL",args:[{prim:"operation"}]},{prim:"PUSH",args:[{prim:"key_hash"},{string:r}]},{prim:"SOME"},{prim:"SET_DELEGATE"},{prim:"CONS"}],Q0=(r,t)=>[{prim:"DROP"},{prim:"NIL",args:[{prim:"operation"}]},{prim:"PUSH",args:[{prim:"key_hash"},{string:r}]},{prim:"IMPLICIT_ACCOUNT"},{prim:"PUSH",args:[{prim:"mutez"},{int:`${t}`}]},{prim:"UNIT"},{prim:"TRANSFER_TOKENS"},{prim:"CONS"}],ty=()=>[{prim:"DROP"},{prim:"NIL",args:[{prim:"operation"}]},{prim:"NONE",args:[{prim:"key_hash"}]},{prim:"SET_DELEGATE"},{prim:"CONS"}],ey=(r,t)=>[{prim:"DROP"},{prim:"NIL",args:[{prim:"operation"}]},{prim:"PUSH",args:[{prim:"address"},{string:r}]},{prim:"CONTRACT",args:[{prim:"unit"}]},[{prim:"IF_NONE",args:[[[{prim:"UNIT"},{prim:"FAILWITH"}]],[]]}],{prim:"PUSH",args:[{prim:"mutez"},{int:`${t}`}]},{prim:"UNIT"},{prim:"TRANSFER_TOKENS"},{prim:"CONS"}],ry={setDelegate:J0,removeDelegate:ty,transferImplicit:Q0,transferToContract:ey},ny=[{prim:"parameter",args:[{prim:"lambda",args:[{prim:"unit"},{prim:"pair",args:[{prim:"list",args:[{prim:"operation"}]},{prim:"unit"}]}]}]},{prim:"storage",args:[{prim:"unit"}]},{prim:"code",args:[[{prim:"CAR"},{prim:"UNIT"},{prim:"EXEC"}]]}],iy="Unit",sy={code:ny,storage:iy};function oy(r,t){return(e,n)=>t(r(e,n),n)}class xl{constructor(t,e){this.id=t,this.provider=e}getSaplingDiff(t){return A(this,void 0,void 0,function*(){return this.provider.getSaplingDiffByID(this.id.toString(),t)})}getId(){return this.id.toString()}}const Xn=100,ay=1,cy=.1,gc=100;class Dt{constructor(t,e,n,i,s=Xn){this._milligasLimit=t,this._storageLimit=e,this.opSize=n,this.minimalFeePerStorageByteMutez=i,this.baseFeeMutez=s}get burnFeeMutez(){return this.roundUp(Number(this.storageLimit)*Number(this.minimalFeePerStorageByteMutez))}get storageLimit(){const t=Math.max(Number(this._storageLimit),0);return t>0?t:0}get gasLimit(){return this.roundUp(Number(this._milligasLimit)/1e3+gc)}get operationFeeMutez(){return(Number(this._milligasLimit)/1e3+gc)*cy+Number(this.opSize)*ay}roundUp(t){return Math.ceil(Number(t))}get minimalFeeMutez(){return this.roundUp(Xn+this.operationFeeMutez)}get suggestedFeeMutez(){return this.roundUp(this.operationFeeMutez+Xn*2)}get usingBaseFeeMutez(){return Math.max(Number(this.baseFeeMutez),Xn)+this.roundUp(this.operationFeeMutez)}get totalCost(){return this.minimalFeeMutez+this.burnFeeMutez}get consumedMilligas(){return Number(this._milligasLimit)}static createEstimateInstanceFromProperties(t){let e=0,n=0,i=0,s=0,o;return t.forEach(a=>{e+=a.milligasLimit,n+=a.storageLimit,i+=a.opSize,s=Math.max(a.minimalFeePerStorageByteMutez,s),a.baseFeeMutez&&(o=o?o+a.baseFeeMutez:a.baseFeeMutez)}),new Dt(e,n,i,s,o)}static createArrayEstimateInstancesFromProperties(t){return t.map(e=>new Dt(e.milligasLimit,e.storageLimit,e.opSize,e.minimalFeePerStorageByteMutez,e.baseFeeMutez))}}class Ei extends Error{constructor(){super("Unable to estimate the reveal operation, the public key is unknown"),this.name="Reveal Estimate Error"}}const uy="edsigtkpiSSschcaCt9pUVrpNPf7TTcgvgDEDD6NCEHMy8NNQJCGnMfLZzYoQj74yLjo9wx6MPVV29CvVzgi7qEcEUok3k7AuMg";class Ll extends Dn{constructor(){super(...arguments),this.ALLOCATION_STORAGE=257,this.ORIGINATION_STORAGE=257,this.OP_SIZE_REVEAL=128,this.prepare=new ln(this.context)}getKeys(){return A(this,void 0,void 0,function*(){const t=this.context.isAnySignerConfigured();return{publicKeyHash:t?yield this.signer.publicKeyHash():yield this.context.walletProvider.getPKH(),publicKey:t?yield this.signer.publicKey():void 0}})}getEstimationPropertiesFromOperationContent(t,e,n){const i=Ue({contents:[t]});let s=0,o=0;return i.forEach(a=>{o+="originated_contracts"in a&&typeof a.originated_contracts<"u"?a.originated_contracts.length*this.ORIGINATION_STORAGE:0,o+="allocated_destination_contract"in a?this.ALLOCATION_STORAGE:0,s+=Number(a.consumed_milligas)||0,o+="paid_storage_size_diff"in a&&Number(a.paid_storage_size_diff)||0,o+="storage_size"in a&&"global_address"in a&&Number(a.storage_size)||0,o+="genesis_commitment_hash"in a?Number(a.size):0}),ks(t)?{milligasLimit:s||0,storageLimit:Number(o||0),opSize:e,minimalFeePerStorageByteMutez:n.toNumber()}:{milligasLimit:0,storageLimit:0,opSize:e,minimalFeePerStorageByteMutez:n.toNumber(),baseFeeMutez:0}}calculateEstimates(t,e){return A(this,void 0,void 0,function*(){const{opbytes:n,opOb:{branch:i,contents:s}}=yield this.forge(t),o={operation:{branch:i,contents:s,signature:uy},chain_id:yield this.context.readProvider.getChainId()},{opResponse:a}=yield this.simulate(o),{cost_per_byte:u}=e,p=[...sn(a,"backtracked"),...sn(a)];if(p.length)throw new Bo(p,"Error occurred during estimation");let f=1;return Array.isArray(t.opOb.contents)&&t.opOb.contents.length>1&&(f=a.contents[0].kind==="reveal"?t.opOb.contents.length-1:t.opOb.contents.length),a.contents.map(m=>this.getEstimationPropertiesFromOperationContent(m,m.kind==="reveal"?this.OP_SIZE_REVEAL/2:n.length/2/f,u))})}originate(t){return A(this,void 0,void 0,function*(){const e=yield this.prepare.originate(t),n=yield this.context.readProvider.getProtocolConstants("head"),i=yield this.calculateEstimates(e,n);return e.opOb.contents[0].kind==="reveal"&&i.shift(),Dt.createEstimateInstanceFromProperties(i)})}transfer(t){var e,{fee:n,storageLimit:i,gasLimit:s}=t,o=$t(t,["fee","storageLimit","gasLimit"]);return A(this,void 0,void 0,function*(){const a=rt(o.to);if(a!==k.VALID)throw new at(o.to,V(a));const u=rt((e=o.source)!==null&&e!==void 0?e:"");if(o.source&&u!==k.VALID)throw new at(o.source,V(u));const p=yield this.prepare.transaction(Object.assign({fee:n,storageLimit:i,gasLimit:s},o)),f=yield this.context.readProvider.getProtocolConstants("head"),m=yield this.calculateEstimates(p,f);return p.opOb.contents[0].kind==="reveal"&&m.shift(),Dt.createEstimateInstanceFromProperties(m)})}transferTicket(t){var e,{fee:n,storageLimit:i,gasLimit:s}=t,o=$t(t,["fee","storageLimit","gasLimit"]);return A(this,void 0,void 0,function*(){const a=rt(o.destination);if(a!==k.VALID)throw new at(o.destination,V(a));const u=rt((e=o.source)!==null&&e!==void 0?e:"");if(o.source&&u!==k.VALID)throw new at(o.source,V(u));const p=yield this.context.readProvider.getProtocolConstants("head"),f=yield this.prepare.transferTicket(Object.assign({fee:n,storageLimit:i,gasLimit:s},o)),m=yield this.calculateEstimates(f,p);return f.opOb.contents[0].kind==="reveal"&&m.shift(),Dt.createEstimateInstanceFromProperties(m)})}setDelegate(t){var e,{fee:n,gasLimit:i,storageLimit:s}=t,o=$t(t,["fee","gasLimit","storageLimit"]);return A(this,void 0,void 0,function*(){const a=rt(o.source);if(o.source&&a!==k.VALID)throw new at(o.source,V(a));const u=rt((e=o.delegate)!==null&&e!==void 0?e:"");if(o.delegate&&u!==k.VALID)throw new at(o.delegate,V(u));const p=yield this.prepare.delegation(Object.assign({fee:n,storageLimit:s,gasLimit:i},o)),f=yield this.context.readProvider.getProtocolConstants("head"),m=yield this.calculateEstimates(p,f);return p.opOb.contents[0].kind==="reveal"&&m.shift(),Dt.createEstimateInstanceFromProperties(m)})}batch(t){return A(this,void 0,void 0,function*(){const e=yield this.context.readProvider.getProtocolConstants("head"),n=yield this.prepare.batch(t),i=yield this.calculateEstimates(n,e);return Dt.createArrayEstimateInstancesFromProperties(i)})}registerDelegate(t,e){var{fee:n,storageLimit:i,gasLimit:s}=t,o=$t(t,["fee","storageLimit","gasLimit"]);return A(this,void 0,void 0,function*(){const a=(yield this.getKeys()).publicKeyHash,u=yield this.context.readProvider.getProtocolConstants("head"),p=e||a,f=yield this.prepare.registerDelegate(Object.assign({fee:n,storageLimit:i,gasLimit:s},o),p),m=yield this.calculateEstimates(f,u);return f.opOb.contents[0].kind==="reveal"&&m.shift(),Dt.createEstimateInstanceFromProperties(m)})}reveal(t){return A(this,void 0,void 0,function*(){const{publicKeyHash:e,publicKey:n}=yield this.getKeys();if(!n)throw new Ei;if(yield this.isAccountRevealRequired(e)){const i=yield this.context.readProvider.getProtocolConstants("head"),s=t?yield this.prepare.reveal(t):yield this.prepare.reveal({}),o=yield this.calculateEstimates(s,i);return Dt.createEstimateInstanceFromProperties(o)}})}registerGlobalConstant(t){var{fee:e,storageLimit:n,gasLimit:i}=t,s=$t(t,["fee","storageLimit","gasLimit"]);return A(this,void 0,void 0,function*(){const o=yield this.prepare.registerGlobalConstant(Object.assign({fee:e,storageLimit:n,gasLimit:i},s)),a=yield this.context.readProvider.getProtocolConstants("head"),u=yield this.calculateEstimates(o,a);return o.opOb.contents[0].kind==="reveal"&&u.shift(),Dt.createEstimateInstanceFromProperties(u)})}increasePaidStorage(t){var{fee:e,storageLimit:n,gasLimit:i}=t,s=$t(t,["fee","storageLimit","gasLimit"]);return A(this,void 0,void 0,function*(){const o=yield this.context.readProvider.getProtocolConstants("head"),a=yield this.prepare.increasePaidStorage(Object.assign({fee:e,storageLimit:n,gasLimit:i},s)),u=yield this.calculateEstimates(a,o);return a.opOb.contents[0].kind==="reveal"&&u.shift(),Dt.createEstimateInstanceFromProperties(u)})}updateConsensusKey(t){return A(this,void 0,void 0,function*(){const e=yield this.context.readProvider.getProtocolConstants("head"),n=yield this.prepare.updateConsensusKey(t),i=yield this.calculateEstimates(n,e);return n.opOb.contents[0].kind==="reveal"&&i.shift(),Dt.createEstimateInstanceFromProperties(i)})}smartRollupAddMessages(t){return A(this,void 0,void 0,function*(){const e=yield this.context.readProvider.getProtocolConstants("head"),n=yield this.prepare.smartRollupAddMessages(t),i=yield this.calculateEstimates(n,e);return n.opOb.contents[0].kind==="reveal"&&i.shift(),Dt.createEstimateInstanceFromProperties(i)})}smartRollupOriginate(t){return A(this,void 0,void 0,function*(){const e=yield this.context.readProvider.getProtocolConstants("head"),n=yield this.prepare.smartRollupOriginate(t),i=yield this.calculateEstimates(n,e);return n.opOb.contents[0].kind==="reveal"&&i.shift(),Dt.createEstimateInstanceFromProperties(i)})}contractCall(t){return A(this,void 0,void 0,function*(){const e=yield this.context.readProvider.getProtocolConstants("head"),n=yield this.prepare.contractCall(t),i=yield this.calculateEstimates(n,e);return n.opOb.contents[0].kind==="reveal"&&i.shift(),Dt.createEstimateInstanceFromProperties(i)})}}var dt;const Zt=(r,t)=>{var e,n,i;return{fee:(e=r.fee)!==null&&e!==void 0?e:t.fee,gasLimit:(n=r.gasLimit)!==null&&n!==void 0?n:t.gasLimit,storageLimit:(i=r.storageLimit)!==null&&i!==void 0?i:t.storageLimit}};class ln extends Dn{constructor(t){super(t),this.context=t,dt.set(this,void 0),xt(this,dt,{})}getBlockHash(){return A(this,void 0,void 0,function*(){return this.context.readProvider.getBlockHash("head~2")})}getProtocolHash(){return A(this,void 0,void 0,function*(){return this.context.readProvider.getNextProtocol("head")})}getHeadCounter(t){var e;return A(this,void 0,void 0,function*(){return(e=this.context.readProvider.getCounter(t,"head"))!==null&&e!==void 0?e:"0"})}adjustGasForBatchOperation(t,e,n){return U.min(e,t.div(n+1))}getAccountLimits(t,e,n){return A(this,void 0,void 0,function*(){const i=yield this.context.readProvider.getBalance(t,"head"),{hard_gas_limit_per_operation:s,hard_gas_limit_per_block:o,hard_storage_limit_per_operation:a,cost_per_byte:u}=e;return{fee:0,gasLimit:n?Math.floor(this.adjustGasForBatchOperation(o,s,n).toNumber()):s.toNumber(),storageLimit:Math.floor(U.min(i.dividedBy(u),a).toNumber())}})}getFee(t,e,n){return(!qn(this,dt)[e]||qn(this,dt)[e]<n)&&(qn(this,dt)[e]=n),{counter:`${++qn(this,dt)[e]}`,fee:typeof t.fee>"u"?"0":`${t.fee}`,gas_limit:typeof t.gas_limit>"u"?"0":`${t.gas_limit}`,storage_limit:typeof t.storage_limit>"u"?"0":`${t.storage_limit}`}}getSource(t,e,n){return{source:typeof t.source>"u"?n||e:t.source}}addRevealOperationIfNeeded(t,e){return A(this,void 0,void 0,function*(){if(vl(t)){const n=[t],{publicKey:i}=yield this.getKeys();if(yield this.isAccountRevealRequired(e)){if(!i)throw new Ei;return n.unshift(yield si({fee:je.REVEAL,storageLimit:Ve.REVEAL,gasLimit:$e.REVEAL},e,i)),n}}return t})}getKeys(){return A(this,void 0,void 0,function*(){const t=this.context.isAnySignerConfigured();return{pkh:t?yield this.signer.publicKeyHash():yield this.context.walletProvider.getPKH(),publicKey:t?yield this.signer.publicKey():void 0}})}convertIntoArray(t){return Array.isArray(t)?[...t]:[t]}constructOpContents(t,e,n,i,s){return t.map(o=>{switch(o.kind){case I.ACTIVATION:case I.DRAIN_DELEGATE:return Object.assign({},o);case I.ORIGINATION:return Object.assign(Object.assign(Object.assign(Object.assign({},o),{balance:typeof o.balance<"u"?`${o.balance}`:"0"}),this.getSource(o,n,i)),this.getFee(o,n,e));case I.TRANSACTION:{const a=Object.assign(Object.assign(Object.assign(Object.assign({},o),{amount:typeof o.amount<"u"?`${o.amount}`:"0"}),this.getSource(o,n,i)),this.getFee(o,n,e));if(a.source.toLowerCase().startsWith("kt1"))throw new tu(`KT1 addresses are not supported as source since ${Rt.PsBabyM1}`);return a}case I.REVEAL:case I.DELEGATION:case I.REGISTER_GLOBAL_CONSTANT:case I.UPDATE_CONSENSUS_KEY:case I.SMART_ROLLUP_ADD_MESSAGES:case I.SMART_ROLLUP_ORIGINATE:return Object.assign(Object.assign(Object.assign({},o),this.getSource(o,n,i)),this.getFee(o,n,e));case I.TRANSFER_TICKET:return Object.assign(Object.assign(Object.assign(Object.assign({},o),{ticket_amount:`${o.ticket_amount}`}),this.getSource(o,n,i)),this.getFee(o,n,e));case I.INCREASE_PAID_STORAGE:return Object.assign(Object.assign(Object.assign(Object.assign({},o),{amount:`${o.amount}`}),this.getSource(o,n,i)),this.getFee(o,n,e));case I.BALLOT:if(s===void 0)throw new Yn("Failed to get the current voting period index");return Object.assign(Object.assign({},o),{period:s==null?void 0:s.voting_period.index});case I.PROPOSALS:if(s===void 0)throw new Yn("Failed to get the current voting period index");return Object.assign(Object.assign({},o),{period:s==null?void 0:s.voting_period.index});default:throw new Ar(o.kind)}})}activate({pkh:t,secret:e}){return A(this,void 0,void 0,function*(){const n=yield fl({pkh:t,secret:e}),i=this.convertIntoArray(n),s=yield this.getBlockHash(),o=yield this.getProtocolHash();xt(this,dt,{});const a=parseInt(yield this.getHeadCounter(t),10),u=this.constructOpContents(i,a,t);return{opOb:{branch:s,contents:u,protocol:o},counter:a}})}reveal({fee:t,gasLimit:e,storageLimit:n}){return A(this,void 0,void 0,function*(){const{pkh:i,publicKey:s}=yield this.getKeys();if(!s)throw new F0;const o=yield this.context.readProvider.getProtocolConstants("head"),a=yield this.getAccountLimits(i,o),u=Zt({fee:t,storageLimit:n,gasLimit:e},a),p=yield si({fee:u.fee,gasLimit:u.gasLimit,storageLimit:u.storageLimit},i,s),f=this.convertIntoArray(p),m=yield this.getBlockHash(),N=yield this.getProtocolHash();xt(this,dt,{});const T=parseInt(yield this.getHeadCounter(i),10),x=this.constructOpContents(f,T,i);return{opOb:{branch:m,contents:x,protocol:N},counter:T}})}originate(t,e){var{fee:n,storageLimit:i,gasLimit:s}=t,o=$t(t,["fee","storageLimit","gasLimit"]);return A(this,void 0,void 0,function*(){const{pkh:a}=yield this.getKeys(),u=yield this.context.readProvider.getProtocolConstants("head"),p=yield this.getAccountLimits(a,u),f=yield xi(yield this.context.parser.prepareCodeOrigination(Object.assign(Object.assign({},o),Zt({fee:n,storageLimit:i,gasLimit:s},p)))),m=yield this.addRevealOperationIfNeeded(f,a),N=this.convertIntoArray(m),T=yield this.getBlockHash(),x=yield this.getProtocolHash();xt(this,dt,{});const B=parseInt(yield this.getHeadCounter(a),10),C=this.constructOpContents(N,B,a,e);return{opOb:{branch:T,contents:C,protocol:x},counter:B}})}transaction(t){var{fee:e,storageLimit:n,gasLimit:i}=t,s=$t(t,["fee","storageLimit","gasLimit"]);return A(this,void 0,void 0,function*(){const{pkh:o}=yield this.getKeys(),a=yield this.context.readProvider.getProtocolConstants("head"),u=yield this.getAccountLimits(o,a),p=yield Li(Object.assign(Object.assign({},s),Zt({fee:e,storageLimit:n,gasLimit:i},u))),f=yield this.addRevealOperationIfNeeded(p,o),m=this.convertIntoArray(f),N=yield this.getBlockHash(),T=yield this.getProtocolHash();xt(this,dt,{});const x=parseInt(yield this.getHeadCounter(o),10),B=this.constructOpContents(m,x,o,s.source);return{opOb:{branch:N,contents:B,protocol:T},counter:x}})}delegation(t){var{fee:e,storageLimit:n,gasLimit:i}=t,s=$t(t,["fee","storageLimit","gasLimit"]);return A(this,void 0,void 0,function*(){const{pkh:o}=yield this.getKeys(),a=yield this.context.readProvider.getProtocolConstants("head"),u=yield this.getAccountLimits(o,a),p=yield Ci(Object.assign(Object.assign({},s),Zt({fee:e,storageLimit:n,gasLimit:i},u))),f=yield this.addRevealOperationIfNeeded(p,o),m=this.convertIntoArray(f),N=yield this.getBlockHash(),T=yield this.getProtocolHash();xt(this,dt,{});const x=parseInt(yield this.getHeadCounter(o),10),B=this.constructOpContents(m,x,o,s.source);return{opOb:{branch:N,contents:B,protocol:T},counter:x}})}registerDelegate({fee:t,storageLimit:e,gasLimit:n},i){return A(this,void 0,void 0,function*(){const{pkh:s}=yield this.getKeys(),o=yield this.context.readProvider.getProtocolConstants("head"),a=yield this.getAccountLimits(s,o),u=Zt({fee:t,storageLimit:e,gasLimit:n},a),p=yield gl({fee:u.fee,storageLimit:u.storageLimit,gasLimit:u.gasLimit},s),f=yield this.addRevealOperationIfNeeded(p,s),m=this.convertIntoArray(f),N=yield this.getBlockHash(),T=yield this.getProtocolHash();xt(this,dt,{});const x=parseInt(yield this.getHeadCounter(s),10),B=this.constructOpContents(m,x,s,i);return{opOb:{branch:N,contents:B,protocol:T},counter:x}})}registerGlobalConstant(t){var{fee:e,storageLimit:n,gasLimit:i}=t,s=$t(t,["fee","storageLimit","gasLimit"]);return A(this,void 0,void 0,function*(){const{pkh:o}=yield this.getKeys(),a=yield this.context.readProvider.getProtocolConstants("head"),u=yield this.getAccountLimits(o,a),p=yield Di(Object.assign(Object.assign({},s),Zt({fee:e,storageLimit:n,gasLimit:i},u))),f=yield this.addRevealOperationIfNeeded(p,o),m=this.convertIntoArray(f),N=yield this.getBlockHash(),T=yield this.getProtocolHash();xt(this,dt,{});const x=parseInt(yield this.getHeadCounter(o),10),B=this.constructOpContents(m,x,o,s.source);return{opOb:{branch:N,contents:B,protocol:T},counter:x}})}updateConsensusKey(t,e){var{fee:n,storageLimit:i,gasLimit:s}=t,o=$t(t,["fee","storageLimit","gasLimit"]);return A(this,void 0,void 0,function*(){const{pkh:a}=yield this.getKeys(),u=yield this.context.readProvider.getProtocolConstants("head"),p=yield this.getAccountLimits(a,u),f=yield El(Object.assign(Object.assign({},o),Zt({fee:n,storageLimit:i,gasLimit:s},p))),m=yield this.addRevealOperationIfNeeded(f,a),N=this.convertIntoArray(m),T=yield this.getBlockHash(),x=yield this.getProtocolHash();xt(this,dt,{});const B=parseInt(yield this.getHeadCounter(a),10),C=this.constructOpContents(N,B,a,e);return{opOb:{branch:T,contents:C,protocol:x},counter:B}})}increasePaidStorage(t){var{fee:e,storageLimit:n,gasLimit:i}=t,s=$t(t,["fee","storageLimit","gasLimit"]);return A(this,void 0,void 0,function*(){const{pkh:o}=yield this.getKeys(),a=yield this.context.readProvider.getProtocolConstants("head"),u=yield this.getAccountLimits(o,a),p=yield ki(Object.assign(Object.assign({},s),Zt({fee:e,storageLimit:n,gasLimit:i},u))),f=yield this.addRevealOperationIfNeeded(p,o),m=this.convertIntoArray(f),N=yield this.getBlockHash(),T=yield this.getProtocolHash();xt(this,dt,{});const x=parseInt(yield this.getHeadCounter(o),10),B=this.constructOpContents(m,x,o,s.source);return{opOb:{branch:N,contents:B,protocol:T},counter:x}})}ballot(t){return A(this,void 0,void 0,function*(){const{pkh:e}=yield this.getKeys(),n=yield yl(Object.assign({},t)),i=this.convertIntoArray(n),s=yield this.getBlockHash(),o=yield this.getProtocolHash();xt(this,dt,{});const a=parseInt(yield this.getHeadCounter(e),10);let u;try{u=yield this.rpc.getCurrentPeriod()}catch{throw new Yn("Failed to get the current voting period index")}const p=this.constructOpContents(i,a,e,void 0,u);return{opOb:{branch:s,contents:p,protocol:o},counter:a}})}proposals(t){return A(this,void 0,void 0,function*(){const{pkh:e}=yield this.getKeys(),n=yield bl(Object.assign({},t)),i=this.convertIntoArray(n),s=yield this.getBlockHash(),o=yield this.getProtocolHash();xt(this,dt,{});const a=parseInt(yield this.getHeadCounter(e),10);let u;try{u=yield this.rpc.getCurrentPeriod()}catch{throw new Yn("Failed to get the current voting period index")}const p=this.constructOpContents(i,a,e,void 0,u);return{opOb:{branch:s,contents:p,protocol:o},counter:a}})}drainDelegate(t,e){return A(this,void 0,void 0,function*(){const{pkh:n}=yield this.getKeys(),i=yield ml(Object.assign({},t)),s=this.convertIntoArray(i),o=yield this.getBlockHash(),a=yield this.getProtocolHash();xt(this,dt,{});const u=parseInt(yield this.getHeadCounter(n),10),p=this.constructOpContents(s,u,n,e);return{opOb:{branch:o,contents:p,protocol:a},counter:u}})}transferTicket(t){var{fee:e,storageLimit:n,gasLimit:i}=t,s=$t(t,["fee","storageLimit","gasLimit"]);return A(this,void 0,void 0,function*(){const{pkh:o}=yield this.getKeys(),a=yield this.context.readProvider.getProtocolConstants("head"),u=yield this.getAccountLimits(o,a),p=yield Mi(Object.assign(Object.assign({},s),Zt({fee:e,storageLimit:n,gasLimit:i},u))),f=yield this.addRevealOperationIfNeeded(p,o),m=this.convertIntoArray(f),N=yield this.getBlockHash(),T=yield this.getProtocolHash();xt(this,dt,{});const x=parseInt(yield this.getHeadCounter(o),10),B=this.constructOpContents(m,x,o,s.source);return{opOb:{branch:N,contents:B,protocol:T},counter:x}})}smartRollupAddMessages(t){var{fee:e,storageLimit:n,gasLimit:i}=t,s=$t(t,["fee","storageLimit","gasLimit"]);return A(this,void 0,void 0,function*(){const{pkh:o}=yield this.getKeys(),a=yield this.context.readProvider.getProtocolConstants("head"),u=yield this.getAccountLimits(o,a),p=yield Bi(Object.assign(Object.assign({},s),Zt({fee:e,storageLimit:n,gasLimit:i},u))),f=yield this.addRevealOperationIfNeeded(p,o),m=this.convertIntoArray(f),N=yield this.getBlockHash(),T=yield this.getProtocolHash();xt(this,dt,{});const x=parseInt(yield this.getHeadCounter(o),10),B=this.constructOpContents(m,x,o,s.source);return{opOb:{branch:N,contents:B,protocol:T},counter:x}})}smartRollupOriginate(t){var{fee:e,storageLimit:n,gasLimit:i}=t,s=$t(t,["fee","storageLimit","gasLimit"]);return A(this,void 0,void 0,function*(){const{pkh:o}=yield this.getKeys(),a=yield this.rpc.getOriginationProof({kind:s.pvmKind,kernel:s.kernel}),u=yield this.context.readProvider.getProtocolConstants("head"),p=yield this.getAccountLimits(o,u),f=yield Ui(Object.assign(Object.assign(Object.assign({},Zt({fee:e,storageLimit:n,gasLimit:i},p)),s),{originationProof:a})),m=yield this.addRevealOperationIfNeeded(f,o),N=this.convertIntoArray(m),T=yield this.getBlockHash(),x=yield this.getProtocolHash();xt(this,dt,{});const B=parseInt(yield this.getHeadCounter(o),10),C=this.constructOpContents(N,B,o,s.source);return{opOb:{branch:T,contents:C,protocol:x},counter:B}})}batch(t,e){return A(this,void 0,void 0,function*(){const{pkh:n,publicKey:i}=yield this.getKeys(),s=yield this.context.readProvider.getProtocolConstants("head"),o=yield this.getAccountLimits(n,s,t.length),a=yield this.isRevealOpNeeded(t,n),u=[];if(e)for(const T of t)if(ks(T)){const x=e.shift(),B=Zt(T,{fee:x.suggestedFeeMutez,storageLimit:x.storageLimit,gasLimit:x.gasLimit});u.push(yield this.getRPCOp(Object.assign(Object.assign({},T),B)))}else u.push(Object.assign({},T));else for(const T of t)if(ks(T)){const x=Zt(T,o);u.push(yield this.getRPCOp(Object.assign(Object.assign({},T),x)))}else u.push(Object.assign({},T));if(a){if(!i)throw new Ei;u.unshift(yield si({fee:je.REVEAL,storageLimit:Ve.REVEAL,gasLimit:$e.REVEAL},n,i))}const p=yield this.getBlockHash(),f=yield this.getProtocolHash();xt(this,dt,{});const m=parseInt(yield this.getHeadCounter(n),10),N=this.constructOpContents(u,m,n);return{opOb:{branch:p,contents:N,protocol:f},counter:m}})}contractCall(t){var e,n,i;return A(this,void 0,void 0,function*(){const s=yield this.getBlockHash(),o=yield this.getProtocolHash(),{pkh:a}=yield this.getKeys();xt(this,dt,{});const u=parseInt(yield this.getHeadCounter(a),10),p=t.toTransferParams(),f=yield this.context.readProvider.getProtocolConstants("head"),m=yield this.getAccountLimits(a,f),N=Zt({fee:p.fee,storageLimit:p.storageLimit,gasLimit:p.gasLimit},m),T=[{kind:I.TRANSACTION,fee:(e=p.fee)!==null&&e!==void 0?e:N.fee,gas_limit:(n=p.gasLimit)!==null&&n!==void 0?n:N.gasLimit,storage_limit:(i=p.storageLimit)!==null&&i!==void 0?i:N.storageLimit,amount:String(p.amount),destination:p.to,parameters:p.parameter}],x=this.constructOpContents(T,u,a);return{opOb:{branch:s,contents:x,protocol:o},counter:u}})}toPreapply(t){return A(this,void 0,void 0,function*(){const{opOb:{contents:e,branch:n,protocol:i}}=t,s=this.toForge(t),o=yield this.context.forger.forge(s),a=yield this.context.signer.sign(o,new Uint8Array([3]));return[{contents:e,branch:n,protocol:i,signature:a.prefixSig}]})}toForge({opOb:{contents:t,branch:e}}){return{branch:e,contents:t}}}dt=new WeakMap;const Cl=[I.ACTIVATION,I.ORIGINATION,I.TRANSACTION,I.DELEGATION];class $o extends Dn{constructor(t,e){super(t),this.estimator=e,this.operations=[],this.prepare=new ln(this.context)}withTransfer(t){const e=rt(t.to);if(e!==k.VALID)throw new at(t.to,V(e));return this.operations.push(Object.assign({kind:I.TRANSACTION},t)),this}withTransferTicket(t){const e=rt(t.destination);if(e!==k.VALID)throw new at(t.destination,V(e));return this.operations.push(Object.assign({kind:I.TRANSFER_TICKET},t)),this}withContractCall(t,e={}){return this.withTransfer(t.toTransferParams(e))}withDelegation(t){var e;const n=rt(t.source);if(t.source&&n!==k.VALID)throw new at(t.source,V(n));const i=rt((e=t.delegate)!==null&&e!==void 0?e:"");if(t.delegate&&i!==k.VALID)throw new at(t.delegate,V(i));return this.operations.push(Object.assign({kind:I.DELEGATION},t)),this}withActivation({pkh:t,secret:e}){const n=Ws(t);if(n!==k.VALID)throw new qs(t,V(n));return this.operations.push({kind:I.ACTIVATION,pkh:t,secret:e}),this}withOrigination(t){return this.operations.push(Object.assign({kind:I.ORIGINATION},t)),this}withRegisterGlobalConstant(t){return this.operations.push(Object.assign({kind:I.REGISTER_GLOBAL_CONSTANT},t)),this}withIncreasePaidStorage(t){return this.operations.push(Object.assign({kind:I.INCREASE_PAID_STORAGE},t)),this}withSmartRollupAddMessages(t){return this.operations.push(Object.assign({kind:I.SMART_ROLLUP_ADD_MESSAGES},t)),this}withSmartRollupOriginate(t){return this.operations.push(Object.assign({kind:I.SMART_ROLLUP_ORIGINATE},t)),this}getRPCOp(t){return A(this,void 0,void 0,function*(){switch(t.kind){case I.TRANSACTION:return Li(Object.assign({},t));case I.ORIGINATION:return xi(yield this.context.parser.prepareCodeOrigination(Object.assign({},t)));case I.DELEGATION:return Ci(Object.assign({},t));case I.REGISTER_GLOBAL_CONSTANT:return Di(Object.assign({},t));case I.INCREASE_PAID_STORAGE:return ki(Object.assign({},t));case I.TRANSFER_TICKET:return Mi(Object.assign({},t));case I.SMART_ROLLUP_ADD_MESSAGES:return Bi(Object.assign({},t));case I.SMART_ROLLUP_ORIGINATE:return Ui(Object.assign({},t));default:throw new Ar(JSON.stringify(t.kind))}})}with(t){for(const e of t)switch(e.kind){case I.TRANSACTION:this.withTransfer(e);break;case I.ORIGINATION:this.withOrigination(e);break;case I.DELEGATION:this.withDelegation(e);break;case I.ACTIVATION:this.withActivation(e);break;case I.REGISTER_GLOBAL_CONSTANT:this.withRegisterGlobalConstant(e);break;case I.INCREASE_PAID_STORAGE:this.withIncreasePaidStorage(e);break;case I.TRANSFER_TICKET:this.withTransferTicket(e);break;case I.SMART_ROLLUP_ADD_MESSAGES:this.withSmartRollupAddMessages(e);break;case I.SMART_ROLLUP_ORIGINATE:this.withSmartRollupOriginate(e);break;default:throw new Ar(JSON.stringify(e.kind))}return this}send(t){return A(this,void 0,void 0,function*(){const e=yield this.signer.publicKeyHash(),n=t&&t.source||e,i=yield this.estimator.batch(this.operations);i.length!==this.operations.length&&i.shift();const s=yield this.prepare.batch(this.operations,i),o=yield this.forge(s),{hash:a,context:u,forgedBytes:p,opResponse:f}=yield this.signAndInject(o);return new Al(a,s.opOb.contents,n,p,f,u)})}}class ly{constructor(t,e){this.context=t,this.estimator=e}batch(t){const e=new $o(this.context,this.estimator);return Array.isArray(t)&&e.with(t),e}}class hy extends Hr{constructor(t,e,n){super(t,e,n),this.opHash=t,this.context=e,this.getOriginatedContractAddresses=()=>A(this,void 0,void 0,function*(){const s=(yield this.operationResults()).filter(a=>a.kind==="origination");let o=[];for(const a of s)a.metadata.operation_result.originated_contracts&&(o=[...o,...a.metadata.operation_result.originated_contracts]);return o})}revealOperation(){return A(this,void 0,void 0,function*(){return(yield this.operationResults()).find(e=>e.kind===I.REVEAL)})}status(){return A(this,void 0,void 0,function*(){return this._included?(yield this.operationResults()).filter(e=>Cl.indexOf(e.kind)!==-1).map(e=>un(e)?e.metadata.operation_result.status:"unknown")[0]||"unknown":"pending"})}}class dy extends Hr{constructor(t,e,n){super(t,e,n),this.opHash=t,this.context=e}revealOperation(){return A(this,void 0,void 0,function*(){return(yield this.operationResults()).find(e=>e.kind===I.REVEAL)})}increasePaidStorageOperation(){return A(this,void 0,void 0,function*(){return(yield this.operationResults()).find(e=>e.kind===I.INCREASE_PAID_STORAGE)})}status(){return A(this,void 0,void 0,function*(){if(!this._included)return"pending";const t=yield this.increasePaidStorageOperation();return t?t.metadata.operation_result.status:"unknown"})}}function py(r){return function(e){return new Oi(null).pipe(Au(r,to(new Error("Confirmation polling timed out"))),Ti(()=>e))}}const fy=(r,t,e)=>r.pipe(py(t.config.confirmationPollingTimeoutSecond*1e3),Ss(1),wn());class gy{constructor(t){this.context=t,this.sharedHeadObs=Eu(()=>ol(this.context.stream.subscribeBlock("head")))}createNewHeadObservable(){return A(this,void 0,void 0,function*(){return fy(this.sharedHeadObs,this.context)})}createPastBlockWalker(t,e=1){return Br(this.context.readProvider.getBlock(t)).pipe(ke(n=>e===1?an(n):ro(n.header.level,e-1).pipe(df(n),Cn(i=>A(this,void 0,void 0,function*(){return this.context.readProvider.getBlock(typeof i=="number"?i:i.header.level)})))))}createHeadObservableFromConfig({blockIdentifier:t}){return A(this,void 0,void 0,function*(){const e=[];return t&&e.push(this.createPastBlockWalker(t)),e.push(yield this.createNewHeadObservable()),hi(...e)})}createOperation(t,e={}){return A(this,void 0,void 0,function*(){return new Hr(t,this.context.clone(),yield this.createHeadObservableFromConfig(e))})}createBatchOperation(t,e={}){return A(this,void 0,void 0,function*(){return new hy(t,this.context.clone(),yield this.createHeadObservableFromConfig(e))})}createTransactionOperation(t,e={}){return A(this,void 0,void 0,function*(){return new Rl(t,this.context.clone(),yield this.createHeadObservableFromConfig(e))})}createDelegationOperation(t,e={}){return A(this,void 0,void 0,function*(){return new Pl(t,this.context.clone(),yield this.createHeadObservableFromConfig(e))})}createOriginationOperation(t,e={}){return A(this,void 0,void 0,function*(){return new Ol(t,this.context.clone(),yield this.createHeadObservableFromConfig(e))})}createIncreasePaidStorageOperation(t,e={}){return A(this,void 0,void 0,function*(){return new dy(t,this.context.clone(),yield this.createHeadObservableFromConfig(e))})}}class my extends Dn{constructor(t){super(t),this.prepare=new ln(this.context)}getBalance(t){return A(this,void 0,void 0,function*(){const e=rt(t);if(e!==k.VALID)throw new at(t,V(e));return this.context.readProvider.getBalance(t,"head")})}getDelegate(t){return A(this,void 0,void 0,function*(){const e=rt(t);if(e!==k.VALID)throw new at(t,V(e));return this.context.readProvider.getDelegate(t,"head")})}activate(t,e){return A(this,void 0,void 0,function*(){const n=Ws(t);if(n!==k.VALID)throw new qs(t,V(n));const i=yield this.prepare.activate({pkh:t,secret:e}),s=yield this.forge(i),o=`${s.opbytes}00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000`;return new Kt(yield this.rpc.injectOperation(o),Object.assign(Object.assign({},s),{opbytes:o}),[],this.context.clone())})}}class Bs extends Kt{constructor(t,e,n,i,s,o){super(t,i,s,o),this.params=e,this.source=n}get operationResults(){const t=Array.isArray(this.results)&&this.results.find(n=>n.kind==="delegation"),e=t&&t.metadata&&t.metadata.operation_result;return e||void 0}get status(){var t,e;return(e=(t=this.operationResults)===null||t===void 0?void 0:t.status)!==null&&e!==void 0?e:"unknown"}get delegate(){return this.params.delegate}get isRegisterOperation(){return this.delegate===this.source}get fee(){return Number(this.params.fee)}get gasLimit(){return Number(this.params.gas_limit)}get storageLimit(){return Number(this.params.storage_limit)}get consumedGas(){return U.config({DECIMAL_PLACES:0,ROUNDING_MODE:U.ROUND_UP}),this.consumedMilliGas?new U(this.consumedMilliGas).dividedBy(1e3).toString():void 0}get consumedMilliGas(){var t;return(t=this.operationResults)===null||t===void 0?void 0:t.consumed_milligas}get errors(){var t;return(t=this.operationResults)===null||t===void 0?void 0:t.errors}}class Dl extends Kt{constructor(t,e,n,i,s,o){super(t,n,i,s),this.params=e,this.contractProvider=o;const a=this.operationResults&&this.operationResults.originated_contracts;Array.isArray(a)&&(this.contractAddress=a[0])}get status(){var t,e;return(e=(t=this.operationResults)===null||t===void 0?void 0:t.status)!==null&&e!==void 0?e:"unknown"}get operationResults(){const t=Array.isArray(this.results)&&this.results.find(n=>n.kind==="origination"),e=t&&un(t)&&t.metadata.operation_result;return e||void 0}get fee(){return Number(this.params.fee)}get gasLimit(){return Number(this.params.gas_limit)}get storageLimit(){return Number(this.params.storage_limit)}get consumedGas(){return U.config({DECIMAL_PLACES:0,ROUNDING_MODE:U.ROUND_UP}),this.consumedMilliGas?new U(this.consumedMilliGas).dividedBy(1e3).toString():void 0}get consumedMilliGas(){var t;return(t=this.operationResults)===null||t===void 0?void 0:t.consumed_milligas}get storageDiff(){const t=this.operationResults&&this.operationResults.paid_storage_size_diff;return t||void 0}get storageSize(){const t=this.operationResults&&this.operationResults.storage_size;return t||void 0}get errors(){var t;return(t=this.operationResults)===null||t===void 0?void 0:t.errors}contract(t,e){return A(this,void 0,void 0,function*(){if(!this.contractAddress)throw new V0("No contract was originated in this operation");return yield this.confirmation(t,e),this.contractProvider.at(this.contractAddress)})}}class yy extends Kt{constructor(t,e,n,i,s,o){super(t,i,s,o),this.params=e,this.source=n,this.globalConstantHash=this.operationResults&&this.operationResults.global_address}get operationResults(){const t=Array.isArray(this.results)&&this.results.find(n=>n.kind==="register_global_constant"),e=t&&t.metadata&&t.metadata.operation_result;return e||void 0}get status(){var t,e;return(e=(t=this.operationResults)===null||t===void 0?void 0:t.status)!==null&&e!==void 0?e:"unknown"}get registeredExpression(){return this.params.value}get fee(){return Number(this.params.fee)}get gasLimit(){return Number(this.params.gas_limit)}get storageLimit(){return Number(this.params.storage_limit)}get errors(){var t;return(t=this.operationResults)===null||t===void 0?void 0:t.errors}get consumedGas(){return U.config({DECIMAL_PLACES:0,ROUNDING_MODE:U.ROUND_UP}),this.consumedMilliGas?new U(this.consumedMilliGas).dividedBy(1e3).toString():void 0}get consumedMilliGas(){var t;return(t=this.operationResults)===null||t===void 0?void 0:t.consumed_milligas}}class by extends Kt{constructor(t,e,n,i,s,o){super(t,i,s,o),this.params=e,this.source=n}get operationResults(){const t=Array.isArray(this.results)&&this.results.find(e=>e.kind==="reveal");return t?[t]:[]}get status(){const e=this.operationResults[0];return e?e.metadata.operation_result.status:"unknown"}get fee(){return Number(this.params.fee)}get gasLimit(){return Number(this.params.gas_limit)}get storageLimit(){return Number(this.params.storage_limit)}get publicKey(){return this.params.public_key}sumProp(t,e){return t.reduce((n,i)=>e in i?Number(i[e])+n:n,0)}get consumedGas(){return U.config({DECIMAL_PLACES:0,ROUNDING_MODE:U.ROUND_UP}),new U(this.consumedMilliGas).dividedBy(1e3).toString()}get consumedMilliGas(){return String(this.sumProp(Ue({contents:this.operationResults}),"consumed_milligas"))}get storageDiff(){return String(this.sumProp(Ue({contents:this.operationResults}),"paid_storage_size_diff"))}get storageSize(){return String(this.sumProp(Ue({contents:this.operationResults}),"storage_size"))}get errors(){return sn({contents:this.operationResults})}}class Ml extends Kt{constructor(t,e,n,i,s,o){super(t,i,s,o),this.params=e,this.source=n}get operationResults(){const t=Array.isArray(this.results)&&this.results.find(e=>e.kind==="transaction");return t?[t]:[]}get status(){const e=this.operationResults[0];return e?e.metadata.operation_result.status:"unknown"}get amount(){return new U(this.params.amount)}get destination(){return this.params.destination}get fee(){return Number(this.params.fee)}get gasLimit(){return Number(this.params.gas_limit)}get storageLimit(){return Number(this.params.storage_limit)}sumProp(t,e){return t.reduce((n,i)=>e in i?Number(i[e])+n:n,0)}get consumedGas(){return U.config({DECIMAL_PLACES:0,ROUNDING_MODE:U.ROUND_UP}),new U(this.consumedMilliGas).dividedBy(1e3).toString()}get consumedMilliGas(){return String(this.sumProp(Ue({contents:this.operationResults}),"consumed_milligas"))}get storageDiff(){return String(this.sumProp(Ue({contents:this.operationResults}),"paid_storage_size_diff"))}get storageSize(){return String(this.sumProp(Ue({contents:this.operationResults}),"storage_size"))}get errors(){return sn({contents:this.operationResults})}}class kl{constructor(t,e,n){this.id=t,this.schema=e,this.provider=n}get(t,e){return A(this,void 0,void 0,function*(){try{return yield this.provider.getBigMapKeyByID(this.id.toString(),t,this.schema,e)}catch(n){if(n instanceof on&&n.status===vn.NOT_FOUND)return;throw n}})}getMultipleValues(t,e,n=5){return A(this,void 0,void 0,function*(){return this.provider.getBigMapKeysByID(this.id.toString(),t,this.schema,e,n)})}toJSON(){return this.id.toString()}toString(){return this.id.toString()}}const mc=r=>({big_map:(t,e)=>{if(!t||!("int"in t)||t.int===void 0)return{};{const n=new ne(e);return new kl(new U(t.int),n,r)}},sapling_state:t=>!t||!("int"in t)||t.int===void 0?{}:new xl(new U(t.int),r)});class Bl extends Kt{constructor(t,e,n,i,s,o){super(t,i,s,o),this.params=e,this.source=n}get operationResults(){const e=Array.isArray(this.results)&&this.results.find(n=>n.kind==="ballot");return e||void 0}get period(){var t;return(t=this.operationResults)===null||t===void 0?void 0:t.period}get proposal(){return this.params.proposal}get ballot(){return this.params.ballot}}class Ul extends Kt{constructor(t,e,n,i,s){super(t,n,i,s),this.params=e}get operationResults(){const t=Array.isArray(this.results)&&this.results.find(n=>n.kind==="drain_delegate"),e=t&&t.metadata&&t.metadata.balance_updates;return e||void 0}get consensusKey(){return this.params.consensus_key}get delegate(){return this.params.delegate}get destination(){return this.params.destination}}class Ey extends Kt{constructor(t,e,n,i,s,o){super(t,i,s,o),this.params=e,this.source=n}get operationResults(){const t=Array.isArray(this.results)&&this.results.find(n=>n.kind===I.TRANSFER_TICKET),e=t&&t.metadata&&t.metadata.operation_result;return e||void 0}get status(){var t,e;return(e=(t=this.operationResults)===null||t===void 0?void 0:t.status)!==null&&e!==void 0?e:"unknown"}get fee(){return Number(this.params.fee)}get gasLimit(){return Number(this.params.gas_limit)}get storageLimit(){return Number(this.params.storage_limit)}get consumedGas(){return U.config({DECIMAL_PLACES:0,ROUNDING_MODE:U.ROUND_UP}),this.consumedMilliGas?new U(this.consumedMilliGas).dividedBy(1e3).toString():void 0}get consumedMilliGas(){var t;return(t=this.operationResults)===null||t===void 0?void 0:t.consumed_milligas}}class vy extends Kt{constructor(t,e,n,i,s,o){super(t,i,s,o),this.params=e,this.source=n}get operationResults(){const t=Array.isArray(this.results)&&this.results.find(n=>n.kind==="increase_paid_storage"),e=t&&t.metadata&&t.metadata.operation_result;return e||void 0}get status(){var t,e;return(e=(t=this.operationResults)===null||t===void 0?void 0:t.status)!==null&&e!==void 0?e:"unknown"}get fee(){return Number(this.params.fee)}get gasLimit(){return Number(this.params.gas_limit)}get storageLimit(){return Number(this.params.storage_limit)}get errors(){var t;return(t=this.operationResults)===null||t===void 0?void 0:t.errors}get consumedMilliGas(){var t;return(t=this.operationResults)===null||t===void 0?void 0:t.consumed_milligas}get amount(){return this.params.amount}get destination(){return this.params.destination}}class wy extends Kt{constructor(t,e,n,i,s,o){super(t,i,s,o),this.params=e,this.source=n}get operationResults(){const e=Array.isArray(this.results)&&this.results.find(n=>n.kind==="proposals");return e||void 0}get proposals(){return this.params.proposals}get period(){var t;return(t=this.operationResults)===null||t===void 0?void 0:t.period}}class _y extends Kt{constructor(t,e,n,i,s,o){super(t,i,s,o),this.params=e,this.source=n}get operationResults(){const t=Array.isArray(this.results)&&this.results.find(n=>n.kind==="update_consensus_key"),e=t&&t.metadata&&t.metadata.operation_result;return e||void 0}get status(){var t,e;return(e=(t=this.operationResults)===null||t===void 0?void 0:t.status)!==null&&e!==void 0?e:"unknown"}get fee(){return Number(this.params.fee)}get gasLimit(){return Number(this.params.gas_limit)}get storageLimit(){return Number(this.params.storage_limit)}get pk(){return this.params.pk}get consumedMilliGas(){var t;return(t=this.operationResults)===null||t===void 0?void 0:t.consumed_milligas}get errors(){var t;return(t=this.operationResults)===null||t===void 0?void 0:t.errors}}class Ay extends Kt{constructor(t,e,n,i,s,o){super(t,i,s,o),this.params=e,this.source=n}get operationResults(){const t=Array.isArray(this.results)&&this.results.find(n=>n.kind==="smart_rollup_add_messages"),e=t&&t.metadata&&t.metadata.operation_result;return e||void 0}get status(){var t,e;return(e=(t=this.operationResults)===null||t===void 0?void 0:t.status)!==null&&e!==void 0?e:"unknown"}get message(){return this.params.message}get fee(){return Number(this.params.fee)}get gasLimit(){return Number(this.params.gas_limit)}get storageLimit(){return Number(this.params.storage_limit)}get consumedMilliGas(){var t;return(t=this.operationResults)===null||t===void 0?void 0:t.consumed_milligas}get errors(){var t;return(t=this.operationResults)===null||t===void 0?void 0:t.errors}}class Sy extends Kt{constructor(t,e,n,i,s,o){super(t,i,s,o),this.params=e,this.source=n}get operationResults(){const t=Array.isArray(this.results)&&this.results.find(n=>n.kind===I.SMART_ROLLUP_ORIGINATE),e=t&&t.metadata&&t.metadata.operation_result;return e||void 0}get status(){var t,e;return(e=(t=this.operationResults)===null||t===void 0?void 0:t.status)!==null&&e!==void 0?e:"unknown"}get fee(){return Number(this.params.fee)}get gasLimit(){return Number(this.params.gas_limit)}get storageLimit(){return Number(this.params.storage_limit)}get consumedMilliGas(){var t;return(t=this.operationResults)===null||t===void 0?void 0:t.consumed_milligas}get pvmKind(){return this.params.pvm_kind}get kernel(){return this.params.kernel}get originationProof(){return this.params.origination_proof}get errors(){var t;return(t=this.operationResults)===null||t===void 0?void 0:t.errors}}class Ry extends Dn{constructor(t,e){super(t),this.estimator=e,this.contractProviderTypeSymbol=Symbol.for("taquito-contract-provider-type-symbol"),this.prepare=new ln(this.context)}getStorage(t,e){return A(this,void 0,void 0,function*(){const n=Wr(t);if(n!==k.VALID)throw new Dr(t,V(n));const i=yield this.context.readProvider.getScript(t,"head");e||(e=i);let s;return ne.isSchema(e)?s=e:s=ne.fromRPCResponse({script:e}),s.Execute(i.storage,mc(this))})}getBigMapKey(t,e,n){return A(this,void 0,void 0,function*(){const i=Wr(t);if(i!==k.VALID)throw new Dr(t,V(i));n||(n=(yield this.rpc.getContract(t)).script);let s;ne.isSchema(n)?s=n:s=ne.fromRPCResponse({script:n});const o=s.EncodeBigMapKey(e),a=yield this.rpc.getBigMapKey(t,o);return s.ExecuteOnBigMapValue(a)})}getBigMapKeyByID(t,e,n,i){return A(this,void 0,void 0,function*(){const{key:s,type:o}=n.EncodeBigMapKey(e),{packed:a}=yield this.context.packer.packData({data:s,type:o}),u=jd(a),p=i?yield this.context.readProvider.getBigMapValue({id:t.toString(),expr:u},i):yield this.context.readProvider.getBigMapValue({id:t.toString(),expr:u},"head");return n.ExecuteOnBigMapValue(p,mc(this))})}getBigMapKeysByID(t,e,n,i,s=5){return A(this,void 0,void 0,function*(){const o=yield this.getBlockForRequest(e,i),a=new Xt;let u=0,p=[];for(;u<e.length;){const m=e.slice(u,u+s).map(N=>this.getBigMapValueOrUndefined(N,t,n,o));p=[...p,...yield Promise.all(m)],u+=s}for(let f=0;f<p.length;f++)a.set(e[f],p[f]);return a})}getBlockForRequest(t,e){return A(this,void 0,void 0,function*(){return t.length===1||typeof e<"u"?e:yield this.context.readProvider.getBlockLevel("head")})}getBigMapValueOrUndefined(t,e,n,i){return A(this,void 0,void 0,function*(){try{return yield this.getBigMapKeyByID(e,t,n,i)}catch(s){if(s instanceof on&&s.status===vn.NOT_FOUND)return;throw s}})}getSaplingDiffByID(t,e){return A(this,void 0,void 0,function*(){return e?yield this.context.readProvider.getSaplingDiffById({id:t.toString()},e):yield this.context.readProvider.getSaplingDiffById({id:t.toString()},"head")})}originate(t){return A(this,void 0,void 0,function*(){const e=yield this.estimate(t,this.estimator.originate.bind(this.estimator)),n=yield this.prepare.originate(Object.assign(Object.assign({},t),e)),i=n.opOb.contents.find(f=>f.kind===I.ORIGINATION),s=yield this.forge(n),{hash:o,context:a,forgedBytes:u,opResponse:p}=yield this.signAndInject(s);return new Dl(o,i,u,p,a,this)})}setDelegate(t){var e;return A(this,void 0,void 0,function*(){const n=rt(t.source);if(t.source&&n!==k.VALID)throw new at(t.source,V(n));const i=rt((e=t.delegate)!==null&&e!==void 0?e:"");if(t.delegate&&i!==k.VALID)throw new at(t.delegate,V(i));if(/kt1/i.test(t.source))throw new cl(t.source);const s=yield this.signer.publicKeyHash(),o=t.source||s,a=yield this.estimate(t,this.estimator.setDelegate.bind(this.estimator)),u=yield this.prepare.delegation(Object.assign(Object.assign({},t),a)),p=u.opOb.contents.find(B=>B.kind===I.DELEGATION),f=yield this.forge(u),{hash:m,context:N,forgedBytes:T,opResponse:x}=yield this.signAndInject(f);return new Bs(m,p,o,T,x,N)})}registerDelegate(t){return A(this,void 0,void 0,function*(){const e=yield this.estimate(t,this.estimator.registerDelegate.bind(this.estimator)),n=yield this.signer.publicKeyHash(),i=yield this.prepare.registerDelegate(Object.assign(Object.assign({},t),e)),s=i.opOb.contents.find(m=>m.kind===I.DELEGATION),o=yield this.forge(i),{hash:a,context:u,forgedBytes:p,opResponse:f}=yield this.signAndInject(o);return new Bs(a,s,n,p,f,u)})}transfer(t){var e;return A(this,void 0,void 0,function*(){const n=rt(t.to);if(n!==k.VALID)throw new at(t.to,V(n));const i=rt((e=t.source)!==null&&e!==void 0?e:"");if(t.source&&i!==k.VALID)throw new at(t.source,V(i));const s=yield this.signer.publicKeyHash(),o=yield this.estimate(t,this.estimator.transfer.bind(this.estimator)),a=t.source||s,u=yield this.prepare.transaction(Object.assign(Object.assign({},t),o)),p=u.opOb.contents.find(B=>B.kind===I.TRANSACTION),f=yield this.forge(u),{hash:m,context:N,forgedBytes:T,opResponse:x}=yield this.signAndInject(f);return new Ml(m,p,a,T,x,N)})}transferTicket(t){var e,n;return A(this,void 0,void 0,function*(){const i=rt(t.destination);if(i!==k.VALID)throw new at(t.destination,V(i));const s=rt((e=t.source)!==null&&e!==void 0?e:"");if(t.source&&s!==k.VALID)throw new at(t.source,V(s));const o=yield this.signer.publicKeyHash(),a=(n=t.source)!==null&&n!==void 0?n:o,u=yield this.estimate(t,this.estimator.transferTicket.bind(this.estimator)),p=yield this.prepare.transferTicket(Object.assign(Object.assign({},t),u)),f=p.opOb.contents.find(C=>C.kind===I.TRANSFER_TICKET),m=yield this.forge(p),{hash:N,context:T,forgedBytes:x,opResponse:B}=yield this.signAndInject(m);return new Ey(N,f,a,x,B,T)})}reveal(t){return A(this,void 0,void 0,function*(){const e=yield this.signer.publicKeyHash(),n=yield this.estimator.reveal(t);if(n){const i=yield this.estimate(t,()=>A(this,void 0,void 0,function*(){return n})),s=yield this.prepare.reveal(Object.assign(Object.assign({},t),i)),o=s.opOb.contents.find(N=>N.kind===I.REVEAL),a=yield this.forge(s),{hash:u,context:p,forgedBytes:f,opResponse:m}=yield this.signAndInject(a);return new by(u,o,e,f,m,p)}else throw new hl(`The publicKeyHash '${e}' has already been revealed.`)})}registerGlobalConstant(t){return A(this,void 0,void 0,function*(){const e=yield this.signer.publicKeyHash(),n=yield this.estimate(t,this.estimator.registerGlobalConstant.bind(this.estimator)),i=yield this.prepare.registerGlobalConstant(Object.assign(Object.assign({},t),n)),s=i.opOb.contents.find(m=>m.kind===I.REGISTER_GLOBAL_CONSTANT),o=yield this.forge(i),{hash:a,context:u,forgedBytes:p,opResponse:f}=yield this.signAndInject(o);return new yy(a,s,e,p,f,u)})}increasePaidStorage(t){return A(this,void 0,void 0,function*(){const e=yield this.signer.publicKeyHash(),n=yield this.estimate(t,this.estimator.increasePaidStorage.bind(this.estimator)),i=yield this.prepare.increasePaidStorage(Object.assign(Object.assign({},t),n)),s=i.opOb.contents.find(m=>m.kind===I.INCREASE_PAID_STORAGE),o=yield this.forge(i),{hash:a,context:u,forgedBytes:p,opResponse:f}=yield this.signAndInject(o);return new vy(a,s,e,p,f,u)})}drainDelegate(t){return A(this,void 0,void 0,function*(){const e=yield this.prepare.drainDelegate(t),n=e.opOb.contents.find(p=>p.kind===I.DRAIN_DELEGATE),i=yield this.forge(e),{hash:s,context:o,forgedBytes:a,opResponse:u}=yield this.signAndInject(i);return new Ul(s,n,a,u,o)})}ballot(t){var e,n;return A(this,void 0,void 0,function*(){const i=yield this.signer.publicKeyHash(),s=rt((e=t.source)!==null&&e!==void 0?e:"");if(t.source&&s!==k.VALID)throw new at(t.source,V(s));const o=(n=t.source)!==null&&n!==void 0?n:i,a=yield this.prepare.ballot(Object.assign(Object.assign({},t),{source:o})),u=a.opOb.contents.find(x=>x.kind===I.BALLOT),p=yield this.forge(a),{hash:f,context:m,forgedBytes:N,opResponse:T}=yield this.signAndInject(p);return new Bl(f,u,i,N,T,m)})}proposals(t){var e,n;return A(this,void 0,void 0,function*(){const i=yield this.signer.publicKeyHash(),s=rt((e=t.source)!==null&&e!==void 0?e:"");if(t.source&&s!==k.VALID)throw new at(t.source,V(s));const o=(n=t.source)!==null&&n!==void 0?n:i,a=yield this.prepare.proposals(Object.assign(Object.assign({},t),{source:o})),u=a.opOb.contents.find(x=>x.kind===I.PROPOSALS),p=yield this.forge(a),{hash:f,context:m,forgedBytes:N,opResponse:T}=yield this.signAndInject(p);return new wy(f,u,i,N,T,m)})}updateConsensusKey(t){return A(this,void 0,void 0,function*(){const e=yield this.signer.publicKeyHash(),n=yield this.estimate(t,this.estimator.updateConsensusKey.bind(this.estimator)),i=yield this.prepare.updateConsensusKey(Object.assign(Object.assign({},t),n)),s=i.opOb.contents.find(m=>m.kind===I.UPDATE_CONSENSUS_KEY),o=yield this.forge(i),{hash:a,context:u,forgedBytes:p,opResponse:f}=yield this.signAndInject(o);return new _y(a,s,e,p,f,u)})}smartRollupAddMessages(t){return A(this,void 0,void 0,function*(){const e=yield this.signer.publicKeyHash(),n=yield this.estimate(t,this.estimator.smartRollupAddMessages.bind(this.estimator)),i=yield this.prepare.smartRollupAddMessages(Object.assign(Object.assign({},t),n)),s=i.opOb.contents.find(m=>m.kind===I.SMART_ROLLUP_ADD_MESSAGES),o=yield this.forge(i),{hash:a,context:u,forgedBytes:p,opResponse:f}=yield this.signAndInject(o);return new Ay(a,s,e,p,f,u)})}smartRollupOriginate(t){return A(this,void 0,void 0,function*(){const e=yield this.signer.publicKeyHash(),n=yield this.estimate(t,this.estimator.smartRollupOriginate.bind(this.estimator)),i=yield this.rpc.getOriginationProof({kind:t.pvmKind,kernel:t.kernel}),s=Object.assign(Object.assign({},t),{originationProof:i}),o=yield this.prepare.smartRollupOriginate(Object.assign(Object.assign({},s),n)),a=o.opOb.contents.find(T=>T.kind===I.SMART_ROLLUP_ORIGINATE),u=yield this.forge(o),{hash:p,context:f,forgedBytes:m,opResponse:N}=yield this.signAndInject(u);return new Sy(p,a,e,m,N,f)})}at(t,e=n=>n){return A(this,void 0,void 0,function*(){const n=Wr(t);if(n!==k.VALID)throw new Dr(t,V(n));const i=this.context.withExtensions().rpc,s=this.context.withExtensions().readProvider,o=yield s.getScript(t,"head"),a=yield s.getEntrypoints(t),u=new Ho(t,o,this,this,a,i,s);return e(u,this.context)})}batch(t){const e=new $o(this.context,this.estimator);return Array.isArray(t)&&e.with(t),e}}class jo{constructor(t){this.context=t}getNextProto(){return A(this,void 0,void 0,function*(){if(!this.context.proto){const t=yield this.context.readProvider.getNextProtocol("head");this.context.proto=t}return this.context.proto})}parseScript(t){return A(this,void 0,void 0,function*(){return new Lr({protocol:yield this.getNextProto()}).parseScript(t)})}parseMichelineExpression(t){return A(this,void 0,void 0,function*(){return new Lr({protocol:yield this.getNextProto()}).parseMichelineExpression(t)})}parseJSON(t){return A(this,void 0,void 0,function*(){return new Lr({protocol:yield this.getNextProto()}).parseJSON(t)})}prepareCodeOrigination(t){return A(this,void 0,void 0,function*(){const e=t;if(e.code=yield this.formatCodeParam(t.code),t.init)e.init=yield this.formatInitParam(t.init);else if(t.storage){const n=e.code.find(o=>"prim"in o&&o.prim==="storage");if(!(n!=null&&n.args))throw new Rn("The storage section is missing from the script",t.code);const i=new ne(n.args[0]),s=yield this.findGlobalConstantsHashAndValue(i);if(Object.keys(s).length!==0){const a=new Lr({expandGlobalConstant:s}).parseJSON(n.args[0]),u=new ne(a);e.init=u.Encode(t.storage)}else e.init=i.Encode(t.storage);delete e.storage}return e})}formatCodeParam(t){return A(this,void 0,void 0,function*(){let e;if(typeof t=="string"){const n=yield this.parseScript(t);if(n===null)throw new Rn("Invalid code parameter",t);e=n}else{const n=yield this.parseJSON(t),i=["parameter","storage","code"];e=n.sort((s,o)=>i.indexOf(s.prim)-i.indexOf(o.prim))}return e})}formatInitParam(t){return A(this,void 0,void 0,function*(){let e;if(typeof t=="string"){const n=yield this.parseMichelineExpression(t);if(n===null)throw new Mo("Invalid init parameter",t);e=n}else e=yield this.parseJSON(t);return e})}findGlobalConstantsHashAndValue(t){return A(this,void 0,void 0,function*(){const e=t.findToken("constant"),n={};if(e.length!==0)for(const i of e){const s=i.tokenVal.args;if(s){const o=s[0];if(o.string){const a=o.string,u=yield this.context.globalConstantsProvider.getGlobalConstantByHash(a);Object.assign(n,{[a]:u})}}}return n})}}class Vo{constructor(t){this.context=t}packData(t){return A(this,void 0,void 0,function*(){return this.context.rpc.packData(t)})}}class Hl extends Error{constructor(t){super(`Please load the value associated with the constant ${t} using the loadGlobalConstant method of the DefaultGlobalConstantsProvider.`),this.hash=t,this.name="GlobalConstantNotFound"}}class $l extends Error{constructor(){super("No global constants provider has been configured. Please configure one by calling setGlobalConstantsProvider({globalConstantsProvider}) on your TezosToolkit instance."),this.name="UnconfiguredGlobalConstantsProviderError"}}class jl{getGlobalConstantByHash(t){return A(this,void 0,void 0,function*(){throw new $l})}}class Go{constructor(t){this.rpc=t}getBalance(t,e){return A(this,void 0,void 0,function*(){return this.rpc.getBalance(t,{block:String(e)})})}getDelegate(t,e){return A(this,void 0,void 0,function*(){return this.rpc.getDelegate(t,{block:String(e)})})}getNextProtocol(t){return A(this,void 0,void 0,function*(){return(yield this.rpc.getProtocols({block:String(t)})).next_protocol})}getProtocolConstants(t){return A(this,void 0,void 0,function*(){const{time_between_blocks:e,minimal_block_delay:n,hard_gas_limit_per_operation:i,hard_gas_limit_per_block:s,hard_storage_limit_per_operation:o,cost_per_byte:a,tx_rollup_origination_size:u,smart_rollup_origination_size:p}=yield this.rpc.getConstants({block:String(t)});return{time_between_blocks:e,minimal_block_delay:n,hard_gas_limit_per_operation:i,hard_gas_limit_per_block:s,hard_storage_limit_per_operation:o,cost_per_byte:a,tx_rollup_origination_size:u,smart_rollup_origination_size:p}})}getScript(t,e){return A(this,void 0,void 0,function*(){const{script:n}=yield this.rpc.getContract(t,{block:String(e)});return n})}getStorage(t,e){return A(this,void 0,void 0,function*(){return this.rpc.getStorage(t,{block:String(e)})})}getBlockHash(t){return A(this,void 0,void 0,function*(){const{hash:e}=yield this.rpc.getBlockHeader({block:String(t)});return e})}getBlockLevel(t){return A(this,void 0,void 0,function*(){const{level:e}=yield this.rpc.getBlockHeader({block:String(t)});return e})}getCounter(t,e){return A(this,void 0,void 0,function*(){const{counter:n}=yield this.rpc.getContract(t,{block:String(e)});return n||"0"})}getBlockTimestamp(t){return A(this,void 0,void 0,function*(){const{timestamp:e}=yield this.rpc.getBlockHeader({block:String(t)});return e})}getBigMapValue(t,e){return A(this,void 0,void 0,function*(){return this.rpc.getBigMapExpr(t.id,t.expr,{block:String(e)})})}getSaplingDiffById(t,e){return A(this,void 0,void 0,function*(){return this.rpc.getSaplingDiffById(t.id,{block:String(e)})})}getSaplingDiffByContract(t,e){return A(this,void 0,void 0,function*(){return this.rpc.getSaplingDiffByContract(t,{block:String(e)})})}getEntrypoints(t){return A(this,void 0,void 0,function*(){return this.rpc.getEntrypoints(t)})}getChainId(){return A(this,void 0,void 0,function*(){return this.rpc.getChainId()})}isAccountRevealed(t,e){return A(this,void 0,void 0,function*(){const n=yield this.rpc.getManagerKey(t,{block:String(e)});return n&&typeof n=="object"?!!n.key:!!n})}getBlock(t){return A(this,void 0,void 0,function*(){return this.rpc.getBlock({block:String(t)})})}getLiveBlocks(t){return this.rpc.getLiveBlocks({block:String(t)})}}const Oy=(r,t)=>r.hash===t.opHash,Py=(r,t)=>{switch(r.kind){case"endorsement":return"metadata"in r&&r.metadata.delegate===t.source;case"activate_account":return"metadata"in r&&r.pkh===t.source;default:return"source"in r&&r.source===t.source}},Ty=(r,t)=>"kind"in r&&r.kind===t.kind,Iy=(r,t)=>{switch(r.kind){case"delegation":return r.delegate===t.destination;case"origination":if("metadata"in r&&"operation_result"in r.metadata&&"originated_contracts"in r.metadata.operation_result&&Array.isArray(r.metadata.operation_result.originated_contracts))return r.metadata.operation_result.originated_contracts.some(e=>e===t.destination);break;case"transaction":return r.destination===t.destination;default:return!1}},Ny=(r,t,e,n)=>!(r.kind!=="event"||e&&r.tag!==e||t&&r.source!==t||n&&r.result.status!=="applied"),xy=(r,t)=>"opHash"in t?Oy(r,t):"source"in t?Py(r,t):"kind"in t?Ty(r,t):"destination"in t?Iy(r,t):!1,Ly=(r,t)=>{if(Array.isArray(t.and))return t.and.every(e=>Us(r,e));if(Array.isArray(t.or))return t.or.some(e=>Us(r,e));throw new K0("Filter expression must contain either and/or property")},Us=(r,t)=>{const e=[];return Array.isArray(t)?e.push(...t):e.push(t),e.every(n=>"and"in n||"or"in n?Ly(r,n):xy(r,n))};class yc extends Error{constructor(t){super(t),this.message=t,this.name="UnsupportedEventError"}}class yn{constructor(t,e=!1,n=_u()){this.shouldRetry=e,this.operatorFunction=n,this.errorListeners=[],this.messageListeners=[],this.closeListeners=[],this.completed$=new Jr,t.pipe(gf(this.completed$),pi(i=>{this.call(this.messageListeners,i)},i=>{this.call(this.errorListeners,i)},()=>{this.call(this.closeListeners)}),this.shouldRetry?n:pi(),no(()=>Up)).subscribe()}call(t,e){for(const n of t)try{n(e)}catch(i){console.error(i)}}remove(t,e){const n=t.indexOf(e);n!==-1&&t.splice(n,1)}on(t,e){switch(t){case"data":this.messageListeners.push(e);break;case"error":this.errorListeners.push(e);break;case"close":this.closeListeners.push(e);break;default:throw new yc(`Trying to register on an unsupported event: ${t}`)}}off(t,e){switch(t){case"data":this.remove(this.messageListeners,e);break;case"error":this.remove(this.errorListeners,e);break;case"close":this.remove(this.closeListeners,e);break;default:throw new yc(`Trying to unregister on an unsupported event: ${t}`)}}close(){this.completed$.next()}}const Cy={shouldObservableSubscriptionRetry:!1,observableSubscriptionRetryFunction:_u()},Dy=r=>Br(r.rpc.getBlock()).pipe(er()),My=r=>Cn(t=>new gt(e=>{for(const n of t.operations)for(const i of n)for(const s of i.contents)Us(Object.assign({hash:i.hash},s),r)&&e.next(Object.assign({hash:i.hash},s));e.complete()})),ky=r=>Cn(t=>new gt(e=>{for(const n of t.operations)for(const i of n)for(const s of i.contents){const a=s.metadata.internal_operation_results;if(a)for(const u of a)Ny(u,r==null?void 0:r.address,r==null?void 0:r.tag,r==null?void 0:r.excludeFailedOperations)&&e.next(Object.assign({opHash:i.hash,blockHash:t.hash,level:t.header.level},u))}e.complete()}));class vi{constructor(t,e={}){this.context=t,this._config$=new Oi(Object.assign(Object.assign({},Cy),e)),this.timer$=this._config$.pipe(Ga("pollingIntervalMilliseconds"),ke(n=>n?Va(0,n):Br(this.getConfirmationPollingInterval()).pipe(ke(i=>Va(0,i))))),this.newBlock$=this.timer$.pipe(ke(()=>Dy(this.context)),Xp("hash"),cf(),wn())}get config(){return this._config$.getValue()}getConfirmationPollingInterval(){return A(this,void 0,void 0,function*(){if(!this.config.pollingIntervalMilliseconds)try{const n=yield this.context.readProvider.getProtocolConstants("head"),s=(n.minimal_block_delay?n.minimal_block_delay.multipliedBy(1e3):n.time_between_blocks?n.time_between_blocks[0].multipliedBy(1e3):new U(5e3)).dividedBy(3);this.config.pollingIntervalMilliseconds=s.toNumber()===0?1e3:s.toNumber()}catch{return 5e3}return this.config.pollingIntervalMilliseconds})}subscribeBlock(t){return new yn(this.newBlock$,this.config.shouldObservableSubscriptionRetry,this.config.observableSubscriptionRetryFunction)}subscribe(t){return new yn(this.newBlock$.pipe(Ga("hash")),this.config.shouldObservableSubscriptionRetry,this.config.observableSubscriptionRetryFunction)}subscribeOperation(t){return new yn(this.newBlock$.pipe(My(t)),this.config.shouldObservableSubscriptionRetry,this.config.observableSubscriptionRetryFunction)}subscribeEvent(t){return new yn(this.newBlock$.pipe(ky(t)),this.config.shouldObservableSubscriptionRetry,this.config.observableSubscriptionRetryFunction)}}class Ko{constructor(t){this.context=t}getNextProto(){return A(this,void 0,void 0,function*(){if(!this.context.proto){const t=yield this.context.readProvider.getNextProtocol("head");this.context.proto=t}return this.context.proto})}forge({branch:t,contents:e}){return A(this,void 0,void 0,function*(){return new sl(yield this.getNextProto()).forge({branch:t,contents:e})})}}const Vl={defaultConfirmationCount:1,confirmationPollingTimeoutSecond:180};class On{constructor(t,e=new Cs,n,i=new Oi(Object.assign({},Vl)),s,o,a,u,p,f,m,N){this._rpc=t,this._signer=e,this._proto=n,this._config=i,this.providerDecorator=[],this.tz=new my(this),this.estimate=new Ll(this),this.contract=new Ry(this,this.estimate),this.prepare=new ln(this),this.batch=new ly(this,this.estimate),this.wallet=new Mn(this),this.withExtensions=()=>{let T=this.clone();return this.providerDecorator.forEach(x=>{T=x(T)}),T},typeof this._rpc=="string"?this._rpcClient=new ei(this._rpc):this._rpcClient=this._rpc,this._forger=s||new Ko(this),this._injector=o||new k0(this),this.operationFactory=new gy(this),this._walletProvider=u||new Uo(this),this._parser=p||new jo(this),this._packer=a||new Vo(this),this._globalConstantsProvider=f||new jl,this._readProvider=m||new Go(this._rpcClient),this._stream=N||new vi(this)}get config(){return this._config.getValue()}set config(t){this._config.next(Object.assign({},t))}setPartialConfig(t){this._config.next(Object.assign(Object.assign({},this._config.getValue()),t))}get rpc(){return this._rpcClient}set rpc(t){this._rpcClient=t}get injector(){return this._injector}set injector(t){this._injector=t}get forger(){return this._forger}set forger(t){this._forger=t}get signer(){return this._signer}set signer(t){this._signer=t}get walletProvider(){return this._walletProvider}set walletProvider(t){this._walletProvider=t}set proto(t){this._proto=t}get proto(){return this._proto}get parser(){return this._parser}set parser(t){this._parser=t}get packer(){return this._packer}set packer(t){this._packer=t}get globalConstantsProvider(){return this._globalConstantsProvider}set globalConstantsProvider(t){this._globalConstantsProvider=t}get readProvider(){return this._readProvider}set readProvider(t){this._readProvider=t}get stream(){return this._stream}set stream(t){this._stream=t}isAnyProtocolActive(t=[]){return A(this,void 0,void 0,function*(){if(this._proto)return t.includes(this._proto);{const e=yield this.readProvider.getNextProtocol("head");return t.includes(e)}})}isAnySignerConfigured(){return!(this.signer instanceof Cs)}clone(){return new On(this.rpc,this.signer,this.proto,this._config,this.forger,this._injector,this.packer,this._walletProvider,this._parser,this._globalConstantsProvider,this._readProvider,this._stream)}registerProviderDecorator(t){this.providerDecorator.push(t)}}const By={commitHash:"adc0f8c31492e8eb2f03b06ac36ba053e8ba6224",version:"16.2.0"};class Uy extends Error{constructor(t){super("Forging mismatch error"),this.results=t,this.name="ForgingMismatchError"}}class bc extends Error{constructor(){super("At least one forger must be specified"),this.name="UnspecifiedForgerError"}}class Hy{constructor(t){if(this.forgers=t,t.length===0)throw new bc}forge({branch:t,contents:e}){return A(this,void 0,void 0,function*(){const n=yield Promise.all(this.forgers.map(s=>s.forge({branch:t,contents:e})));if(n.length===0)throw new bc;let i=n.pop();for(;n.length;){const s=n.pop();if(s!==i)throw new Uy([i,s]);i=s}return i})}}class $y{constructor(t){this.context=t}forge({branch:t,contents:e}){return this.context.rpc.forgeOperations({branch:t,contents:e})}}class jy{prepareCodeOrigination(t){return A(this,void 0,void 0,function*(){return t})}}class Vy{packData(t){return A(this,void 0,void 0,function*(){const{bytes:e}=Zg(t.data,t.type);return{packed:e}})}}class Gy{constructor(){this._globalConstantsLibrary={}}loadGlobalConstant(t){for(const e in t)Object.assign(this._globalConstantsLibrary,{[e]:t[e]})}getGlobalConstantByHash(t){return A(this,void 0,void 0,function*(){const e=this._globalConstantsLibrary[t];if(!e)throw new Hl(t);return e})}}class Ky{constructor(t){this._rpc=t,this._options={},this.format=Zs,typeof this._rpc=="string"?this._rpcClient=new ei(this._rpc):this._rpcClient=this._rpc,this._context=new On(t),this._wallet=new Mn(this._context),this.setProvider({rpc:this._rpcClient}),this.batch=this._context.batch.batch.bind(this._context.batch)}setProvider({rpc:t,stream:e,signer:n,protocol:i,config:s,forger:o,wallet:a,packer:u,globalConstantsProvider:p,readProvider:f,parserProvider:m}){this.setRpcProvider(t),this.setStreamProvider(e),this.setSignerProvider(n),this.setForgerProvider(o),this.setWalletProvider(a),this.setPackerProvider(u),this.setGlobalConstantsProvider(p),this.setReadProvider(f),this.setParserProvider(m),this._context.proto=i,s&&this._context.setPartialConfig(s)}setSignerProvider(t){!this._options.signer&&typeof t>"u"?(this._context.signer=new Cs,this._options.signer=t):typeof t<"u"&&(this._context.signer=t,this._options.signer=t)}setRpcProvider(t){typeof t=="string"?this._rpcClient=new ei(t):t===void 0||(this._rpcClient=t),this._options.rpc=this._rpcClient,this._context.rpc=this._rpcClient}setForgerProvider(t){if(typeof t<"u")this._options.forger=t,this._context.forger=t;else if(this._options.forger===void 0){const e=this.getFactory(Ko)();this._options.forger=e,this._context.forger=e}}setStreamProvider(t){if(typeof t=="string"){const e=new vi(new On(new ei(t)));this._options.stream=e,this._context.stream=e}else if(typeof t<"u")this._options.stream=t,this._context.stream=t;else if(this._options.stream===void 0){const e=this.getFactory(vi)();this._options.stream=e,this._context.stream=e}}setWalletProvider(t){if(!this._options.wallet&&typeof t>"u"){const e=this.getFactory(Uo)();this._options.wallet=e,this._context.walletProvider=e}else typeof t<"u"&&(this._options.wallet=t,this._context.walletProvider=t)}setPackerProvider(t){if(!this._options.packer&&typeof t>"u"){const e=this.getFactory(Vo)();this._context.packer=e,this._options.packer=e}else typeof t<"u"&&(this._context.packer=t,this._options.packer=t)}setGlobalConstantsProvider(t){if(!this._options.globalConstantsProvider&&typeof t>"u"){const e=new jl;this._context.globalConstantsProvider=e,this._options.globalConstantsProvider=e}else typeof t<"u"&&(this._context.globalConstantsProvider=t,this._options.globalConstantsProvider=t)}setReadProvider(t){const e=t||new Go(this._context.rpc);this._options.readProvider=e,this._context.readProvider=e}setParserProvider(t){if(!this._options.parserProvider&&typeof t>"u"){const e=new jo(this._context);this._context.parser=e,this._options.parserProvider=e}else typeof t<"u"&&(this._context.parser=t,this._options.parserProvider=t)}get tz(){return this._context.tz}get contract(){return this._context.contract}get prepare(){return this._context.prepare}get wallet(){return this._wallet}get operation(){return this._context.operationFactory}get estimate(){return this._context.estimate}get stream(){return this._context.stream}get rpc(){return this._context.rpc}get signer(){return this._context.signer}get globalConstants(){return this._context.globalConstantsProvider}addExtension(t){Array.isArray(t)?t.forEach(e=>e.configureContext(this._context)):t.configureContext(this._context)}getFactory(t){return(...e)=>new t(this._context,...e)}getVersionInfo(){return By}}const qy=Object.freeze(Object.defineProperty({__proto__:null,BallotOperation:Bl,BatchOperation:Al,BigMapAbstraction:kl,COST_PER_BYTE:al,get ChainIds(){return Ds},CompositeForger:Hy,Context:On,ContractAbstraction:Ho,ContractMethod:Il,ContractMethodObject:Tl,ContractView:Nl,get DEFAULT_FEE(){return je},get DEFAULT_GAS_LIMIT(){return $e},DEFAULT_SMART_CONTRACT_METHOD_NAME:Cr,get DEFAULT_STORAGE_LIMIT(){return Ve},DefaultGlobalConstantsProvider:Gy,DelegateOperation:Bs,DelegationWalletOperation:Pl,DrainDelegateOperation:Ul,Estimate:Dt,GlobalConstantNotFound:Hl,IntegerError:pl,InvalidCodeParameter:Rn,InvalidDelegationSource:cl,InvalidEstimateValueError:oi,InvalidInitParameter:Mo,InvalidParameterError:Do,InvalidViewSimulationContext:Ms,LegacyWalletProvider:Uo,MANAGER_LAMBDA:ry,MichelCodecPacker:Vy,MichelCodecParser:jo,MichelsonMap:Xt,NoopParser:jy,ObservableSubscription:yn,get OpKind(){return I},Operation:Kt,OperationBatch:$o,OriginationOperation:Dl,OriginationParameterError:dl,OriginationWalletOperation:Ol,PollingSubscribeProvider:vi,PrepareProvider:ln,get Protocols(){return Rt},RPCEstimateProvider:Ll,RevealEstimateError:Ei,RevealOperationError:hl,RpcForger:$y,RpcPacker:Vo,RpcReadAdapter:Go,SaplingStateAbstraction:xl,TaquitoLocalForger:Ko,TezosOperationError:Bo,TezosPreapplyFailureError:wl,TezosToolkit:Ky,TransactionOperation:Ml,TransactionWalletOperation:Rl,UnconfiguredGlobalConstantsProviderError:$l,UnitValue:Os,VIEW_LAMBDA:sy,ViewSimulationError:ul,Wallet:Mn,WalletOperation:Hr,WalletOperationBatch:Sl,compose:oy,createActivationOperation:fl,createBallotOperation:yl,createDrainDelegateOperation:ml,createIncreasePaidStorageOperation:ki,createOriginationOperation:xi,createProposalsOperation:bl,createRegisterDelegateOperation:gl,createRegisterGlobalConstantOperation:Di,createRevealOperation:si,createSetDelegateOperation:Ci,createSmartRollupAddMessagesOperation:Bi,createSmartRollupOriginateOperation:Ui,createTransferOperation:Li,createTransferTicketOperation:Mi,createUpdateConsensusKeyOperation:El,defaultConfigConfirmation:Vl,protocols:B0,validateAndExtractFailwith:ll},Symbol.toStringTag,{value:"Module"}));export{U as B,Xt as M,I as O,Ky as T,he as a,Li as b,zy as c,ki as d,ws as e,xi as f,Ci as g,qy as t};
